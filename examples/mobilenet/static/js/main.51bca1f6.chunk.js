(this.webpackJsonpstyle=this.webpackJsonpstyle||[]).push([[0],{29:function(e,t,n){},31:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"CPUTensor",(function(){return F}));var i={};n.r(i),n.d(i,"GPUTensor",(function(){return lt})),n.d(i,"gpuConstructor",(function(){return pt}));var r={};n.r(r),n.d(r,"tensorConstructor",(function(){return kt})),n.d(r,"wasmLoaded",(function(){return Sn})),n.d(r,"WASMTensor",(function(){return An}));var s={};n.r(s),n.d(s,"SparseTensor",(function(){return ea}));var o={};n.r(o),n.d(o,"cpu",(function(){return a})),n.d(o,"gpu",(function(){return i})),n.d(o,"wasm",(function(){return r})),n.d(o,"sparse",(function(){return s}));var u={};n.r(u),n.d(u,"OnnxModel",(function(){return gs}));var c={};n.r(c),n.d(c,"model",(function(){return u}));var h=n(9),l=n(14),p=n.n(l),f=n(21),d=n.n(f),v=(n(29),n(4)),m=n.n(v),y=n(12),w=n(8),b=n(17),g=n(0),k=n(1),x=n(3),O=n(2),j=(n(31),n(10)),S=n(7);function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e.length)return t;for(var n=1,a=0;a<e.length;a+=1)n*=e[a];return n}function M(e){var t=e.length;if(0===t)return[];if(1===t)return 1===e[0]?[0]:[1];var n=new Array(t);n[t-1]=1,1===e[t-1]&&(n[t-1]=0);for(var a=1,i=t-2;i>=0;i-=1)a=e[i+1]*a,1===e[i]?n[i]=0:n[i]=a;return n}function T(e,t,n){for(var a=0,i=0;i<e.length;i+=1){if(n&&(e[i]<0||e[i]>=n[i]&&1!==n[i]))throw new Error("Invalid index");a+=e[i]*t[i]}return a}function I(e,t){for(var n=e,a=t.length,i=new Array(a),r=0;r<i.length;r+=1)i[r]=Math.floor(n/t[r]),n%=t[r];return i}function C(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0}function V(e,t){for(var n=e.length-1;n>=0&&(e[n]+=1,e[n]>=t[n]);n--)e[n]=0}var P=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},D={float64:Float64Array,float32:Float32Array,float16:Float32Array,int32:Int32Array,int16:Int16Array,int8:Int8Array,uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},G=function(){function e(t){Object(g.a)(this,e),this.dtype=t}return Object(k.a)(e,[{key:"compare",value:function(e,t){return P(this,void 0,void 0,m.a.mark((function n(){var a,i,r,s;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(C(this.getShape(),e.getShape())){n.next=2;break}return n.abrupt("return",!1);case 2:return n.next=4,this.getValues();case 4:return a=n.sent,n.next=7,e.getValues();case 7:if(i=n.sent,void 0===t){n.next=18;break}r=0;case 10:if(!(r<a.length)){n.next=16;break}if(!(Math.abs(a[r]-i[r])>t)){n.next=13;break}return n.abrupt("return",!1);case 13:r+=1,n.next=10;break;case 16:n.next=25;break;case 18:s=0;case 19:if(!(s<a.length)){n.next=25;break}if(a[s]===i[s]){n.next=22;break}return n.abrupt("return",!1);case 22:s+=1,n.next=19;break;case 25:return n.abrupt("return",!0);case 26:case"end":return n.stop()}}),n,this)})))}},{key:"getAxes",value:function(e){var t,n=this.getShape();if(void 0===e){t=[];for(var a=0;a<n.length;a++)t.push(a)}else if(e instanceof Array){t=e;for(var i=0;i<t.length;i++)t[i]<0&&(t[i]+=this.getShape().length)}else t=[e];return t}},{key:"sum",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.sum_impl(n,t)}},{key:"sumSquare",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.sumSquare_impl(n,t)}},{key:"product",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.product_impl(n,t)}},{key:"max",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.max_impl(n,t)}},{key:"min",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.min_impl(n,t)}},{key:"reduceMean",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.reduceMean_impl(n,t)}},{key:"reduceLogSum",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.reduceLogSum_impl(n.sort(),t)}},{key:"reduceLogSumExp",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.reduceLogSumExp_impl(n,t)}},{key:"reduceMeanSquare",value:function(e,t){var n=this.getAxes(e);return t=t||!1,this.reduceMeanSquare_impl(n,t)}},{key:"conv",value:function(e,t,n,a,i,r,s){var o=this.getShape().length-2;return n=n||new Array(o).fill(1),a=a||1,i=i||new Array(2*o).fill(0),r=r||new Array(o).fill(1),void 0===s&&(s="id"),this.conv_impl(e,n,a,i,r,s,t)}},{key:"convTranspose",value:function(e,t,n,a,i){var r=this.getShape().length-2;return t=t||new Array(r).fill(1),n=n||1,a=a||new Array(2*r).fill(0),i=i||new Array(r).fill(1),this.convTranspose_impl(e,t,n,a,i)}},{key:"pad",value:function(e,t,n){return void 0===t&&(t="constant"),void 0===n&&(n=0),this.pad_impl(e,t,n)}},{key:"averagePool",value:function(e,t,n,a){var i=this.getShape().length-2;return t=t||new Array(2*i).fill(0),n=n||new Array(i).fill(1),a=a||!1,this.averagePool_impl(e,t,n,a)}},{key:"reshape",value:function(e,t){for(var n=1,a=-1,i=0;i<e.length;i++)-1===e[i]?a=i:n*=e[i];if(void 0===t&&(t=!0),-1!==a){var r=A(this.getShape()),s=Object(S.a)(e);return s[a]=r/n,this.reshape_impl(s,t)}return this.reshape_impl(e,t)}},{key:"alignShapes",value:function(e,t){if(C(e,t))return[e,t,e];if(e.length<t.length){var n;e=Object(S.a)(e);var a=t.length-e.length;(n=e).unshift.apply(n,Object(S.a)(new Array(a).fill(1)))}else if(t.length<e.length){var i;t=Object(S.a)(t);var r=e.length-t.length;(i=t).unshift.apply(i,Object(S.a)(new Array(r).fill(1)))}for(var s=new Array(e.length).fill(1),o=0;o<e.length;o++)s[o]=Math.max(e[o],t[o]);return[e,t,s]}},{key:"alignTensor",value:function(e){var t=this.getShape(),n=e.getShape();if(C(t,n))return[this,e,t];var a=this;if(t.length<n.length){var i;t=Object(S.a)(t);var r=n.length-t.length;(i=t).unshift.apply(i,Object(S.a)(new Array(r).fill(1))),a=this.reshape(t,!1)}else if(n.length<t.length){var s;n=Object(S.a)(n);var o=t.length-n.length;(s=n).unshift.apply(s,Object(S.a)(new Array(o).fill(1))),e=e.reshape(n,!1)}for(var u=new Array(t.length).fill(1),c=0;c<t.length;c++)u[c]=Math.max(t[c],n[c]);return[a,e,u]}},{key:"add",value:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=1);var a=this.alignTensor(e),i=Object(w.a)(a,3),r=i[0],s=i[1],o=i[2];return this.add_impl(r,s,o,t,n)}},{key:"subtract",value:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=1);var a=this.alignTensor(e),i=Object(w.a)(a,3),r=i[0],s=i[1],o=i[2];return this.subtract_impl(r,s,o,t,n)}},{key:"multiply",value:function(e,t){void 0===t&&(t=1);var n=this.alignTensor(e),a=Object(w.a)(n,3),i=a[0],r=a[1],s=a[2];return this.multiply_impl(i,r,s,t)}},{key:"multiplyScalar",value:function(e){return this.addMultiplyScalar(e,0)}},{key:"addScalar",value:function(e){return this.addMultiplyScalar(1,e)}},{key:"divide",value:function(e,t){void 0===t&&(t=1);var n=this.alignTensor(e),a=Object(w.a)(n,3),i=a[0],r=a[1],s=a[2];return this.divide_impl(i,r,s,t)}},{key:"power",value:function(e){var t=this.alignTensor(e),n=Object(w.a)(t,3),a=n[0],i=n[1],r=n[2];return this.power_impl(a,i,r)}},{key:"transpose",value:function(e){if(void 0===e){var t=this.getShape().length;e=[];for(var n=0;n<t;n++)e.push(t-n-1)}return this.transpose_impl(e)}},{key:"softmax",value:function(e){var t=this.max(e,!0),n=this.subtract(t),a=n.exp(),i=a.sum(e,!0),r=a.divide(i);return t.delete(),n.delete(),a.delete(),i.delete(),r}},{key:"gemm",value:function(e,t,n,a,i,r){if(t=t||!1,n=n||!1,a=void 0!==a?a:1,r=void 0!==r?r:1,void 0!==i){var s=this.getShape(),o=i.getShape(),u=s.length,c=o.length;u>c&&(o=[].concat(Object(S.a)(new Array(u-c).fill(1)),Object(S.a)(o)),i=i.reshape(o,!1))}return this.gemm_impl(e,t,n,a,r,i)}},{key:"slice",value:function(e,t,n,a){var i=this.getShape(),r=i.length;if(void 0===n){n=[];for(var s=0;s<r;s++)n.push(s)}else n=n.map((function(e){return e<0?e+r:e}));void 0===a&&(a=new Array(r).fill(1)),e=Object(S.a)(e),t=Object(S.a)(t);for(var o=0;o<n.length;o++){var u=i[n[o]];e[o]<0?e[o]+=u:e[o]>=u&&(a[o]>0?e[o]=u:e[o]=u-1),t[o]<0?t[o]+=u:t[o]>=u&&(t[o]=u)}return this.slice_impl(e,t,n,a)}},{key:"squeeze",value:function(){var e,t=this.getShape(),n=[],a=Object(j.a)(t);try{for(a.s();!(e=a.n()).done;){var i=e.value;1!==i&&n.push(i)}}catch(r){a.e(r)}finally{a.f()}return this.reshape(n)}},{key:"flatten",value:function(e){void 0===e&&(e=1);var t=this.getShape();e<0&&(e+=t.length);var n=[A(t.slice(0,e),1),A(t.slice(e),1)];return this.reshape(n)}}]),e}();function E(e,t,n,a,i,r){var s=i*(t-1)+1;return Math.floor((e+n+a-s)/r+1)}function R(e,t,n,a,i,r){for(var s=[],o=0;o<e.length;o++)s.push(E(e[o],t[o],n[o],a[o],i[o],r[o]));return s}function _(e,t){for(var n=new F(e.shape,void 0,e.dtype),a=0;a<n.size;a+=1)n.set(a,t(e.get(a)));return n}function X(e,t,n,a){if(!function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n+=1)if(e[n]!==t[n]&&1!==e[n]&&1!==t[n])return!1;return!0}(e.shape,t.shape))throw new Error("The shapes of the two tensors should be the same for a binary operation");for(var i=new F(a,void 0,e.dtype),r=new Array(a.length).fill(0),s=0;s<i.size;s+=1)i.set(r,n(e.get(r),t.get(r))),V(r,a);return i}function B(e,t,n){return _(e,(function(e){return e*t+n}))}function z(e,t,n,a,i,r){for(var s,o,u,c,h,l=[],p=0;p<e.length;p++)l.push((s=e[p],o=t[p],u=n[p],c=a[p],h=i[p],r[p]*(s-1)+u+c-(h*(o-1)+1)+2));return l}function U(e,t,n){for(var a=[],i=[],r=[],s=0;s<e.length;s++)t.includes(s)?(n&&(a.push(1),r.push(s)),i.push(e[s])):(a.push(e[s]),r.push(s));return 0===a.length&&a.push(1),[a,r]}function W(e,t,n,a,i){for(var r=e.getShape(),s=A(r),o=U(r,t,a),u=Object(w.a)(o,2),c=u[0],h=u[1],l=A(c),p=M(c),f=new F(c,void 0,e.dtype),d=new Array(l).fill(!1),v=new Array(r.length).fill(0),m=new Array(c.length).fill(0),y=0;y<s;y++){for(var b=0;b<h.length;b++)m[b]=v[h[b]];var g=T(m,p);d[g]?f.set(m,n(e.get(y),f.get(m))):(d[g]=!0,f.set(m,n(e.get(y)))),V(v,r)}if(i)for(var k=0;k<f.size;k++)f.set(k,i(f.get(k)));return f}function L(e,t,n,a,i){if(i)return e.get(t);var r=e.shape.length;if("constant"===n)return a;if("edge"===n)for(var s=0;s<r;s++)t[s]<0?t[s]=0:t[s]>=e.shape[s]&&(t[s]=e.shape[s]-1);else for(var o=0;o<r;o++)t[o]<0?t[o]=-t[o]:t[o]>=e.shape[o]&&(t[o]=2*e.shape[o]-t[o]-2);return e.get(t)}var F=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,i||"float32")).deleted=!1,r.shape=e,r.strides=M(e),r.size=A(e),r.values=void 0!==a?a instanceof Array?new D[r.dtype](a):a:new D[r.dtype](r.size),r}return Object(k.a)(n,[{key:"getValues",value:function(){return Promise.resolve(this.values)}},{key:"getShape",value:function(){return this.shape}},{key:"constantLike",value:function(e){return new n(this.shape,new D[this.dtype](this.size).fill(e),this.dtype)}},{key:"singleConstant",value:function(e){return new n([1],[e],this.dtype)}},{key:"cast",value:function(e){return new n(this.shape,Array.from(this.values),e)}},{key:"delete",value:function(){this.values=void 0,this.deleted=!0}},{key:"copy",value:function(e){void 0===e&&(e=Object(S.a)(this.shape));for(var t=new D[this.dtype](this.size),a=0;a<this.size;a++)t[a]=this.values[a];return new n(e,t,this.dtype)}},{key:"get",value:function(e){var t;return t=Array.isArray(e)?T(e,this.strides,this.shape):e,this.values[t]}},{key:"set",value:function(e,t){var n;n=Array.isArray(e)?T(e,this.strides):e,this.values[n]=t}},{key:"setValues",value:function(e,t){if(!(e instanceof n))throw new Error("Can only set CPU values to CPU values");return function(e,t,n){for(var a=new F(e.shape,void 0,e.dtype),i=new Array(e.shape.length).fill(0),r=0;r<a.size;r+=1){for(var s=!0,o=new Array(n.length).fill(0),u=0;u<n.length;u++){if(i[u]<n[u]||i[u]>=n[u]+t.shape[u]){s=!1;break}o[u]=i[u]-n[u]}s?a.set(r,t.get(o)):a.set(r,e.get(r)),V(i,e.shape)}return a}(this,e,t)}},{key:"exp",value:function(){return _(this,(function(e){return Math.exp(e)}))}},{key:"log",value:function(){return _(this,(function(e){return Math.log(e)}))}},{key:"sqrt",value:function(){return _(this,(function(e){return Math.sqrt(e)}))}},{key:"abs",value:function(){return _(this,(function(e){return Math.abs(e)}))}},{key:"sin",value:function(){return _(this,(function(e){return Math.sin(e)}))}},{key:"cos",value:function(){return _(this,(function(e){return Math.cos(e)}))}},{key:"tan",value:function(){return _(this,(function(e){return Math.tan(e)}))}},{key:"asin",value:function(){return _(this,(function(e){return Math.asin(e)}))}},{key:"acos",value:function(){return _(this,(function(e){return Math.acos(e)}))}},{key:"atan",value:function(){return _(this,(function(e){return Math.atan(e)}))}},{key:"sinh",value:function(){return _(this,(function(e){return Math.sinh(e)}))}},{key:"cosh",value:function(){return _(this,(function(e){return Math.cosh(e)}))}},{key:"tanh",value:function(){return _(this,(function(e){return Math.tanh(e)}))}},{key:"asinh",value:function(){return _(this,(function(e){return Math.asinh(e)}))}},{key:"acosh",value:function(){return _(this,(function(e){return Math.acosh(e)}))}},{key:"atanh",value:function(){return _(this,(function(e){return Math.atanh(e)}))}},{key:"floor",value:function(){return _(this,(function(e){return Math.floor(e)}))}},{key:"ceil",value:function(){return _(this,(function(e){return Math.ceil(e)}))}},{key:"round",value:function(){return _(this,(function(e){return Math.round(e)}))}},{key:"negate",value:function(){return _(this,(function(e){return-e}))}},{key:"powerScalar",value:function(e,t){return function(e,t,n){return _(e,(function(e){return Math.pow(e,t)*n}))}(this,e,t)}},{key:"multiplyScalar",value:function(e){return B(this,e,0)}},{key:"addScalar",value:function(e){return B(this,1,e)}},{key:"addMultiplyScalar",value:function(e,t){return B(this,e,t)}},{key:"sign",value:function(){return _(this,(function(e){return e<0?-1:0===e?0:1}))}},{key:"clip",value:function(e,t){return function(e,t,n){var a=function(e){return e};return void 0!==t&&void 0!==n?a=function(e){return Math.min(n,Math.max(t,e))}:void 0!==n?a=function(e){return Math.min(n,e)}:void 0!==t&&(a=function(e){return Math.max(t,e)}),_(e,a)}(this,e,t)}},{key:"clipBackward",value:function(e,t,a){if(!(e instanceof n))throw new Error("Can only do clipBackward with CPUTensor");return function(e,t,n,a,i){return X(e,t,(function(e,t){return void 0!==a&&e<a||void 0!==i&&e>i?0:t}),n)}(this,e,this.getShape(),t,a)}},{key:"sigmoid",value:function(){return _(this,(function(e){return 1/(1+Math.exp(-e))}))}},{key:"hardSigmoid",value:function(e,t){return function(e,t,n){return _(e,(function(e){return Math.max(0,Math.min(1,t*e+n))}))}(this,e,t)}},{key:"add_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(e,t,n,a,i){return X(e,t,(function(e,t){return e*a+t*i}),n)}(e,t,a,i,r)}},{key:"subtract_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only subtract CPU tensor to CPU tensor");return function(e,t,n,a,i){return X(e,t,(function(e,t){return e*a-t*i}),n)}(e,t,a,i,r)}},{key:"multiply_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(e,t,n,a){return X(e,t,(function(e,t){return e*t*a}),n)}(e,t,a,i)}},{key:"divide_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(e,t,n,a){return X(e,t,(function(e,t){return e/t*a}),n)}(e,t,a,i)}},{key:"power_impl",value:function(e,t,a){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only take CPU tensor to power of CPU tensor");return function(e,t,n){return X(e,t,(function(e,t){return Math.pow(e,t)}),n)}(e,t,a)}},{key:"matMul",value:function(e){if(!(e instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(e,t){if(2!==e.shape.length||2!==t.shape.length)throw new Error("Matmul expects both operands to have rank 2");if(e.shape[1]!==t.shape[0])throw new Error("Matmul expects dimension 1 of operand 1 to equal dimension 0 of operand 2");for(var n=e.shape[0],a=e.shape[1],i=t.shape[1],r=new F([n,i],void 0,e.dtype),s=0;s<n;s+=1)for(var o=0;o<i;o+=1){for(var u=0,c=0;c<a;c+=1)u+=e.get([s,c])*t.get([c,o]);r.set([s,o],u)}return r}(this,e)}},{key:"gemm_impl",value:function(e,t,a,i,r,s){if(!(e instanceof n&&(void 0===s||s instanceof n)))throw new Error("Can only do gemm with CPU tensors");return function(e,t,n,a,i,r,s){var o=e.shape.length,u=n?e.shape[o-1]:e.shape[o-2],c=n?e.shape[o-2]:e.shape[o-1],h=a?t.shape[o-2]:t.shape[o-1],l=u*c,p=c*h,f=u*h,d=n?u:1,v=n?1:c,m=a?1:h,y=a?c:1,w=0,b=0,g=0;void 0!==s&&(w=s.strides[o-2],b=s.strides[o-1],A(s.shape.slice(0,o-2))>1?1===(g=s.shape[o-2]*s.shape[o-1])&&(g=0):g=0);var k=e.shape.slice(0,o-2),x=A(k);0===x&&(x=1);for(var O=[].concat(Object(S.a)(k),[u,h]),j=new F(O,void 0,e.dtype),M=0;M<x;M++)for(var T=M*l,I=M*p,C=M*f,V=M*g,P=0;P<u;P++)for(var D=0;D<h;D++){for(var G=0,E=0;E<c;E++)G+=e.get(T+P*v+E*d)*t.get(I+E*m+D*y);G*=i,void 0!==s&&(G+=r*s.get(V+P*w+D*b)),j.set(C+P*h+D,G)}return j}(this,e,t,a,i,r,s)}},{key:"sum_impl",value:function(e,t){return function(e,t,n){return W(e,t,(function(e,t){return e+(void 0!==t?t:0)}),n)}(this,e,t)}},{key:"sumSquare_impl",value:function(e,t){return function(e,t,n){return W(e,t,(function(e,t){return e*e+(void 0!==t?t:0)}),n)}(this,e,t)}},{key:"product_impl",value:function(e,t){return function(e,t,n){return W(e,t,(function(e,t){return e*(void 0!==t?t:1)}),n)}(this,e,t)}},{key:"max_impl",value:function(e,t){return function(e,t,n){return W(e,t,(function(e,t){return Math.max(e,void 0!==t?t:e)}),n)}(this,e,t)}},{key:"min_impl",value:function(e,t){return function(e,t,n){return W(e,t,(function(e,t){return Math.min(e,void 0!==t?t:e)}),n)}(this,e,t)}},{key:"reduceMean_impl",value:function(e,t){return function(e,t,n){for(var a=1,i=0;i<t.length;i++)a*=e.shape[t[i]];return W(e,t,(function(e,t){return e+(void 0!==t?t:0)}),n,(function(e){return e/a}))}(this,e,t)}},{key:"reduceMeanSquare_impl",value:function(e,t){return function(e,t,n){for(var a=1,i=0;i<t.length;i++)a*=e.shape[t[i]];return W(e,t,(function(e,t){return e*e+(void 0!==t?t:0)}),n,(function(e){return e/a}))}(this,e,t)}},{key:"reduceLogSum_impl",value:function(e,t){return function(e,t,n){return W(e,t,(function(e,t){return e+(void 0!==t?t:0)}),n,(function(e){return Math.log(e)}))}(this,e,t)}},{key:"reduceLogSumExp_impl",value:function(e,t){return function(e,t,n){return W(e,t,(function(e,t){return Math.exp(e)+(void 0!==t?t:0)}),n,(function(e){return Math.log(e)}))}(this,e,t)}},{key:"conv_impl",value:function(e,t,a,i,r,s,o){if(!(e instanceof n)||void 0!==o&&!(o instanceof n))throw new Error("Can only do convolution of CPU tensor with CPU tensor");return function(e,t,n,a,i,r,s,o){var u=e.shape[0],c=e.shape[1],h=e.shape.slice(2),l=t.shape.slice(2),p=t.shape[0],f=c/a,d=A(l),v=R(h,l,i.slice(0,i.length/2),i.slice(i.length/2),n,r),m=A(v),y=[u,p];y=y.concat(v);for(var w=new F(y,void 0,e.dtype),b=v.length,g=0;g<u;g++)for(var k=0;k<p;k++){if(o){var x=o?o.get([k]):0,O=new Array(v.length).fill(0);O.unshift(g,k);for(var j=0;j<m;j++)w.set(O,x),V(O,w.shape)}for(var S=0;S<f;S++){var M=(k*f+S)%c,T=new Array(v.length).fill(0);T.unshift(g,k);for(var I=0;I<m;I++){var C=w.get(T),P=new Array(v.length).fill(0);P.unshift(k,S);for(var D=0;D<d;D++){for(var G=[g,M],E=!1,_=0;_<b;_++){var X=0===r.length?1:r[_],B=0===i.length?0:i[_],z=0===n.length?1:n[_],U=T[_+2]*X-B+P[_+2]*z;if(U<0||U>=h[_]){E=!0;break}G.push(U)}E||(C+=t.get(P)*e.get(G)),V(P,t.shape)}w.set(T,C),V(T,w.shape)}}if("id"!==s){var W=new Array(v.length).fill(0);W.unshift(g,k);for(var L=0;L<m;L++){var N=w.get(W);"relu"===s?N=Math.max(0,N):"relu6"===s&&(N=Math.min(Math.max(0,N),6)),w.set(W,N),V(W,w.shape)}}}return w}(this,e,t,a,i,r,s,o)}},{key:"convTranspose_impl",value:function(e,t,a,i,r){if(!(e instanceof n))throw new Error("Can only do transpose convolution of CPU tensor with CPU tensor");return function(e,t,n,a,i,r){var s=e.shape[0],o=e.shape[1],u=e.shape.slice(2),c=t.shape.slice(2),h=t.shape[0],l=o/a,p=A(c),f=z(u,c,i.slice(0,i.length/2),i.slice(i.length/2),n,r),d=A(f),v=[s,h];v=v.concat(f);for(var m=new F(v,void 0,e.dtype),y=f.length,w=0;w<s;w++)for(var b=0;b<h;b++)for(var g=0;g<l;g++){var k=(b*l+g)%o,x=new Array(f.length).fill(0);x.unshift(w,b);for(var O=0;O<d;O++){var j=m.get(x),S=new Array(f.length).fill(0);S.unshift(b,g);for(var M=0;M<p;M++){for(var T=[w,k],I=!1,C=0;C<y;C++){var P=0===r.length?1:r[C],D=0===i.length?0:i[C],G=0===n.length?1:n[C],E=x[C+2]-D+S[C+2]*G;if(0!==E%P){I=!0;break}if((E/=P)<0||E>=u[C]){I=!0;break}T.push(E)}if(!I){for(var R=[b,g],_=0;_<y;_++)R.push(c[_]-S[_+2]-1);j+=t.get(R)*e.get(T)}V(S,t.shape)}m.set(x,j),V(x,m.shape)}}return m}(this,e,t,a,i,r)}},{key:"pad_impl",value:function(e,t,n){return function(e,t,n,a){for(var i=e.shape.length,r=Object(S.a)(e.shape),s=0;s<i;s++)r[s]+=t[s]+t[s+i];for(var o=new F(r,void 0,e.dtype),u=new Array(i).fill(0),c=new Array(i).fill(0),h=0;h<o.size;h++){for(var l=!0,p=0;p<i;p++)c[p]=u[p]-t[p],(c[p]<0||c[p]>=e.shape[p])&&(l=!1);o.set(h,L(e,c,n,a,l)),V(u,r)}return o}(this,e,t,n)}},{key:"averagePool_impl",value:function(e,t,n,a){return function(e,t,n,a,i){var r=e.shape[0],s=e.shape[1],o=e.shape.slice(2),u=o.length,c=A(t),h=R(o,t,n.slice(0,n.length/2),n.slice(n.length/2),new Array(u).fill(1),a),l=A(h),p=[r,s];p=p.concat(h);for(var f=new F(p,void 0,e.dtype),d=0;d<r;d++)for(var v=0;v<s;v++){var m=new Array(h.length).fill(0);m.unshift(d,v);for(var y=0;y<l;y++){for(var w=0,b=new Array(h.length).fill(0),g=0,k=0;k<c;k++){for(var x=[d,v],O=!1,j=0;j<u;j++){var S=0===a.length?1:a[j],M=0===n.length?0:n[j],T=m[j+2]*S-M+b[j];if(T<0||T>=o[j]){O=!0;break}x.push(T)}O||(w+=e.get(x)),O&&!i||(g+=1),V(b,t)}w/=g,f.set(m,w),V(m,f.shape)}}return f}(this,e,t,n,a)}},{key:"reshape_impl",value:function(e,t){return t?this.copy(e):new n(e,this.values,this.dtype)}},{key:"concat",value:function(e,t){if(!(e instanceof n))throw new Error("Can only concat CPU tensor to CPU tensor");return t<0&&(t+=this.shape.length),function(e,t,n){var a=Object(S.a)(e.shape);a[n]+=t.shape[n];for(var i=new F(a,void 0,e.dtype),r=0,s=0,o=0,u=i.strides[n]*e.shape[n],c=i.strides[n]*t.shape[n],h=i.size/(n>0?i.strides[n-1]:i.size),l=0;l<h;l++){for(var p=0;p<u;p++)i.set(o,e.get(r)),o++,r++;for(var f=0;f<c;f++)i.set(o,t.get(s)),o++,s++}return i}(this,e,t)}},{key:"transpose_impl",value:function(e){return function(e,t){for(var n=e.shape.length,a=new Array(n),i=new Array(n),r=0;r<n;r++)a[r]=e.shape[t[r]],i[t[r]]=r;for(var s=new F(a,void 0,e.dtype),o=s.strides,u=new Array(n),c=0;c<n;c++)u[c]=o[i[c]];for(var h=new Array(n).fill(0),l=0;l<e.size;l++){for(var p=0,f=0;f<n;f++)p+=h[f]*u[f];s.set(p,e.get(l)),V(h,e.shape)}return s}(this,e)}},{key:"repeat",value:function(e){return function(e,t){for(var n=e.shape.length,a=new Array(n),i=0;i<n;i++)a[i]=e.shape[i]*t[i];for(var r=new F(a,void 0,e.dtype),s=new Array(n).fill(0),o=0;o<r.size;o++){for(var u=new Array(n),c=0;c<n;c++)u[c]=s[c]%e.shape[c];r.set(o,e.get(u)),V(s,r.shape)}return r}(this,e)}},{key:"expand",value:function(e){var t=this.alignShapes(this.shape,e),n=Object(w.a)(t,3),a=n[0],i=(n[1],n[2]);return C(this.shape,i)?this.copy():function(e,t){for(var n=e.shape.length,a=new F(t,void 0,e.dtype),i=new Array(n).fill(0),r=0;r<a.size;r++)a.set(r,e.get(i)),V(i,a.shape);return a}(this.reshape(a,!1),i)}},{key:"gather",value:function(e,t){return function(e,t,n){for(var a=e.shape.length,i=n.shape.length,r=a+i-1,s=new Array(r),o=0;o<t;o++)s[o]=e.shape[o];for(var u=0;u<i;u++)s[u+t]=n.shape[u];for(var c=t+1;c<a;c++)s[c+i-1]=e.shape[c];for(var h,l,p=new F(s,void 0,e.dtype),f=new Array(r).fill(0),d=0;d<p.size;d++){h=f.slice(t,t+i);var v=n.get(h);l=[].concat(Object(S.a)(f.slice(0,t)),[v],Object(S.a)(f.slice(t+i))),p.set(d,e.get(l)),V(f,s)}return p}(this,e,t)}},{key:"slice_impl",value:function(e,t,n,a){return function(e,t,n,a,i){for(var r=e.shape.length,s=Object(S.a)(e.shape),o=0,u=0;u<r&&o<a.length;u++)u===a[o]&&(s[u]=Math.ceil((n[o]-t[o])/i[o]),o++);for(var c,h=new F(s,void 0,e.dtype),l=new Array(r).fill(0),p=0;p<h.size;p++){c=new Array(r);for(var f=0;f<a.length;f++)c[a[f]]=l[a[f]]*i[f]+t[f];h.set(p,e.get(c)),V(l,s)}return h}(this,e,t,n,a)}},{key:"upsample",value:function(e){return function(e,t){for(var n=e.shape.length,a=Object(S.a)(e.shape),i=0;i<n;i++)a[i]=Math.floor(a[i]*t[i]);for(var r=new F(a,void 0,e.dtype),s=new Array(n).fill(0),o=new Array(n),u=0;u<r.size;u++){for(var c=0;c<n;c++)o[c]=Math.floor(s[c]/t[c]);r.set(u,e.get(o)),V(s,a)}return r}(this,e)}},{key:"normalize",value:function(e,t,a,i,r){if(!(e instanceof n)||!(t instanceof n)||!(i instanceof n)||!(r instanceof n))throw new Error("Can only normalize with CPU tensors");return function(e,t,n,a,i,r){for(var s=e.shape.length,o=Object(S.a)(e.shape),u=new F(o,void 0,e.dtype),c=new Array(s).fill(0),h=0;h<u.size;h++){var l=(e.get(c)-t.get(c))/Math.sqrt(n.get(c)+a);l=l*i.get(c)+r.get(c),u.set(h,l),V(c,o)}return u}(this,e,t,a,i,r)}}],[{key:"range",value:function(e,t,a){for(var i=Math.max(Math.ceil((t-e)/a),0),r=new Float32Array(i),s=0;s<i;s++)r[s]=e+s*a;return new n([i],r)}}]),n}(G),N=n(6),q=n(5),H=n(22),J=n.n(H),K=function(){function e(t){Object(g.a)(this,e),this.toNumber=t,this.numEntries=0,this.dict={}}return Object(k.a)(e,[{key:"betweenBoundsFirst",value:function(e){if(void 0!==e.gte){var t=this.toNumber(e.gte);return void 0!==this.dict[t]&&this.dict[t].length>0?[{key:e.gte,value:this.dict[t][this.dict[t].length-1]}]:[]}if(void 0!==e.lte){var n=this.toNumber(e.lte);return void 0!==this.dict[n]&&this.dict[n].length>0?[{key:e.lte,value:this.dict[n][this.dict[n].length-1]}]:[]}return[]}},{key:"deleteFirst",value:function(e){var t=this.toNumber(e);void 0!==this.dict[t]&&(this.dict[t].pop(),this.numEntries--)}},{key:"insert",value:function(e,t){var n=this.toNumber(e);void 0===this.dict[n]&&(this.dict[n]=[]),this.dict[n].push(t),this.numEntries++}}]),e}();function Z(e){return Y(e)}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!Number.isInteger(e))return t;var a=Math.abs(e);if(a<2)return t;var i=Math.sqrt(a),r=2;if(a%r&&a%(r=3)){r=5;for(var s=2;a%r&&r<i;)r+=s,s=6-s}if(r=r<=i?r:a,n)t.push(r);else{var o=t.indexOf(r);o<0&&t.push(r)}return r===a?t:Y(a/r,t,n)}var Q,$,ee,te={float32:"float",float16:"half float",int32:"float",int16:"float",int8:"float",uint32:"float",uint16:"float",uint8:"float"},ne=function(){function e(t,n,a){Object(g.a)(this,e),this.orderedDictConstructor=n,this.totalAllocations=0,this.trees={},this.regl=t,this.entryId=0,this.maxSizeFactor=a||2}return Object(k.a)(e,[{key:"getColorType",value:function(e){return te[e]}},{key:"dtypeGroup",value:function(e){return"float16"===e?"float16":"float32"}},{key:"allocate",value:function(e,t){var n=this.dtypeGroup(t),a=e*this.maxSizeFactor,i=4*Math.ceil(e/4);i<a&&(a=i);var r=void 0!==this.trees[n]?this.trees[n].betweenBoundsFirst({gte:i,lte:a}):[];if(0===r.length){var s=Math.ceil(e/4),o=this.getTextureDims(s),u=o.width,c=o.height,h={width:u,height:c,size:u*c*4,frameBuffer:this.regl.framebuffer({width:u,height:c,depthStencil:!1,colorFormat:"rgba",colorType:te[t]}),id:this.entryId++,dtype:t};return this.totalAllocations++,h}var l=r[0];return this.trees[n].deleteFirst(l.key),l.value.dtype=t,l.value}},{key:"getAllocationDimensions",value:function(e,t){var n=this.dtypeGroup(t),a=e*this.maxSizeFactor,i=4*Math.ceil(e/4);i<a&&(a=i);var r=void 0!==this.trees[n]?this.trees[n].betweenBoundsFirst({gte:e,lte:a}):[];if(0===r.length){var s=Math.ceil(e/4);return this.getTextureDims(s)}var o=r[0];return{width:o.value.width,height:o.value.height}}},{key:"deallocate",value:function(e){var t=this.dtypeGroup(e.dtype);void 0===this.trees[t]&&(this.trees[t]=this.orderedDictConstructor()),this.trees[t].insert(e.size,e)}},{key:"allocateTexture",value:function(e,t){for(var n=Math.ceil(e.length/4),a=this.getTextureDims(n),i=a.width,r=a.height,s=i*r*4,o=new Array(s),u=0;u<e.length;u++)o[u]=e[u];for(var c=e.length;c<s;c++)o[c]=0;var h=this.regl.texture({width:i,height:r,format:"rgba",type:te[t],data:o}),l=this.regl.framebuffer({color:h,width:i,height:r,depthStencil:!1});return this.totalAllocations++,{width:i,height:r,size:s,frameBuffer:l,id:this.entryId++,dtype:t}}},{key:"allocateOfDimensions",value:function(e,t,n){var a=e*t*4,i=this.regl.texture({width:e,height:t,format:"rgba",type:te[n]}),r=this.regl.framebuffer({color:i,width:e,height:t,depthStencil:!1});return this.totalAllocations++,{width:e,height:t,size:a,frameBuffer:r,id:this.entryId++,dtype:n}}},{key:"allocateFramebuffer",value:function(e,t){var n=this.regl.framebuffer({color:e,width:e.width,height:e.height,depthStencil:!1,colorType:te[t]});return this.totalAllocations++,{width:e.width,height:e.height,size:e.width*e.height*4,frameBuffer:n,id:this.entryId++,dtype:t}}},{key:"getTextureDims",value:function(e){for(var t=Z(e),n=1,a=1,i=0;i<t.length;i+=2)n*=t[i],i+1<t.length&&(a*=t[i+1]);return{width:n,height:a}}},{key:"getNumEntries",value:function(){var e=0;for(var t in this.trees)e+=this.trees[t].numEntries;return e}}]),e}(),ae=document.createElement("canvas");Q=ae.getContext("webgl",{failIfMajorPerformanceCaveat:!1}),$=J()({gl:Q,extensions:["OES_texture_float","WEBGL_color_buffer_float","OES_texture_half_float"]}),ee=new ne($,(function(){return new K((function(e){return e}))}));var ie=function(){function e(t,n,a,i){Object(g.a)(this,e),this.dtype=n,this.statics=new Set,this.copyCounter=0,this.fullyStatic=!1,void 0===a&&(a=ee),void 0===i&&(i=10),this.allocator=a,this.maxRank=i,this.gpuTensorConstructor=t}return Object(k.a)(e,[{key:"registerStatics",value:function(e){var t=0,n=0;for(var a in e)if(a.startsWith("shape")){var i=a.slice("shape".length);this.statics.add("shape".concat(i)),this.statics.add("size".concat(i)),this.statics.add("rank".concat(i)),this.statics.add("strides".concat(i)),t++}else this.statics.add(a),a.startsWith("width")||a.startsWith("height")||n++;t-1===this.getTextureNames().length&&n===this.getUniformAttrs().length&&(this.fullyStatic=!0,this.outputShape=e.shapeOutput)}},{key:"getVarModifier",value:function(e){return this.statics.has(e)?"":"uniform"}},{key:"pad",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxRank;e.length<t;)e.push(-1);return e}},{key:"copyPad",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.maxRank,n=Array.from(e);n.length<t;)n.push(-1);return n}},{key:"getVariables",value:function(){return""}},{key:"getVariableDeclarations",value:function(){var e=this,t=this.getTextureNames();return t.push("Output"),"\n      ".concat(t.map((function(t){return"\n        ".concat("Output"===t?"":"uniform sampler2D ".concat(t,";"),"\n        ").concat(e.getVarModifier("size"+t)," int size").concat(t,";\n        ").concat(e.getVarModifier("width"+t)," int width").concat(t,";\n        ").concat(e.getVarModifier("height"+t)," int height").concat(t,";\n        ").concat(e.getVarModifier("strides"+t)," int strides").concat(t,"[").concat(e.maxRank,"];\n        ").concat(e.getVarModifier("shape"+t)," int shape").concat(t,"[").concat(e.maxRank,"];\n        ").concat(e.getVarModifier("rank"+t)," int rank").concat(t,";\n        ")})).join("\n"),"\n      varying vec2 uv;\n\n      ").concat(this.getVariables())}},{key:"getVariableInitializations",value:function(e){var t=this.getTextureNames();t.push("Output");var n,a="",i=Object(j.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;if("shape".concat(r)in e){var s=e["shape".concat(r)],o=M(s),u=A(s),c=s.length;a+=this.getArrayInit("shape".concat(r),s),a+=this.getArrayInit("strides".concat(r),o),a+="\nsize".concat(r," = ").concat(u,";"),a+="\nrank".concat(r," = ").concat(c,";")}}}catch(l){i.e(l)}finally{i.f()}for(var h in e){if(!h.startsWith("shape"))if(Array.isArray(e[h]))a+=this.getArrayInit(h,e[h]);else a+="int"===this.getVarType(h)?"\n".concat(h," = ").concat(e[h],";"):"\n".concat(h," = ").concat(e[h].toPrecision(20),";")}return a}},{key:"getVarType",value:function(e){var t=this.getUniformAttrs().find((function(t){return t.name===e}));return void 0!==t&&t.type?t.type:"int"}},{key:"getArrayInit",value:function(e,t,n,a){void 0===n&&(n=this.maxRank);var i=this.getVarType(e);void 0===a&&("int"===i?a="-1":"float"===i&&(a="-1.0"));for(var r="",s=0;s<n;s++)s<t.length?"int"===i?r+="\n ".concat(e,"[").concat(s,"] = ").concat(t[s],";"):"float"===i&&(r+="\n ".concat(e,"[").concat(s,"] = ").concat(t[s].toPrecision(20),";")):r+="\n ".concat(e,"[").concat(s,"] = ").concat(a,";");return r}},{key:"getUtilFunctions",value:function(){return"\n    int fromFloat(float f) {\n      return int(floor(f+0.5));\n    }\n\n    int coordinateToPos(vec2 coordinate, int textureWidth, int textureHeight) {\n      int x = (fromFloat(coordinate.x*float(textureWidth*2))-1)/2;\n      int y = (fromFloat(coordinate.y*float(textureHeight*2))-1)/2;\n\n      int pos = x + y*textureWidth;\n\n      return pos*4;\n    }\n\n    vec2 posToCoordinate(int pos, int textureWidth, int textureHeight) {\n      pos = pos/4;\n\n      int y = pos/textureWidth;\n      int x = pos - y*textureWidth;\n\n      return vec2(float(x*2+1)/float(textureWidth*2), float(y*2+1)/float(textureHeight*2));\n    }\n\n    int indexToPos(int index[".concat(this.maxRank,"], int strides[").concat(this.maxRank,"]) {\n      int pos = 0;\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (strides[i] == -1) {\n          break;\n        }\n        pos += index[i]*strides[i];\n      }\n      return pos;\n    }\n\n    // TODO: Change return type based on dtype of operation\n    // TODO: Change values per texel here\n    float getValueAtPos(int pos, int textureWidth, int textureHeight, sampler2D tex) {\n      vec2 coord = posToCoordinate(pos, textureWidth, textureHeight);\n      int res = pos - (pos/4)*4;\n      vec4 val = texture2D(tex, coord);\n      if (res == 0) {\n        return val.r;\n      } else if (res == 1) {\n        return val.g;\n      } else if (res == 2) {\n        return val.b;\n      } else {\n        return val.a;\n      }\n    }\n\n    // TODO: Change return type based on dtype of operation\n    float getValueAt(int index[").concat(this.maxRank,"], int strides[").concat(this.maxRank,"], int textureWidth, int textureHeight, sampler2D tex) {\n      int pos = indexToPos(index, strides);\n      return getValueAtPos(pos, textureWidth, textureHeight, tex);\n    }")}},{key:"getTextureFunctions",value:function(){var e=this;return this.getTextureNames().map((function(t){return"\n        float _".concat(t,"(int indices[").concat(e.maxRank,"]) {\n          return getValueAt(indices, strides").concat(t,", width").concat(t,", height").concat(t,", ").concat(t,");\n        }\n      ")})).join("\n")}},{key:"getCompleteFragmentShader",value:function(e){var t=this.getFragmentShader(e),n=this.getVariableDeclarations(),a=this.getVariableInitializations(e),i=this.getUtilFunctions(),r=this.getTextureFunctions();return"\n    // TODO: Change between int/float here\n    precision ".concat(this.precisionString()," float;\n\n    ").concat(n,"\n\n    ").concat(i,"\n    ").concat(r,"\n\n    void initVars() {\n      ").concat(a,"\n    }\n\n    ").concat(t)}},{key:"getUniforms",value:function(e){var t,n=[],a=this.getUniformAttrs(),i=Object(j.a)(a);try{for(i.s();!(t=i.n()).done;){var r=t.value;void 0===e[r.name]&&n.push(r)}}catch(m){i.e(m)}finally{i.f()}var s=this.getTextureNames();s.push("Output");var o,u=Object(j.a)(s);try{for(u.s();!(o=u.n()).done;){var c=o.value;n.push({name:c}),void 0===e["shape".concat(c)]&&(n.push({name:"size".concat(c)}),n.push({name:"strides".concat(c),length:this.maxRank}),n.push({name:"shape".concat(c),length:this.maxRank}),n.push({name:"rank".concat(c)})),void 0===e["width".concat(c)]&&n.push({name:"width".concat(c)}),void 0===e["height".concat(c)]&&n.push({name:"height".concat(c)})}}catch(m){u.e(m)}finally{u.f()}for(var h={},l=0,p=n;l<p.length;l++){var f=p[l];if(void 0===e[f.name])if(void 0!==f.length)for(var d=0;d<f.length;d++){var v="".concat(f.name,"[").concat(d,"]");h[v]=$.prop(v)}else h[f.name]=$.prop(f.name)}return h}},{key:"posToIndex",value:function(e,t,n){var a="".concat(n,"_").concat(this.copyCounter++);return"\n    int ".concat(a," = ").concat(n,";\n    for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n      if (").concat(e,"[i] == -1) {\n        ").concat(t,"[i] = -1;\n      } else {\n        if (").concat(e,"[i] == 0) {\n          ").concat(t,"[i] = 0;\n        } else {\n          ").concat(t,"[i] = ").concat(a,"/").concat(e,"[i];\n          ").concat(a," = ").concat(a," - ").concat(e,"[i]*").concat(t,"[i]; // Stupid modulo hack\n        }\n      }\n    }")}},{key:"initIndex",value:function(e,t){return void 0===t?"\n        for (int i = 0; i < ".concat(this.maxRank,"; i++) {\n          ").concat(e,"[i] = -1;\n        }"):"\n        for (int i = 0; i < ".concat(this.maxRank,"; i++) {\n          if (i < ").concat(t,") {\n            ").concat(e,"[i] = 0;\n          } else {\n            ").concat(e,"[i] = -1;\n          }\n        }")}},{key:"incrementIndex",value:function(e,t){return"\n    for (int i = ".concat(this.maxRank," - 1; i >= 0; i--) {\n      if (").concat(t,"[i] != -1) {\n        ").concat(e,"[i] += 1;\n        if (").concat(e,"[i] >= ").concat(t,"[i]) {\n          ").concat(e,"[i] = 0;\n        } else {\n          break;\n        }\n      }\n    }\n    ")}},{key:"incrementConditional",value:function(e,t,n){return"\n    for (int i = 0; i < ".concat(this.maxRank,"; i++) {\n      if (").concat(n,"[i] == 1) {\n        ").concat(e,"[i] += 1;\n        if (").concat(e,"[i] >= ").concat(t,"[i]) {\n          ").concat(e,"[i] = 0;\n        } else {\n          break;\n        }\n      } else if (").concat(n,"[i] == -1) {\n        break;\n      }\n    }\n    ")}},{key:"getDefaultMain",value:function(){return"\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      // TODO: change number of values per pixel here\n      vec4 result = vec4(0,0,0,0);\n\n      if (pos < sizeOutput) {\n        int index[".concat(this.maxRank,"];\n        ").concat(this.posToIndex("stridesOutput","index","pos"),"\n        result.r = process(index);\n\n        pos += 1;\n\n        if (pos < sizeOutput) {\n          ").concat(this.posToIndex("stridesOutput","index","pos"),"\n          result.g = process(index);\n\n          pos += 1;\n\n          if (pos < sizeOutput) {\n            ").concat(this.posToIndex("stridesOutput","index","pos"),"\n            result.b = process(index);\n\n            pos += 1;\n\n            if (pos < sizeOutput) {\n              ").concat(this.posToIndex("stridesOutput","index","pos"),"\n              result.a = process(index);\n            }\n          }\n        }\n      }\n\n      gl_FragColor = result;\n    }")}},{key:"precisionString",value:function(){return"float16"===this.dtype?"mediump":"highp"}},{key:"getDrawCommand",value:function(e){var t=this.getCompleteFragmentShader(e),n=this.getUniforms(e);return $({frag:t,vert:"\n        // TODO: Change between float/int\n        precision ".concat(this.precisionString()," float;\n        attribute vec2 position;\n        varying vec2 uv;\n        void main() {\n          uv = 0.5 * (position + 1.0);\n          gl_Position = vec4(position, 0, 1);\n        }"),attributes:{position:[-4,-4,4,-4,0,4]},uniforms:n,framebuffer:$.prop("framebuffer"),depth:{enable:!1},count:3})}},{key:"compile",value:function(e){this.registerStatics(e),this.drawCommand=this.getDrawCommand(e)}},{key:"compute",value:function(e,t,n){void 0===this.drawCommand&&this.compile({});var a=A(e),i=this.allocator.allocate(a,this.dtype);for(var r in t){if(t[r].memory.id===i.id)throw new Error("Allocator returned a framebuffer that is also an input\n                         Did you delete a GPU tensor that was still used elsewhere?")}var s={};for(var o in t)s[o]=t[o].memory.frameBuffer;if(void 0===n&&(n={}),!this.fullyStatic){for(var u in t)this.statics.has("shape".concat(u))||(n["size".concat(u)]=t[u].size,n["strides".concat(u)]=this.pad(M(t[u].shape)),n["shape".concat(u)]=this.copyPad(t[u].shape),n["rank".concat(u)]=t[u].shape.length),this.statics.has("width".concat(u))||(n["width".concat(u)]=t[u].memory.width),this.statics.has("height".concat(u))||(n["height".concat(u)]=t[u].memory.height);this.statics.has("shapeOutput")||(n.sizeOutput=a,n.stridesOutput=this.pad(M(e)),n.shapeOutput=this.copyPad(e),n.rankOutput=e.length),this.statics.has("widthOutput")||(n.widthOutput=i.width),this.statics.has("heightOutput")||(n.heightOutput=i.height)}return this.drawCommand(Object.assign(Object.assign({framebuffer:i.frameBuffer},s),n)),this.gpuTensorConstructor(i,e,this.precision)}},{key:"getUniformAttrs",value:function(){return[]}}]),e}(),re=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r.maxRank=2,r}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int ix1[").concat(this.maxRank,"];\n      ").concat(this.initIndex("ix1"),"\n      ix1[0] = index[0];\n\n      int ix2[").concat(this.maxRank,"];\n      ").concat(this.initIndex("ix2"),"\n      ix2[1] = index[1];\n\n      int k = shapeA[1];\n\n      float res = 0.0;\n\n      for (int i = 0; i < ").concat(this.maxIterations,"; i++) {\n        if (i >= k) {\n          break;\n        }\n        ix1[1] = i;\n        ix2[0] = i;\n\n        float v1 = _A(ix1);\n        float v2 = _B(ix2);\n        res += v1*v2;\n      }\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A","B"]}},{key:"calc",value:function(e){var t=this.getOutputShape(e);return this.compute(t,{A:e.A,B:e.B})}},{key:"getOutputShape",value:function(e){return[e.A.shape[0],e.B.shape[1]]}},{key:"compile",value:function(e){void 0!==e.shapeA?this.maxIterations=e.shapeA[1]:void 0!==e.shapeB&&(this.maxIterations=e.shapeB[0]),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeB:e.A.shape,widthB:e.A.memory.width,heightB:e.A.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.B.shape)}}]),n}(ie),se=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = ".concat(this.operation("texture2D(X, uv)"),";\n    }\n    ")}},{key:"getTextureNames",value:function(){return["X"]}},{key:"calc",value:function(e){return this.compute(e.input.shape,{X:e.input})}},{key:"getOutputShape",value:function(e){return e.input.shape}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeX:e.input.shape,widthX:e.input.memory.width,heightX:e.input.memory.height,shapeOutput:this.getOutputShape(e),widthOutput:n.width,heightOutput:n.height}}},{key:"getInputInfoString",value:function(e){return"".concat(e.input.shape)}}]),n}(ie),oe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"exp(".concat(e,")")}}]),n}(se),ue=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"updateInputIx",value:function(){return"\n    for (int d = 0; d < ".concat(this.maxRank-2,"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      int dilation = dilations[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d+2]*dilation;\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    ")}},{key:"getMainBody",value:function(){return"\n    int n = index[0];\n    int m = index[1];\n\n    int kernelIx[".concat(this.maxRank,"];\n    ").concat(this.initIndex("kernelIx"),"\n    for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n      if (i >= dataRank) {\n        break;\n      }\n      kernelIx[i+2] = 0;\n    }\n    kernelIx[0] = m;\n    int inputIx[").concat(this.maxRank,"];\n    ").concat(this.initIndex("inputIx"),"\n    inputIx[0] = n;\n\n    for (int cg = 0; cg < ").concat(this.maxIterations,"; cg++) {\n      if (cg >= CG) {\n        break;\n      }\n      int c = m * CG + cg;\n      int d = c/C;\n      c = c - d*C;\n      inputIx[1] = c;\n      kernelIx[1] = cg;\n      for (int kIx = 0; kIx < ").concat(this.maxIterations,"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        ").concat(this.updateInputIx(),"\n\n        if (!skip) {\n          res += _X(inputIx) * _W(kernelIx);\n        }\n\n        ").concat(this.incrementIndex("kernelIx","shapeW"),"\n      }\n    }\n    ")}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("CG")," int CG;\n    ").concat(this.getVarModifier("kernelSize")," int kernelSize;\n    ").concat(this.getVarModifier("dataRank")," int dataRank;\n    ").concat(this.getVarModifier("C")," int C;\n    ").concat(this.getVarModifier("dilations")," int dilations[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("pads")," int pads[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("strides")," int strides[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("activation")," int activation;\n    ")}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      float res = 0.0;\n\n      ").concat(this.getMainBody(),"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      } else if (activation == 2) {\n        res = max(0.0, min(res,6.0));\n      }\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X","W"]}},{key:"getUniformAttrs",value:function(){return[{name:"CG"},{name:"kernelSize"},{name:"C"},{name:"dataRank"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"dilations",length:this.maxRank},{name:"activation"}]}},{key:"getActivationFlag",value:function(e){return"id"===e?0:"relu"===e?1:2}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.X,W:e.W});var t=e.X.shape[0],n=e.X.shape[1],a=e.X.shape.slice(2),i=e.W.shape.slice(2),r=e.W.shape[0],s=e.W.shape[1],o=A(i),u=R(a,i,e.pads.slice(0,e.pads.length/2),e.pads.slice(e.pads.length/2),e.dilations,e.strides),c=[t,r];return c=c.concat(u),this.compute(c,{X:e.X,W:e.W},{CG:s,kernelSize:o,C:n,dataRank:a.length,pads:this.copyPad(e.pads,2*this.maxRank),strides:this.copyPad(e.strides),dilations:this.copyPad(e.dilations),activation:this.getActivationFlag(e.activation)})}},{key:"getOutputShape",value:function(e){var t=e.X.shape[0],n=e.X.shape.slice(2),a=e.W.shape.slice(2),i=e.W.shape[0],r=R(n,a,e.pads.slice(0,e.pads.length/2),e.pads.slice(e.pads.length/2),e.dilations,e.strides),s=[t,i];return s=s.concat(r)}},{key:"compile",value:function(e){void 0!==e.shapeW&&(e.CG=e.shapeW[1],e.kernelSize=A(e.shapeW.slice(2)),e.dataRank=e.shapeW.length-2,this.maxRank=e.shapeW.length),void 0!==e.shapeX&&(e.C=e.shapeX[1],e.dataRank=e.shapeX.length-2,this.maxRank=e.shapeX.length),void 0!==e.activation&&"string"===typeof e.activation&&(e.activation=this.getActivationFlag(e.activation)),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=A(e.W.shape.slice(2)),i=e.X.shape[1],r=e.X.shape.slice(2);return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,shapeW:e.W.shape,widthW:e.W.memory.width,heightW:e.W.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,pads:e.pads,dilations:e.dilations,strides:e.strides,CG:e.W.shape[1],kernelSize:a,dataRank:r.length,C:i,activation:this.getActivationFlag(e.activation)}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.W.shape,"-").concat(e.dilations,"-").concat(e.pads,"-").concat(e.dilations,"-").concat(e.strides,"-").concat(e.activation)}}]),n}(ie),ce=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int biasIndex[").concat(this.maxRank,"];\n      ").concat(this.initIndex("biasIndex"),"\n      biasIndex[0] = index[1];\n      float res = _B(biasIndex);\n\n      ").concat(this.getMainBody(),"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      } else if (activation == 2) {\n        res = max(0.0, min(res,6.0));\n      }\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X","W","B"]}},{key:"calc",value:function(e){var t=e.X.shape[0],n=e.X.shape[1],a=e.X.shape.slice(2),i=e.W.shape.slice(2),r=e.W.shape[0],s=e.W.shape[1],o=A(i),u=R(a,i,e.pads.slice(0,e.pads.length/2),e.pads.slice(e.pads.length/2),e.dilations,e.strides),c=[t,r];return c=c.concat(u),this.compute(c,{X:e.X,W:e.W,B:e.B},{CG:s,kernelSize:o,C:n,dataRank:a.length,pads:this.copyPad(e.pads,2*this.maxRank),strides:this.copyPad(e.strides),dilations:this.copyPad(e.dilations),activation:this.getActivationFlag(e.activation)})}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{shapeB:e.B.shape,widthB:e.B.memory.width,heightB:e.B.memory.height})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.B.shape)}}]),n}(ue),he=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"abs(".concat(e,")")}}]),n}(se),le=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int[".concat(this.maxRank,"] index) {\n      return ").concat(this.getOp("_A(index)","_B(index)"),";\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getOutputShape",value:function(e){return e.outputShape}},{key:"getTextureNames",value:function(){return["A","B"]}},{key:"calc",value:function(e){return this.compute(e.outputShape,{A:e.A,B:e.B})}},{key:"compile",value:function(e){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),void 0!==e.shapeB&&(this.maxRank=e.shapeB.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=ee.getAllocationDimensions(A(e.outputShape),this.dtype);return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeB:e.B.shape,widthB:e.B.memory.width,heightB:e.B.memory.height,shapeOutput:e.outputShape,widthOutput:t.width,heightOutput:t.height}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.B.shape)}}]),n}(ie),pe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getOp",value:function(e,t){return"alpha*".concat(e," + beta*").concat(t)}},{key:"calc",value:function(e){return this.compute(e.outputShape,{A:e.A,B:e.B},{alpha:e.alpha,beta:e.beta})}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("alpha")," float alpha;\n    ").concat(this.getVarModifier("beta")," float beta;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{alpha:e.alpha,beta:e.beta})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.alpha,"-").concat(e.beta)}}]),n}(le),fe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getOp",value:function(e,t){return"alpha*".concat(e," * ").concat(t)}},{key:"calc",value:function(e){return this.compute(e.outputShape,{A:e.A,B:e.B},{alpha:e.alpha})}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("alpha")," float alpha;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"alpha",type:"float"}]}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{alpha:e.alpha})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.alpha)}}]),n}(le),de=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getOp",value:function(e,t){return"alpha*".concat(e," - beta*").concat(t)}},{key:"calc",value:function(e){return this.compute(e.outputShape,{A:e.A,B:e.B},{alpha:e.alpha,beta:e.beta})}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("alpha")," float alpha;\n    ").concat(this.getVarModifier("beta")," float beta;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{alpha:e.alpha,beta:e.beta})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.alpha,"-").concat(e.beta)}}]),n}(le),ve=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getOp",value:function(e,t){return"alpha*".concat(e," / ").concat(t)}},{key:"calc",value:function(e){return this.compute(e.outputShape,{A:e.A,B:e.B},{alpha:e.alpha})}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("alpha")," float alpha;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"alpha",type:"float"}]}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{alpha:e.alpha})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.alpha)}}]),n}(le),me=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"updateInputIx",value:function(){return"\n    for (int d = 0; d < ".concat(this.maxRank-2,"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d];\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    ")}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("kernelSize")," int kernelSize;\n    ").concat(this.getVarModifier("dataRank")," int dataRank;\n    ").concat(this.getVarModifier("includePad")," int includePad;\n    ").concat(this.getVarModifier("pads")," int pads[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("strides")," int strides[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("kernelShape")," int kernelShape[").concat(this.maxRank,"];\n    ")}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      float res = 0.0;\n      int count = 0;\n\n      int n = index[0];\n      int c = index[1];\n\n      int kernelIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("kernelIx"),"\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (i >= dataRank) {\n          break;\n        }\n        kernelIx[i] = 0;\n      }\n      int inputIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("inputIx"),"\n      inputIx[0] = n;\n      inputIx[1] = c;\n\n      for (int kIx = 0; kIx < ").concat(this.maxIterations,"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        ").concat(this.updateInputIx(),"\n\n        if (!skip) {\n          res += _X(inputIx);\n        }\n\n        if (!skip || includePad == 1) {\n          count += 1;\n        }\n\n        ").concat(this.incrementIndex("kernelIx","kernelShape"),"\n      }\n\n      res = res / float(count);\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X"]}},{key:"getUniformAttrs",value:function(){return[{name:"kernelSize"},{name:"dataRank"},{name:"includePad"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"kernelShape",length:this.maxRank}]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.X});var t=e.X.shape[0],n=e.X.shape[1],a=e.X.shape.slice(2),i=A(e.kernelShape),r=R(a,e.kernelShape,e.pads.slice(0,e.pads.length/2),e.pads.slice(e.pads.length/2),new Array(a.length).fill(1),e.strides),s=[t,n];return s=s.concat(r),this.compute(s,{X:e.X},{kernelSize:i,includePad:e.includePad?1:0,dataRank:a.length,pads:this.copyPad(e.pads,2*this.maxRank),strides:this.copyPad(e.strides),kernelShape:this.copyPad(e.kernelShape)})}},{key:"getOutputShape",value:function(e){var t=e.X.shape[0],n=e.X.shape[1],a=e.X.shape.slice(2),i=R(a,e.kernelShape,e.pads.slice(0,e.pads.length/2),e.pads.slice(e.pads.length/2),new Array(a.length).fill(1),e.strides),r=[t,n];return r=r.concat(i)}},{key:"compile",value:function(e){void 0!==e.shapeX&&(e.dataRank=e.shapeX.length-2,this.maxRank=e.shapeX.length),!0===e.includePad?e.includePad=1:!1===e.includePad&&(e.includePad=0),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=A(e.kernelShape);return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,kernelShape:e.kernelShape,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,pads:e.pads,strides:e.strides,kernelSize:a,dataRank:e.X.shape.length-2,includePad:e.includePad?1:0}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.kernelShape,"-").concat(e.pads,"-").concat(e.strides,"-").concat(e.includePad)}}]),n}(ie),ye=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("mappedInputStrides")," int mappedInputStrides[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("mappedInputStrides")," int sumDims[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("mappedInputStrides")," int sumSize;\n    ")}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int inputIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("inputIx"),"\n\n      int inputPos = 0;\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (mappedInputStrides[i] == -1 || index[i] == -1) {\n          break;\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n      }\n\n      ").concat(this.posToIndex("stridesX","inputIx","inputPos"),"\n\n      float res = 0.0;\n\n      for (int i = 0; i < ").concat(this.maxIterations,"; i++) {\n        if (i >= sumSize) {\n          break;\n        }\n        float curr = _X(inputIx);\n        if (i == 0) {\n          res = ").concat(this.init("curr"),";\n        } else {\n          res = ").concat(this.update("curr","res"),";\n        }\n\n        ").concat(this.incrementConditional("inputIx","shapeX","sumDims"),"\n      }\n\n      ").concat(this.post("res"),"\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"post",value:function(e){return""}},{key:"init",value:function(e){return e}},{key:"getTextureNames",value:function(){return["X"]}},{key:"getUniformAttrs",value:function(){return[{name:"mappedInputStrides",length:this.maxRank},{name:"sumDims",length:this.maxRank},{name:"sumSize"}]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.X});var t,n=U(e.X.shape,e.axes,e.keepDims),a=Object(w.a)(n,2),i=a[0],r=a[1],s=M(e.X.shape),o=[],u=Object(j.a)(r);try{for(u.s();!(t=u.n()).done;){var c=t.value;o.push(s[c])}}catch(f){u.e(f)}finally{u.f()}for(var h=1,l=new Array(e.X.shape.length).fill(0),p=0;p<e.axes.length;p++)l[e.axes[p]]=1,h*=e.X.shape[e.axes[p]];return this.compute(i,{X:e.X},{mappedInputStrides:this.pad(o),sumDims:this.pad(l),sumSize:h})}},{key:"getOutputShape",value:function(e){var t=U(e.X.shape,e.axes,e.keepDims),n=Object(w.a)(t,2),a=n[0];n[1];return a}},{key:"compile",value:function(e){if(void 0!==e.shapeX&&void 0!==e.axes&&void 0!==e.keepDims){var t,a=U(e.shapeX,e.axes,e.keepDims),i=Object(w.a)(a,2),r=i[0],s=i[1],o=M(e.shapeX),u=[],c=Object(j.a)(s);try{for(c.s();!(t=c.n()).done;){var h=t.value;u.push(o[h])}}catch(d){c.e(d)}finally{c.f()}for(var l=1,p=new Array(e.shapeX.length).fill(0),f=0;f<e.axes.length;f++)p[e.axes[f]]=1,l*=e.shapeX[e.axes[f]];e.sumDims=p,e.shapeOutput=r,e.mappedInputStrides=u,e.sumSize=l,delete e.keepDims,delete e.axes,this.maxRank=e.shapeX.length}Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t,n=U(e.X.shape,e.axes,e.keepDims),a=Object(w.a)(n,2),i=a[0],r=a[1],s=M(e.X.shape),o=[],u=Object(j.a)(r);try{for(u.s();!(t=u.n()).done;){var c=t.value;o.push(s[c])}}catch(d){u.e(d)}finally{u.f()}for(var h=1,l=new Array(e.X.shape.length).fill(0),p=0;p<e.axes.length;p++)l[e.axes[p]]=1,h*=e.X.shape[e.axes[p]];var f=ee.getAllocationDimensions(A(i),this.dtype);return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,shapeOutput:i,widthOutput:f.width,heightOutput:f.height,mappedInputStrides:o,sumDims:l,sumSize:h}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.axes,"-").concat(e.keepDims)}}]),n}(ie),we=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"".concat(e," + ").concat(t)}},{key:"post",value:function(e){return"".concat(e," = ").concat(e,"/float(sumSize);")}}]),n}(ye),be=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"(".concat(e,"*").concat(e,") + ").concat(t)}},{key:"post",value:function(e){return"".concat(e," = ").concat(e,"/float(sumSize);")}},{key:"init",value:function(e){return"".concat(e,"*").concat(e)}}]),n}(ye),ge=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"(".concat(e,"*").concat(e,") + ").concat(t)}},{key:"init",value:function(e){return"".concat(e,"*").concat(e)}}]),n}(ye),ke=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"".concat(e," + ").concat(t)}}]),n}(ye),xe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"".concat(e," * ").concat(t)}}]),n}(ye),Oe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"max(".concat(e,", ").concat(t,")")}}]),n}(ye),je=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"min(".concat(e,", ").concat(t,")")}}]),n}(ye),Se=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"ceil(".concat(e,")")}}]),n}(se),Ae=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    void main() {\n      initVars();\n\n      vec4 maxVec = vec4(maxVal,maxVal,maxVal,maxVal);\n      vec4 minVec = vec4(minVal,minVal,minVal,minVal);\n\n      vec4 res = texture2D(X, uv);\n      if (doMin == 1) {\n        res = max(minVec, res);\n      }\n      if (doMax == 1) {\n        res = min(maxVec, res);\n      }\n\n      gl_FragColor = res;\n    }\n    "}},{key:"getTextureNames",value:function(){return["X"]}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("minVal")," float minVal;\n    ").concat(this.getVarModifier("maxVal")," float maxVal;\n    ").concat(this.getVarModifier("doMin")," int doMin;\n    ").concat(this.getVarModifier("doMax")," int doMax;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"minVal",type:"float"},{name:"maxVal",type:"float"},{name:"doMin"},{name:"doMax"}]}},{key:"calc",value:function(e){return this.fullyStatic&&void 0!==this.outputShape?this.compute(this.outputShape,{X:e.input}):this.compute(e.input.shape,{X:e.input},{minVal:void 0!==e.minVal?e.minVal:0,maxVal:void 0!==e.maxVal?e.maxVal:0,doMin:void 0!==e.minVal?1:0,doMax:void 0!==e.maxVal?1:0})}},{key:"getOutputShape",value:function(e){return e.input.shape}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=ee.getAllocationDimensions(e.input.size,this.dtype);return{shapeX:e.input.shape,widthX:e.input.memory.width,heightX:e.input.memory.height,shapeOutput:e.input.shape,widthOutput:t.width,heightOutput:t.height,minVal:void 0!==e.minVal?e.minVal:0,maxVal:void 0!==e.maxVal?e.maxVal:0,doMin:void 0!==e.minVal?1:0,doMax:void 0!==e.maxVal?1:0}}},{key:"getInputInfoString",value:function(e){return"".concat(e.input.shape,"-").concat(e.minVal,"-").concat(e.maxVal)}}]),n}(ie),Me=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"floor(".concat(e,")")}}]),n}(se),Te=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("axis")," int axis;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"axis"}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      float res = 0.0;\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (i == axis) {\n          if (index[i] >= shapeA[i]) {\n            index[i] = index[i] - shapeA[i];\n            res = _B(index);\n          } else {\n            res = _A(index);\n          }\n          break;\n        }\n      }\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A","B"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.A,B:e.B});var t=this.getOutputShape(e);return this.compute(t,{A:e.A,B:e.B},{axis:e.axis})}},{key:"getOutputShape",value:function(e){var t=Object(S.a)(e.A.shape);return t[e.axis]+=e.B.shape[e.axis],t}},{key:"compile",value:function(e){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),void 0!==e.shapeB&&(this.maxRank=e.shapeB.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeB:e.B.shape,widthB:e.B.memory.width,heightB:e.B.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,axis:e.axis}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.B.shape,"-").concat(e.axis)}}]),n}(ie),Ie=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = texture2D(X, uv);\n    }\n    "}},{key:"getTextureNames",value:function(){return["X"]}},{key:"calc",value:function(e){var t=this.getOutputShape(e);return this.compute(t,{X:e.input})}},{key:"getOutputShape",value:function(e){var t=e.outputShape;return void 0===t&&(t=e.input.shape),t}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeX:e.input.shape,widthX:e.input.memory.width,heightX:e.input.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height}}},{key:"getInputInfoString",value:function(e){return"".concat(e.input,"-").concat(this.getOutputShape(e))}}]),n}(ie),Ce=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      return _X(index);\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X"]}},{key:"calc",value:function(e){return this.compute(e.outputShape,{X:e.input})}},{key:"getOutputShape",value:function(e){return e.outputShape}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeX:e.input.shape,widthX:e.input.memory.width,heightX:e.input.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height}}},{key:"getInputInfoString",value:function(e){return"".concat(e.input.shape,"-").concat(e.outputShape)}}]),n}(ie),Ve=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).gatherMaxIxSize=10,r}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("axis")," int axis;\n    ").concat(this.getVarModifier("indexValues")," int indexValues[").concat(this.gatherMaxIxSize,"];\n    ").concat(this.getVarModifier("mappedIndexStrides")," int mappedIndexStrides[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("mappedInputStrides")," int mappedInputStrides[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"axis"},{name:"indexValues",length:this.gatherMaxIxSize},{name:"mappedInputStrides",length:this.maxRank},{name:"mappedIndexStrides",length:this.maxRank}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int inputPos = 0;\n      int indexPos = 0;\n\n      int strideAxis = 0;\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n        if (i == axis) {\n          strideAxis = stridesX[i];\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n        indexPos += mappedIndexStrides[i]*index[i];\n      }\n\n      for (int i = 0; i < ").concat(this.gatherMaxIxSize,"; i++) {\n        if (i == indexPos) {\n          inputPos += indexValues[i]*strideAxis;\n          break;\n        }\n      }\n\n      return getValueAtPos(inputPos, widthX, heightX, X);\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.X});if(e.indices.size>this.gatherMaxIxSize)throw new Error("Gather on GPU can deal with at most ".concat(this.gatherMaxIxSize," indices, input had ").concat(e.indices.size));for(var t=e.X.shape.length,n=e.indices.shape.length,a=M(e.X.shape),i=M(e.indices.shape),r=t+n-1,s=new Array(r),o=new Array(r).fill(0),u=new Array(r).fill(0),c=0;c<e.axis;c++)s[c]=e.X.shape[c],o[c]=a[c],u[c]=0;for(var h=0;h<n;h++)s[h+e.axis]=e.indices.shape[h],u[h+e.axis]=i[h],o[h+e.axis]=0;for(var l=e.axis+1;l<t;l++)s[l+n-1]=e.X.shape[l],o[l+n-1]=a[l],u[l+n-1]=0;return this.compute(s,{X:e.X},{axis:e.axis,indexValues:this.pad(Array.from(e.indices.values),this.gatherMaxIxSize),mappedInputStrides:this.pad(o),mappedIndexStrides:this.pad(u)})}},{key:"getOutputShape",value:function(e){for(var t=e.X.shape.length,n=e.indices.shape.length,a=new Array(t+n-1),i=0;i<e.axis;i++)a[i]=e.X.shape[i];for(var r=0;r<n;r++)a[r+e.axis]=e.indices.shape[r];for(var s=e.axis+1;s<t;s++)a[s+n-1]=e.X.shape[s];return a}},{key:"compile",value:function(e){if(void 0!==e.shapeX&&(this.maxRank=e.shapeX.length,void 0!==e.indices&&void 0!==e.axis)){for(var t=e.shapeX.length,a=e.indices.shape.length,i=M(e.shapeX),r=M(e.indices.shape),s=t+a-1,o=new Array(s),u=new Array(s).fill(0),c=new Array(s).fill(0),h=0;h<e.axis;h++)o[h]=e.shapeX[h],u[h]=i[h],c[h]=0;for(var l=0;l<a;l++)o[l+e.axis]=e.indices.shape[l],c[l+e.axis]=r[l],u[l+e.axis]=0;for(var p=e.axis+1;p<t;p++)o[p+a-1]=e.shapeX[p],u[p+a-1]=i[p],c[p+a-1]=0;e.mappedIndexStrides=c,e.mappedInputStrides=u,e.indexValues=Array.from(e.indices.values),delete e.indices}Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){for(var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=e.X.shape.length,i=e.indices.shape.length,r=M(e.X.shape),s=M(e.indices.shape),o=a+i-1,u=new Array(o),c=new Array(o).fill(0),h=new Array(o).fill(0),l=0;l<e.axis;l++)u[l]=e.X.shape[l],c[l]=r[l],h[l]=0;for(var p=0;p<i;p++)u[p+e.axis]=e.indices.shape[p],h[p+e.axis]=s[p],c[p+e.axis]=0;for(var f=e.axis+1;f<a;f++)u[f+i-1]=e.X.shape[f],c[f+i-1]=r[f],h[f+i-1]=0;return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,axis:e.axis,indexValues:Array.from(e.indices.values),mappedIndexStrides:h,mappedInputStrides:c}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.axis,"-").concat(Array.from(e.indices.values),"-").concat(e.indices.shape)}}]),n}(ie),Pe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"getMainBody",value:function(){return"\n      int ixA[".concat(this.maxRank,"];\n      ").concat(this.initIndex("ixA"),"\n      int ixB[").concat(this.maxRank,"];\n      ").concat(this.initIndex("ixA"),"\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (i >= rank - 2) {\n          break;\n        }\n        ixA[i] = index[i];\n        ixB[i] = index[i];\n      }\n\n      int m = 0;\n      int o = 0;\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (i == rank-2) {\n          m = index[i];\n          o = index[i+1];\n\n          if (aTranspose == 0) {\n            ixA[i] = m;\n          } else {\n            ixA[i+1] = m;\n          }\n\n          if (bTranspose == 0) {\n            ixB[i+1] = o;\n          } else {\n            ixB[i] = o;\n          }\n\n          break;\n        }\n      }\n\n      float res = 0.0;\n\n      for (int n = 0; n < ").concat(this.maxIterations,"; n++) {\n        if (n >= N) {\n          break;\n        }\n        for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n          if (i == rank-2) {\n            if (aTranspose == 0) {\n              ixA[i+1] = n;\n            } else {\n              ixA[i] = n;\n            }\n\n            if (bTranspose == 0) {\n              ixB[i] = n;\n            } else {\n              ixB[i+1] = n;\n            }\n\n            break;\n          }\n        }\n        res += _A(ixA) * _B(ixB);\n      }\n\n      res = res*alpha;\n    ")}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("M")," int M;\n    ").concat(this.getVarModifier("N")," int N;\n    ").concat(this.getVarModifier("O")," int O;\n    ").concat(this.getVarModifier("rank")," int rank;\n    ").concat(this.getVarModifier("aTranspose")," int aTranspose;\n    ").concat(this.getVarModifier("bTranspose")," int bTranspose;\n    ").concat(this.getVarModifier("alpha")," float alpha;\n    ").concat(this.getVarModifier("beta")," float beta;\n    ")}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      ").concat(this.getMainBody(),"\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A","B"]}},{key:"getUniformAttrs",value:function(){return[{name:"M"},{name:"N"},{name:"O"},{name:"rank"},{name:"aTranspose"},{name:"bTranspose"},{name:"alpha",type:"float"},{name:"beta",type:"float"}]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.a,B:e.b});var t=e.a.shape.length,n=e.aTranspose?e.a.shape[t-1]:e.a.shape[t-2],a=e.aTranspose?e.a.shape[t-2]:e.a.shape[t-1],i=e.bTranspose?e.b.shape[t-2]:e.b.shape[t-1],r=e.a.shape.slice(0,t-2),s=[].concat(Object(S.a)(r),[n,i]),o={M:n,N:a,O:i,rank:t,aTranspose:e.aTranspose?1:0,bTranspose:e.bTranspose?1:0,alpha:e.alpha,beta:e.beta};return this.compute(s,{A:e.a,B:e.b},o)}},{key:"getOutputShape",value:function(e){var t=e.a.shape.length,n=e.aTranspose?e.a.shape[t-1]:e.a.shape[t-2],a=e.bTranspose?e.b.shape[t-2]:e.b.shape[t-1],i=e.a.shape.slice(0,t-2);return[].concat(Object(S.a)(i),[n,a])}},{key:"compile",value:function(e){if(void 0!==e.shapeA){var t=e.shapeA.length;if(e.rank=t,this.maxRank=t,void 0!==e.aTranspose){var a=e.aTranspose?e.shapeA[t-1]:e.shapeA[t-2],i=e.aTranspose?e.shapeA[t-2]:e.shapeA[t-1];e.M=a,e.N=i,e.aTranspose=e.aTranspose?1:0}}if(void 0!==e.shapeB&&void 0!==e.bTranspose){var r=e.shapeB.length,s=e.bTranspose?e.shapeB[r-2]:e.shapeB[r-1];e.O=s,e.bTranspose=e.bTranspose?1:0}Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=e.a.shape.length,i=e.aTranspose?e.a.shape[a-1]:e.a.shape[a-2],r=e.aTranspose?e.a.shape[a-2]:e.a.shape[a-1],s=e.bTranspose?e.b.shape[a-2]:e.b.shape[a-1];return{shapeA:e.a.shape,widthA:e.a.memory.width,heightA:e.a.memory.height,shapeB:e.b.shape,widthB:e.b.memory.width,heightB:e.b.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,M:i,N:r,O:s,aTranspose:e.aTranspose?1:0,bTranspose:e.bTranspose?1:0,alpha:e.alpha,beta:e.beta,rank:a}}},{key:"getInputInfoString",value:function(e){return"".concat(e.a.shape,"-").concat(e.b.shape,"-").concat(e.aTranspose,"-").concat(e.bTranspose,"-").concat(e.alpha,"-").concat(e.beta)}}]),n}(ie),De=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"getTextureNames",value:function(){return["A","B","C"]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      ").concat(this.getMainBody(),"\n\n      res += beta*_C(index);\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.a,B:e.b,C:e.c});var t=e.a.shape.length,n=e.aTranspose?e.a.shape[t-1]:e.a.shape[t-2],a=e.aTranspose?e.a.shape[t-2]:e.a.shape[t-1],i=e.bTranspose?e.b.shape[t-2]:e.b.shape[t-1],r=e.a.shape.slice(0,t-2),s=[].concat(Object(S.a)(r),[n,i]),o={M:n,N:a,O:i,rank:t,aTranspose:e.aTranspose?1:0,bTranspose:e.bTranspose?1:0,alpha:e.alpha,beta:e.beta};return this.compute(s,{A:e.a,B:e.b,C:e.c},o)}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{shapeC:e.c.shape,widthC:e.c.memory.width,heightC:e.c.memory.height})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.c.shape)}}]),n}(Pe),Ge=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getOp",value:function(e,t){return"pow(".concat(e,", ").concat(t,")")}}]),n}(le),Ee=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"sqrt(".concat(e,")")}}]),n}(se),Re=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"log(".concat(e,")")}}]),n}(se),_e=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("mappedStrides")," int mappedStrides[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"mappedStrides",length:this.maxRank}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      return getValueAt(index, mappedStrides, widthA, heightA, A);\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.A});for(var t=e.A.shape.length,n=this.getOutputShape(e),a=M(e.A.shape),i=new Array(t),r=0;r<t;r++)i[r]=a[e.permutation[r]];return this.compute(n,{A:e.A},{mappedStrides:this.pad(i)})}},{key:"getOutputShape",value:function(e){for(var t=e.A.shape.length,n=new Array(t),a=0;a<t;a++)n[a]=e.A.shape[e.permutation[a]];return n}},{key:"compile",value:function(e){if(void 0!==e.shapeA&&(this.maxRank=e.shapeA.length,void 0!==e.permutation)){for(var t=e.shapeA.length,a=M(e.shapeA),i=new Array(t),r=0;r<t;r++)i[r]=a[e.permutation[r]];e.mappedStrides=i,delete e.permutation}Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){for(var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=e.A.shape.length,i=M(e.A.shape),r=new Array(a),s=0;s<a;s++)r[s]=i[e.permutation[s]];return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,mappedStrides:r}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.permutation)}}]),n}(ie),Xe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("repeats")," int repeats[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"repeats",length:this.maxRank}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int inIndex[").concat(this.maxRank,"];\n      ").concat(this.initIndex("inIndex"),"\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (repeats[i] == -1) {\n          break;\n        }\n        int d = index[i] / shapeA[i];\n        inIndex[i] = index[i] - d*shapeA[i];\n      }\n\n      return _A(inIndex);\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getOutputShape",value:function(e){for(var t=e.A.shape.length,n=new Array(t),a=0;a<t;a++)n[a]=e.A.shape[a]*e.repeats[a];return n}},{key:"getTextureNames",value:function(){return["A"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.A});var t=this.getOutputShape(e);return this.compute(t,{A:e.A},{repeats:this.copyPad(e.repeats)})}},{key:"compile",value:function(e){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,repeats:e.repeats}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.repeats)}}]),n}(ie),Be=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int inputIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("inputIx"),"\n      if (mode == 0) {\n        float res = value;\n\n        int outOfBounds = 0;\n        for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0 || inputIx[i] >= shapeX[i]) {\n            outOfBounds = 1;\n            break;\n          }\n        }\n\n        if (outOfBounds == 0) {\n          res = _X(inputIx);\n        }\n\n        return res;\n      } else if (mode == 1) {\n        for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = -inputIx[i];\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = 2*shapeX[i] - inputIx[i] - 2;\n          }\n        }\n\n        return _X(inputIx);\n      } else {\n        for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = 0;\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = shapeX[i] - 1;\n          }\n        }\n\n        return _X(inputIx);\n      }\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X"]}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("pads")," int pads[").concat(2*this.maxRank,"];\n    ").concat(this.getVarModifier("value")," float value;\n    ").concat(this.getVarModifier("mode")," int mode;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"value",type:"float"},{name:"pads",length:2*this.maxRank},{name:"mode"}]}},{key:"getModeFlag",value:function(e){return"constant"===e?0:"reflect"===e?1:2}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.input});var t=this.getOutputShape(e);return this.compute(t,{X:e.input},{pads:this.copyPad(e.pads,2*this.maxRank),value:e.value,mode:this.getModeFlag(e.mode)})}},{key:"getOutputShape",value:function(e){for(var t=e.input.shape.length,n=Object(S.a)(e.input.shape),a=0;a<t;a++)n[a]+=e.pads[a]+e.pads[a+t];return n}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),void 0!==e.mode&&"string"===typeof e.mode&&(e.mode=this.getModeFlag(e.mode)),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeX:e.input.shape,widthX:e.input.memory.width,heightX:e.input.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,pads:e.pads,mode:this.getModeFlag(e.mode),value:e.value}}},{key:"getInputInfoString",value:function(e){return"".concat(e.input.shape,"-").concat(e.pads,"-").concat(e.mode,"-").concat(e.value)}}]),n}(ie),ze=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int inIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("inIx"),"\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = index[i]*steps[i] + offsets[i];\n      }\n\n      return _X(inIx);\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X"]}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("offsets")," int offsets[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("steps")," int steps[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"offsets",length:this.maxRank},{name:"steps",length:this.maxRank}]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.X});for(var t=e.X.shape.length,n=Object(S.a)(e.X.shape),a=new Array(t).fill(0),i=new Array(t).fill(1),r=0,s=0;s<t&&r<e.axes.length;s++)s===e.axes[r]&&(n[s]=Math.ceil((e.ends[r]-e.starts[r])/e.steps[r]),a[s]=e.starts[r],i[s]=e.steps[r],r++);return this.compute(n,{X:e.X},{offsets:this.pad(a),steps:this.pad(i)})}},{key:"getOutputShape",value:function(e){for(var t=e.X.shape.length,n=Object(S.a)(e.X.shape),a=0,i=0;i<t&&a<e.axes.length;i++)i===e.axes[a]&&(n[i]=Math.ceil((e.ends[a]-e.starts[a])/e.steps[a]),a++);return n}},{key:"compile",value:function(e){if(void 0!==e.shapeX&&(this.maxRank=e.shapeX.length,void 0!==e.axes&&void 0!==e.starts&&void 0!==e.ends&&void 0!==e.steps)){for(var t=e.shapeX.length,a=new Array(t).fill(0),i=new Array(t).fill(1),r=0,s=0;s<t&&r<e.axes.length;s++)s===e.axes[r]&&(a[s]=e.starts[r],i[s]=e.steps[r],r++);e.offsets=a,e.steps=i,delete e.starts,delete e.ends,delete e.axes}Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){for(var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=e.X.shape.length,i=Object(S.a)(e.X.shape),r=new Array(a).fill(0),s=new Array(a).fill(1),o=0,u=0;u<a&&o<e.axes.length;u++)u===e.axes[o]&&(i[u]=Math.ceil((e.ends[o]-e.starts[o])/e.steps[o]),r[u]=e.starts[o],s[u]=e.steps[o],o++);return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,offsets:r,steps:s}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.axes,"-").concat(e.starts,"-").concat(e.ends,"-").concat(e.steps)}}]),n}(ie),Ue=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int inIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("inIx"),"\n\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = int(floor(float(index[i]) / scales[i]));\n      }\n\n      return _X(inIx);\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X"]}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("scales")," float scales[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"scales",length:this.maxRank,type:"float"}]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.X});var t=this.getOutputShape(e);return this.compute(t,{X:e.X},{scales:this.copyPad(e.scales)})}},{key:"getOutputShape",value:function(e){for(var t=e.X.shape.length,n=Object(S.a)(e.X.shape),a=0;a<t;a++)n[a]=Math.floor(n[a]*e.scales[a]);return n}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,scales:e.scales}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.scales)}}]),n}(ie),We=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("epsilon")," float epsilon;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"epsilon",type:"float"}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int[".concat(this.maxRank,"] index) {\n      float result = _X(index) - _Mean(index);\n      result = result / sqrt(_Variance(index) + epsilon);\n      result = result * _Scale(index) + _Bias(index);\n      return result;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getOutputShape",value:function(e){return e.X.shape}},{key:"getTextureNames",value:function(){return["X","Mean","Variance","Scale","Bias"]}},{key:"calc",value:function(e){return this.compute(e.X.shape,{X:e.X,Mean:e.Mean,Variance:e.Variance,Scale:e.Scale,Bias:e.Bias},{epsilon:e.epsilon})}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,shapeBias:e.Bias.shape,widthBias:e.Bias.memory.width,heightBias:e.Bias.memory.height,shapeMean:e.Mean.shape,widthMean:e.Mean.memory.width,heightMean:e.Mean.memory.height,shapeScale:e.Scale.shape,widthScale:e.Scale.memory.width,heightScale:e.Scale.memory.height,shapeVariance:e.Variance.shape,widthVariance:e.Variance.memory.width,heightVariance:e.Variance.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,epsilon:e.epsilon}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.Mean.shape,"-").concat(e.Variance.shape,"-").concat(e.Scale.shape,"-").concat(e.Bias.shape,"-").concat(e.epsilon)}}]),n}(ie),Le=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;Object(g.a)(this,e),this.getOp=t,this.minCallsToCompile=n,this.opDict={}}return Object(k.a)(e,[{key:"getDefault",value:function(e){var t="default-".concat(e);if(void 0===this.opDict[t]){var n=this.getOp(e);n.compile({}),this.opDict[t]={infoString:t,numCalls:0,operation:n}}return this.opDict[t]}},{key:"calc",value:function(e,t){var n=this.getDefault(t),a=n.operation.getInputInfoString(e);void 0===this.opDict[a]&&(this.opDict[a]={infoString:a,numCalls:0});var i=this.opDict[a];if(i.numCalls++,i.numCalls>=this.minCallsToCompile){if(void 0===i.operation){i.operation=this.getOp(t);var r=n.operation.getCompilationInfo(e);i.operation.compile(r)}return i.operation.calc(e)}return n.numCalls++,n.operation.calc(e)}}]),e}(),Fe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"sign(".concat(e,")")}}]),n}(se),Ne=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"-".concat(e)}}]),n}(se),qe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      float val = _X(index);\n      if (doMin == 1 && val < minVal) {\n        return 0.0;\n      }\n      if (doMax == 1 && val > maxVal) {\n        return 0.0;\n      }\n      return _Grad(index);\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X","Grad"]}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("minVal")," float minVal;\n    ").concat(this.getVarModifier("maxVal")," float maxVal;\n    ").concat(this.getVarModifier("doMin")," int doMin;\n    ").concat(this.getVarModifier("doMax")," int doMax;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"minVal",type:"float"},{name:"maxVal",type:"float"},{name:"doMin"},{name:"doMax"}]}},{key:"calc",value:function(e){return this.fullyStatic&&void 0!==this.outputShape?this.compute(this.outputShape,{X:e.input,Grad:e.grad}):this.compute(e.input.shape,{X:e.input,Grad:e.grad},{minVal:void 0!==e.minVal?e.minVal:0,maxVal:void 0!==e.maxVal?e.maxVal:0,doMin:void 0!==e.minVal?1:0,doMax:void 0!==e.maxVal?1:0})}},{key:"getOutputShape",value:function(e){return e.input.shape}},{key:"compile",value:function(e){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=ee.getAllocationDimensions(e.input.size,this.dtype);return{shapeX:e.input.shape,widthX:e.input.memory.width,heightX:e.input.memory.height,shapeGrad:e.grad.shape,widthGrad:e.grad.memory.width,heightGrad:e.grad.memory.height,shapeOutput:e.input.shape,widthOutput:t.width,heightOutput:t.height,minVal:void 0!==e.minVal?e.minVal:0,maxVal:void 0!==e.maxVal?e.maxVal:0,doMin:void 0!==e.minVal?1:0,doMax:void 0!==e.maxVal?1:0}}},{key:"getInputInfoString",value:function(e){return"".concat(e.input.shape,"-").concat(e.minVal,"-").concat(e.maxVal)}}]),n}(ie),He=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"updateInputIx",value:function(){return"\n    for (int d = 0; d < ".concat(this.maxRank-2,"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      int dilation = dilations[d];\n      if (stride == -1) {\n        break;\n      }\n\n      int trans_kernel_ix = shapeW[d + 2] - kernelIx[d + 2] - 1;\n\n      inputIx[d+2] = index[d + 2] - pad + trans_kernel_ix * dilation;\n\n      int divS = inputIx[d+2] / stride;\n      int resS = inputIx[d+2] - divS*stride;\n\n      if (resS != 0) {\n        skip = true;\n        break;\n      }\n      inputIx[d+2] = divS;\n\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    ")}},{key:"getMainBody",value:function(){return"\n    int n = index[0];\n    int m = index[1];\n\n    int kernelIx[".concat(this.maxRank,"];\n    ").concat(this.initIndex("kernelIx"),"\n    for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n      if (i >= dataRank) {\n        break;\n      }\n      kernelIx[i+2] = 0;\n    }\n    kernelIx[0] = m;\n    int inputIx[").concat(this.maxRank,"];\n    ").concat(this.initIndex("inputIx"),"\n    inputIx[0] = n;\n\n    for (int cg = 0; cg < ").concat(this.maxIterations,"; cg++) {\n      if (cg >= CG) {\n        break;\n      }\n      int c = m * CG + cg;\n      int d = c/C;\n      c = c - d*C;\n      inputIx[1] = c;\n      kernelIx[1] = cg;\n      for (int kIx = 0; kIx < ").concat(this.maxIterations,"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        ").concat(this.updateInputIx(),"\n\n        if (!skip) {\n          res += _X(inputIx) * _W(kernelIx);\n        }\n\n        ").concat(this.incrementIndex("kernelIx","shapeW"),"\n      }\n    }\n    ")}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("CG")," int CG;\n    ").concat(this.getVarModifier("kernelSize")," int kernelSize;\n    ").concat(this.getVarModifier("dataRank")," int dataRank;\n    ").concat(this.getVarModifier("C")," int C;\n    ").concat(this.getVarModifier("dilations")," int dilations[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("pads")," int pads[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("strides")," int strides[").concat(this.maxRank,"];\n    ")}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      float res = 0.0;\n\n      ").concat(this.getMainBody(),"\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["X","W"]}},{key:"getUniformAttrs",value:function(){return[{name:"CG"},{name:"kernelSize"},{name:"C"},{name:"dataRank"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"dilations",length:this.maxRank}]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:e.X,W:e.W});var t=e.X.shape[0],n=e.X.shape[1],a=e.X.shape.slice(2),i=e.W.shape.slice(2),r=e.W.shape[0],s=e.W.shape[1],o=A(i),u=z(a,i,e.pads.slice(0,e.pads.length/2),e.pads.slice(e.pads.length/2),e.dilations,e.strides),c=[t,r];return c=c.concat(u),this.compute(c,{X:e.X,W:e.W},{CG:s,kernelSize:o,C:n,dataRank:a.length,pads:this.copyPad(e.pads,2*this.maxRank),strides:this.copyPad(e.strides),dilations:this.copyPad(e.dilations)})}},{key:"getOutputShape",value:function(e){var t=e.X.shape[0],n=e.X.shape.slice(2),a=e.W.shape.slice(2),i=e.W.shape[0],r=z(n,a,e.pads.slice(0,e.pads.length/2),e.pads.slice(e.pads.length/2),e.dilations,e.strides),s=[t,i];return s=s.concat(r)}},{key:"compile",value:function(e){void 0!==e.shapeW&&(e.CG=e.shapeW[1],e.kernelSize=A(e.shapeW.slice(2)),e.dataRank=e.shapeW.length-2,this.maxRank=e.shapeW.length),void 0!==e.shapeX&&(e.C=e.shapeX[1],e.dataRank=e.shapeX.length-2,this.maxRank=e.shapeX.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=A(e.W.shape.slice(2)),i=e.X.shape[1],r=e.X.shape.slice(2);return{shapeX:e.X.shape,widthX:e.X.memory.width,heightX:e.X.memory.height,shapeW:e.W.shape,widthW:e.W.memory.width,heightW:e.W.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,pads:e.pads,dilations:e.dilations,strides:e.strides,CG:e.W.shape[1],kernelSize:a,dataRank:r.length,C:i}}},{key:"getInputInfoString",value:function(e){return"".concat(e.X.shape,"-").concat(e.W.shape,"-").concat(e.dilations,"-").concat(e.pads,"-").concat(e.dilations,"-").concat(e.strides)}}]),n}(ie),Je=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"1.0/(1.0 + exp(-".concat(e,"))")}}]),n}(se),Ke=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"factor*".concat(e," + add")}},{key:"calc",value:function(e){return this.compute(e.input.shape,{X:e.input},{factor:e.factor,add:e.add})}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{factor:e.factor,add:e.add})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.factor,"-").concat(e.add)}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("factor")," float factor;\n    ").concat(this.getVarModifier("add")," float add;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"factor",type:"float"},{name:"add",type:"float"}]}}]),n}(se),Ze=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("starts")," int starts[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"starts",length:this.maxRank}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int valueIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("valueIx"),"\n\n      int inValues = 1;\n\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        if (index[i] < starts[i] || index[i] >= (starts[i] + shapeValues[i])) {\n          inValues = 0;\n          break;\n        } else {\n          valueIx[i] = index[i] - starts[i];\n        }\n      }\n\n      if (inValues == 1) {\n        return _Values(valueIx);\n      } else {\n        return _A(index);\n      }\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A","Values"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.A,Values:e.Values});var t=this.getOutputShape(e);return this.compute(t,{A:e.A,Values:e.Values},{starts:this.pad(e.starts)})}},{key:"getOutputShape",value:function(e){return e.A.shape}},{key:"compile",value:function(e){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeValues:e.Values.shape,widthValues:e.Values.memory.width,heightValues:e.Values.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,starts:e.starts}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.Values.shape,"-").concat(e.starts)}}]),n}(ie),Ye=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"sin(".concat(e,")")}}]),n}(se),Qe=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"asin(".concat(e,")")}}]),n}(se),$e=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"(exp(".concat(e,") - exp(-").concat(e,"))/2.0")}}]),n}(se),et=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"cos(".concat(e,")")}}]),n}(se),tt=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"acos(".concat(e,")")}}]),n}(se),nt=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"(1.0 + exp(-2.0*".concat(e,"))/(2.0*exp(-").concat(e,"))")}}]),n}(se),at=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"tan(".concat(e,")")}}]),n}(se),it=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"atan(".concat(e,")")}}]),n}(se),rt=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"(exp(2.0*".concat(e,") - 1.0)/(exp(2.0*").concat(e,") + 1.0)")}}]),n}(se),st=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"".concat(e," + ").concat(t)}},{key:"post",value:function(e){return"".concat(e," = log(").concat(e,");")}},{key:"init",value:function(e){return"".concat(e)}}]),n}(ye),ot=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(k.a)(n,[{key:"update",value:function(e,t){return"exp(".concat(e,") + ").concat(t)}},{key:"post",value:function(e){return"".concat(e," = log(").concat(e,");")}},{key:"init",value:function(e){return"exp(".concat(e,")")}}]),n}(ye),ut=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"max(vec4(0.0,0.0,0.0,0.0), min(vec4(1.0,1.0,1.0,1.0), alpha*".concat(e," + beta))")}},{key:"calc",value:function(e){return this.compute(e.input.shape,{X:e.input},{alpha:e.alpha,beta:e.beta})}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{alpha:e.alpha,beta:e.beta})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.alpha,"-").concat(e.beta)}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("alpha")," float alpha;\n    ").concat(this.getVarModifier("beta")," float beta;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]}}]),n}(se),ct=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){throw new Error("Method not implemented.")}},{key:"getFragmentShader",value:function(e){return"\n    void main() {\n      initVars();\n\n      if (power < 0.0) {\n        gl_FragColor = vec4(factor,factor,factor,factor) / pow(texture2D(X, uv), vec4(-power,-power,-power,-power));\n      } else {\n        gl_FragColor = pow(texture2D(X, uv), vec4(power,power,power,power)) * factor;\n      }\n    }\n    "}},{key:"calc",value:function(e){return this.compute(e.input.shape,{X:e.input},{factor:e.factor,power:e.power})}},{key:"getCompilationInfo",value:function(e){var t=Object(N.a)(Object(q.a)(n.prototype),"getCompilationInfo",this).call(this,e);return Object.assign(Object.assign({},t),{factor:e.factor,power:e.power})}},{key:"getInputInfoString",value:function(e){return"".concat(Object(N.a)(Object(q.a)(n.prototype),"getInputInfoString",this).call(this,e),"-").concat(e.factor,"-").concat(e.power)}},{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("factor")," float factor;\n    ").concat(this.getVarModifier("power")," float power;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"factor",type:"float"},{name:"power",type:"float"}]}}]),n}(se),ht=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"operation",value:function(e){return"floor(".concat(e,"+vec4(0.5))")}}]),n}(se),lt=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,i||"float32")).shape=a,r.deleted=!1,r.size=A(a),r.memory=e instanceof Array?ee.allocateTexture(e,r.dtype):e,r}return Object(k.a)(n,[{key:"cast",value:function(e){if("float64"===e)throw new Error("The WebGL backend does not support float64 tensors");return wn.calc({input:this},e)}},{key:"getValues",value:function(){var e=this;if("float16"!==this.dtype)return new Promise((function(t){$({framebuffer:e.memory.frameBuffer})((function(){var n=new Float32Array(e.memory.size);if(n=$.read(n),"float32"===e.dtype)t(n.subarray(0,e.size));else{for(var a=new D[e.dtype](e.size),i=0;i<e.size;i++)a[i]=n[i];t(a)}}))}));throw new Error("Reading values not supported for data type float16")}},{key:"getShape",value:function(){return this.shape}},{key:"constantLike",value:function(e){return new n(new Array(this.size).fill(e),this.shape,this.dtype)}},{key:"singleConstant",value:function(e){return new n([e],[1],this.dtype)}},{key:"delete",value:function(){this.deleted||(this.deleted=!0,ee.deallocate(this.memory),this.memory=void 0)}},{key:"copy",value:function(){return wn.calc({input:this},this.dtype)}},{key:"exp",value:function(){return St.calc({input:this},this.dtype)}},{key:"log",value:function(){return Ft.calc({input:this},this.dtype)}},{key:"sqrt",value:function(){return Lt.calc({input:this},this.dtype)}},{key:"abs",value:function(){return At.calc({input:this},this.dtype)}},{key:"sin",value:function(){return Mt.calc({input:this},this.dtype)}},{key:"cos",value:function(){return Tt.calc({input:this},this.dtype)}},{key:"tan",value:function(){return It.calc({input:this},this.dtype)}},{key:"asin",value:function(){return Ct.calc({input:this},this.dtype)}},{key:"acos",value:function(){return Vt.calc({input:this},this.dtype)}},{key:"atan",value:function(){return Pt.calc({input:this},this.dtype)}},{key:"sinh",value:function(){return Dt.calc({input:this},this.dtype)}},{key:"cosh",value:function(){return Gt.calc({input:this},this.dtype)}},{key:"tanh",value:function(){return Et.calc({input:this},this.dtype)}},{key:"asinh",value:function(){throw new Error("Method not implemented")}},{key:"acosh",value:function(){throw new Error("Method not implemented")}},{key:"atanh",value:function(){throw new Error("Method not implemented")}},{key:"sigmoid",value:function(){return Rt.calc({input:this},this.dtype)}},{key:"hardSigmoid",value:function(e,t){return _t.calc({input:this,alpha:e,beta:t},this.dtype)}},{key:"floor",value:function(){return Bt.calc({input:this},this.dtype)}},{key:"ceil",value:function(){return Xt.calc({input:this},this.dtype)}},{key:"round",value:function(){return zt.calc({input:this},this.dtype)}},{key:"negate",value:function(){return Nt.calc({input:this},this.dtype)}},{key:"addMultiplyScalar",value:function(e,t){return qt.calc({input:this,factor:e,add:t},this.dtype)}},{key:"powerScalar",value:function(e,t){return Ht.calc({input:this,factor:t,power:e},this.dtype)}},{key:"sign",value:function(){return Jt.calc({input:this},this.dtype)}},{key:"setValues",value:function(e,t){if(!(e instanceof n))throw new Error("Can only set GPU values to GPU tensor");return yn.calc({A:this,Values:e,starts:t},this.dtype)}},{key:"add_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add GPU tensor to GPU tensor");return tn.calc({A:e,B:t,outputShape:a,alpha:i,beta:r},this.dtype)}},{key:"subtract_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only subtract GPU tensor from GPU tensor");return nn.calc({A:e,B:t,outputShape:a,alpha:i,beta:r},this.dtype)}},{key:"multiply_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only multiply GPU tensor with GPU tensor");return an.calc({A:e,B:t,outputShape:a,alpha:i},this.dtype)}},{key:"divide_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only divide GPU tensor by GPU tensor");return rn.calc({A:e,B:t,outputShape:a,alpha:i},this.dtype)}},{key:"power_impl",value:function(e,t,a){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only take GPU tensor to power of GPU tensor");return sn.calc({A:e,B:t,outputShape:a},this.dtype)}},{key:"matMul",value:function(e){if(!(e instanceof n))throw new Error("Can only matrix multiply GPU tensor to GPU tensor");return xt.calc({A:this,B:e},this.dtype)}},{key:"gemm_impl",value:function(e,t,a,i,r,s){if(!(e instanceof n&&(void 0===s||s instanceof n)))throw new Error("Can only do gemm with CPU tensors");return void 0===s?Ot.calc({a:this,b:e,aTranspose:t,bTranspose:a,alpha:i,beta:r},this.dtype):jt.calc({a:this,b:e,c:s,aTranspose:t,bTranspose:a,alpha:i,beta:r},this.dtype)}},{key:"sum_impl",value:function(e,t){return hn.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"sumSquare_impl",value:function(e,t){return cn.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"reduceMean_impl",value:function(e,t){return on.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"reduceMeanSquare_impl",value:function(e,t){return un.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"reduceLogSum_impl",value:function(e,t){return dn.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"reduceLogSumExp_impl",value:function(e,t){return vn.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"product_impl",value:function(e,t){return ln.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"max_impl",value:function(e,t){return pn.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"min_impl",value:function(e,t){return fn.calc({X:this,axes:e,keepDims:t},this.dtype)}},{key:"conv_impl",value:function(e,t,a,i,r,s,o){if(!(e instanceof n)||void 0!==o&&!(o instanceof n))throw new Error("Can only do convolution of GPU tensor with GPU tensor");return void 0===o?Kt.calc({X:this,W:e,pads:i,dilations:t,strides:r,activation:s},this.dtype):Yt.calc({X:this,W:e,B:o,pads:i,dilations:t,strides:r,activation:s},this.dtype)}},{key:"convTranspose_impl",value:function(e,t,a,i,r){if(!(e instanceof n))throw new Error("Can only do transpose convolution of GPU tensor with GPU tensor");return Qt.calc({X:this,W:e,pads:i,dilations:t,strides:r},this.dtype)}},{key:"averagePool_impl",value:function(e,t,n,a){return Zt.calc({X:this,includePad:a,kernelShape:e,pads:t,strides:n},this.dtype)}},{key:"reshape_impl",value:function(e,t){return t?wn.calc({input:this,outputShape:e},this.dtype):new n(this.memory,e,this.dtype)}},{key:"concat",value:function(e,t){if(!(e instanceof n))throw new Error("Can only concat GPU tensor to GPU tensor");return t<0&&(t+=this.shape.length),mn.calc({A:this,B:e,axis:t},this.dtype)}},{key:"transpose_impl",value:function(e){return kn.calc({A:this,permutation:e},this.dtype)}},{key:"clip",value:function(e,t){return Ut.calc({input:this,minVal:e,maxVal:t},this.dtype)}},{key:"clipBackward",value:function(e,t,n){return Wt.calc({input:this,minVal:t,maxVal:n,grad:e},this.dtype)}},{key:"repeat",value:function(e){return xn.calc({A:this,repeats:e},this.dtype)}},{key:"expand",value:function(e){var t=this.alignShapes(this.shape,e),n=Object(w.a)(t,3),a=n[0],i=(n[1],n[2]);return C(this.shape,i)?this.copy():bn.calc({input:this.reshape(a,!1),outputShape:i},this.dtype)}},{key:"pad_impl",value:function(e,t,n){return $t.calc({input:this,pads:e,mode:t,value:n},this.dtype)}},{key:"gather",value:function(e,t){return gn.calc({X:this,axis:e,indices:t},this.dtype)}},{key:"slice_impl",value:function(e,t,n,a){return On.calc({X:this,starts:e,ends:t,axes:n,steps:a},this.dtype)}},{key:"upsample",value:function(e){return en.calc({X:this,scales:e},this.dtype)}},{key:"normalize",value:function(e,t,a,i,r){if(!(e instanceof n)||!(t instanceof n)||!(i instanceof n)||!(r instanceof n))throw new Error("Can only normalize with CPU tensors");return jn.calc({X:this,Mean:e,Variance:t,Scale:i,Bias:r,epsilon:a},this.dtype)}}],[{key:"range",value:function(e,t,a,i){for(var r=Math.max(Math.ceil((t-e)/a),0),s=new Array(r),o=0;o<r;o++)s[o]=e+o*a;return new n(s,[r],i)}},{key:"fromData",value:function(e){var t=$.texture({data:e,format:"rgba",type:ee.getColorType("float32")}),a=ee.allocateFramebuffer(t,"float32"),i=t.width;return new n(a,[t.height,i,4],"float32")}}]),n}(G);function pt(e,t,n){return new lt(e,t,n)}var ft,dt,vt,mt,yt,wt,bt,gt,kt,xt=new Le((function(e){return new re(pt,e)})),Ot=new Le((function(e){return new Pe(pt,e)})),jt=new Le((function(e){return new De(pt,e)})),St=new Le((function(e){return new oe(pt,e)})),At=new Le((function(e){return new he(pt,e)})),Mt=new Le((function(e){return new Ye(pt,e)})),Tt=new Le((function(e){return new et(pt,e)})),It=new Le((function(e){return new at(pt,e)})),Ct=new Le((function(e){return new Qe(pt,e)})),Vt=new Le((function(e){return new tt(pt,e)})),Pt=new Le((function(e){return new it(pt,e)})),Dt=new Le((function(e){return new $e(pt,e)})),Gt=new Le((function(e){return new nt(pt,e)})),Et=new Le((function(e){return new rt(pt,e)})),Rt=new Le((function(e){return new Je(pt,e)})),_t=new Le((function(e){return new ut(pt,e)})),Xt=new Le((function(e){return new Se(pt,e)})),Bt=new Le((function(e){return new Me(pt,e)})),zt=new Le((function(e){return new ht(pt,e)})),Ut=new Le((function(e){return new Ae(pt,e)})),Wt=new Le((function(e){return new qe(pt,e)})),Lt=new Le((function(e){return new Ee(pt,e)})),Ft=new Le((function(e){return new Re(pt,e)})),Nt=new Le((function(e){return new Ne(pt,e)})),qt=new Le((function(e){return new Ke(pt,e)})),Ht=new Le((function(e){return new ct(pt,e)})),Jt=new Le((function(e){return new Fe(pt,e)})),Kt=new Le((function(e){return new ue(pt,e)})),Zt=new Le((function(e){return new me(pt,e)})),Yt=new Le((function(e){return new ce(pt,e)})),Qt=new Le((function(e){return new He(pt,e)})),$t=new Le((function(e){return new Be(pt,e)})),en=new Le((function(e){return new Ue(pt,e)})),tn=new Le((function(e){return new pe(pt,e)})),nn=new Le((function(e){return new de(pt,e)})),an=new Le((function(e){return new fe(pt,e)})),rn=new Le((function(e){return new ve(pt,e)})),sn=new Le((function(e){return new Ge(pt,e)})),on=new Le((function(e){return new we(pt,e)})),un=new Le((function(e){return new be(pt,e)})),cn=new Le((function(e){return new ge(pt,e)})),hn=new Le((function(e){return new ke(pt,e)})),ln=new Le((function(e){return new xe(pt,e)})),pn=new Le((function(e){return new Oe(pt,e)})),fn=new Le((function(e){return new je(pt,e)})),dn=new Le((function(e){return new st(pt,e)})),vn=new Le((function(e){return new ot(pt,e)})),mn=new Le((function(e){return new Te(pt,e)})),yn=new Le((function(e){return new Ze(pt,e)})),wn=new Le((function(e){return new Ie(pt,e)})),bn=new Le((function(e){return new Ce(pt,e)})),gn=new Le((function(e){return new Ve(pt,e)})),kn=new Le((function(e){return new _e(pt,e)})),xn=new Le((function(e){return new Xe(pt,e)})),On=new Le((function(e){return new ze(pt,e)})),jn=new Le((function(e){return new We(pt,e)})),Sn=new Promise((function(e){n.e(3).then(n.bind(null,52)).then((function(t){ft=t.TensorF32,dt=t.TensorF64,vt=t.TensorI32,mt=t.TensorI16,yt=t.TensorI8,wt=t.TensorU32,bt=t.TensorU16,gt=t.TensorU8,kt={float64:dt,float32:ft,int32:vt,int16:mt,int8:yt,uint32:wt,uint16:bt,uint8:gt},e()}))})),An=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;if(Object(g.a)(this,n),r=t.call(this,i||"float32"),e instanceof Array){if(void 0===a)throw new Error("Need the shape when creating a Wasm tensor from values");var s=new D[r.dtype](e);r.wasmTensor=kt[r.dtype].create(a,s)}else r.wasmTensor=e;return r}return Object(k.a)(n,[{key:"cast",value:function(e){throw new Error("Method not implemented.")}},{key:"getValues",value:function(){return Promise.resolve(this.wasmTensor.get_vals())}},{key:"getShape",value:function(){return Array.from(this.wasmTensor.get_shape())}},{key:"constantLike",value:function(e){return new n([e],this.wasmTensor.get_shape(),this.dtype)}},{key:"singleConstant",value:function(e){return new n([e],new Uint32Array([1]),this.dtype)}},{key:"delete",value:function(){void 0!==this.wasmTensor&&(this.wasmTensor.free(),this.wasmTensor=void 0)}},{key:"copy",value:function(){return new n(this.wasmTensor.copy(),void 0,this.dtype)}},{key:"exp",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Exp can only be called on float tensors");return new n(this.wasmTensor.exp())}},{key:"log",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Log can only be called on float tensors");return new n(this.wasmTensor.log())}},{key:"sqrt",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Sqrt can only be called on float tensors");return new n(this.wasmTensor.sqrt())}},{key:"abs",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft)&&!(this.wasmTensor instanceof vt)&&!(this.wasmTensor instanceof mt)&&!(this.wasmTensor instanceof yt))throw new Error("Abs can only be called on signed tensors");return new n(this.wasmTensor.abs())}},{key:"sin",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Sin can only be called on float tensors");return new n(this.wasmTensor.sin())}},{key:"cos",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Cos can only be called on float tensors");return new n(this.wasmTensor.cos())}},{key:"tan",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Tan can only be called on float tensors");return new n(this.wasmTensor.tan())}},{key:"asin",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Asin can only be called on float tensors");return new n(this.wasmTensor.asin())}},{key:"acos",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Acos can only be called on float tensors");return new n(this.wasmTensor.acos())}},{key:"atan",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Atan can only be called on float tensors");return new n(this.wasmTensor.atan())}},{key:"sinh",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Sinh can only be called on float tensors");return new n(this.wasmTensor.sinh())}},{key:"cosh",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Cosh can only be called on float tensors");return new n(this.wasmTensor.cosh())}},{key:"tanh",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Tanh can only be called on float tensors");return new n(this.wasmTensor.tanh())}},{key:"asinh",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Asinh can only be called on float tensors");return new n(this.wasmTensor.asinh())}},{key:"acosh",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Acosh can only be called on float tensors");return new n(this.wasmTensor.acosh())}},{key:"atanh",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Atanh can only be called on float tensors");return new n(this.wasmTensor.atanh())}},{key:"sigmoid",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Sigmoid can only be called on float tensors");return new n(this.wasmTensor.sigmoid())}},{key:"hardSigmoid",value:function(e,t){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("HardSigmoid can only be called on float tensors");return new n(this.wasmTensor.hard_sigmoid(e,t))}},{key:"negate",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft)&&!(this.wasmTensor instanceof vt)&&!(this.wasmTensor instanceof mt)&&!(this.wasmTensor instanceof yt))throw new Error("Negate can only be called on signed tensors");return new n(this.wasmTensor.negate())}},{key:"powerScalar",value:function(e,t){return new n(this.wasmTensor.power_scalar(e,t))}},{key:"addMultiplyScalar",value:function(e,t){return new n(this.wasmTensor.add_multiply_scalar(e,t))}},{key:"sign",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft)&&!(this.wasmTensor instanceof vt)&&!(this.wasmTensor instanceof mt)&&!(this.wasmTensor instanceof yt))throw new Error("Sign can only be called on signed tensors");return new n(this.wasmTensor.sign())}},{key:"setValues",value:function(e,t){if(!(e instanceof n))throw new Error("Can only set WASM values to WASM values");return new n(this.wasmTensor.set_values(e.wasmTensor,new Uint32Array(t)))}},{key:"add_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add WASM tensor to WASM tensor");return new n(e.wasmTensor.addition(t.wasmTensor,i,r))}},{key:"subtract_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only subtract WASM tensor from WASM tensor");return new n(e.wasmTensor.subtraction(t.wasmTensor,i,r))}},{key:"multiply_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only multiply WASM tensor with WASM tensor");return new n(e.wasmTensor.multiply(t.wasmTensor,i))}},{key:"divide_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only divide WASM tensor by WASM tensor");return new n(e.wasmTensor.divide(t.wasmTensor,i))}},{key:"power_impl",value:function(e,t,a){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only take WASM tensor to power of WASM tensor");return new n(e.wasmTensor.power(t.wasmTensor))}},{key:"matMul",value:function(e){if(!(e instanceof n))throw new Error("Can only add WASM tensor to WASM tensor");return new n(this.wasmTensor.matmul(e.wasmTensor))}},{key:"gemm_impl",value:function(e,t,a,i,r,s){if(!(e instanceof n&&(void 0===s||s instanceof n)))throw new Error("Can only do gemm with CPU tensors");return new n(void 0!==s?this.wasmTensor.gemm_with_c(e.wasmTensor,t,a,i,s.wasmTensor,r):this.wasmTensor.gemm(e.wasmTensor,t,a,i))}},{key:"sum_impl",value:function(e,t){return new n(this.wasmTensor.sum(new Uint32Array(e),t))}},{key:"sumSquare_impl",value:function(e,t){return new n(this.wasmTensor.sum_square(new Uint32Array(e),t))}},{key:"product_impl",value:function(e,t){return new n(this.wasmTensor.product(new Uint32Array(e),t))}},{key:"max_impl",value:function(e,t){return new n(this.wasmTensor.max(new Uint32Array(e),t))}},{key:"min_impl",value:function(e,t){return new n(this.wasmTensor.min(new Uint32Array(e),t))}},{key:"reduceMean_impl",value:function(e,t){return new n(this.wasmTensor.reduce_mean(new Uint32Array(e),t))}},{key:"reduceMeanSquare_impl",value:function(e,t){return new n(this.wasmTensor.reduce_mean_square(new Uint32Array(e),t))}},{key:"reduceLogSum_impl",value:function(e,t){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("ReduceLogSum can only be called on float tensors");return new n(this.wasmTensor.reduce_log_sum(new Uint32Array(e),t))}},{key:"reduceLogSumExp_impl",value:function(e,t){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("ReduceLogSumExp can only be called on float tensors");return new n(this.wasmTensor.reduce_log_sum_exp(new Uint32Array(e),t))}},{key:"getActivationFlag",value:function(e){return"id"===e?0:"relu"===e?1:2}},{key:"conv_impl",value:function(e,t,a,i,r,s,o){if(!(e instanceof n)||void 0!==o&&!(o instanceof n))throw new Error("Can only do convolution of WASM tensor with WASM tensor");var u=this.getActivationFlag(s);return new n(void 0!==o?this.wasmTensor.conv_with_bias(e.wasmTensor,o.wasmTensor,new Uint32Array(t),a,new Uint32Array(i),new Uint32Array(r),u):this.wasmTensor.conv(e.wasmTensor,new Uint32Array(t),a,new Uint32Array(i),new Uint32Array(r),u))}},{key:"convTranspose_impl",value:function(e,t,a,i,r){if(!(e instanceof n))throw new Error("Can only do transpose convolution of WASM tensor with WASM tensor");return new n(this.wasmTensor.conv_transpose(e.wasmTensor,new Uint32Array(t),a,new Uint32Array(i),new Uint32Array(r)))}},{key:"averagePool_impl",value:function(e,t,a,i){return new n(this.wasmTensor.average_pool(new Uint32Array(e),new Uint32Array(t),new Uint32Array(a),i))}},{key:"reshape_impl",value:function(e){var t=new Uint32Array(e);return new n(this.wasmTensor.reshape(t),t)}},{key:"concat",value:function(e,t){if(!(e instanceof n))throw new Error("Can only concat WASM tensor to WASM tensor");return t<0&&(t+=this.getShape().length),new n(this.wasmTensor.concat(e.wasmTensor,t))}},{key:"transpose_impl",value:function(e){return new n(this.wasmTensor.transpose(new Uint32Array(e)))}},{key:"clip",value:function(e,t){return void 0!==e&&void 0!==t?new n(this.wasmTensor.clip(e,t)):void 0!==e?new n(this.wasmTensor.clip_min(e)):void 0!==t?new n(this.wasmTensor.clip_max(t)):this.copy()}},{key:"clipBackward",value:function(e,t,a){if(!(e instanceof n))throw new Error("Can only do grad backward with Wasm tensor");return void 0!==t&&void 0!==a?new n(this.wasmTensor.clip_backward(t,a,e.wasmTensor)):void 0!==t?new n(this.wasmTensor.clip_min_backward(t,e.wasmTensor)):void 0!==a?new n(this.wasmTensor.clip_max_backward(a,e.wasmTensor)):this.copy()}},{key:"repeat",value:function(e){return new n(this.wasmTensor.repeat(new Uint32Array(e)))}},{key:"expand",value:function(e){var t=this.getShape(),a=this.alignShapes(t,e),i=Object(w.a)(a,3),r=i[0],s=(i[1],i[2]);return C(t,s)?this.copy():new n(this.reshape(r,!1).wasmTensor.expand(new Uint32Array(s)))}},{key:"pad_impl",value:function(e,t,a){return new n(this.wasmTensor.pad(new Uint32Array(e),n.padModeToInt[t],a))}},{key:"gather",value:function(e,t){return new n(this.wasmTensor.gather(e,t.values,new Uint32Array(t.shape)))}},{key:"floor",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Floor can only be called on float tensors");return new n(this.wasmTensor.floor())}},{key:"ceil",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Ceil can only be called on float tensors");return new n(this.wasmTensor.ceil())}},{key:"round",value:function(){if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Round can only be called on float tensors");return new n(this.wasmTensor.round())}},{key:"slice_impl",value:function(e,t,a,i){return new n(this.wasmTensor.slice(new Uint32Array(e),new Uint32Array(t),new Uint32Array(a),new Int32Array(i)))}},{key:"upsample",value:function(e){return new n(this.wasmTensor.upsample(new Float32Array(e)))}},{key:"normalize",value:function(e,t,a,i,r){if(!(e instanceof n)||!(t instanceof n)||!(i instanceof n)||!(r instanceof n))throw new Error("Can only normalize with WASM tensors");if(!(this.wasmTensor instanceof dt)&&!(this.wasmTensor instanceof ft))throw new Error("Normalize can only be called on float tensors");return new n(this.wasmTensor.normalize(e.wasmTensor,t.wasmTensor,a,i.wasmTensor,r.wasmTensor))}}],[{key:"range",value:function(e,t,a){for(var i=Math.max(Math.ceil((t-e)/a),0),r=new Array(i),s=0;s<i;s++)r[s]=e+s*a;return new n(r,new Uint32Array([i]))}}]),n}(G);function Mn(e,t,n,a,i,r){var s,o=U(e.shape,t,n),u=Object(w.a)(o,2),c=u[0],h=u[1],l=new F(c,void 0,e.values.dtype),p=e.getDenseShape(),f=A(p,1);void 0===i&&void 0===r||(s=new Array(l.size).fill(0));for(var d=e.indices,v=e.values,m=0;m<e.nnz;m++){for(var y=new Array(e.sparseDims),b=0;b<e.sparseDims;b++)y[b]=d.get(m*e.sparseDims+b);for(var g=new Array(e.denseDims).fill(0),k=0;k<f;k++){for(var x=[].concat(y,Object(S.a)(g)),O=new Array(h.length),j=0;j<h.length;j++)O[j]=x[h[j]];var M=T(O,l.strides);void 0!==i&&void 0!==s&&0===s[M]?l.set(M,i(v.get(m*f+k))):l.set(M,a(l.get(M),v.get(m*f+k))),void 0!==s&&s[M]++,V(g,p)}}if(void 0!==r&&void 0!==s)for(var I=0;I<l.size;I++)l.set(I,r(l.get(I),s[I]));return l}function Tn(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return Math.max(e,t)}),(function(e){return e}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){return new An(e.values.wasmTensor.max_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Maximum over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.max(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function In(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return Math.min(e,t)}),(function(e){return e}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){return new An(e.values.wasmTensor.min_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Minimum over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.min(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function Cn(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return e*t}),(function(e){return e}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){return new An(e.values.wasmTensor.product_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Product over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.product(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function Vn(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return e+t}),void 0,(function(e,t){return Math.log(e)}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){if("float32"!==e.dtype&&"float64"===e.dtype)throw new Error("Reduce log sum expects tensor datatype to be float, but found "+e.dtype);return new An(e.values.wasmTensor.reduce_log_sum_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Reduce log sum over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.reduceLogSum(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function Pn(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return e+Math.exp(t)}),(function(e){return Math.exp(e)}),(function(e,t){return Math.log(e)}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){if("float32"!==e.dtype&&"float64"===e.dtype)throw new Error("Reduce log sum exp expects tensor datatype to be float, but found "+e.dtype);return new An(e.values.wasmTensor.reduce_log_sum_exp_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Reduce log sum exp over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.reduceLogSumExp(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function Dn(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return e+t}),void 0,(function(e,t){return e/t}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){return new An(e.values.wasmTensor.reduce_mean_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Reduce mean over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.reduceMean(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function Gn(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return e+t*t}),(function(e){return e*e}),(function(e,t){return e/t}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){return new An(e.values.wasmTensor.reduce_mean_squared_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Reduce mean squared over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.reduceMeanSquare(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function En(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return e+t}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){return new An(e.values.wasmTensor.sum_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Sum over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.sum(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function Rn(e,t,n){if(void 0!==t.find((function(t){return t<e.sparseDims})))return function(e,t,n){if(e.values instanceof F)return function(e,t,n){return Mn(e,t,n,(function(e,t){return e+t*t}),(function(e){return e*e}))}(e,t,n);if(e.values instanceof An)return function(e,t,n){return new An(e.values.wasmTensor.sum_square_sparse(new Uint32Array(e.getShape()),e.indices.wasmTensor,new Uint32Array(t),n),void 0,e.dtype)}(e,t,n);throw new Error("Squared sum over sparse dimensions not implemented in WebGL yet")}(e,t,n);var a=U(e.shape,t,n),i=Object(w.a)(a,2),r=i[0];i[1];return new ea(e.values.sumSquare(t.map((function(t){return t-e.sparseDims+1})),n),e.indices.copy(),r,n?e.denseDims:e.denseDims-t.length)}function _n(e,t,n,a){for(var i=e.sparseDims,r=n.slice(0,i),s=n.slice(i),o=A(s,1),u=e.values,c=e.indices,h=new F([e.nnz].concat(Object(S.a)(s)),void 0,e.dtype),l=e.indices.copy(),p=0;p<e.nnz;p++){for(var f=new Array(r.length),d=0;d<r.length;d++)f[d]=c.get(p*i+d);for(var v=new Array(s.length).fill(0),m=0;m<o;m++){var y=u.get([p].concat(Object(S.a)(v))),w=t.get([].concat(f,Object(S.a)(v)));h.set(p*o+m,a(y,w)),V(v,s)}}return new ea(h,l,n,e.denseDims)}function Xn(e,t,n,a){for(var i=e.sparseDims,r=n.slice(0,i),s=n.slice(i),o=A(s,1),u=e.values,c=e.indices,h=t.values,l=t.indices,p=M(r),f={},d=0;d<t.nnz;d++){for(var v=0,m=0;m<i;m++)v+=l.get(d*i+m)*p[m];f[v]=d}for(var y=new F([e.nnz].concat(Object(S.a)(s)),void 0,e.dtype),w=e.indices.copy(),b=0;b<e.nnz;b++){for(var g=0,k=0;k<i;k++)g+=c.get(b*i+k)*p[k];for(var x=f[g],O=new Array(s.length).fill(0),j=0;j<o;j++){var T=u.get([b].concat(Object(S.a)(O))),I=h.get([x].concat(Object(S.a)(O)));y.set(b*o+j,a(T,I)),V(O,s)}}return new ea(y,w,n,e.denseDims)}function Bn(e,t,n,a,i){return t instanceof ea?function(e,t,n,a,i){if(e.nnz!==t.nnz)throw new Error("Addition with two sparse tensors expects the same sparsity pattern, and thus the same number of nonzero entries in both tensors");if(e.denseDims!==t.denseDims)throw new Error("Addition with two sparse tensors expects the same number of sparse and dense dimensions in both tensors");if(e.values instanceof F)return function(e,t,n,a,i){return Xn(e,t,n,(function(e,t){return a*e+i*t}))}(e,t,n,a,i);if(e.values instanceof An)return function(e,t,n,a,i){var r=new An(e.values.wasmTensor.add_sparse_sparse(e.indices.wasmTensor,t.indices.wasmTensor,t.values.wasmTensor,new Uint32Array(n),a,i),void 0,e.dtype);return new ea(r,e.indices.copy(),n,e.denseDims)}(e,t,n,a,i);throw new Error("Sparse-sparse matrix addition not supported on WebGL backend")}(e,t,n,a,i):function(e,t,n,a,i){if(t instanceof F)return function(e,t,n,a,i){return _n(e,t,n,(function(e,t){return a*e+i*t}))}(e,t,n,a,i);if(t instanceof An)return function(e,t,n,a,i){var r=new An(e.values.wasmTensor.add_sparse_dense(e.indices.wasmTensor,t.wasmTensor,new Uint32Array(n),a,i),void 0,e.dtype);return new ea(r,e.indices.copy(),n,e.denseDims)}(e,t,n,a,i);throw new Error("Sparse-dense matrix addition not supported on WebGL backend")}(e,t,n,a,i)}function zn(e,t,n,a){return t instanceof ea?function(e,t,n,a){if(e.nnz!==t.nnz)throw new Error("Element wise division with two sparse tensors expects the same sparsity pattern, and thus the same number of nonzero entries in both tensors");if(e.denseDims!==t.denseDims)throw new Error("Element wise division with two sparse tensors expects the same number of sparse and dense dimensions in both tensors");if(e.values instanceof F)return function(e,t,n,a){return Xn(e,t,n,(function(e,t){return a*e/t}))}(e,t,n,a);if(e.values instanceof An)return function(e,t,n,a){var i=new An(e.values.wasmTensor.divide_sparse_sparse(e.indices.wasmTensor,t.indices.wasmTensor,t.values.wasmTensor,new Uint32Array(n),a),void 0,e.dtype);return new ea(i,e.indices.copy(),n,e.denseDims)}(e,t,n,a);throw new Error("Sparse-sparse matrix division not supported on WebGL backend")}(e,t,n,a):function(e,t,n,a){if(t instanceof F)return function(e,t,n,a){return _n(e,t,n,(function(e,t){return a*e/t}))}(e,t,n,a);if(t instanceof An)return function(e,t,n,a){var i=new An(e.values.wasmTensor.divide_sparse_dense(e.indices.wasmTensor,t.wasmTensor,new Uint32Array(n),a),void 0,e.dtype);return new ea(i,e.indices.copy(),n,e.denseDims)}(e,t,n,a);throw new Error("Sparse-dense matrix element wise division not supported on WebGL backend")}(e,t,n,a)}function Un(e,t,n,a){return t instanceof ea?function(e,t,n,a){if(e.nnz!==t.nnz)throw new Error("Element wise multiplication with two sparse tensors expects the same sparsity pattern, and thus the same number of nonzero entries in both tensors");if(e.denseDims!==t.denseDims)throw new Error("Element wise multiplication with two sparse tensors expects the same number of sparse and dense dimensions in both tensors");if(e.values instanceof F)return function(e,t,n,a){return Xn(e,t,n,(function(e,t){return a*e*t}))}(e,t,n,a);if(e.values instanceof An)return function(e,t,n,a){var i=new An(e.values.wasmTensor.multiply_sparse_sparse(e.indices.wasmTensor,t.indices.wasmTensor,t.values.wasmTensor,new Uint32Array(n),a),void 0,e.dtype);return new ea(i,e.indices.copy(),n,e.denseDims)}(e,t,n,a);throw new Error("Sparse-sparse matrix addition not supported on WebGL backend")}(e,t,n,a):function(e,t,n,a){if(t instanceof F)return function(e,t,n,a){return _n(e,t,n,(function(e,t){return a*e*t}))}(e,t,n,a);if(t instanceof An)return function(e,t,n,a){var i=new An(e.values.wasmTensor.multiply_sparse_dense(e.indices.wasmTensor,t.wasmTensor,new Uint32Array(n),a),void 0,e.dtype);return new ea(i,e.indices.copy(),n,e.denseDims)}(e,t,n,a);throw new Error("Sparse-dense matrix element wise multiplication not supported on WASM/WebGL backend")}(e,t,n,a)}function Wn(e,t,n,a,i){return t instanceof ea?function(e,t,n,a,i){if(e.nnz!==t.nnz)throw new Error("Subtraction with two sparse tensors expects the same sparsity pattern, and thus the same number of nonzero entries in both tensors");if(e.denseDims!==t.denseDims)throw new Error("Subtraction with two sparse tensors expects the same number of sparse and dense dimensions in both tensors");if(e.values instanceof F)return function(e,t,n,a,i){return Xn(e,t,n,(function(e,t){return a*e-i*t}))}(e,t,n,a,i);if(e.values instanceof An)return function(e,t,n,a,i){var r=new An(e.values.wasmTensor.subtract_sparse_sparse(e.indices.wasmTensor,t.indices.wasmTensor,t.values.wasmTensor,new Uint32Array(n),a,i),void 0,e.dtype);return new ea(r,e.indices.copy(),n,e.denseDims)}(e,t,n,a,i);throw new Error("Sparse-sparse matrix subtraction not supported on WebGL backend")}(e,t,n,a,i):function(e,t,n,a,i){if(t instanceof F)return function(e,t,n,a,i){return _n(e,t,n,(function(e,t){return a*e-i*t}))}(e,t,n,a,i);if(t instanceof An)return function(e,t,n,a,i){var r=new An(e.values.wasmTensor.subtract_sparse_dense(e.indices.wasmTensor,t.wasmTensor,new Uint32Array(n),a,i),void 0,e.dtype);return new ea(r,e.indices.copy(),n,e.denseDims)}(e,t,n,a,i);throw new Error("Sparse-dense matrix addition not supported on WASM/WebGL backend")}(e,t,n,a,i)}An.padModeToInt={constant:0,reflect:1,edge:2};var Ln=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("axis")," int axis;\n    ").concat(this.getVarModifier("count")," int count;\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"axis"},{name:"count"}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      float res = _A(index);\n\n      if (index[1] == axis) {\n        res += float(count);\n      }\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.A});var t=this.getOutputShape(e),n=this.getCompilationInfo(e);return this.compute(t,{A:e.A},{axis:n.axis,count:n.count})}},{key:"getOutputShape",value:function(e){return Object(S.a)(e.A.shape)}},{key:"compile",value:function(e){Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,axis:e.axis,count:e.count}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.axis,"-").concat(e.count)}}]),n}(ie),Fn=new Le((function(e){return new Ln(pt,e)}));function Nn(e,t,n){if(!C(e.shape,t.shape)||e.sparseDims!==t.sparseDims)throw new Error("Sparse tensors can only be concatenated with the same shape and number of sparse dims");if(n>e.sparseDims)throw new Error("Concatenation along dense axis of sparse tensor not supported yet");var a=e.values.concat(t.values,0),i=function(e,t,n){return e instanceof F?function(e,t,n){for(var a=e.copy(),i=t;i<a.size;i+=e.shape[1])a.set(i,a.get(i)+n);return a}(e,t,n):e instanceof An?function(e,t,n){return new An(e.wasmTensor.add_index(t,n))}(e,t,n):function(e,t,n){return Fn.calc({A:e,axis:t,count:n},"uint32")}(e,t,n)}(t.indices,n,e.shape[n]),r=e.indices.concat(i,0);i.delete();var s=Object(S.a)(e.shape);return s[n]+=t.shape[n],new ea(a,r,s,e.denseDims)}function qn(e,t){if(t instanceof ea)throw new Error("Sparse-sparse matrix multiplication not yet implemented");return function(e,t){if(1===e.denseDims)return new ea(e.values.matMul(t),e.indices.copy(),[e.shape[0],t.getShape()[1]],1);if(t instanceof F)return function(e,t){for(var n=e.shape[0],a=t.shape[1],i=new F([n,a],void 0,t.dtype),r=e.indices,s=e.values,o=0;o<e.nnz;o++)for(var u=r.get(2*o),c=r.get(2*o+1),h=s.get(o),l=0;l<a;l++)i.set(u*a+l,i.get(u*a+l)+h*t.get(c*a+l));return i}(e,t);if(t instanceof An)return function(e,t){return new An(e.values.wasmTensor.matmul_sparse_dense(e.indices.wasmTensor,t.wasmTensor,e.shape[0]),void 0,e.dtype)}(e,t);throw new Error("Sparse-dense matrix multiplication not yet supported on WebGL")}(e,t)}var Hn=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("sparseShape")," int sparseShape[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("repeatStrides")," int repeatStrides[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"sparseShape",length:this.maxRank},{name:"repeatStrides",length:this.maxRank}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      int newPos = index[0];\n      int nnz = shapeA[0];\n\n      int repeatPos = newPos / nnz;\n      int oldPos = newPos - repeatPos*nnz;\n\n      int oldIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("oldIx"),"\n      oldIx[0] = oldPos;\n      oldIx[1] = index[1];\n\n      int repeatIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("repeatIx"),"\n      ").concat(this.posToIndex("repeatStrides","repeatIx","repeatPos"),"\n\n      float res = _A(oldIx);\n      for (int i = 0; i < ").concat(this.maxRank,"; i++) {\n        if (i == index[1]) {\n          res += float(repeatIx[i]*sparseShape[i]);\n          break;\n        }\n      }\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.A});var t=this.getOutputShape(e),n=this.getCompilationInfo(e);return this.compute(t,{A:e.A},{sparseShape:this.pad(n.sparseShape),repeatStrides:this.pad(n.repeatStrides)})}},{key:"getOutputShape",value:function(e){return[e.A.shape[0]*e.repeatsProd,e.A.shape[1]]}},{key:"compile",value:function(e){void 0!==e.sparseShape&&(this.maxRank=e.sparseShape.length),void 0!==e.repeatStrides&&(this.maxRank=e.repeatStrides.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,sparseShape:e.shape,repeatStrides:M(e.repeats)}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.repeats,"-").concat(e.shape)}}]),n}(ie),Jn=new Le((function(e){return new Hn(pt,e)}));function Kn(e,t){var n,a=t.slice(0,e.sparseDims),i=t.slice(e.sparseDims),r=a.reduce((function(e,t){return e*t}),1),s=e.values.repeat([r].concat(Object(S.a)(i)));n=r>1?function(e,t,n,a){return e instanceof F?function(e,t,n,a){for(var i=e.shape[0],r=i*a,s=e.shape[1],o=new F([i*a,s],void 0,"uint32"),u=M(t),c=0;c<r;c++)for(var h=c%i,l=I(Math.floor(c/i),u).map((function(e,t){return e*n[t]})),p=0;p<s;p++)o.set(c*s+p,l[p]+e.get(h*s+p));return o}(e,t,n,a):e instanceof An?function(e,t,n,a){return new An(e.wasmTensor.repeat_sparse_indices(new Uint32Array(t),new Uint32Array(n),a))}(e,t,n,a):function(e,t,n,a){return Jn.calc({A:e,repeats:t,shape:n,repeatsProd:a},"uint32")}(e,t,n,a)}(e.indices,a,e.getSparseShape(),r):e.indices.copy();var o=e.shape.map((function(e,n){return e*t[n]}));return new ea(s,n,o,e.denseDims)}var Zn=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("nnzFraction")," int nnzFraction;\n    ").concat(this.getVarModifier("sparseDims")," int sparseDims;\n    ").concat(this.getVarModifier("oldSparseStrides")," int oldSparseStrides[").concat(this.maxRank,"];\n    ").concat(this.getVarModifier("newSparseStrides")," int newSparseStrides[").concat(this.maxRank,"];\n    ")}},{key:"getUniformAttrs",value:function(){return[{name:"nnzFraction"},{name:"sparseDims"},{name:"oldSparseStrides",length:this.maxRank},{name:"newSparseStrides",length:this.maxRank}]}},{key:"getFragmentShader",value:function(e){return"\n    float process(int index[".concat(this.maxRank,"]) {\n      float res = 0.0;\n\n      int newNNZ = int(index[0]);\n      int oldNnzIx = newNNZ / nnzFraction;\n      int residualNNZ = newNNZ - oldNnzIx*nnzFraction;\n\n      int oldSparseIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("oldSparseIx"),"\n      for (int j = 0; j < ").concat(this.maxRank,"; j++) {\n        if (j >= sparseDims) {\n          break;\n        }\n        oldSparseIx[j] = int(getValueAtPos(oldNnzIx * sparseDims + j, widthA, heightA, A));\n      }\n\n      int oldSparsePos = indexToPos(oldSparseIx, oldSparseStrides);\n      int newSparsePos = oldSparsePos * nnzFraction + residualNNZ;\n      int newSparseIx[").concat(this.maxRank,"];\n      ").concat(this.initIndex("newSparseIx"),"\n      ").concat(this.posToIndex("newSparseStrides","newSparseIx","newSparsePos"),"\n\n      int ax = int(index[1]);\n\n      for (int j = 0; j < ").concat(this.maxRank,"; j++) {\n        if (j == ax) {\n          res = float(newSparseIx[j]);\n          break;\n        }\n      }\n\n      return res;\n    }\n\n    ").concat(this.getDefaultMain(),"\n    ")}},{key:"getTextureNames",value:function(){return["A"]}},{key:"calc",value:function(e){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:e.A});var t=this.getOutputShape(e),n=this.getCompilationInfo(e);return this.compute(t,{A:e.A},{nnzFraction:n.nnzFraction,sparseDims:n.sparseDims,oldSparseStrides:this.pad(n.oldSparseStrides),newSparseStrides:this.pad(n.newSparseStrides)})}},{key:"getOutputShape",value:function(e){for(var t=A(e.sparseShape),n=[],a=1,i=0;i<e.shape.length&&a<t;i++)a*=e.shape[i],n.push(e.shape[i]);var r=a/t;return[e.nnz*r,n.length]}},{key:"compile",value:function(e){Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){for(var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype),a=A(e.sparseShape),i=[],r=[],s=1,o=0;o<e.shape.length;o++)s<a?(s*=e.shape[o],i.push(e.shape[o])):r.push(e.shape[o]);var u=M(e.sparseShape),c=M(i),h=s/a;return{shapeA:e.A.shape,widthA:e.A.memory.width,heightA:e.A.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,sparseDims:e.sparseShape.length,newSparseStrides:c,oldSparseStrides:u,nnzFraction:h}}},{key:"getInputInfoString",value:function(e){return"".concat(e.A.shape,"-").concat(e.nnz,"-").concat(e.shape,"-").concat(e.sparseShape)}}]),n}(ie),Yn=new Le((function(e){return new Zn(pt,e)}));function Qn(e,t,n){return e.values instanceof F?function(e,t,n,a,i){for(var r=A(e.getSparseShape()),s=[],o=[],u=1,c=0;c<a.length;c++)u<r?(u*=a[c],s.push(a[c])):o.push(a[c]);var h,l=M(e.getSparseShape()),p=M(s),f=u/r,d=e.nnz*f,v=t.reshape([d].concat(o),i);if(!i&&C(s,e.getSparseShape()))h=n;else{h=new F([d,s.length],void 0,"uint32");for(var m=0;m<d;m++){for(var y=Math.floor(m/f),w=[],b=0;b<e.sparseDims;b++)w.push(n.get(y*e.sparseDims+b));for(var g=I(T(w,l)*f+m%f,p),k=0;k<s.length;k++)h.set(m*s.length+k,g[k])}}return new ea(v,h,a,o.length)}(e,e.values,e.indices,t,n):e.values instanceof An?function(e,t,n,a,i){for(var r=A(e.getSparseShape()),s=[],o=[],u=1,c=0;c<a.length;c++)u<r?(u*=a[c],s.push(a[c])):o.push(a[c]);var h,l=u/r,p=e.nnz*l,f=t.reshape([p].concat(o),i);return h=!i&&C(s,e.getSparseShape())?n:new An(n.wasmTensor.reshape_sparse_indices(new Uint32Array(e.getSparseShape()),new Uint32Array(a)),void 0,"uint32"),new ea(f,h,a,o.length)}(e,e.values,e.indices,t,n):function(e,t,n,a,i){for(var r=A(e.getSparseShape()),s=[],o=[],u=1,c=0;c<a.length;c++)u<r?(u*=a[c],s.push(a[c])):o.push(a[c]);var h,l=u/r,p=e.nnz*l,f=t.reshape([p].concat(o),i);return h=!i&&C(s,e.getSparseShape())?n:Yn.calc({A:n,sparseShape:e.getSparseShape(),shape:a,nnz:e.nnz},"uint32"),new ea(f,h,a,o.length)}(e,e.values,e.indices,t,n)}var $n=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ea=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(g.a)(this,n),(r=t.call(this,e.dtype)).values=e,r.indices=a,r.shape=i,r.denseDims=s,r.size=A(i),r.strides=M(i),r.nnz=r.indices.getShape()[0],r.sparseDims=r.shape.length-r.denseDims,r}return Object(k.a)(n,[{key:"getValues",value:function(){return $n(this,void 0,void 0,m.a.mark((function e(){var t,n,a,i,r,s,o,u,c,h;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.values.getValues();case 2:return t=e.sent,e.next=5,this.indices.getValues();case 5:for(n=e.sent,a=A(this.getDenseShape(),1),i=M(this.getSparseShape()),r=new D[this.values.dtype](this.size),s=0;s<this.nnz;s++){for(o=[],u=0;u<this.sparseDims;u++)o.push(n[s*this.sparseDims+u]);for(c=T(o,i),h=0;h<a;h++)r[c*a+h]=t[s*a+h]}return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"getSparseShape",value:function(){return this.shape.slice(0,this.shape.length-this.denseDims)}},{key:"getDenseShape",value:function(){return this.shape.slice(this.shape.length-this.denseDims)}},{key:"getShape",value:function(){return this.shape}},{key:"constantLike",value:function(e){return new n(this.values.constantLike(e),this.indices.copy(),this.shape,this.denseDims)}},{key:"singleConstant",value:function(e){throw new Error("Method not implemented.")}},{key:"cast",value:function(e){return new n(this.values.cast(e),this.indices.copy(),this.shape,this.denseDims)}},{key:"delete",value:function(){this.values.delete(),this.indices.delete()}},{key:"reshape_impl",value:function(e,t){return Qn(this,e,t)}},{key:"exp",value:function(){return new n(this.values.exp(),this.indices.copy(),this.shape,this.denseDims)}},{key:"log",value:function(){return new n(this.values.log(),this.indices.copy(),this.shape,this.denseDims)}},{key:"sqrt",value:function(){return new n(this.values.sqrt(),this.indices.copy(),this.shape,this.denseDims)}},{key:"abs",value:function(){return new n(this.values.abs(),this.indices.copy(),this.shape,this.denseDims)}},{key:"sin",value:function(){return new n(this.values.sin(),this.indices.copy(),this.shape,this.denseDims)}},{key:"cos",value:function(){return new n(this.values.cos(),this.indices.copy(),this.shape,this.denseDims)}},{key:"tan",value:function(){return new n(this.values.tan(),this.indices.copy(),this.shape,this.denseDims)}},{key:"asin",value:function(){return new n(this.values.asin(),this.indices.copy(),this.shape,this.denseDims)}},{key:"acos",value:function(){return new n(this.values.acos(),this.indices.copy(),this.shape,this.denseDims)}},{key:"atan",value:function(){return new n(this.values.atan(),this.indices.copy(),this.shape,this.denseDims)}},{key:"sinh",value:function(){return new n(this.values.sinh(),this.indices.copy(),this.shape,this.denseDims)}},{key:"cosh",value:function(){return new n(this.values.cosh(),this.indices.copy(),this.shape,this.denseDims)}},{key:"tanh",value:function(){return new n(this.values.tanh(),this.indices.copy(),this.shape,this.denseDims)}},{key:"asinh",value:function(){return new n(this.values.asinh(),this.indices.copy(),this.shape,this.denseDims)}},{key:"acosh",value:function(){return new n(this.values.acosh(),this.indices.copy(),this.shape,this.denseDims)}},{key:"atanh",value:function(){return new n(this.values.atanh(),this.indices.copy(),this.shape,this.denseDims)}},{key:"negate",value:function(){return new n(this.values.negate(),this.indices.copy(),this.shape,this.denseDims)}},{key:"powerScalar",value:function(e,t){return new n(this.values.powerScalar(e,t),this.indices.copy(),this.shape,this.denseDims)}},{key:"sigmoid",value:function(){return new n(this.values.sigmoid(),this.indices.copy(),this.shape,this.denseDims)}},{key:"hardSigmoid",value:function(e,t){return new n(this.values.hardSigmoid(e,t),this.indices.copy(),this.shape,this.denseDims)}},{key:"sign",value:function(){return new n(this.values.sign(),this.indices.copy(),this.shape,this.denseDims)}},{key:"addMultiplyScalar",value:function(e,t){return new n(this.values.addMultiplyScalar(e,t),this.indices.copy(),this.shape,this.denseDims)}},{key:"matMul",value:function(e){return qn(this,e)}},{key:"concat",value:function(e,t){if(!(e instanceof n))throw new Error("Can only concatenate sparse tensors!");return Nn(this,e,t)}},{key:"clip",value:function(e,t){return new n(this.values.clip(e,t),this.indices.copy(),this.shape,this.denseDims)}},{key:"clipBackward",value:function(e,t,n){throw new Error("Method not implemented.")}},{key:"repeat",value:function(e){return Kn(this,e)}},{key:"expand",value:function(e){throw new Error("Method not implemented.")}},{key:"copy",value:function(){return new n(this.values.copy(),this.indices.copy(),this.shape,this.denseDims)}},{key:"gather",value:function(e,t){throw new Error("Method not implemented.")}},{key:"setValues",value:function(e,t){throw new Error("Method not implemented.")}},{key:"floor",value:function(){return new n(this.values.floor(),this.indices.copy(),this.shape,this.denseDims)}},{key:"ceil",value:function(){return new n(this.values.ceil(),this.indices.copy(),this.shape,this.denseDims)}},{key:"round",value:function(){return new n(this.values.round(),this.indices.copy(),this.shape,this.denseDims)}},{key:"upsample",value:function(e){throw new Error("Method not implemented.")}},{key:"normalize",value:function(e,t,n,a,i){throw new Error("Method not implemented.")}},{key:"add",value:function(e,t,a){return Object(N.a)(Object(q.a)(n.prototype),"add",this).call(this,e,t,a)}},{key:"subtract",value:function(e,t,a){return Object(N.a)(Object(q.a)(n.prototype),"subtract",this).call(this,e,t,a)}},{key:"multiply",value:function(e,t){return Object(N.a)(Object(q.a)(n.prototype),"multiply",this).call(this,e,t)}},{key:"divide",value:function(e,t){return Object(N.a)(Object(q.a)(n.prototype),"divide",this).call(this,e,t)}},{key:"add_impl",value:function(e,t,n,a,i){return Bn(e,t,n,a,i)}},{key:"subtract_impl",value:function(e,t,n,a,i){return Wn(e,t,n,a,i)}},{key:"multiply_impl",value:function(e,t,n,a){return Un(e,t,n,a)}},{key:"divide_impl",value:function(e,t,n,a){return zn(e,t,n,a)}},{key:"power_impl",value:function(e,t,n){throw new Error("Method not implemented.")}},{key:"gemm_impl",value:function(e,t,n,a,i,r){throw new Error("Method not implemented.")}},{key:"sum",value:function(e,t){return Object(N.a)(Object(q.a)(n.prototype),"sum",this).call(this,e,t)}},{key:"sum_impl",value:function(e,t){return En(this,e,t)}},{key:"sumSquare_impl",value:function(e,t){return Rn(this,e,t)}},{key:"product_impl",value:function(e,t){return Cn(this,e,t)}},{key:"max_impl",value:function(e,t){return Tn(this,e,t)}},{key:"min_impl",value:function(e,t){return In(this,e,t)}},{key:"reduceMean_impl",value:function(e,t){return Dn(this,e,t)}},{key:"reduceMeanSquare_impl",value:function(e,t){return Gn(this,e,t)}},{key:"reduceLogSum_impl",value:function(e,t){return Vn(this,e,t)}},{key:"reduceLogSumExp_impl",value:function(e,t){return Pn(this,e,t)}},{key:"conv_impl",value:function(e,t,n,a,i,r,s){throw new Error("Method not implemented.")}},{key:"convTranspose_impl",value:function(e,t,n,a,i){throw new Error("Method not implemented.")}},{key:"pad_impl",value:function(e,t,n){throw new Error("Method not implemented.")}},{key:"averagePool_impl",value:function(e,t,n,a){throw new Error("Method not implemented.")}},{key:"transpose_impl",value:function(e){throw new Error("Method not implemented.")}},{key:"slice_impl",value:function(e,t,n,a){throw new Error("Method not implemented.")}}],[{key:"fromDense",value:function(e){for(var t=0,a=[],i=[],r=0;r<e.size;r++)if(0!==e.get(r)){t++;for(var s=I(r,e.strides),o=0;o<e.shape.length;o++)a.push(s[o]);i.push(e.get(r))}var u=new F([t,e.shape.length],a,"uint32");return new n(new F([t],i,e.dtype),u,e.shape)}}]),n}(G),ta=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.sign(),n=e.multiply(t);t.delete(),this.input.backward(n)||n.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),na=function(){function e(t,n){Object(g.a)(this,e),this.input=t,this.exp=n}return Object(k.a)(e,[{key:"backward",value:function(e){var t=e.multiply(this.exp);this.input.backward(t)||t.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),aa=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=e.divide(this.input.value);this.input.backward(t)||t.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),ia=function(){function e(t,n){Object(g.a)(this,e),this.a=t,this.b=n}return Object(k.a)(e,[{key:"backward",value:function(e){if(!this.b.noGrad){var t=this.a.value.gemm(e,!0,!1);this.b.backward(t)||t.delete()}if(!this.a.noGrad){var n=e.gemm(this.b.value,!1,!0);this.a.backward(n)||n.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()}}]),e}(),ra=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=e.negate();this.input.backward(t)||t.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),sa=function(){function e(t,n){Object(g.a)(this,e),this.input=t,this.sqrt=n}return Object(k.a)(e,[{key:"backward",value:function(e){var t=e.divide(this.sqrt,.5);this.input.backward(t)||t.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),oa=function(){function e(t,n,a){Object(g.a)(this,e),this.a=t,this.b=n,this.axis=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.axis;if(t<0&&(t+=this.a.getShape().length),!this.a.noGrad){var n=e.slice([0],[this.a.getShape()[t]],[t]);this.a.backward(n)||n.delete()}if(!this.b.noGrad){var a=e.slice([this.a.getShape()[t]],[e.getShape()[t]],[t]);this.b.backward(a)||a.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()}}]),e}(),ua=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.min=n,this.max=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.clipBackward(e,this.min,this.max);this.input.backward(t)||t.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),ca=function(){function e(t,n){Object(g.a)(this,e),this.a=t,this.repeats=n}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=this.a.getShape(),n=[],a=[],i=0;i<t.length;i++)n.push(this.repeats[i],t[i]),a.push(2*i);var r=e.reshape(n,!1).sum(a,!1);this.a.backward(r)||r.delete()}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete()}}]),e}(),ha=function(){function e(t,n){Object(g.a)(this,e),this.a=t,this.shape=n}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=this.a.value.alignShapes(this.a.getShape(),this.shape),n=Object(w.a)(t,3),a=n[0],i=n[1],r=(n[2],[]),s=0;s<a.length;s++)a[s]<i[s]&&r.push(s);var o=e.sum(r).reshape(this.a.getShape());this.a.backward(o)||o.delete()}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete()}}]),e}(),la=function(){function e(t){Object(g.a)(this,e),this.a=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.a.getShape();if(!this.a.noGrad){var n=e.reshape(t);this.a.backward(n)||n.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete()}}]),e}(),pa=function(){function e(t,n,a,i,r){Object(g.a)(this,e),this.a=t,this.b=n,this.shape=a,this.alpha=i,this.beta=r}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=this.a.getShape(),n=this.b.getShape(),a=[],i=[],r=0;r<this.shape.length;r++)t[r]<this.shape[r]&&a.push(r),n[r]<this.shape[r]&&i.push(r);if(!this.a.noGrad){var s;if(0===a.length)s=1===this.alpha?e.reshape(t):e.multiplyScalar(this.alpha).reshape(t,!1);else if(1===this.alpha)s=e.sum(a).reshape(t,!1);else{var o=e.sum(a),u=o.multiplyScalar(this.alpha);o.delete(),s=u.reshape(t,!1)}this.a.backward(s)||s.delete()}if(!this.b.noGrad){var c;if(0===i.length)c=1===this.beta?e.reshape(n):e.multiplyScalar(this.beta).reshape(n,!1);else if(1===this.beta)c=e.sum(i).reshape(n,!1);else{var h=e.sum(i),l=h.multiplyScalar(this.beta);h.delete(),c=l.reshape(n,!1)}this.b.backward(c)||c.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()}}]),e}(),fa=function(){function e(t,n,a,i,r){Object(g.a)(this,e),this.a=t,this.b=n,this.shape=a,this.alpha=i,this.beta=r}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=this.a.getShape(),n=this.b.getShape(),a=[],i=[],r=0;r<this.shape.length;r++)t[r]<this.shape[r]&&a.push(r),n[r]<this.shape[r]&&i.push(r);if(!this.a.noGrad){var s;if(0===a.length)s=1===this.alpha?e.reshape(t):e.multiplyScalar(this.alpha).reshape(t,!1);else if(1===this.alpha)s=e.sum(a).reshape(t,!1);else{var o=e.sum(a),u=o.multiplyScalar(this.alpha);o.delete(),s=u.reshape(t,!1)}this.a.backward(s)||s.delete()}if(!this.b.noGrad){var c;if(0===i.length)c=e.multiplyScalar(-this.beta).reshape(n,!1);else{var h=e.sum(i),l=h.multiplyScalar(-this.beta);h.delete(),c=l.reshape(n,!1)}this.b.backward(c)||c.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()}}]),e}(),da=function(){function e(t,n,a,i){Object(g.a)(this,e),this.a=t,this.b=n,this.shape=a,this.alpha=i}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=this.a.getShape(),n=this.b.getShape(),a=[],i=[],r=0;r<this.shape.length;r++)t[r]<this.shape[r]&&a.push(r),n[r]<this.shape[r]&&i.push(r);if(!this.a.noGrad){var s;if(0===a.length)s=e.multiply(this.b.value,this.alpha).reshape(t,!1);else{var o=e.multiply(this.b.value,this.alpha),u=o.sum(a);o.delete(),s=u.reshape(t,!1)}this.a.backward(s)||s.delete()}if(!this.b.noGrad){var c;if(0===i.length)c=e.multiply(this.a.value,this.alpha).reshape(n,!1);else{var h=e.multiply(this.a.value,this.alpha),l=h.sum(i);h.delete(),c=l.reshape(n,!1)}this.b.backward(c)||c.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()}}]),e}(),va=function(){function e(t,n,a,i,r,s,o){Object(g.a)(this,e),this.x=t,this.w=n,this.strides=a,this.padding=i,this.dilations=r,this.group=s,this.b=o}return Object(k.a)(e,[{key:"backward",value:function(e){if(!this.w.noGrad){var t=this.x.value.conv(e,void 0,this.strides,this.group,this.padding,this.dilations);this.w.backward(t)||t.delete()}if(void 0!==this.b&&!this.b.noGrad){for(var n=[0],a=0;a<this.dilations.length;a++)n.push(a+2);var i=e.sum(n);this.b.backward(i)||i.delete()}if(!this.x.noGrad){for(var r=this.w.getShape(),s=[],o=0;o<this.dilations.length;o++)s.push(r[o+2]-this.padding[o]+this.dilations[o]-2);s=[].concat(Object(S.a)(s),Object(S.a)(s));var u=e.convTranspose(this.w.value,this.dilations,this.group,s,this.strides);this.x.backward(u)||u.delete()}}},{key:"delete",value:function(){this.x.isLeaf()||this.x.delete(),this.w.isLeaf()||this.w.delete(),void 0===this.b||this.b.isLeaf()||this.b.delete()}}]),e}(),ma=function(){function e(t,n,a,i,r){Object(g.a)(this,e),this.a=t,this.b=n,this.divResult=a,this.shape=i,this.alpha=r}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=this.a.getShape(),n=this.b.getShape(),a=[],i=[],r=0;r<this.shape.length;r++)t[r]<this.shape[r]&&a.push(r),n[r]<this.shape[r]&&i.push(r);if(!this.a.noGrad){var s;if(0===a.length)s=e.divide(this.b.value,this.alpha).reshape(t,!1);else{var o=e.divide(this.b.value,this.alpha),u=o.sum(a);o.delete(),s=u.reshape(t,!1)}this.a.backward(s)||s.delete()}if(!this.b.noGrad){var c;if(0===i.length){var h=e.multiply(this.divResult),l=h.divide(this.b.value,-this.alpha);h.delete(),c=l.reshape(n,!1)}else{var p=e.multiply(this.divResult),f=p.divide(this.b.value,-this.alpha);p.delete();var d=f.sum(i);f.delete(),c=d.reshape(n,!1)}this.b.backward(c)||c.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()}}]),e}(),ya=function(){function e(t,n,a,i){Object(g.a)(this,e),this.a=t,this.b=n,this.powerResult=a,this.shape=i}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=this.a.getShape(),n=this.b.getShape(),a=[],i=[],r=0;r<this.shape.length;r++)t[r]<this.shape[r]&&a.push(r),n[r]<this.shape[r]&&i.push(r);if(!this.a.noGrad){var s;if(0===a.length){var o=this.powerResult.multiply(this.b.value),u=o.divide(this.a.value);o.delete();var c=e.multiply(u);u.delete(),s=c.reshape(t,!1)}else{var h=this.powerResult.multiply(this.b.value),l=h.divide(this.a.value);h.delete();var p=e.multiply(l);l.delete();var f=p.sum(a);p.delete(),s=f.reshape(t,!1)}this.a.backward(s)||s.delete()}if(!this.b.noGrad){var d;if(0===i.length){var v=this.a.value.log(),m=this.powerResult.multiply(v);v.delete(),d=e.multiply(m),m.delete(),d=d.reshape(n,!1)}else{var y=this.a.value.log(),w=this.powerResult.multiply(y);y.delete();var b=e.multiply(w);w.delete();var g=b.sum(i);b.delete(),d=g.reshape(n,!1)}this.b.backward(d)||d.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()}}]),e}(),wa=function(){function e(t,n,a,i,r,s,o){Object(g.a)(this,e),this.a=t,this.b=n,this.transA=a,this.transB=i,this.alpha=r,this.beta=s,this.c=o}return Object(k.a)(e,[{key:"backward",value:function(e){var t,n;this.b.noGrad||(t=this.transB?e.gemm(this.a.value,!0,this.transA,this.alpha):this.a.value.gemm(e,!this.transA,!1,this.alpha),this.b.backward(t)||t.delete());this.a.noGrad||(n=this.transA?this.b.value.gemm(e,this.transB,!0,this.alpha):e.gemm(this.b.value,!1,!this.transB,this.alpha),this.a.backward(n)||n.delete());if(void 0!==this.c&&!this.c.noGrad){for(var a=e.getShape(),i=this.c.getShape(),r=[],s=0;s<a.length;s++)i[s]<a[s]&&r.push(s);var o=e.sum(r).reshape(i,!1);if(1!==this.beta){var u=o;o=o.multiplyScalar(this.beta),u.delete()}this.c.backward(o)||o.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete(),void 0===this.c||this.c.isLeaf()||this.c.delete()}}]),e}(),ba=function(){function e(t,n){Object(g.a)(this,e),this.a=t,this.permutation=n}return Object(k.a)(e,[{key:"backward",value:function(e){for(var t=new Array(this.permutation.length),n=0;n<this.permutation.length;n++)t[this.permutation[n]]=n;var a=e.transpose(t);this.a.backward(a)||a.delete()}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete()}}]),e}(),ga=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.sumDims=n,this.keepDims=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.getShape();if(!this.keepDims){for(var n=[],a=0,i=0;i<t.length;i++)a<this.sumDims.length&&this.sumDims[a]===i?(n.push(1),a++):n.push(t[i]);e=e.reshape(n,!1)}e=e.expand(t),this.input.backward(e)||e.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),ka=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.sumDims=n,this.keepDims=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.getShape();if(!this.keepDims){for(var n=[],a=0,i=0;i<t.length;i++)a<this.sumDims.length&&this.sumDims[a]===i?(n.push(1),a++):n.push(t[i]);e=e.reshape(n,!1)}var r=e.expand(t),s=r.multiply(this.input.value,2);r.delete(),this.input.backward(s)||s.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),xa=function(){function e(t,n){Object(g.a)(this,e),this.input=t,this.scalar=n}return Object(k.a)(e,[{key:"backward",value:function(e){var t=e.multiplyScalar(this.scalar);this.input.backward(t)||t.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Oa=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.sumDims=n,this.keepDims=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.getShape();if(!this.keepDims){for(var n=[],a=0,i=0;i<t.length;i++)a<this.sumDims.length&&this.sumDims[a]===i?(n.push(1),a++):n.push(t[i]);e=e.reshape(n,!1)}for(var r=1,s=0;s<this.sumDims.length;s++)r*=t[this.sumDims[s]];var o=e.multiplyScalar(1/r),u=o.expand(t);o.delete,this.input.backward(u)||e.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),ja=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.sumDims=n,this.keepDims=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.getShape();if(!this.keepDims){for(var n=[],a=0,i=0;i<t.length;i++)a<this.sumDims.length&&this.sumDims[a]===i?(n.push(1),a++):n.push(t[i]);e=e.reshape(n,!1)}for(var r=1,s=0;s<this.sumDims.length;s++)r*=t[this.sumDims[s]];var o=e.expand(t),u=o.multiply(this.input.value,2/r);o.delete(),this.input.backward(u)||u.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Sa=function(){function e(t,n,a,i,r){if(Object(g.a)(this,e),this.a=t,this.starts=n,this.ends=a,this.axes=i,this.steps=r,void 0!==r.find((function(e){return 1!==e})))throw new Error("Slice backward pass only supports step size of 1")}return Object(k.a)(e,[{key:"backward",value:function(e){if(!this.a.noGrad){for(var t=this.a.getShape(),n=t.length,a=new Array(2*n).fill(0),i=0;i<this.axes.length;i++)a[this.axes[i]]=this.starts[i],a[n+this.axes[i]]=t[this.axes[i]]-this.ends[i];var r=e.pad(a,"constant",0);this.a.backward(r)||r.delete()}}},{key:"delete",value:function(){this.a.isLeaf()||this.a.delete()}}]),e}(),Aa=function(){function e(t,n,a,i,r){Object(g.a)(this,e),this.x=t}return Object(k.a)(e,[{key:"backward",value:function(e){throw new Error("Backward pass not implemented for average pool")}},{key:"delete",value:function(){this.x.isLeaf()||this.x.delete()}}]),e}(),Ma=function(){function e(t,n,a,i){Object(g.a)(this,e),this.x=t,this.pads=n,this.mode=a,this.value=i}return Object(k.a)(e,[{key:"backward",value:function(e){throw new Error("Backward pass not implemented for pad")}},{key:"delete",value:function(){this.x.isLeaf()||this.x.delete()}}]),e}(),Ta=function(){function e(t,n,a,i){Object(g.a)(this,e),this.input=t,this.product=n,this.sumDims=a,this.keepDims=i}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.getShape(),n=e.multiply(this.product);if(!this.keepDims){for(var a=[],i=0,r=0;r<t.length;r++)i<this.sumDims.length&&this.sumDims[i]===r?(a.push(1),i++):a.push(t[r]);n=n.reshape(a,!1)}var s=n.expand(t);n.delete();var o=s.divide(this.input.value);s.delete(),this.input.backward(o)||o.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Ia=function(){function e(t,n){Object(g.a)(this,e),this.input=t,this.sigmoid=n}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.sigmoid.addMultiplyScalar(-1,1),n=this.sigmoid.multiply(t);t.delete();var a=n.multiply(e);n.delete(),this.input.backward(a)||a.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Ca=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.cos(),n=e.multiply(t);t.delete(),this.input.backward(n)||n.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Va=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.multiply(this.input.value),n=t.addMultiplyScalar(-1,1);t.delete();var a=n.sqrt();n.delete();var i=e.divide(a);a.delete(),this.input.backward(i)||i.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Pa=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.cosh(),n=e.multiply(t);t.delete(),this.input.backward(n)||n.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Da=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.multiply(this.input.value),n=t.addMultiplyScalar(1,1);t.delete();var a=n.sqrt();n.delete();var i=e.divide(a);a.delete(),this.input.backward(i)||i.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Ga=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.sin(),n=e.multiply(t,-1);t.delete(),this.input.backward(n)||n.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Ea=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.multiply(this.input.value),n=t.addMultiplyScalar(-1,1);t.delete();var a=n.sqrt();n.delete();var i=e.divide(a,-1);a.delete(),this.input.backward(i)||i.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Ra=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.sinh(),n=e.multiply(t);t.delete(),this.input.backward(n)||n.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),_a=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.multiply(this.input.value),n=t.addMultiplyScalar(1,-1);t.delete();var a=n.sqrt();n.delete();var i=e.divide(a);a.delete(),this.input.backward(i)||i.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Xa=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.cos(),n=t.multiply(t);t.delete();var a=e.divide(n);n.delete(),this.input.backward(a)||a.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Ba=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.multiply(this.input.value),n=t.addMultiplyScalar(1,1);t.delete();var a=e.divide(n);n.delete(),this.input.backward(a)||a.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),za=function(){function e(t,n){Object(g.a)(this,e),this.input=t,this.tanH=n}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.tanH.multiply(this.tanH),n=t.addMultiplyScalar(-1,1);t.delete();var a=e.multiply(n);n.delete(),this.input.backward(a)||a.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Ua=function(){function e(t){Object(g.a)(this,e),this.input=t}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.multiply(this.input.value),n=t.addMultiplyScalar(-1,1);t.delete();var a=e.divide(n);n.delete(),this.input.backward(a)||a.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Wa=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.sumDims=n,this.keepDims=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.getShape(),n=this.input.value.sum(this.sumDims,this.keepDims),a=e.divide(n);if(n.delete(),!this.keepDims){for(var i=[],r=0,s=0;s<t.length;s++)r<this.sumDims.length&&this.sumDims[r]===s?(i.push(1),r++):i.push(t[s]);a=a.reshape(i,!1)}var o=a.expand(t);a.delete(),this.input.backward(o)||o.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),La=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.sumDims=n,this.keepDims=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.getShape(),n=this.input.value.exp(),a=n.sum(this.sumDims,!0),i=n.divide(a);if(n.delete(),a.delete(),!this.keepDims){for(var r=[],s=0,o=0;o<t.length;o++)s<this.sumDims.length&&this.sumDims[s]===o?(r.push(1),s++):r.push(t[o]);e=e.reshape(r,!1)}var u=e.expand(t),c=u.multiply(i);u.delete(),this.input.backward(c)||c.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Fa=function(){function e(t,n,a){Object(g.a)(this,e),this.input=t,this.power=n,this.factor=a}return Object(k.a)(e,[{key:"backward",value:function(e){var t=this.input.value.powerScalar(this.power-1,this.factor*this.power),n=e.multiply(t);t.delete(),this.input.backward(n)||n.delete()}},{key:"delete",value:function(){this.input.isLeaf()||this.input.delete()}}]),e}(),Na=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a){var i;return Object(g.a)(this,n),(i=t.call(this,e.dtype)).value=e,void 0===a&&(a={}),i.grad=a.grad,void 0!==a.backEdge&&(i.backEdge=a.backEdge),i.noGrad=a.noGrad||!1,i}return Object(k.a)(n,[{key:"cast",value:function(e){throw new Error("Method not implemented.")}},{key:"backward",value:function(e){if(void 0===e){var t=this.value.getShape();if(1!==t.length||1!==t[0])throw new Error("Backward without an input gradient can only be done for tensors with shape [1]");e=this.value}var n=!1;if(void 0!==this.grad){var a=this.grad;this.grad=this.grad.add(e),a.delete()}else this.grad=e,n=!0;return void 0!==this.backEdge&&this.backEdge.backward(e),n}},{key:"isLeaf",value:function(){return void 0===this.backEdge}},{key:"constantLike",value:function(e){return new n(this.value.constantLike(e),{noGrad:!0})}},{key:"singleConstant",value:function(e){return new n(this.value.singleConstant(e),{noGrad:!0})}},{key:"getValues",value:function(){return this.value.getValues()}},{key:"getShape",value:function(){return this.value.getShape()}},{key:"delete",value:function(){this.value.delete(),void 0!==this.grad&&this.grad.delete(),void 0!==this.backEdge&&this.backEdge.delete()}},{key:"reshape_impl",value:function(e,t){return new n(this.value.reshape(e),{backEdge:this.noGrad?void 0:new la(this),noGrad:this.noGrad})}},{key:"exp",value:function(){var e=this.value.exp();return new n(e,{backEdge:this.noGrad?void 0:new na(this,e),noGrad:this.noGrad})}},{key:"log",value:function(){return new n(this.value.log(),{backEdge:this.noGrad?void 0:new aa(this),noGrad:this.noGrad})}},{key:"sqrt",value:function(){var e=this.value.sqrt();return new n(e,{backEdge:this.noGrad?void 0:new sa(this,e),noGrad:this.noGrad})}},{key:"abs",value:function(){return new n(this.value.abs(),{backEdge:this.noGrad?void 0:new ta(this),noGrad:this.noGrad})}},{key:"sin",value:function(){return new n(this.value.sin(),{backEdge:this.noGrad?void 0:new Ca(this),noGrad:this.noGrad})}},{key:"cos",value:function(){return new n(this.value.cos(),{backEdge:this.noGrad?void 0:new Ga(this),noGrad:this.noGrad})}},{key:"tan",value:function(){return new n(this.value.tan(),{backEdge:this.noGrad?void 0:new Xa(this),noGrad:this.noGrad})}},{key:"asin",value:function(){return new n(this.value.asin(),{backEdge:this.noGrad?void 0:new Va(this),noGrad:this.noGrad})}},{key:"acos",value:function(){return new n(this.value.acos(),{backEdge:this.noGrad?void 0:new Ea(this),noGrad:this.noGrad})}},{key:"atan",value:function(){return new n(this.value.atan(),{backEdge:this.noGrad?void 0:new Ba(this),noGrad:this.noGrad})}},{key:"sinh",value:function(){return new n(this.value.sinh(),{backEdge:this.noGrad?void 0:new Pa(this),noGrad:this.noGrad})}},{key:"cosh",value:function(){return new n(this.value.cosh(),{backEdge:this.noGrad?void 0:new Ra(this),noGrad:this.noGrad})}},{key:"tanh",value:function(){var e=this.value.tanh();return new n(e,{backEdge:this.noGrad?void 0:new za(this,e),noGrad:this.noGrad})}},{key:"asinh",value:function(){return new n(this.value.asinh(),{backEdge:this.noGrad?void 0:new Da(this),noGrad:this.noGrad})}},{key:"acosh",value:function(){return new n(this.value.acosh(),{backEdge:this.noGrad?void 0:new _a(this),noGrad:this.noGrad})}},{key:"atanh",value:function(){return new n(this.value.atanh(),{backEdge:this.noGrad?void 0:new Ua(this),noGrad:this.noGrad})}},{key:"sigmoid",value:function(){var e=this.value.sigmoid();return new n(e,{backEdge:this.noGrad?void 0:new Ia(this,e),noGrad:this.noGrad})}},{key:"hardSigmoid",value:function(e,t){throw new Error("Method not implemented.")}},{key:"sign",value:function(){return new n(this.value.sign())}},{key:"negate",value:function(){return new n(this.value.negate(),{backEdge:this.noGrad?void 0:new ra(this),noGrad:this.noGrad})}},{key:"addMultiplyScalar",value:function(e,t){return new n(this.value.addMultiplyScalar(e,t),{backEdge:this.noGrad?void 0:new xa(this,e),noGrad:this.noGrad})}},{key:"powerScalar",value:function(e,t){return new n(this.value.powerScalar(e,t),{backEdge:this.noGrad?void 0:new Fa(this,e,t),noGrad:this.noGrad})}},{key:"setValues",value:function(e,t){throw new Error("Method not implemented.")}},{key:"matMul",value:function(e){if(!(e instanceof n))throw new Error("MatMul can only be done with another variable");var t=this.noGrad&&e.noGrad;return new n(this.value.matMul(e.value),{backEdge:t?void 0:new ia(this,e),noGrad:t})}},{key:"concat",value:function(e,t){if(!(e instanceof n))throw new Error("Concat can only be done with another variable");var a=this.noGrad&&e.noGrad;return new n(this.value.concat(e.value,t),{backEdge:a?void 0:new oa(this,e,t),noGrad:a})}},{key:"clip",value:function(e,t){return new n(this.value.clip(e,t),{backEdge:this.noGrad?void 0:new ua(this,e,t),noGrad:this.noGrad})}},{key:"clipBackward",value:function(e,t,n){throw new Error("Clip backward not implemented for Variable")}},{key:"repeat",value:function(e){return new n(this.value.repeat(e),{backEdge:this.noGrad?void 0:new ca(this,e),noGrad:this.noGrad})}},{key:"expand",value:function(e){return new n(this.value.expand(e),{backEdge:this.noGrad?void 0:new ha(this,e),noGrad:this.noGrad})}},{key:"copy",value:function(){return new n(this.value.copy(),{grad:void 0!==this.grad?this.grad.copy():void 0})}},{key:"gather",value:function(e,t){throw new Error("Method not implemented.")}},{key:"floor",value:function(){return new n(this.value.floor())}},{key:"ceil",value:function(){return new n(this.value.ceil())}},{key:"round",value:function(){return new n(this.value.round())}},{key:"upsample",value:function(e){throw new Error("Method not implemented.")}},{key:"normalize",value:function(e,t,n,a,i){throw new Error("Method not implemented.")}},{key:"add_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add Variable tensor to Variable tensor");var s=e.noGrad&&t.noGrad;return new n(e.value.add_impl(e.value,t.value,a,i,r),{backEdge:s?void 0:new pa(e,t,a,i,r),noGrad:s})}},{key:"subtract_impl",value:function(e,t,a,i,r){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add Variable tensor to Variable tensor");var s=e.noGrad&&t.noGrad;return new n(e.value.subtract_impl(e.value,t.value,a,i,r),{backEdge:s?void 0:new fa(e,t,a,i,r),noGrad:s})}},{key:"multiply_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only add Variable tensor to Variable tensor");var r=e.noGrad&&t.noGrad;return new n(e.value.multiply_impl(e.value,t.value,a,i),{backEdge:r?void 0:new da(e,t,a,i),noGrad:r})}},{key:"divide_impl",value:function(e,t,a,i){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only divide Variable tensor by Variable tensor");var r=e.value.divide_impl(e.value,t.value,a,i),s=e.noGrad&&t.noGrad;return new n(r,{backEdge:s?void 0:new ma(e,t,r,a,i),noGrad:s})}},{key:"power_impl",value:function(e,t,a){if(!(t instanceof n)||!(e instanceof n))throw new Error("Can only take Variable tensor to power of Variable tensor");var i=e.value.power_impl(e.value,t.value,a),r=e.noGrad&&t.noGrad;return new n(i,{backEdge:r?void 0:new ya(e,t,i,a),noGrad:r})}},{key:"gemm_impl",value:function(e,t,a,i,r,s){if(!(e instanceof n)||void 0!==s&&!(s instanceof n))throw new Error("Can only do gemm with variable tensors");var o=this.noGrad&&e.noGrad&&(void 0===s||s.noGrad);return new n(this.value.gemm_impl(e.value,t,a,i,r,void 0!==s?s.value:void 0),{backEdge:o?void 0:new wa(this,e,t,a,i,r,s),noGrad:o})}},{key:"sum_impl",value:function(e,t){return new n(this.value.sum(e,t),{backEdge:this.noGrad?void 0:new ga(this,e,t),noGrad:this.noGrad})}},{key:"sumSquare_impl",value:function(e,t){return new n(this.value.sumSquare(e,t),{backEdge:this.noGrad?void 0:new ka(this,e,t),noGrad:this.noGrad})}},{key:"product_impl",value:function(e,t){var a=this.value.product(e,t);return new n(a,{backEdge:this.noGrad?void 0:new Ta(this,a,e,t),noGrad:this.noGrad})}},{key:"max_impl",value:function(e,t){throw new Error("Method not implemented.")}},{key:"min_impl",value:function(e,t){throw new Error("Method not implemented.")}},{key:"reduceMean_impl",value:function(e,t){return new n(this.value.reduceMean(e,t),{backEdge:this.noGrad?void 0:new Oa(this,e,t),noGrad:this.noGrad})}},{key:"reduceMeanSquare_impl",value:function(e,t){return new n(this.value.reduceMeanSquare(e,t),{backEdge:this.noGrad?void 0:new ja(this,e,t),noGrad:this.noGrad})}},{key:"reduceLogSum_impl",value:function(e,t){return new n(this.value.reduceLogSum(e,t),{backEdge:this.noGrad?void 0:new Wa(this,e,t),noGrad:this.noGrad})}},{key:"reduceLogSumExp_impl",value:function(e,t){return new n(this.value.reduceLogSumExp(e,t),{backEdge:this.noGrad?void 0:new La(this,e,t),noGrad:this.noGrad})}},{key:"conv_impl",value:function(e,t,a,i,r,s,o){if(!(e instanceof n)||void 0!==o&&!(o instanceof n))throw new Error("Can only do convolution with variable as kernel and bias");if("id"!==s)throw new Error("Activation has to be ID for convolution with variables");var u=this.noGrad&&e.noGrad&&(void 0===o||o.noGrad);return new n(this.value.conv(e.value,void 0!==o?o.value:void 0,t,a,i,r),{backEdge:u?void 0:new va(this,e,r,i,t,a,o),noGrad:u})}},{key:"convTranspose_impl",value:function(e,t,n,a,i){throw new Error("Method not implemented.")}},{key:"pad_impl",value:function(e,t,a){return new n(this.value.pad(e,t,a),{backEdge:this.noGrad?void 0:new Ma(this,e,t,a),noGrad:this.noGrad})}},{key:"averagePool_impl",value:function(e,t,a,i){return new n(this.value.averagePool(e,t,a,i),{backEdge:this.noGrad?void 0:new Aa(this,e,t,a,i),noGrad:this.noGrad})}},{key:"transpose_impl",value:function(e){return new n(this.value.transpose(e),{backEdge:this.noGrad?void 0:new ba(this,e),noGrad:this.noGrad})}},{key:"slice_impl",value:function(e,t,a,i){return new n(this.value.slice(e,t,a,i),{backEdge:this.noGrad?void 0:new Sa(this,e,t,a,i),noGrad:this.noGrad})}}],[{key:"create",value:function(e,t,a,i,r){return void 0===r&&(r="float32"),new n("CPU"===a?new F(e,t):"WASM"===a?new An(t,new Uint32Array(e),r):new lt(t,e,r),i)}},{key:"fromData",value:function(e,t){return new n(lt.fromData(e),t)}}]),n}(G),qa=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))};function Ha(e){return qa(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Na)){t.next=17;break}return t.t0=Na,t.next=4,Ha(e.value);case 4:if(t.t1=t.sent,void 0===e.grad){t.next=11;break}return t.next=8,Ha(e.grad);case 8:t.t2=t.sent,t.next=12;break;case 11:t.t2=void 0;case 12:return t.t3=t.t2,t.t4={grad:t.t3},t.abrupt("return",new t.t0(t.t1,t.t4));case 17:if(!(e instanceof ea)){t.next=28;break}return t.t5=ea,t.next=21,Ha(e.values);case 21:return t.t6=t.sent,t.next=24,Ha(e.indices);case 24:return t.t7=t.sent,t.t8=e.shape,t.t9=e.denseDims,t.abrupt("return",new t.t5(t.t6,t.t7,t.t8,t.t9));case 28:if(!(e instanceof F)){t.next=30;break}return t.abrupt("return",e);case 30:return t.next=32,e.getValues();case 32:return n=t.sent,t.abrupt("return",new F(e.getShape(),n,e.dtype));case 34:case"end":return t.stop()}}),t)})))}function Ja(e){return qa(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("float16"!==e.dtype){t.next=2;break}throw new Error("Cant represent float16 tensor on Wasm backend");case 2:if(!(e instanceof Na)){t.next=19;break}return t.t0=Na,t.next=6,Ja(e.value);case 6:if(t.t1=t.sent,void 0===e.grad){t.next=13;break}return t.next=10,Ja(e.grad);case 10:t.t2=t.sent,t.next=14;break;case 13:t.t2=void 0;case 14:return t.t3=t.t2,t.t4={grad:t.t3},t.abrupt("return",new t.t0(t.t1,t.t4));case 19:if(!(e instanceof ea)){t.next=30;break}return t.t5=ea,t.next=23,Ja(e.values);case 23:return t.t6=t.sent,t.next=26,Ja(e.indices);case 26:return t.t7=t.sent,t.t8=e.shape,t.t9=e.denseDims,t.abrupt("return",new t.t5(t.t6,t.t7,t.t8,t.t9));case 30:if(!(e instanceof An)){t.next=32;break}return t.abrupt("return",e);case 32:return t.next=34,e.getValues();case 34:if(n=t.sent,!(e instanceof F&&n instanceof Int32Array)){t.next=37;break}return t.abrupt("return",e);case 37:return t.abrupt("return",new An(Array.from(n),new Uint32Array(e.getShape()),e.dtype));case 38:case"end":return t.stop()}}),t)})))}function Ka(e){return qa(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("float64"!==e.dtype){t.next=2;break}throw new Error("Cant represent float64 tensor on WebGL backend");case 2:if(!(e instanceof Na)){t.next=19;break}return t.t0=Na,t.next=6,Ka(e.value);case 6:if(t.t1=t.sent,void 0===e.grad){t.next=13;break}return t.next=10,Ka(e.grad);case 10:t.t2=t.sent,t.next=14;break;case 13:t.t2=void 0;case 14:return t.t3=t.t2,t.t4={grad:t.t3},t.abrupt("return",new t.t0(t.t1,t.t4));case 19:if(!(e instanceof ea)){t.next=30;break}return t.t5=ea,t.next=23,Ka(e.values);case 23:return t.t6=t.sent,t.next=26,Ka(e.indices);case 26:return t.t7=t.sent,t.t8=e.shape,t.t9=e.denseDims,t.abrupt("return",new t.t5(t.t6,t.t7,t.t8,t.t9));case 30:if(!(e instanceof lt)){t.next=32;break}return t.abrupt("return",e);case 32:return t.next=34,e.getValues();case 34:if(n=t.sent,!(e instanceof F&&n instanceof Int32Array)){t.next=37;break}return t.abrupt("return",e);case 37:return t.abrupt("return",new lt(Array.from(n),e.getShape(),e.dtype));case 38:case"end":return t.stop()}}),t)})))}var Za=n(11),Ya=n.n(Za),Qa=n(23),$a=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ei=function(){function e(){Object(g.a)(this,e),this.backend="CPU",this.mode="train"}return Object(k.a)(e,[{key:"getSubModules",value:function(){for(var t=[],n=0,a=Object.keys(this);n<a.length;n++){var i=a[n];this[i]instanceof e&&t.push(this[i])}return t}},{key:"getParameters",value:function(){for(var e=[],t=0,n=Object.keys(this);t<n.length;t++){var a=n[t];this[a]instanceof Na&&e.push(this[a])}var i,r=this.getSubModules(),s=Object(j.a)(r);try{for(s.s();!(i=s.n()).done;){var o=i.value.getParameters();e=e.concat(o)}}catch(u){s.e(u)}finally{s.f()}return e}},{key:"toBackend",value:function(e){return"CPU"===e?this.toCPU():"WASM"===e?this.toWASM():this.toGPU()}},{key:"toCPU",value:function(){return $a(this,void 0,void 0,m.a.mark((function e(){var t,n,a,i,r,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.getSubModules(),n=Object(j.a)(t),e.prev=2,n.s();case 4:if((a=n.n()).done){e.next=10;break}return i=a.value,e.next=8,i.toCPU();case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:r=0,s=Object.keys(this);case 19:if(!(r<s.length)){e.next=28;break}if(!(this[o=s[r]]instanceof G)){e.next=25;break}return e.next=24,Ha(this[o]);case 24:this[o]=e.sent;case 25:r++,e.next=19;break;case 28:this.backend="CPU";case 29:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})))}},{key:"toWASM",value:function(){return $a(this,void 0,void 0,m.a.mark((function e(){var t,n,a,i,r,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.getSubModules(),n=Object(j.a)(t),e.prev=2,n.s();case 4:if((a=n.n()).done){e.next=10;break}return i=a.value,e.next=8,i.toWASM();case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:r=0,s=Object.keys(this);case 19:if(!(r<s.length)){e.next=28;break}if(!(this[o=s[r]]instanceof G)){e.next=25;break}return e.next=24,Ja(this[o]);case 24:this[o]=e.sent;case 25:r++,e.next=19;break;case 28:this.backend="WASM";case 29:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})))}},{key:"toGPU",value:function(){return $a(this,void 0,void 0,m.a.mark((function e(){var t,n,a,i,r,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.getSubModules(),n=Object(j.a)(t),e.prev=2,n.s();case 4:if((a=n.n()).done){e.next=10;break}return i=a.value,e.next=8,i.toGPU();case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:r=0,s=Object.keys(this);case 19:if(!(r<s.length)){e.next=28;break}if(!(this[o=s[r]]instanceof G)){e.next=25;break}return e.next=24,Ka(this[o]);case 24:this[o]=e.sent;case 25:r++,e.next=19;break;case 28:this.backend="GPU";case 29:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})))}}]),e}(),ti=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ni=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;Object(g.a)(this,n),(u=t.call(this)).attributes={},u.mode=o;for(var c=0;c<e.length;c++)u.attributes[e[c].name]=e[c];u.inputs=a,u.outputs=i,u.onnxVersion=s,u.variableInputs=0;for(var h=0;h<u.inputs.length;h++)void 0===r[u.inputs[h]]&&u.variableInputs++;return u}return Object(k.a)(n,[{key:"initialize",value:function(e){}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"getAttributeString",value:function(e){var t=this.attributes[e];if(void 0!==t){var n=t.s;return void 0!==n&&null!==n?new TextDecoder("utf-8").decode(n):void 0}}},{key:"getAttributeInts",value:function(e){if(void 0!==this.attributes[e]){var t=this.attributes[e].ints;if(void 0!==t&&null!==t){for(var n=0;n<t.length;n++)Ya.a.isLong(t[n])&&(t[n]=t[n].toNumber());return t}}}},{key:"getAttributeInt",value:function(e){var t=this.attributes[e];if(void 0!==t){var n=t.i;return Ya.a.isLong(n)&&(n=n.toNumber()),n}}},{key:"getAttributeFloat",value:function(e){var t=this.attributes[e];if(void 0!==t)return t.f}},{key:"getAttributeFloats",value:function(e){var t=this.attributes[e];if(void 0!==t)return t.floats}},{key:"getAttributeTensor",value:function(e){var t=this.attributes[e];if(void 0!==t)return t.t}},{key:"toValues",value:function(e){return ti(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e instanceof F){t.next=5;break}return console.warn("Tensor for values not on CPU, need to transfer!"),t.next=4,Ha(e);case 4:e=t.sent;case 5:for(n=e,a=new Array(n.size),i=0;i<n.size;i++)a[i]=n.get(i);return t.abrupt("return",a);case 9:case"end":return t.stop()}}),t)})))}},{key:"toCPU",value:function(){return ti(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"toWASM",value:function(){return ti(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"toGPU",value:function(){return ti(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}}]),n}(ei);function ai(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==e.segment&&null!==e.segment)throw new Error("Handling of tensor proto segment not yet implemented");var n=e.dims;if(void 0===n||null===n)throw new Error("Tensor shape must be specified");for(var a=0;a<n.length;a++)Ya.a.isLong(n[a])&&(n[a]=n[a].toNumber());0===n.length&&(n=[1]);var i=A(n);if(1===e.dataType){if(e.floatData&&e.floatData.length>0)return new F(n,e.floatData);if(e.rawData&&e.rawData.length>0){var r=e.rawData.buffer.slice(e.rawData.byteOffset,e.rawData.byteOffset+e.rawData.byteLength),s=new Float32Array(r);return new F(n,s,t?"float16":"float32")}if(0===i)return new F(n);throw new Error("Cant process float tensor without float or raw data")}if(7===e.dataType){if(e.rawData&&e.rawData.length>0){for(var o=new Int32Array(e.rawData.length/8),u=0;u<e.rawData.length;u+=8){var c=Ya.a.fromBytesLE(Array.from(e.rawData.slice(u,u+8))).toNumber();o[u/8]=c}return new F(n,o,"int32")}throw new Error("Cant process int64 tensor without raw data")}throw new Error("Handling of tensor type ".concat(e.dataType," not yet implemented"))}var ii=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ri=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;Object(g.a)(this,n);var c=(u=t.call(this,e,a,i,r,s,o)).getAttributeTensor("value");if(void 0===c||null===c)throw new Error('Constant needs tensor value, but attribute "value" was not defined');return u.tensor=ai(c),"train"===o&&void 0!==u.tensor&&(u.tensor=new Na(u.tensor)),u}return Object(k.a)(n,[{key:"forward",value:function(e){return ii(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.tensor){e.next=2;break}return e.abrupt("return",[this.tensor]);case 2:throw new Error("Constant without tensor value doesnt work");case 3:case"end":return e.stop()}}),e,this)})))}},{key:"toCPU",value:function(){return ii(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.tensor){e.next=4;break}return e.next=3,Ha(this.tensor);case 3:this.tensor=e.sent;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"toWASM",value:function(){return ii(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.tensor){e.next=4;break}return e.next=3,Ja(this.tensor);case 3:this.tensor=e.sent;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"toGPU",value:function(){return ii(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.tensor){e.next=4;break}return e.next=3,Ka(this.tensor);case 3:this.tensor=e.sent;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getType",value:function(){return"Constant"}},{key:"delete",value:function(){void 0!==this.tensor&&this.tensor.delete()}}]),n}(ni),si=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},oi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o,u,c,h){var l;if(Object(g.a)(this,n),void 0!==(l=t.call(this,e,a,i,r,s,o)).getAttributeString("autoPad"))throw new Error("Autopad in conv not supported yet");return void 0===h&&(h="id"),l.activation=h,l.group=l.getAttributeInt("group")||1,l.dilations=l.getAttributeInts("dilations"),l.pads=l.getAttributeInts("pads"),l.strides=l.getAttributeInts("strides"),l.kernel=u,l.bias=c,"train"===o&&void 0!==l.kernel&&(l.kernel=new Na(l.kernel)),"train"===o&&void 0!==l.bias&&(l.bias=new Na(l.bias)),l}return Object(k.a)(n,[{key:"forward",value:function(e){return si(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=void 0!==this.kernel?this.kernel:e[1],i=e.length>2?e[2]:this.bias,t.abrupt("return",[n.conv(a,i,this.dilations,this.group,this.pads,this.strides,this.activation)]);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getDilations",value:function(e){return void 0!==this.dilations?this.dilations:new Array(e).fill(1)}},{key:"getPads",value:function(e){return void 0!==this.pads?this.pads:new Array(2*e).fill(0)}},{key:"getStrides",value:function(e){return void 0!==this.strides?this.strides:new Array(e).fill(1)}},{key:"getType",value:function(){return"Conv"}},{key:"toCPU",value:function(){return si(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.kernel){e.next=4;break}return e.next=3,Ha(this.kernel);case 3:this.kernel=e.sent;case 4:if(void 0===this.bias){e.next=8;break}return e.next=7,Ha(this.bias);case 7:this.bias=e.sent;case 8:case"end":return e.stop()}}),e,this)})))}},{key:"toWASM",value:function(){return si(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.kernel){e.next=4;break}return e.next=3,Ja(this.kernel);case 3:this.kernel=e.sent;case 4:if(void 0===this.bias){e.next=8;break}return e.next=7,Ja(this.bias);case 7:this.bias=e.sent;case 8:case"end":return e.stop()}}),e,this)})))}},{key:"toGPU",value:function(){return si(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.kernel){e.next=4;break}return e.next=3,Ka(this.kernel);case 3:this.kernel=e.sent;case 4:if(void 0===this.bias){e.next=8;break}return e.next=7,Ka(this.bias);case 7:this.bias=e.sent;case 8:case"end":return e.stop()}}),e,this)})))}},{key:"delete",value:function(){void 0!==this.kernel&&this.kernel.delete(),void 0!==this.bias&&this.bias.delete()}}]),n}(ni),ui=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this)).nodeTypes=e,a}return Object(k.a)(n,[{key:"findApplications",value:function(e){var t=[],n=e.getNodes();for(var a in Object.keys(n)){var i=n[a];if(void 0!==i&&i.getType()===this.nodeTypes[0]){var r=this.checkApplication(e,a);void 0!==r&&t.push(r)}}return t}},{key:"checkApplication",value:function(e,t){for(var n=e.getNodes(),a=[t],i=n[t],r=[i],s=1;s<this.nodeTypes.length;s++){var o=e.getNodeWithInput(i.outputs[0]);if(void 0===o)return;var u=n[o];if(u.getType()!==this.nodeTypes[s])return;a.push(o),i=u,r.push(i)}return this.canApply(r)?a:void 0}},{key:"canApply",value:function(e){return!0}}]),n}((function e(){Object(g.a)(this,e)})),ci=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.call(this,["Conv","BatchNormalization"])}return Object(k.a)(n,[{key:"apply",value:function(e,t,n,a){var i=e[0],r=e[1],s=t(i.inputs[1]),o=t(i.inputs[2]),u=t(r.inputs[1]),c=t(r.inputs[2]),h=t(r.inputs[3]),l=t(r.inputs[4]).add(r.epsTensor).sqrt(),p=u.divide(l);l.delete();var f=c.subtract(h.multiply(p)),d=[].concat(Object(S.a)(p.getShape()),Object(S.a)(new Array(s.getShape().length-p.getShape().length).fill(1))),v=s.multiply(p.reshape(d,!1)),m=f;if(void 0!==o){var y=o.multiply(p);m=m.add(y),y.delete()}return new oi(Object.entries(i.attributes).map((function(e){return e[1]})),[i.inputs[0]],r.outputs,n,a,i.mode,v,m)}}]),n}(ui),hi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.call(this,["Conv","Relu"])}return Object(k.a)(n,[{key:"apply",value:function(e,t,n,a){var i=e[0],r=e[1];return new oi(Object.entries(i.attributes).map((function(e){return e[1]})),i.inputs,r.outputs,n,a,i.mode,i.kernel,i.bias,"relu")}}]),n}(ui),li=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(){return Object(g.a)(this,n),t.call(this,["Conv","Clip"])}return Object(k.a)(n,[{key:"apply",value:function(e,t,n,a){var i=e[0],r=e[1];return new oi(Object.entries(i.attributes).map((function(e){return e[1]})),i.inputs,r.outputs,n,a,i.mode,i.kernel,i.bias,"relu6")}},{key:"canApply",value:function(e){var t=e[1];return 0===t.min&&6===t.max}}]),n}(ui),pi=[new ci,new hi,new li],fi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},di=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o,u){var c;return Object(g.a)(this,n),(c=t.call(this,e,a,i,r,s,u)).name=o,c}return Object(k.a)(n,[{key:"forward",value:function(e){return fi(this,void 0,void 0,m.a.mark((function t(){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.onnxVersion<13&&this.onnxVersion>=7)){t.next=4;break}return n=e[0],a=e[1],t.abrupt("return",[this.compute(n,a)]);case 4:throw new Error("".concat(this.name," not implemented for onnx version ").concat(this.onnxVersion));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return this.name}},{key:"delete",value:function(){}}]),n}(ni),vi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Add",o)}return Object(k.a)(n,[{key:"compute",value:function(e,t){return e.add(t)}}]),n}(di),mi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},yi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).epsilon=u.getAttributeFloat("epsilon")||1e-5,u.momentum=u.getAttributeFloat("momentum")||.9,u.epsTensor=new F([1],[u.epsilon]),"train"===o&&(u.epsTensor=new Na(u.epsTensor)),u}return Object(k.a)(n,[{key:"forward",value:function(e){return mi(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o,u,c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=e[1],i=e[2],r=e[3],s=e[4],o=a.getShape()[0],u=[1,o].concat(Object(S.a)(new Array(n.getShape().length-2).fill(1))),a=a.reshape(u,!1),i=i.reshape(u,!1),r=r.reshape(u,!1),s=s.reshape(u,!1),c=n.normalize(r,s,this.epsilon,a,i),t.abrupt("return",[c]);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"BatchNormalization"}},{key:"toCPU",value:function(){return mi(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ha(this.epsTensor);case 2:this.epsTensor=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"toWASM",value:function(){return mi(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ja(this.epsTensor);case 2:this.epsTensor=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"toGPU",value:function(){return mi(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ka(this.epsTensor);case 2:this.epsTensor=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"delete",value:function(){this.epsTensor.delete()}}]),n}(ni),wi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},bi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).to=u.getAttributeString("to"),u}return Object(k.a)(n,[{key:"forward",value:function(e){return wi(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],t.abrupt("return",[n.cast(this.to)]);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Cast"}},{key:"delete",value:function(){}}]),n}(ni),gi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ki=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o,u){var c;return Object(g.a)(this,n),(c=t.call(this,e,a,i,r,s,u)).name=o,c}return Object(k.a)(n,[{key:"forward",value:function(e){return gi(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],t.abrupt("return",[this.compute(n)]);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return this.name}},{key:"delete",value:function(){}}]),n}(ni),xi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Ceil",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.ceil()}}]),n}(ki),Oi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ji=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),u=t.call(this,e,a,i,r,s,o),s<11&&(u.min=u.getAttributeFloat("min"),u.max=u.getAttributeFloat("max")),u}return Object(k.a)(n,[{key:"forward",value:function(e){return Oi(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e[0],!(this.onnxVersion<11)){t.next=5;break}return t.abrupt("return",[n.clip(this.min,this.max)]);case 5:if(a=e.length>1?e[1]:void 0,i=e.length>2?e[2]:void 0,void 0!==a||void 0!==i){t.next=9;break}return t.abrupt("return",[n.copy()]);case 9:throw new Error("Clip with onnx version >= 11 not yet implemented");case 10:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Clip"}},{key:"delete",value:function(){}}]),n}(ni),Si=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Ai=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),u=t.call(this,e,a,i,r,s,o),s<13&&(u.axis=u.getAttributeInt("axis")),u}return Object(k.a)(n,[{key:"forward",value:function(e){return Si(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.length,!(this.onnxVersion<13&&void 0!==this.axis)){t.next=5;break}for(n=e[0],a=1;a<e.length;a++)i=n.concat(e[a],this.axis),a>1&&n.delete(),n=i;return t.abrupt("return",[n]);case 5:throw new Error("Concat not implemented for onnx version ".concat(this.onnxVersion));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Concat"}},{key:"delete",value:function(){}}]),n}(ni),Mi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Ti=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;if(Object(g.a)(this,n),u=t.call(this,e,a,i,r,s,o),s<11){var c=u.getAttributeTensor("value");null!==c&&void 0!==c&&(u.tensor=ai(c))}return u}return Object(k.a)(n,[{key:"forward",value:function(e){return Mi(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e[0],!(this.onnxVersion<11&&void 0!==this.tensor)){t.next=9;break}if(n instanceof F){t.next=4;break}throw new Error("ConstantOfShape needs cpu tensor as shape tensor");case 4:for(a=new Array(n.size),i=0;i<n.size;i++)a[i]=n.get(i);return r=A(a),s=new Float32Array(r).fill(this.tensor.get(0)),t.abrupt("return",[new F(a,s,this.tensor.dtype)]);case 9:throw new Error("ConstantOfShape not implemented for onnx version ".concat(this.onnxVersion));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"ConstantOfShape"}},{key:"delete",value:function(){void 0!==this.tensor&&this.tensor.delete()}}]),n}(ni),Ii=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Div",o)}return Object(k.a)(n,[{key:"compute",value:function(e,t){return e.divide(t)}}]),n}(di),Ci=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Exp",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.exp()}}]),n}(ki),Vi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Pi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return Vi(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.onnxVersion<13)){t.next=8;break}if(n=e[0],(a=e[1])instanceof F){t.next=5;break}throw new Error("Expand needs cpu tensor as shape tensor");case 5:for(i=new Array(a.size),r=0;r<a.size;r++)i[r]=a.get(r);return t.abrupt("return",[n.expand(i)]);case 8:throw new Error("Expand not yet implemented for onnx version ".concat(this.onnxVersion));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Expand"}},{key:"delete",value:function(){}}]),n}(ni),Di=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Floor",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.floor()}}]),n}(ki),Gi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Ei=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).axis=u.getAttributeInt("axis")||0,u}return Object(k.a)(n,[{key:"forward",value:function(e){return Gi(this,void 0,void 0,m.a.mark((function t(){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e[0],(a=e[1])instanceof F){t.next=4;break}throw new Error("Gather requires CPU tensor for the indices");case 4:return t.abrupt("return",[n.gather(this.axis,a)]);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Gather"}},{key:"delete",value:function(){}}]),n}(ni),Ri=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},_i=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).alpha=u.getAttributeFloat("alpha")||1,u.beta=u.getAttributeFloat("beta")||1;var c=u.getAttributeInt("transA"),h=u.getAttributeInt("transB");return u.transA=1===c,u.transB=1===h,u}return Object(k.a)(n,[{key:"forward",value:function(e){return Ri(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=e[1],i=e[2],t.abrupt("return",[n.gemm(a,this.transA,this.transB,this.alpha,i,this.beta)]);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Gemm"}},{key:"delete",value:function(){}}]),n}(ni),Xi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Bi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).epsilon=u.getAttributeFloat("epsilon")||1e-5,u}return Object(k.a)(n,[{key:"forward",value:function(e){return Xi(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o,u,c,h,l,p,f;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=e[0],a=e[1],i=e[2],r=n.getShape().length-2,s=a.getShape()[0],o=[1,s].concat(Object(S.a)(new Array(r).fill(1))),a=a.reshape(o,!1),i=i.reshape(o,!1),u=new Array(n.getShape().length-2),c=0;c<r;c++)u[c]=c+2;return h=n.reduceMean(u,!0),Q.flush(),l=n.subtract(h),Q.flush(),p=l.reduceMeanSquare(u,!0),Q.flush(),f=n.normalize(h,p,this.epsilon,a,i),h.delete(),l.delete(),p.delete(),t.abrupt("return",[f]);case 21:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"InstanceNormalization"}},{key:"delete",value:function(){}}]),n}(ni),zi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Ui=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return zi(this,void 0,void 0,m.a.mark((function t(){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e[0],a=e[1],!(this.onnxVersion<13)){t.next=6;break}if(n.getShape().length===a.getShape().length){t.next=5;break}throw new Error("Automatic broadcasting in MatMul not supported yet");case 5:return t.abrupt("return",[n.gemm(a)]);case 6:throw new Error("Matmul with onnx version ".concat(this.onnxVersion," not yet implemented"));case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"MatMul"}},{key:"delete",value:function(){}}]),n}(ni),Wi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Mul",o)}return Object(k.a)(n,[{key:"compute",value:function(e,t){return e.multiply(t)}}]),n}(di),Li=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Fi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).padMode=u.getAttributeString("mode")||"constant",u.pads=u.getAttributeInts("pads"),u.value=u.getAttributeFloat("value")||0,u}return Object(k.a)(n,[{key:"forward",value:function(e){return Li(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.onnxVersion<11)){t.next=2;break}return t.abrupt("return",[e[0].pad(this.pads,this.padMode,this.value)]);case 2:throw new Error("Pad not implemented for onnx version ".concat(this.onnxVersion));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Pad"}},{key:"delete",value:function(){}}]),n}(ni),Ni=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},qi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o,u){var c;Object(g.a)(this,n),(c=t.call(this,e,a,i,r,s,u)).axes=c.getAttributeInts("axes");var h=c.getAttributeInt("keepdims");return c.keepDims=1===h||void 0===h,c.name=o,c}return Object(k.a)(n,[{key:"getAxes",value:function(e){if(void 0!==this.axes)return this.axes;for(var t=e.getShape().length,n=new Array(t),a=0;a<t;a++)n[a]=a;return n}},{key:"forward",value:function(e){return Ni(this,void 0,void 0,m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.onnxVersion<13)){t.next=2;break}return t.abrupt("return",[this.calc(e[0])]);case 2:throw new Error("".concat(this.name," is not implemented for onnx version ").concat(this.onnxVersion));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return this.name}},{key:"delete",value:function(){}}]),n}(ni),Hi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceMax",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.max(this.axes,this.keepDims)}}]),n}(qi),Ji=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceMean",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.reduceMean(this.axes,this.keepDims)}}]),n}(qi),Ki=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceSum",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.sum(this.axes,this.keepDims)}}]),n}(qi),Zi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceSumSquare",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.sumSquare(this.axes,this.keepDims)}}]),n}(qi),Yi=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).max=void 0,u.min=0,u}return Object(k.a)(n,[{key:"getType",value:function(){return"Relu"}}]),n}(ji),Qi=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},$i=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return Qi(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e[0],(a=e[1])instanceof F){t.next=4;break}throw new Error("Reshape only works with CPU tensor as shape tensor");case 4:if(!(this.onnxVersion<13)){t.next=8;break}for(i=new Array(a.size),r=0;r<a.size;r++)i[r]=a.get(r);return t.abrupt("return",[n.reshape(i)]);case 8:throw new Error("Reshape with onnx version ".concat(this.onnxVersion," not yet implemented"));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Reshape"}},{key:"delete",value:function(){}}]),n}(ni),er=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},tr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return er(this,void 0,void 0,m.a.mark((function t(){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.onnxVersion<13)){t.next=4;break}return n=e[0],a=n.getShape(),t.abrupt("return",[new F([a.length],Object(S.a)(a),"int32")]);case 4:throw new Error("Shape not implemented for onnx version ".concat(this.onnxVersion));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Shape"}},{key:"delete",value:function(){}}]),n}(ni),nr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ar=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).axes=u.getAttributeInts("axes"),u.starts=u.getAttributeInts("starts"),u.ends=u.getAttributeInts("ends"),u}return Object(k.a)(n,[{key:"forward",value:function(e){return nr(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o,u,c,h,l;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.onnxVersion<10)){t.next=7;break}if(void 0!==this.starts&&void 0!==this.ends){t.next=3;break}throw new Error("Slice with onnx version < 10 needs starts and ends defined as attributes");case 3:return n=e[0],t.abrupt("return",[n.slice(this.starts,this.ends,this.axes)]);case 7:return a=e[0],i=e[1],r=e[2],s=e[3],o=e[4],t.next=14,this.toValues(i);case 14:return u=t.sent,t.next=17,this.toValues(r);case 17:if(c=t.sent,void 0===s){t.next=24;break}return t.next=21,this.toValues(s);case 21:t.t0=t.sent,t.next=25;break;case 24:t.t0=void 0;case 25:if(h=t.t0,void 0===o){t.next=32;break}return t.next=29,this.toValues(o);case 29:t.t1=t.sent,t.next=33;break;case 32:t.t1=void 0;case 33:return l=t.t1,t.abrupt("return",[a.slice(u,c,h,l)]);case 35:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Slice"}},{key:"delete",value:function(){}}]),n}(ni),ir=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},rr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).axis=u.getAttributeInt("axis"),u}return Object(k.a)(n,[{key:"forward",value:function(e){return ir(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o,u,c,h,l;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.getShape(),void 0===(i=this.axis)&&(i=this.onnxVersion<13?1:a.length-1),r=a.slice(0,i).reduce((function(e,t){return e*t}),1),s=n.reshape([r,-1],!1),o=s.max(1,!0),u=s.subtract(o),c=u.exp(),h=c.sum(1,!0),l=c.divide(h),o.delete(),u.delete(),c.delete(),h.delete(),t.abrupt("return",[l.reshape(a,!1)]);case 16:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Softmax"}},{key:"delete",value:function(){}}]),n}(ni),sr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Sub",o)}return Object(k.a)(n,[{key:"compute",value:function(e,t){return e.subtract(t)}}]),n}(di),or=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ur=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return or(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e[0],(a=e[1])instanceof F){t.next=4;break}throw new Error("Tile only works with CPU tensor as repeats");case 4:if(!(this.onnxVersion<13&&this.onnxVersion>=6)){t.next=8;break}for(i=new Array(a.size),r=0;r<a.size;r++)i[r]=a.get(r);return t.abrupt("return",[n.repeat(i)]);case 8:throw new Error("Tile with onnx version ".concat(this.onnxVersion," not yet implemented"));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Tile"}},{key:"delete",value:function(){}}]),n}(ni),cr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},hr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).permutation=u.getAttributeInts("perm"),u}return Object(k.a)(n,[{key:"forward",value:function(e){return cr(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],t.abrupt("return",[n.transpose(this.permutation)]);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Transpose"}},{key:"delete",value:function(){}}]),n}(ni),lr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},pr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),u=t.call(this,e,a,i,r,s,o),s<13&&(u.axes=u.getAttributeInts("axes")),u}return Object(k.a)(n,[{key:"forward",value:function(e){return lr(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e[0],!(this.onnxVersion<13&&void 0!==this.axes)){t.next=8;break}for(a=n.getShape(),i=[],r=0,s=0;s<a.length;s++)r<this.axes.length&&this.axes[r]===s&&(i.push(1),r++),i.push(a[s]);return this.axes[this.axes.length-1]===a.length&&i.push(1),t.abrupt("return",[n.reshape(i)]);case 8:throw new Error("Unsqueeze with onnx version ".concat(this.onnxVersion," not yet implemented"));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Unsqueeze"}},{key:"delete",value:function(){}}]),n}(ni),fr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},dr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;if(Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).sampleMode=u.getAttributeString("mode"),"nearest"!==u.sampleMode)throw new Error("Upsampling only supported with nearest neighbor sampling");if(u.onnxVersion<9){var c=u.getAttributeFloats("scales");if(void 0===c||null===c)throw new Error("Upsample node with onnx version ".concat(u.onnxVersion," is missing scales attribute"));u.scales=c}return u}return Object(k.a)(n,[{key:"getScales",value:function(e){return fr(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.onnxVersion<9)){t.next=2;break}return t.abrupt("return",this.scales);case 2:if(e instanceof F){t.next=7;break}return console.warn("Scales tensor for upsample not on CPU, need to transfer!"),t.next=6,Ha(e);case 6:e=t.sent;case 7:for(n=e,a=new Array(n.size),i=0;i<n.size;i++)a[i]=n.get(i);return t.abrupt("return",a);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"forward",value:function(e){return fr(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=e[1],t.next=4,this.getScales(a);case 4:return i=t.sent,t.abrupt("return",[n.upsample(i)]);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Upsample"}},{key:"delete",value:function(){}}]),n}(ni),vr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},mr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return vr(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=e[0],a=new Array(n.getShape().length-2),i=0;i<n.getShape().length-2;i++)a[i]=i+2;return t.abrupt("return",[n.reduceMean(a,!0)]);case 4:case"end":return t.stop()}}),t)})))}},{key:"getType",value:function(){return"GlobalAveragePool"}},{key:"delete",value:function(){}}]),n}(ni),yr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Abs",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.abs()}}]),n}(ki),wr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Log",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.log()}}]),n}(ki),br=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Sqrt",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.sqrt()}}]),n}(ki),gr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Sign",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.sign()}}]),n}(ki),kr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Tan",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.tan()}}]),n}(ki),xr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Atan",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.atan()}}]),n}(ki),Or=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"TanH",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.tanh()}}]),n}(ki),jr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ATanH",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.atanh()}}]),n}(ki),Sr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Cos",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.cos()}}]),n}(ki),Ar=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Acos",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.acos()}}]),n}(ki),Mr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Cosh",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.cosh()}}]),n}(ki),Tr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"AcosH",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.acosh()}}]),n}(ki),Ir=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Sin",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.sin()}}]),n}(ki),Cr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Asin",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.asin()}}]),n}(ki),Vr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Sinh",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.sinh()}}]),n}(ki),Pr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Asinh",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.asinh()}}]),n}(ki),Dr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Sigmoid",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.sigmoid()}}]),n}(ki),Gr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceMin",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.min(this.axes,this.keepDims)}}]),n}(qi),Er=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceProd",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.product(this.axes,this.keepDims)}}]),n}(qi),Rr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceLogSum",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.reduceLogSum(this.axes,this.keepDims)}}]),n}(qi),_r=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceLogSumExp",o)}return Object(k.a)(n,[{key:"calc",value:function(e){return e.reduceLogSumExp(this.axes,this.keepDims)}}]),n}(qi),Xr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceL2",o)}return Object(k.a)(n,[{key:"calc",value:function(e){var t=e.sumSquare(this.axes,this.keepDims),n=t.sqrt();return t.delete(),n}}]),n}(qi),Br=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"ReduceL1",o)}return Object(k.a)(n,[{key:"calc",value:function(e){var t=e.abs(),n=t.sum(this.axes,this.keepDims);return t.delete(),n}}]),n}(qi),zr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Pow",o)}return Object(k.a)(n,[{key:"compute",value:function(e,t){return e.power(t)}}]),n}(di),Ur=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Identity",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.copy()}}]),n}(ki),Wr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,"HardSigmoid",o)).alpha=u.getAttributeFloat("alpha")||.2,u.beta=u.getAttributeFloat("beta")||.5,u}return Object(k.a)(n,[{key:"compute",value:function(e){return e.hardSigmoid(this.alpha,this.beta)}}]),n}(ki),Lr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Neg",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.negate()}}]),n}(ki),Fr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Reciprocal",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.powerScalar(-1,1)}}]),n}(ki),Nr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},qr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return Nr(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],t.abrupt("return",[n.squeeze()]);case 2:case"end":return t.stop()}}),t)})))}},{key:"getType",value:function(){return"Squeeze"}},{key:"delete",value:function(){}}]),n}(ni),Hr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Jr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return Hr(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.getShape(),i=A(a),t.abrupt("return",[new F([1],[i],"uint32")]);case 4:case"end":return t.stop()}}),t)})))}},{key:"getType",value:function(){return"Size"}},{key:"delete",value:function(){}}]),n}(ni),Kr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Zr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).alpha=u.getAttributeFloat("alpha")||.01,u}return Object(k.a)(n,[{key:"forward",value:function(e){return Kr(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.clip(void 0,0),i=n.clip(0,void 0),r=a.add(i,this.alpha),a.delete(),i.delete(),t.abrupt("return",[r]);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"delete",value:function(){}},{key:"getType",value:function(){return"LeakyRelu"}}]),n}(ni),Yr=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},Qr=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).alpha=u.getAttributeFloat("alpha")||1,u}return Object(k.a)(n,[{key:"forward",value:function(e){return Yr(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.clip(void 0,0),i=n.clip(0,void 0),r=a.exp(),a.delete(),s=r.addMultiplyScalar(this.alpha,-this.alpha),r.delete(),o=s.add(i),s.delete(),i.delete(),t.abrupt("return",[o]);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"delete",value:function(){}},{key:"getType",value:function(){return"Elu"}}]),n}(ni),$r=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},es=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return $r(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=e[1],i=n.clip(void 0,0),r=n.clip(0,void 0),s=i.multiply(a),i.delete(),o=s.add(r),s.delete(),r.delete(),t.abrupt("return",[o]);case 10:case"end":return t.stop()}}),t)})))}},{key:"delete",value:function(){}},{key:"getType",value:function(){return"PRElu"}}]),n}(ni),ts=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ns=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).alpha=u.getAttributeFloat("alpha")||1.6732631921768188,u.gamma=u.getAttributeFloat("gamma")||1.0507010221481323,u}return Object(k.a)(n,[{key:"forward",value:function(e){return ts(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.clip(void 0,0),i=n.clip(0,void 0),r=a.exp(),a.delete(),s=r.addMultiplyScalar(this.gamma*this.alpha,-this.alpha*this.gamma),r.delete(),o=s.add(i,1,this.gamma),s.delete(),i.delete(),t.abrupt("return",[o]);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"delete",value:function(){}},{key:"getType",value:function(){return"Selu"}}]),n}(ni),as=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},is=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;Object(g.a)(this,n);var c=(u=t.call(this,e,a,i,r,s,o)).getAttributeInt("axis");return null!==c&&(u.axis=c),u}return Object(k.a)(n,[{key:"forward",value:function(e){return as(this,void 0,void 0,m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],t.abrupt("return",[n.flatten(this.axis)]);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getType",value:function(){return"Flatten"}},{key:"delete",value:function(){}}]),n}(ni),rs=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ss=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return rs(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.exp(),i=a.addScalar(1),a.delete(),r=i.log(),i.delete(),t.abrupt("return",[r]);case 7:case"end":return t.stop()}}),t)})))}},{key:"getType",value:function(){return"Softplus"}},{key:"delete",value:function(){}}]),n}(ni),os=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},us=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return os(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.abs(),i=a.addScalar(1),a.delete(),r=n.divide(i),i.delete(),t.abrupt("return",[r]);case 7:case"end":return t.stop()}}),t)})))}},{key:"getType",value:function(){return"Softsign"}},{key:"delete",value:function(){}}]),n}(ni),cs=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},hs=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return cs(this,void 0,void 0,m.a.mark((function t(){var n,a,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e.length,n=e[0],a=1;a<e.length;a++)i=n.add(e[a]),a>1&&n.delete(),n=i;return t.abrupt("return",[n]);case 4:case"end":return t.stop()}}),t)})))}},{key:"getType",value:function(){return"Sum"}},{key:"delete",value:function(){}}]),n}(ni),ls=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ps=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,o)}return Object(k.a)(n,[{key:"forward",value:function(e){return ls(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e.length,n=e[0],a=1;a<e.length;a++)i=n.add(e[a]),a>1&&n.delete(),n=i;return r=n.multiplyScalar(1/e.length),e.length>2&&n.delete(),t.abrupt("return",[r]);case 6:case"end":return t.stop()}}),t)})))}},{key:"getType",value:function(){return"Mean"}},{key:"delete",value:function(){}}]),n}(ni),fs=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ds=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).alpha=u.getAttributeFloat("alpha")||1,u}return Object(k.a)(n,[{key:"forward",value:function(e){return fs(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=n.clip(void 0,0),i=n.clip(0,void 0),r=a.multiplyScalar(1/this.alpha),a.delete(),s=r.exp(),r.delete(),o=s.addMultiplyScalar(this.alpha,-this.alpha),s.delete(),u=o.add(i),o.delete(),i.delete(),t.abrupt("return",[u]);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"delete",value:function(){}},{key:"getType",value:function(){return"Celu"}}]),n}(ni),vs=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){return Object(g.a)(this,n),t.call(this,e,a,i,r,s,"Round",o)}return Object(k.a)(n,[{key:"compute",value:function(e){return e.round()}}]),n}(ki),ms=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},ys=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i,r,s,o){var u;return Object(g.a)(this,n),(u=t.call(this,e,a,i,r,s,o)).backend="CPU",u}return Object(k.a)(n,[{key:"forward",value:function(e){return ms(this,void 0,void 0,m.a.mark((function t(){var n,a,i,r,s,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],a=e[1],i=e[2],t.next=5,this.toValues(n);case 5:return r=t.sent[0],t.next=8,this.toValues(a);case 8:return s=t.sent[0],t.next=11,this.toValues(i);case 11:if(o=t.sent[0],"CPU"!==this.backend){t.next=16;break}return t.abrupt("return",[F.range(r,s,o)]);case 16:if("WASM"!==this.backend){t.next=20;break}return t.abrupt("return",[An.range(r,s,o)]);case 20:return t.abrupt("return",[lt.range(r,s,o)]);case 21:case"end":return t.stop()}}),t,this)})))}},{key:"delete",value:function(){}},{key:"getType",value:function(){return"Range"}},{key:"toCPU",value:function(){return ms(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.backend="CPU";case 1:case"end":return e.stop()}}),e,this)})))}},{key:"toWASM",value:function(){return ms(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.backend="WASM";case 1:case"end":return e.stop()}}),e,this)})))}},{key:"toGPU",value:function(){return ms(this,void 0,void 0,m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.backend="GPU";case 1:case"end":return e.stop()}}),e,this)})))}}]),n}(ni),ws={Conv:function(e,t,n,a,i,r){return new oi(e,t,n,a,i,r)},BatchNormalization:function(e,t,n,a,i,r){return new yi(e,t,n,a,i,r)},Clip:function(e,t,n,a,i,r){return new ji(e,t,n,a,i,r)},Add:function(e,t,n,a,i,r){return new vi(e,t,n,a,i,r)},Pow:function(e,t,n,a,i,r){return new zr(e,t,n,a,i,r)},ReduceMean:function(e,t,n,a,i,r){return new Ji(e,t,n,a,i,r)},Gemm:function(e,t,n,a,i,r){return new _i(e,t,n,a,i,r)},Constant:function(e,t,n,a,i,r){return new ri(e,t,n,a,i,r)},Reshape:function(e,t,n,a,i,r){return new $i(e,t,n,a,i,r)},Range:function(e,t,n,a,i,r){return new ys(e,t,n,a,i,r)},Flatten:function(e,t,n,a,i,r){return new is(e,t,n,a,i,r)},Tile:function(e,t,n,a,i,r){return new ur(e,t,n,a,i,r)},MatMul:function(e,t,n,a,i,r){return new Ui(e,t,n,a,i,r)},Exp:function(e,t,n,a,i,r){return new Ci(e,t,n,a,i,r)},Log:function(e,t,n,a,i,r){return new wr(e,t,n,a,i,r)},Sqrt:function(e,t,n,a,i,r){return new br(e,t,n,a,i,r)},Sign:function(e,t,n,a,i,r){return new gr(e,t,n,a,i,r)},ReduceSum:function(e,t,n,a,i,r){return new Ki(e,t,n,a,i,r)},ReduceProd:function(e,t,n,a,i,r){return new Er(e,t,n,a,i,r)},ReduceMax:function(e,t,n,a,i,r){return new Hi(e,t,n,a,i,r)},ReduceMin:function(e,t,n,a,i,r){return new Gr(e,t,n,a,i,r)},ReduceSumSquare:function(e,t,n,a,i,r){return new Zi(e,t,n,a,i,r)},ReduceL2:function(e,t,n,a,i,r){return new Xr(e,t,n,a,i,r)},ReduceL1:function(e,t,n,a,i,r){return new Br(e,t,n,a,i,r)},ReduceLogSum:function(e,t,n,a,i,r){return new Rr(e,t,n,a,i,r)},ReduceLogSumExp:function(e,t,n,a,i,r){return new _r(e,t,n,a,i,r)},Sub:function(e,t,n,a,i,r){return new sr(e,t,n,a,i,r)},Mul:function(e,t,n,a,i,r){return new Wi(e,t,n,a,i,r)},Div:function(e,t,n,a,i,r){return new Ii(e,t,n,a,i,r)},Unsqueeze:function(e,t,n,a,i,r){return new pr(e,t,n,a,i,r)},Concat:function(e,t,n,a,i,r){return new Ai(e,t,n,a,i,r)},Sum:function(e,t,n,a,i,r){return new hs(e,t,n,a,i,r)},Mean:function(e,t,n,a,i,r){return new ps(e,t,n,a,i,r)},ConstantOfShape:function(e,t,n,a,i,r){return new Ti(e,t,n,a,i,r)},Expand:function(e,t,n,a,i,r){return new Pi(e,t,n,a,i,r)},Squeeze:function(e,t,n,a,i,r){return new qr(e,t,n,a,i,r)},InstanceNormalization:function(e,t,n,a,i,r){return new Bi(e,t,n,a,i,r)},Pad:function(e,t,n,a,i,r){return new Fi(e,t,n,a,i,r)},Relu:function(e,t,n,a,i,r){return new Yi(e,t,n,a,i,r)},LeakyRelu:function(e,t,n,a,i,r){return new Zr(e,t,n,a,i,r)},Elu:function(e,t,n,a,i,r){return new Qr(e,t,n,a,i,r)},PRelu:function(e,t,n,a,i,r){return new es(e,t,n,a,i,r)},Selu:function(e,t,n,a,i,r){return new ns(e,t,n,a,i,r)},Celu:function(e,t,n,a,i,r){return new ds(e,t,n,a,i,r)},Shape:function(e,t,n,a,i,r){return new tr(e,t,n,a,i,r)},Size:function(e,t,n,a,i,r){return new Jr(e,t,n,a,i,r)},Gather:function(e,t,n,a,i,r){return new Ei(e,t,n,a,i,r)},Cast:function(e,t,n,a,i,r){return new bi(e,t,n,a,i,r)},Floor:function(e,t,n,a,i,r){return new Di(e,t,n,a,i,r)},Ceil:function(e,t,n,a,i,r){return new xi(e,t,n,a,i,r)},Round:function(e,t,n,a,i,r){return new vs(e,t,n,a,i,r)},Abs:function(e,t,n,a,i,r){return new yr(e,t,n,a,i,r)},Neg:function(e,t,n,a,i,r){return new Lr(e,t,n,a,i,r)},Reciprocal:function(e,t,n,a,i,r){return new Fr(e,t,n,a,i,r)},Identity:function(e,t,n,a,i,r){return new Ur(e,t,n,a,i,r)},Sigmoid:function(e,t,n,a,i,r){return new Dr(e,t,n,a,i,r)},HardSigmoid:function(e,t,n,a,i,r){return new Wr(e,t,n,a,i,r)},Sin:function(e,t,n,a,i,r){return new Ir(e,t,n,a,i,r)},Cos:function(e,t,n,a,i,r){return new Sr(e,t,n,a,i,r)},Tan:function(e,t,n,a,i,r){return new kr(e,t,n,a,i,r)},Asin:function(e,t,n,a,i,r){return new Cr(e,t,n,a,i,r)},Acos:function(e,t,n,a,i,r){return new Ar(e,t,n,a,i,r)},Atan:function(e,t,n,a,i,r){return new xr(e,t,n,a,i,r)},Sinh:function(e,t,n,a,i,r){return new Vr(e,t,n,a,i,r)},Cosh:function(e,t,n,a,i,r){return new Mr(e,t,n,a,i,r)},Tanh:function(e,t,n,a,i,r){return new Or(e,t,n,a,i,r)},Asinh:function(e,t,n,a,i,r){return new Pr(e,t,n,a,i,r)},Acosh:function(e,t,n,a,i,r){return new Tr(e,t,n,a,i,r)},Atanh:function(e,t,n,a,i,r){return new jr(e,t,n,a,i,r)},Slice:function(e,t,n,a,i,r){return new ar(e,t,n,a,i,r)},Upsample:function(e,t,n,a,i,r){return new dr(e,t,n,a,i,r)},Transpose:function(e,t,n,a,i,r){return new hr(e,t,n,a,i,r)},Softmax:function(e,t,n,a,i,r){return new rr(e,t,n,a,i,r)},Softplus:function(e,t,n,a,i,r){return new ss(e,t,n,a,i,r)},Softsign:function(e,t,n,a,i,r){return new us(e,t,n,a,i,r)},GlobalAveragePool:function(e,t,n,a,i,r){return new mr(e,t,n,a,i,r)}},bs=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function s(e){try{u(a.next(e))}catch(t){r(t)}}function o(e){try{u(a.throw(e))}catch(t){r(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((a=a.apply(e,t||[])).next())}))},gs=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a){var i,r;Object(g.a)(this,n),(i=t.call(this)).inputSet=new Set,i.nodes={},i.nodeIds=[],i.defaultReady=[],i.intermediaries={},i.constants={},i.nodeIdCounter=1e4,void 0===a&&(a={}),i.noConvertConstants=new Set(void 0!==a.noConvertConstants?a.noConvertConstants:[]),i.noConvertNodes=new Set(void 0!==a.noConvertNodes?a.noConvertNodes:[]),i.mode=a.mode||"inference",i.precision=a.precision||32,r=e instanceof ArrayBuffer?new Uint8Array(e):e,i.modelProto=Qa.onnx.ModelProto.decode(r);var s=i.modelProto.opsetImport[0].version;Ya.a.isLong(s)&&(s=s.toNumber()),i.version=s,i.inputs=i.modelProto.graph.input;for(var o=0;o<i.inputs.length;o++)i.inputSet.add(i.inputs[o].name);return i.outputs=i.modelProto.graph.output.map((function(e){return e.name})),i.initializer(i.modelProto.graph.initializer),i.initNodes(i.modelProto),i}return Object(k.a)(n,[{key:"initNodes",value:function(e){for(var t=this,n=0;n<e.graph.node.length;n++){var a=e.graph.node[n],i=ws[a.opType];if(void 0===i)throw new Error("Node operator ".concat(a.opType," can not be resolved"));var r=a.attribute||[],s=a.input||[],o=i(r,s,a.output||[],this.constants,this.version,this.mode);this.nodes[n]=o,this.nodeIds.push(n);for(var u=0;u<s.length;u++){var c=s[u];void 0===this.intermediaries[c]&&(this.intermediaries[c]={to:[],deletable:!0}),this.intermediaries[c].to.push(n)}0===o.variableInputs&&this.defaultReady.push(n),"Constant"===a.opType&&(void 0===this.intermediaries[a.output[0]]?this.intermediaries[a.output[0]]={to:[],deletable:!1}:this.intermediaries[a.output[0]].deletable=!1)}var h,l=Object(j.a)(this.nodeIds);try{for(l.s();!(h=l.n()).done;){var p=h.value;this.nodes[p].initialize((function(e){return t.resolveConstant(e)}))}}catch(f){l.e(f)}finally{l.f()}}},{key:"initializer",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],a=ai(n,16===this.precision);"train"===this.mode&&(a=new Na(a)),this.constants[n.name]=a}}},{key:"forward",value:function(e,t){return bs(this,void 0,void 0,m.a.mark((function n(){var a,i,r,s,o,u,c,h,l,p,f,d,v,y,w,b=this;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a={},i={},r=Object(j.a)(this.nodeIds);try{for(r.s();!(s=r.n()).done;)o=s.value,i[o]={variableInputs:0}}catch(m){r.e(m)}finally{r.f()}u=Object(S.a)(this.defaultReady),this.initializeForward(e,a,i,u);case 6:if(!(u.length>0)){n.next=29;break}return c=u.shift(),h=this.nodes[c],l=this.getInputsToNode(h,a),p=l.inputs,f=l.toDelete,d=void 0,n.prev=11,n.next=14,h.forward(p);case 14:d=n.sent,n.next=21;break;case 17:throw n.prev=17,n.t0=n.catch(11),console.error("Error occurred in node ".concat(c," with inputs ").concat(h.inputs," from nodes ").concat(h.inputs.map((function(e){return b.getNodeWithOutput(e)})))),n.t0;case 21:for(Q.flush(),this.propagateResults(h,a,d,i,u),v=0;v<f.length;v++)this.inputSet.has(f[v])||(a[f[v]].value.delete(),delete a[f[v]]);if(void 0===t){n.next=27;break}return n.next=27,new Promise((function(e){setTimeout(e,t)}));case 27:n.next=6;break;case 29:for(y=[],w=0;w<this.outputs.length;w++)y.push(a[this.outputs[w]].value);return n.abrupt("return",y);case 32:case"end":return n.stop()}}),n,this,[[11,17]])})))}},{key:"initializeForward",value:function(e,t,n,a){for(var i=0;i<e.length;i++){t[this.inputs[i].name]={value:e[i],used:0};for(var r=this.intermediaries[this.inputs[i].name],s=0;s<r.to.length;s++){var o=r.to[s];n[o].variableInputs++,n[o].variableInputs===this.nodes[o].variableInputs&&(a.push(o),delete n[o])}}}},{key:"getInputsToNode",value:function(e,t){for(var n=[],a=[],i=0;i<e.inputs.length;i++){var r=e.inputs[i];if(void 0!==this.constants[r])n.push(this.constants[r]);else{var s=t[r];s.used++,s.used>=this.intermediaries[r].to.length&&this.intermediaries[r].deletable&&a.push(r),n.push(s.value)}}return{inputs:n,toDelete:a}}},{key:"propagateResults",value:function(e,t,n,a,i){for(var r=0;r<e.outputs.length;r++){var s=e.outputs[r];t[s]={value:n[r],used:0};var o=this.intermediaries[s];if(void 0!==o)for(var u=0;u<o.to.length;u++){var c=o.to[u];a[c].variableInputs++,a[c].variableInputs===this.nodes[c].variableInputs&&(i.push(c),delete a[c])}}}},{key:"toCPU",value:function(){return bs(this,void 0,void 0,m.a.mark((function e(){var t,n,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=m.a.keys(this.constants);case 1:if((e.t1=e.t0()).done){e.next=9;break}if(t=e.t1.value,this.noConvertConstants.has(t)){e.next=7;break}return e.next=6,Ha(this.constants[t]);case 6:this.constants[t]=e.sent;case 7:e.next=1;break;case 9:n=Object(j.a)(this.nodeIds),e.prev=10,n.s();case 12:if((a=n.n()).done){e.next=19;break}if(i=a.value,this.noConvertNodes.has(i)){e.next=17;break}return e.next=17,this.nodes[i].toCPU();case 17:e.next=12;break;case 19:e.next=24;break;case 21:e.prev=21,e.t2=e.catch(10),n.e(e.t2);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[10,21,24,27]])})))}},{key:"toWASM",value:function(){return bs(this,void 0,void 0,m.a.mark((function e(){var t,n,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=m.a.keys(this.constants);case 1:if((e.t1=e.t0()).done){e.next=9;break}if(t=e.t1.value,this.noConvertConstants.has(t)){e.next=7;break}return e.next=6,Ja(this.constants[t]);case 6:this.constants[t]=e.sent;case 7:e.next=1;break;case 9:n=Object(j.a)(this.nodeIds),e.prev=10,n.s();case 12:if((a=n.n()).done){e.next=19;break}if(i=a.value,this.noConvertNodes.has(i)){e.next=17;break}return e.next=17,this.nodes[i].toWASM();case 17:e.next=12;break;case 19:e.next=24;break;case 21:e.prev=21,e.t2=e.catch(10),n.e(e.t2);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[10,21,24,27]])})))}},{key:"toGPU",value:function(){return bs(this,void 0,void 0,m.a.mark((function e(){var t,n,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=m.a.keys(this.constants);case 1:if((e.t1=e.t0()).done){e.next=9;break}if(t=e.t1.value,this.noConvertConstants.has(t)){e.next=7;break}return e.next=6,Ka(this.constants[t]);case 6:this.constants[t]=e.sent;case 7:e.next=1;break;case 9:n=Object(j.a)(this.nodeIds),e.prev=10,n.s();case 12:if((a=n.n()).done){e.next=19;break}if(i=a.value,this.noConvertNodes.has(i)){e.next=17;break}return e.next=17,this.nodes[i].toGPU();case 17:e.next=12;break;case 19:e.next=24;break;case 21:e.prev=21,e.t2=e.catch(10),n.e(e.t2);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[10,21,24,27]])})))}},{key:"optimize",value:function(){var e,t=this,n=Object(j.a)(pi);try{for(n.s();!(e=n.n()).done;){var a,i=e.value,r=i.findApplications(this),s=Object(j.a)(r);try{for(s.s();!(a=s.n()).done;){var o,u=a.value,c=u.map((function(e){return t.nodes[e]})),h=i.apply(c,(function(e){return t.resolveConstant(e)}),this.constants,this.version),l=new Set(h.outputs),p=Object(j.a)(u);try{for(p.s();!(o=p.n()).done;){var f=o.value;this.removeNode(f,l)}}catch(d){p.e(d)}finally{p.f()}this.insertNode(h)}}catch(d){s.e(d)}finally{s.f()}}}catch(d){n.e(d)}finally{n.f()}this.prune()}},{key:"prune",value:function(e){for(var t=this;;){var n=this.pruneIntermediaries(e);if(e=[],!(n.size>0))break;n.forEach((function(n){var a=t.removeNode(n,new Set);e=null===e||void 0===e?void 0:e.concat(a)}))}}},{key:"pruneIntermediaries",value:function(e){var t=this,n=new Set;void 0===e&&(e=[]);for(var a=0;a<e.length;a++){var i=e[a],r=this.getNodeWithOutput(i);void 0!==r&&n.add(r);var s=this.getNodeWithInput(i);void 0!==s&&n.add(s)}var o=function(a){if(0===t.intermediaries[a].to.length&&void 0===t.outputs.find((function(e){return e===a}))){e.push(a);var i=t.getNodeWithOutput(a);void 0!==i&&n.add(i);var r=t.getNodeWithInput(a);void 0!==r&&n.add(r)}};for(var u in this.intermediaries)o(u);var c,h=Object(j.a)(e);try{for(h.s();!(c=h.n()).done;){var l=c.value;delete this.intermediaries[l]}}catch(p){h.e(p)}finally{h.f()}return n}},{key:"removeNode",value:function(e,t){var n,a=this.nodes[e],i=Object(j.a)(a.inputs);try{for(i.s();!(n=i.n()).done;){var r=n.value;void 0!==this.intermediaries[r]&&(this.intermediaries[r].to=this.intermediaries[r].to.filter((function(t){return t.toString()!==e.toString()})))}}catch(o){i.e(o)}finally{i.f()}var s=[];return t.has(a.outputs[0])||s.push(a.outputs[0]),this.nodeIds=this.nodeIds.filter((function(t){return t.toString()!==e.toString()})),this.nodes[e].delete(),delete this.nodes[e],this.defaultReady=this.defaultReady.filter((function(t){return t!==e})),s}},{key:"insertNode",value:function(e){var t=this.nodeIdCounter++;this.nodeIds.push(t),this.nodes[t]=e;var n,a=Object(j.a)(e.inputs);try{for(a.s();!(n=a.n()).done;){var i=n.value;this.intermediaries[i].to.push(t)}}catch(r){a.e(r)}finally{a.f()}}},{key:"getNodeWithOutput",value:function(e){var t,n=Object(j.a)(this.nodeIds);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(-1!==this.nodes[a].outputs.findIndex((function(t){return t===e})))return a}}catch(i){n.e(i)}finally{n.f()}}},{key:"getNodeWithInput",value:function(e){var t,n=Object(j.a)(this.nodeIds);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(-1!==this.nodes[a].inputs.findIndex((function(t){return t===e})))return a}}catch(i){n.e(i)}finally{n.f()}}},{key:"resolveConstant",value:function(e){if(void 0!==this.constants[e])return this.constants[e];var t=this.getNodeWithOutput(e),n=this.nodes[t];return n instanceof ri?n.tensor:void 0}},{key:"getNodes",value:function(){return this.nodes}},{key:"delete",value:function(){for(var e in this.constants)this.constants[e].delete();var t,n=Object(j.a)(this.nodeIds);try{for(n.s();!(t=n.n()).done;){var a=t.value;this.nodes[a].delete()}}catch(i){n.e(i)}finally{n.f()}}},{key:"getSubModules",value:function(){var e,t=Object(N.a)(Object(q.a)(n.prototype),"getSubModules",this).call(this),a=Object(j.a)(this.nodeIds);try{for(a.s();!(e=a.n()).done;){var i=e.value;t.push(this.nodes[i])}}catch(r){a.e(r)}finally{a.f()}return t}},{key:"getParameters",value:function(){var e=Object(N.a)(Object(q.a)(n.prototype),"getParameters",this).call(this);for(var t in this.constants)this.constants[t]instanceof Na&&e.push(this.constants[t]);return e}}]),n}(ei),ks=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("beta1")," float beta1;\n    ").concat(this.getVarModifier("beta2")," float beta2;\n    ").concat(this.getVarModifier("t")," int t;\n    ")}},{key:"getFragmentShader",value:function(e){return"\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      float m1 = getValueAtPos(pos, widthMoments, heightMoments, Moments);\n      float m2 = getValueAtPos(pos+2, widthMoments, heightMoments, Moments);\n      float grad = getValueAtPos(pos/4, widthGrad, heightGrad, Grad);\n\n      m1 = beta1*m1 + (1.0-beta1)*grad;\n      m2 = beta2*m2 + (1.0-beta2)*grad*grad;\n\n      float m1Corr = m1/(1.0-pow(beta1, float(t)));\n      float m2Corr = m2/(1.0-pow(beta2, float(t)));\n\n      gl_FragColor = vec4(m1,m1Corr,m2,m2Corr);\n    }\n    "}},{key:"getTextureNames",value:function(){return["Grad","Moments"]}},{key:"getUniformAttrs",value:function(){return[{name:"beta1",type:"float"},{name:"beta2",type:"float"},{name:"t",type:"int"}]}},{key:"calc",value:function(e){return this.compute(e.Moments.shape,{Grad:e.Grad,Moments:e.Moments},{beta1:e.beta1,beta2:e.beta2,t:e.t})}},{key:"getOutputShape",value:function(e){return e.Moments.shape}},{key:"compile",value:function(e){void 0!==e.shapeMoments&&(this.maxRank=e.shapeMoments.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeGrad:e.Grad.shape,widthGrad:e.Grad.memory.width,heightGrad:e.Grad.memory.height,shapeMoments:e.Moments.shape,widthMoments:e.Moments.memory.width,heightMoments:e.Moments.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,beta1:e.beta1,beta2:e.beta2}}},{key:"getInputInfoString",value:function(e){return"".concat(e.Grad.shape,"-").concat(e.Moments.shape,"-").concat(e.beta1,"-").concat(e.beta2)}}]),n}(ie),xs=(new Le((function(e){return new ks(pt,e)})),function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){var r;return Object(g.a)(this,n),(r=t.call(this,e,a,i)).maxIterations=1e6,r}return Object(k.a)(n,[{key:"getVariables",value:function(){return"\n    ".concat(this.getVarModifier("alpha")," float alpha;\n    ").concat(this.getVarModifier("epsilon")," float epsilon;\n    ")}},{key:"getFragmentShader",value:function(e){return"\n    float newVal(float m1Corr, float m2Corr, float value) {\n      return value - alpha*(m1Corr/(sqrt(m2Corr)+epsilon));\n    }\n\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      vec4 result = vec4(0,0,0,0);\n\n      float m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      float m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      float value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.r = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.g = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.b = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.a = newVal(m1Corr, m2Corr, value);\n\n\n      gl_FragColor = result;\n    }\n    "}},{key:"getTextureNames",value:function(){return["Value","Moments"]}},{key:"getUniformAttrs",value:function(){return[{name:"alpha",type:"float"},{name:"epsilon",type:"float"}]}},{key:"calc",value:function(e){return this.compute(e.Value.shape,{Value:e.Value,Moments:e.Moments},{alpha:e.alpha,epsilon:e.epsilon})}},{key:"getOutputShape",value:function(e){return e.Value.shape}},{key:"compile",value:function(e){void 0!==e.shapeMoments&&(this.maxRank=e.shapeMoments.length),Object(N.a)(Object(q.a)(n.prototype),"compile",this).call(this,e)}},{key:"getCompilationInfo",value:function(e){var t=this.getOutputShape(e),n=ee.getAllocationDimensions(A(t),this.dtype);return{shapeValue:e.Value.shape,widthValue:e.Value.memory.width,heightValue:e.Value.memory.height,shapeMoments:e.Moments.shape,widthMoments:e.Moments.memory.width,heightMoments:e.Moments.memory.height,shapeOutput:t,widthOutput:n.width,heightOutput:n.height,alpha:e.alpha,epsilon:e.epsilon}}},{key:"getInputInfoString",value:function(e){return"".concat(e.Value.shape,"-").concat(e.Moments.shape,"-").concat(e.alpha,"-").concat(e.epsilon)}}]),n}(ie));new Le((function(e){return new xs(pt,e)}));var Os=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getOp",value:function(e,t){return"".concat(t," == 1.0 ? -1.0/").concat(e," : 1.0/(1.0-").concat(e,")")}}]),n}(le);new Le((function(e){return new Os(pt,e)}));var js=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e,a,i){return Object(g.a)(this,n),t.call(this,e,a,i)}return Object(k.a)(n,[{key:"getOp",value:function(e,t){return"".concat(t," == 1.0 ? -log(").concat(e,") : -log(1.0-").concat(e,")")}}]),n}(le);new Le((function(e){return new js(pt,e)}));function Ss(){return(Ss=Object(b.a)(m.a.mark((function e(t){var n,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("models/".concat(t,".onnx"));case 2:return n=e.sent,e.next=5,n.arrayBuffer();case 5:return a=e.sent,i=new c.model.OnnxModel(a,{noConvertNodes:[69,98]}),e.next=9,i.toGPU();case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var As=["Tench","Goldfish","Great white shark","Tiger shark","Hammerhead","Electric ray","Stingray","Cock","Hen","Ostrich","Brambling","Goldfinch","House finch","Junco","Indigo bunting","Robin","Bulbul","Jay","Magpie","Chickadee","Water ouzel","Kite","Bald eagle","Vulture","Great grey owl","Europeafire salamander","Commonewt","Eft","Spotted salamander","Axolotl","Bullfrog","Tree frog","Tailed frog","Loggerhead","Leatherback turtle","Mud turtle","Terrapin","Box turtle","Banded gecko","Commoiguana","Americachameleon","Whiptail","Agama","Frilled lizard","Alligator lizard","Gila monster","Greelizard","Africachameleon","Komodo dragon","Africacrocodile","Americaalligator","Triceratops","Thunder snake","Ringneck snake","Hognose snake","Greesnake","King snake","Garter snake","Water snake","Vine snake","Night snake","Boa constrictor","Rock python","Indiacobra","Greemamba","Sea snake","Horned viper","Diamondback","Sidewinder","Trilobite","Harvestman","Scorpion","Black and gold gardespider","Barspider","Gardespider","Black widow","Tarantula","Wolf spider","Tick","Centipede","Black grouse","Ptarmigan","Ruffed grouse","Prairie chicken","Peacock","Quail","Partridge","Africagrey","Macaw","Sulphur-crested cockatoo","Lorikeet","Coucal","Bee eater","Hornbill","Hummingbird","Jacamar","Toucan","Drake","Red-breasted merganser","Goose","Black swan","Tusker","Echidna","Platypus","Wallaby","Koala","Wombat","Jellyfish","Sea anemone","Braicoral","Flatworm","Nematode","Conch","Snail","Slug","Sea slug","Chiton","Chambered nautilus","Dungeness crab","Rock crab","Fiddler crab","King crab","Americalobster","Spiny lobster","Crayfish","Hermit crab","Isopod","White stork","Black stork","Spoonbill","Flamingo","Little blue heron","Americaegret","Bittern","Crane","Limpkin","Europeagallinule","Americacoot","Bustard","Ruddy turnstone","Red-backed sandpiper","Redshank","Dowitcher","Oystercatcher","Pelican","King penguin","Albatross","Grey whale","Killer whale","Dugong","Sea lion","Chihuahua","Japanese spaniel","Maltese dog","Pekinese","Shih-Tzu","Blenheim spaniel","Papillon","Toy terrier","Rhodesiaridgeback","Afghahound","Basset","Beagle","Bloodhound","Bluetick","Black-and-tacoonhound","Walker hound","English foxhound","Redbone","Borzoi","Irish wolfhound","Italiagreyhound","Whippet","Ibizahound","Norwegiaelkhound","Otterhound","Saluki","Scottish deerhound","Weimaraner","Staffordshire bullterrier","AmericaStaffordshire terrier","Bedlingtoterrier","Border terrier","Kerry blue terrier","Irish terrier","Norfolk terrier","Norwich terrier","Yorkshire terrier","Wire-haired fox terrier","Lakeland terrier","Sealyham terrier","Airedale","Cairn","Australiaterrier","Dandie Dinmont","Bostobull","Miniature schnauzer","Giant schnauzer","Standard schnauzer","Scotch terrier","Tibetaterrier","Silky terrier","Soft-coated wheateterrier","West Highland white terrier","Lhasa","Flat-coated retriever","Curly-coated retriever","Golderetriever","Labrador retriever","Chesapeake Bay retriever","Germashort-haired pointer","Vizsla","English setter","Irish setter","Gordosetter","Brittany spaniel","Clumber","English springer","Welsh springer spaniel","Cocker spaniel","Sussex spaniel","Irish water spaniel","Kuvasz","Schipperke","Groenendael","Malinois","Briard","Kelpie","Komondor","Old English sheepdog","Shetland sheepdog","Collie","Border collie","Bouvier des Flandres","Rottweiler","Germashepherd","Doberman","Miniature pinscher","Greater Swiss Mountaidog","Bernese mountaidog","Appenzeller","EntleBucher","Boxer","Bull mastiff","Tibetamastiff","French bulldog","Great Dane","Saint Bernard","Eskimo dog","Malamute","Siberiahusky","Dalmatian","Affenpinscher","Basenji","Pug","Leonberg","Newfoundland","Great Pyrenees","Samoyed","Pomeranian","Chow","Keeshond","Brabancogriffon","Pembroke","Cardigan","Toy poodle","Miniature poodle","Standard poodle","Mexicahairless","Timber wolf","White wolf","Red wolf","Coyote","Dingo","Dhole","Africahunting dog","Hyena","Red fox","Kit fox","Arctic fox","Grey fox","Tabby","Tiger cat","Persiacat","Siamese cat","Egyptiacat","Cougar","Lynx","Leopard","Snow leopard","Jaguar","Lion","Tiger","Cheetah","Browbear","Americablack bear","Ice bear","Sloth bear","Mongoose","Meerkat","Tiger beetle","Ladybug","Ground beetle","Long-horned beetle","Leaf beetle","Dung beetle","Rhinoceros beetle","Weevil","Fly","Bee","Ant","Grasshopper","Cricket","Walking stick","Cockroach","Mantis","Cicada","Leafhopper","Lacewing","Dragonfly's darning needle","Damselfly","Admiral","Ringlet","Monarch","Cabbage butterfly","Sulphur butterfly","Lycaenid","Starfish","Sea urchin","Sea cucumber","Wood rabbit","Hare","Angora","Hamster","Porcupine","Fox squirrel","Marmot","Beaver","Guinea pig","Sorrel","Zebra","Hog","Wild boar","Warthog","Hippopotamus","Ox","Water buffalo","Bison","Ram","Bighorn","Ibex","Hartebeest","Impala","Gazelle","Arabiacamel","Llama","Weasel","Mink","Polecat","Black-footed ferret","Otter","Skunk","Badger","Armadillo","Three-toed sloth","Orangutan","Gorilla","Chimpanzee","Gibbon","Siamang","Guenon","Patas","Baboon","Macaque","Langur","Colobus","Proboscis monkey","Marmoset","Capuchin","Howler monkey","Titi","Spider monkey","Squirrel monkey","Madagascar cat","Indri","Indiaelephant","Africaelephant","Lesser panda","Giant panda","Barracouta","Eel","Coho","Rock beauty","Anemone fish","Sturgeon","Gar","Lionfish","Puffer","Abacus","Abaya","Academic gown's robe","Accordion","Acoustic guitar","Aircraft carrier","Airliner","Airship","Altar","Ambulance","Amphibian","Analog clock","Apiary","Apron","Ashcan","Assault rifle","Backpack","Bakery","Balance beam","Balloon","Ballpoint","Band Aid","Banjo","Bannister","Barbell","Barber chair","Barbershop","Barn","Barometer","Barrel","Barrow","Baseball","Basketball","Bassinet","Bassoon","Bathing cap","Bath towel","Bathtub","Beach wagon","Beacon","Beaker","Bearskin","Beer bottle","Beer glass","Bell cote","Bib","Bicycle-built-for-two","Bikini","Binder","Binoculars","Birdhouse","Boathouse","Bobsled","Bolo tie","Bonnet","Bookcase","Bookshop","Bottlecap","Bow","Bow tie","Brass","Brassiere","Breakwater","Breastplate","Broom","Bucket","Buckle","Bulletproof vest","Bullet train","Butcher shop","Cab","Caldron","Candle","Cannon","Canoe","Caopener","Cardigan","Car mirror","Carousel","Carpenter's kit","Carton","Car wheel","Cash machine","Cassette","Cassette player","Castle","Catamaran","CD player","Cello","Cellular telephone","Chain","Chainlink fence","Chaimail","Chaisaw","Chest","Chiffonier","Chime","China cabinet","Christmas stocking","Church","Cinema","Cleaver","Cliff dwelling","Cloak","Clog","Cocktail shaker","Coffee mug","Coffeepot","Coil","Combinatiolock","Computer keyboard","Confectionery","Container ship","Convertible","Corkscrew","Cornet","Cowboy boot","Cowboy hat","Cradle","Crane","Crash helmet","Crate","Crib","Crock Pot","Croquet ball","Crutch","Cuirass","Dam","Desk","Desktop computer","Dial telephone","Diaper","Digital clock","Digital watch","Dining table","Dishrag","Dishwasher","Disk brake","Dock","Dogsled","Dome","Doormat","Drilling platform","Drum","Drumstick","Dumbbell","Dutch oven","Electric fan","Electric guitar","Electric locomotive","Entertainment center","Envelope","Espresso maker","Face powder","Feather boa","File","Fireboat","Fire engine","Fire screen","Flagpole","Flute","Folding chair","Football helmet","Forklift","Fountain","Fountaipen","Four-poster","Freight car","French horn","Frying pan","Fur coat","Garbage truck","Gasmask","Gas pump","Goblet","Go-kart","Golf ball","Golfcart","Gondola","Gong","Gown","Grand piano","Greenhouse","Grille","Grocery store","Guillotine","Hair slide","Hair spray","Half track","Hammer","Hamper","Hand blower","Hand-held computer","Handkerchief","Hard disc","Harmonica","Harp","Harvester","Hatchet","Holster","Home theater","Honeycomb","Hook","Hoopskirt","Horizontal bar","Horse cart","Hourglass","IPod","Iron","Jack-o'-lantern","Jean","Jeep","Jersey","Jigsaw puzzle","Jinrikisha","Joystick","Kimono","Knee pad","Knot","Lab coat","Ladle","Lampshade","Laptop","Lawmower","Lens cap","Letter opener","Library","Lifeboat","Lighter","Limousine","Liner","Lipstick","Loafer","Lotion","Loudspeaker","Loupe's loupe","Lumbermill","Magnetic compass","Mailbag","Mailbox","Maillot","Maillot","Manhole cover","Maraca","Marimba","Mask","Matchstick","Maypole","Maze","Measuring cup","Medicine chest","Megalith","Microphone","Microwave","Military uniform","Milk can","Minibus","Miniskirt","Minivan","Missile","Mitten","Mixing bowl","Mobile home","Model T","Modem","Monastery","Monitor","Moped","Mortar","Mortarboard","Mosque","Mosquito net","Motor scooter","Mountaibike","Mountaitent","Mouse","Mousetrap","Moving van","Muzzle","Nail","Neck brace","Necklace","Nipple","Notebook","Obelisk","Oboe","Ocarina","Odometer","Oil filter","Organ","Oscilloscope","Overskirt","Oxcart","Oxygemask","Packet","Paddle","Paddlewheel","Padlock","Paintbrush","Pajama's","Palace","Panpipe","Paper towel","Parachute","Parallel bars","Park bench","Parking meter","Passenger car","Patio","Pay-phone","Pedestal","Pencil box","Pencil sharpener","Perfume","Petri dish","Photocopier","Pick","Pickelhaube","Picket fence","Pickup","Pier","Piggy bank","Pill bottle","Pillow","Ping-pong ball","Pinwheel","Pirate","Pitcher","Plane's plane","Planetarium","Plastic bag","Plate rack","Plow","Plunger's helper","Polaroid camera","Pole","Police van","Poncho","Pool table","Pop bottle","Pot","Potter's wheel","Power drill","Prayer rug","Printer","Prison","Projectile","Projector","Puck","Punching bag","Purse","Quill","Quilt","Racer","Racket","Radiator","Radio","Radio telescope","Raibarrel","Recreational vehicle.V.","Reel","Reflex camera","Refrigerator","Remote control","Restaurant","Revolver","Rifle","Rocking chair","Rotisserie","Rubber eraser","Rugby ball","Rule","Running shoe","Safe","Safety pin","Saltshaker","Sandal","Sarong","Sax","Scabbard","Scale","School bus","Schooner","Scoreboard","Screen","Screw","Screwdriver","Seat belt","Sewing machine","Shield","Shoe shop","Shoji","Shopping basket","Shopping cart","Shovel","Shower cap","Shower curtain","Ski","Ski mask","Sleeping bag","Slide rule","Sliding door","Slot","Snorkel","Snowmobile","Snowplow","Soap dispenser","Soccer ball","Sock","Solar dish","Sombrero","Soup bowl","Space bar","Space heater","Space shuttle","Spatula","Speedboat","Spider web's web","Spindle","Sports car","Spotlight","Stage","Steam locomotive","Steel arch bridge","Steel drum","Stethoscope","Stole","Stone wall","Stopwatch","Stove","Strainer","Streetcar","Stretcher","Studio couch","Stupa","Submarine","Suit","Sundial","Sunglass","Sunglasses","Sunscreen","Suspensiobridge","Swab","Sweatshirt","Swimming trunks","Swing","Switch","Syringe","Table lamp","Tank","Tape player","Teapot","Teddy","Television","Tennis ball","Thatch","Theater curtain","Thimble","Thresher","Throne","Tile roof","Toaster","Tobacco shop","Toilet seat","Torch","Totem pole","Tow truck","Toyshop","Tractor","Trailer truck","Tray","Trench coat","Tricycle","Trimaran","Tripod","Triumphal arch","Trolleybus","Trombone","Tub","Turnstile","Typewriter keyboard","Umbrella","Unicycle","Upright","Vacuum","Vase","Vault","Velvet","Vending machine","Vestment","Viaduct","Violin","Volleyball","Waffle iron","Wall clock","Wallet","Wardrobe","Warplane","Washbasin","Washer","Water bottle","Water jug","Water tower","Whiskey jug","Whistle","Wig","Window screen","Window shade","Windsor tie","Wine bottle","Wing","Wok","Woodespoon","Wool","Worm fence","Wreck","Yawl","Yurt","Web site","Comic book","Crossword puzzle","Street sign","Traffic light","Book jacket","Menu","Plate","Guacamole","Consomme","Hot pot","Trifle","Ice cream","Ice lolly","French loaf","Bagel","Pretzel","Cheeseburger","Hotdog","Mashed potato","Head cabbage","Broccoli","Cauliflower","Zucchini","Spaghetti squash","Acorsquash","Butternut squash","Cucumber","Artichoke","Bell pepper","Cardoon","Mushroom","Granny Smith","Strawberry","Orange","Lemon","Fig","Pineapple","Banana","Jackfruit","Custard apple","Pomegranate","Hay","Carbonara","Chocolate sauce","Dough","Meat loaf","Pizza","Potpie","Burrito","Red wine","Espresso","Cup","Eggnog","Alp","Bubble","Cliff","Coral reef","Geyser","Lakeside","Promontory","Sandbar","Seashore","Valley","Volcano","Ballplayer","Groom","Scuba diver","Rapeseed","Daisy","Yellow lady's slipper","Corn","Acorn","Hip","Buckeye","Coral fungus","Agaric","Gyromitra","Stinkhorn","Earthstar","Hen-of-the-woods","Bolete","Ear","Toilet tissue"],Ms=["n01440764_tench.JPEG","n03160309_dam.JPEG","n03216828_dock.JPEG","n03670208_limousine.JPEG","n04548280_wall_clock.JPEG","n04552348_warplane.JPEG","n04599235_wool.JPEG","n06874185_traffic_light.JPEG","n07873807_pizza.JPEG","n07920052_espresso.JPEG","n09193705_alp.JPEG","n12620546_hip.JPEG"],Ts=function(e){Object(x.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(g.a)(this,n),(a=t.call(this,e)).model=void 0,a.mean=new o.gpu.GPUTensor([.485,.456,.406],[3,1,1]),a.std=new o.gpu.GPUTensor([.229,.224,.225],[3,1,1]),function(e){return Ss.apply(this,arguments)}("mobilenet").then((function(e){a.model=e,console.log("Got model")})),a.setState({showResult:!1,results:[]}),a}return Object(k.a)(n,[{key:"getImageData",value:function(){var e=Object(b.a)(m.a.mark((function e(){var t,n,a,i,r,s,u,c,h,l,p,f,d,v,b,g,k,x,O,j=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("img"),console.log("Reading pixels"),a=o.gpu.GPUTensor.fromData(n),i=a.shape.slice(0,2),r=Object(w.a)(i,2),s=r[0],u=r[1],c=Math.min(u,s),h=Math.floor(c/2),l=Math.floor(u/2)-h,p=Math.floor(s/2)-h,f=a.slice([p,l,0],[p+c,l+c,3],[0,1,2]),a.delete(),d=224/c,v=f.upsample([d,d,1]),f.delete(),b=v.getShape()[0],this.setState(Object(y.a)({},this.state)),g=v.transpose([2,0,1]),v.delete(),k=g.subtract(this.mean),g.delete(),x=k.divide(this.std),k.delete(),O=x.reshape([1,3,b,b],!1),null===(t=this.model)||void 0===t||t.forward([O]).then((function(e){return j.handleResult(e[0])}));case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleResult",value:function(){var e=Object(b.a)(m.a.mark((function e(t){var n,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Got result",t),n=t.softmax(1),t.delete(),e.next=5,n.getValues();case 5:a=e.sent,i=(i=Array.from(a).map((function(e,t){return{prob:e,name:As[t]}}))).sort((function(e,t){return t.prob-e.prob})),this.setState(Object(y.a)(Object(y.a)({},this.state),{},{showResult:!0,results:i.slice(0,5)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fileSelected",value:function(e){this.setState(Object(y.a)(Object(y.a)({},this.state),{},{img:URL.createObjectURL(e.target.files[0]),showResult:!1,results:[]}))}},{key:"setImage",value:function(e){this.setState(Object(y.a)(Object(y.a)({},this.state),{},{img:"img/"+e,showResult:!1,results:[]}))}},{key:"render",value:function(){var e,t=this,n=!1;this.state&&(e=this.state.img,n=this.state.showResult);return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)("h1",{children:"MobilenNet Classification"}),Object(h.jsx)("label",{htmlFor:"file",children:"Choose an image:"})," ",Object(h.jsx)("input",{type:"file",id:"file",onChange:function(e){return t.fileSelected(e)}}),Object(h.jsx)("br",{}),"Or use one of the examples:",Object(h.jsx)("table",{children:Object(h.jsx)("tr",{children:Ms.map((function(e){return Object(h.jsx)("td",{children:Object(h.jsx)("img",{src:"img/"+e,height:50,onClick:function(){return t.setImage(e)},className:"exampleImage",alt:"Example"})})}))})}),void 0!==e?Object(h.jsx)(h.Fragment,{children:Object(h.jsx)("table",{children:Object(h.jsxs)("tr",{children:[Object(h.jsxs)("td",{children:[Object(h.jsx)("img",{id:"img",src:this.state.img,alt:"Your upload",width:400}),Object(h.jsx)("br",{}),Object(h.jsx)("button",{onClick:function(){return t.getImageData()},children:"Run"}),Object(h.jsx)("br",{})]}),Object(h.jsx)("td",{className:"resultList",children:n?this.renderResults():Object(h.jsx)(h.Fragment,{})})]})})}):Object(h.jsx)(h.Fragment,{})]})}},{key:"renderResults",value:function(){return Object(h.jsx)(h.Fragment,{children:Object(h.jsx)("table",{children:this.state.results.map((function(e){return Object(h.jsxs)("tr",{children:[Object(h.jsx)("td",{className:"resultName",children:e.name}),Object(h.jsx)("td",{children:Object(h.jsx)("div",{style:{width:400*e.prob},children:Object(h.jsx)("div",{className:"result",children:400*e.prob>50?Math.round(100*e.prob)+"%":Object(h.jsx)(h.Fragment,{})})})})]},e.name)}))})})}}]),n}(p.a.Component),Is=function(e){e&&e instanceof Function&&n.e(4).then(n.bind(null,53)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),i(e),r(e),s(e)}))};d.a.render(Object(h.jsx)(p.a.StrictMode,{children:Object(h.jsx)(Ts,{})}),document.getElementById("root")),Is()}},[[48,1,2]]]);
//# sourceMappingURL=main.51bca1f6.chunk.js.map