(this.webpackJsonpstyle=this.webpackJsonpstyle||[]).push([[0],{66:function(t,e,n){},68:function(t,e,n){},88:function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"CPUTensor",(function(){return $}));var o={};n.r(o),n.d(o,"GPUTensor",(function(){return hn})),n.d(o,"gpuConstructor",(function(){return ln}));var i={};n.r(i),n.d(i,"wasmLoaded",(function(){return or})),n.d(i,"WASMTensor",(function(){return ir}));var a={};n.r(a),n.d(a,"cpu",(function(){return r})),n.d(a,"gpu",(function(){return o})),n.d(a,"wasm",(function(){return i}));var s={};n.r(s),n.d(s,"OnnxModel",(function(){return Ea}));var u={};n.r(u),n.d(u,"model",(function(){return s}));var p=n(4),c=n(0),h=n.n(c),l=n(15),f=n.n(l),d=(n(66),n(30)),y=n(13),v=n(52),m=n(9),g=n.n(m),w=n(46),b=n(47),x=n(53),_=n(51),O=n(12);n(68);function k(t){if(0===t.length)return 0;for(var e=1,n=0;n<t.length;n+=1)e*=t[n];return e}function A(t){var e=t.length;if(0===e)return[];if(1===e)return 1===t[0]?[0]:[1];var n=new Array(e);n[e-1]=1,1===t[e-1]&&(n[e-1]=0);for(var r=1,o=e-2;o>=0;o-=1)r=t[o+1]*r,1===t[o]?n[o]=0:n[o]=r;return n}function S(t,e,n){for(var r=0,o=0;o<t.length;o+=1){if(n&&(t[o]<0||t[o]>=n[o]&&1!==n[o]))throw new Error("Invalid index");r+=t[o]*e[o]}return r}function P(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(t[n]!==e[n])return!1;return!0}function j(t,e){for(var n=t.length-1;n>=0&&(t[n]+=1,t[n]>=e[n]);n--)t[n]=0}var I=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},M=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},V=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},T=function(){function t(){}return t.prototype.compare=function(t,e){return I(this,void 0,void 0,(function(){var n,r,o;return M(this,(function(i){switch(i.label){case 0:return P(this.getShape(),t.getShape())?[4,this.getValues()]:[2,!1];case 1:return n=i.sent(),[4,t.getValues()];case 2:if(r=i.sent(),void 0!==e){for(o=0;o<n.length;o+=1)if(Math.abs(n[o]-r[o])>e)return[2,!1]}else for(o=0;o<n.length;o+=1)if(n[o]!==r[o])return[2,!1];return[2,!0]}}))}))},t.prototype.getAxes=function(t){var e,n=this.getShape();if(void 0===t){e=[];for(var r=0;r<n.length;r++)e.push(r)}else e=t instanceof Array?t:[t];return e},t.prototype.sum=function(t,e){var n=this.getAxes(t);return e=e||!1,this.sum_impl(n,e)},t.prototype.sumSquare=function(t,e){var n=this.getAxes(t);return e=e||!1,this.sumSquare_impl(n,e)},t.prototype.product=function(t,e){var n=this.getAxes(t);return e=e||!1,this.product_impl(n,e)},t.prototype.max=function(t,e){var n=this.getAxes(t);return e=e||!1,this.max_impl(n,e)},t.prototype.min=function(t,e){var n=this.getAxes(t);return e=e||!1,this.min_impl(n,e)},t.prototype.reduceMean=function(t,e){var n=this.getAxes(t);return e=e||!1,this.reduceMean_impl(n,e)},t.prototype.reduceMeanSquare=function(t,e){var n=this.getAxes(t);return e=e||!1,this.reduceMeanSquare_impl(n,e)},t.prototype.conv=function(t,e,n,r,o,i,a){var s=this.getShape().length-2;return n=n||new Array(s).fill(1),r=r||1,o=o||new Array(2*s).fill(0),i=i||new Array(s).fill(1),void 0===a&&(a="id"),this.conv_impl(t,n,r,o,i,a,e)},t.prototype.convTranspose=function(t,e,n,r,o){var i=this.getShape().length-2;return e=e||new Array(i).fill(1),n=n||1,r=r||new Array(2*i).fill(0),o=o||new Array(i).fill(1),this.convTranspose_impl(t,e,n,r,o)},t.prototype.pad=function(t,e,n){return void 0===e&&(e="constant"),void 0===n&&(n=0),this.pad_impl(t,e,n)},t.prototype.averagePool=function(t,e,n,r){var o=this.getShape().length-2;return e=e||new Array(2*o).fill(0),n=n||new Array(o).fill(1),r=r||!1,this.averagePool_impl(t,e,n,r)},t.prototype.reshape=function(t,e){for(var n=1,r=-1,o=0;o<t.length;o++)-1===t[o]?r=o:n*=t[o];if(void 0===e&&(e=!0),-1!==r){var i=k(this.getShape()),a=V(t);return a[r]=i/n,this.reshape_impl(a,e)}return this.reshape_impl(t,e)},t.prototype.alignShapes=function(t,e){var n,r;if(P(t,e))return[t,e,t];if(t.length<e.length){t=V(t);var o=e.length-t.length;(n=t).unshift.apply(n,new Array(o).fill(1))}else if(e.length<t.length){e=V(e);o=t.length-e.length;(r=e).unshift.apply(r,new Array(o).fill(1))}for(var i=new Array(t.length).fill(1),a=0;a<t.length;a++)i[a]=Math.max(t[a],e[a]);return[t,e,i]},t.prototype.alignTensor=function(t){var e,n,r=this.getShape(),o=t.getShape();if(P(r,o))return[this,t,r];var i=this;if(r.length<o.length){r=V(r);var a=o.length-r.length;(e=r).unshift.apply(e,new Array(a).fill(1)),i=this.reshape(r,!1)}else if(o.length<r.length){o=V(o);a=r.length-o.length;(n=o).unshift.apply(n,new Array(a).fill(1)),t=t.reshape(o,!1)}for(var s=new Array(r.length).fill(1),u=0;u<r.length;u++)s[u]=Math.max(r[u],o[u]);return[i,t,s]},t.prototype.add=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1);var r=this.alignTensor(t),o=r[0],i=r[1],a=r[2];return this.add_impl(o,i,a,e,n)},t.prototype.subtract=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1);var r=this.alignTensor(t),o=r[0],i=r[1],a=r[2];return this.subtract_impl(o,i,a,e,n)},t.prototype.multiply=function(t,e){void 0===e&&(e=1);var n=this.alignTensor(t),r=n[0],o=n[1],i=n[2];return this.multiply_impl(r,o,i,e)},t.prototype.multiplyScalar=function(t){return this.addMultiplyScalar(t,0)},t.prototype.addScalar=function(t){return this.addMultiplyScalar(1,t)},t.prototype.divide=function(t,e){void 0===e&&(e=1);var n=this.alignTensor(t),r=n[0],o=n[1],i=n[2];return this.divide_impl(r,o,i,e)},t.prototype.power=function(t){var e=this.alignTensor(t),n=e[0],r=e[1],o=e[2];return this.power_impl(n,r,o)},t.prototype.transpose=function(t){if(void 0===t){var e=this.getShape().length;t=[];for(var n=0;n<e;n++)t.push(e-n-1)}return this.transpose_impl(t)},t.prototype.softmax=function(t){var e=this.max(t,!0),n=this.subtract(e),r=n.exp(),o=r.sum(t,!0),i=r.divide(o);return e.delete(),n.delete(),r.delete(),o.delete(),i},t.prototype.gemm=function(t,e,n,r,o,i){if(e=e||!1,n=n||!1,r=void 0!==r?r:1,i=void 0!==i?i:1,void 0!==o){var a=this.getShape(),s=o.getShape(),u=a.length,p=s.length;u>p&&(s=V(new Array(u-p).fill(1),s),o=o.reshape(s,!1))}return this.gemm_impl(t,e,n,r,i,o)},t.prototype.slice=function(t,e,n){var r=this.getShape(),o=r.length;if(void 0===n){n=[];for(var i=0;i<o;i++)n.push(i)}t=V(t),e=V(e);for(i=0;i<n.length;i++){var a=r[n[i]];t[i]<0?t[i]+=a:t[i]>=a&&(t[i]=a),e[i]<0?e[i]+=a:e[i]>=a&&(e[i]=a)}return this.slice_impl(t,e,n)},t}();function C(t,e,n,r,o,i){var a=o*(e-1)+1;return Math.floor((t+n+r-a)/i+1)}function X(t,e,n,r,o,i){for(var a=[],s=0;s<t.length;s++)a.push(C(t[s],e[s],n[s],r[s],o[s],i[s]));return a}function G(t,e){for(var n=new $(t.shape),r=0;r<n.size;r+=1)n.set(r,e(t.get(r)));return n}function R(t,e,n,r){if(!function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(t[n]!==e[n]&&1!==t[n]&&1!==e[n])return!1;return!0}(t.shape,e.shape))throw new Error("The shapes of the two tensors should be the same for a binary operation");for(var o=new $(r),i=new Array(r.length).fill(0),a=0;a<o.size;a+=1)o.set(i,n(t.get(i),e.get(i))),j(i,r);return o}function E(t,e,n){return G(t,(function(t){return t*e+n}))}var D=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};function U(t,e,n,r,o,i){for(var a,s,u,p,c,h=[],l=0;l<t.length;l++)h.push((a=t[l],s=e[l],u=n[l],p=r[l],c=o[l],i[l]*(a-1)+u+p-(c*(s-1)+1)+2));return h}var B=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};var z=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};function W(t,e,n){for(var r=[],o=[],i=[],a=0;a<t.length;a++)e.includes(a)?(n&&(r.push(1),i.push(a)),o.push(t[a])):(r.push(t[a]),i.push(a));return 0===r.length&&r.push(1),[r,i]}function F(t,e,n,r,o){for(var i=t.getShape(),a=k(i),s=W(i,e,r),u=s[0],p=s[1],c=k(u),h=A(u),l=new $(u),f=new Array(c).fill(!1),d=new Array(i.length).fill(0),y=new Array(u.length).fill(0),v=0;v<a;v++){for(var m=0;m<p.length;m++)y[m]=d[p[m]];var g=S(y,h);f[g]?l.set(y,n(t.get(v),l.get(y))):(f[g]=!0,l.set(y,n(t.get(v)))),j(d,i)}if(o)for(v=0;v<l.size;v++)l.set(v,o(l.get(v)));return l}var N=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};var L=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};function q(t,e,n,r,o){if(o)return t.get(e);var i=t.shape.length;if("constant"===n)return r;if("edge"===n)for(var a=0;a<i;a++)e[a]<0?e[a]=0:e[a]>=t.shape[a]&&(e[a]=t.shape[a]-1);else for(a=0;a<i;a++)e[a]<0?e[a]=-e[a]:e[a]>=t.shape[a]&&(e[a]=2*t.shape[a]-e[a]-2);return t.get(e)}var H=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};var Y=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};var J=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),K=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Q=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Z=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},$=function(t){function e(e,n,r){var o=t.call(this)||this;return o.deleted=!1,o.shape=e,o.strides=A(e),o.size=k(e),void 0!==n?n instanceof Float32Array||n instanceof Int32Array?(o.values=n,o.type=n instanceof Float32Array?"float":"int"):"int"===r?(o.values=Int32Array.from(n),o.type="int"):(o.values=Float32Array.from(n),o.type="float"):"int"===r?(o.values=new Int32Array(o.size),o.type="int"):(o.values=new Float32Array(o.size),o.type="float"),o.type="float",o}return J(e,t),e.prototype.getValues=function(){return Promise.resolve(this.values)},e.prototype.getShape=function(){return this.shape},e.prototype.constantLike=function(t){return new e(this.shape,new Float32Array(this.size).fill(t))},e.prototype.singleConstant=function(t){return new e([1],[t])},e.prototype.cpu=function(){return K(this,void 0,void 0,(function(){return Q(this,(function(t){return[2,this]}))}))},e.prototype.delete=function(){this.values=void 0,this.deleted=!0},e.prototype.copy=function(t){void 0===t&&(t=Z(this.shape));for(var n=new Float32Array(this.size),r=0;r<this.size;r++)n[r]=this.values[r];return new e(t,n)},e.prototype.get=function(t){var e;return e=Array.isArray(t)?S(t,this.strides,this.shape):t,this.values[e]},e.prototype.set=function(t,e){var n;n=Array.isArray(t)?S(t,this.strides):t,this.values[n]=e},e.prototype.setValues=function(t,n){if(!(t instanceof e))throw new Error("Can only set CPU values to CPU values");return function(t,e,n){for(var r=new $(t.shape),o=new Array(t.shape.length).fill(0),i=0;i<r.size;i+=1){for(var a=!0,s=new Array(n.length).fill(0),u=0;u<n.length;u++){if(o[u]<n[u]||o[u]>=n[u]+e.shape[u]){a=!1;break}s[u]=o[u]-n[u]}a?r.set(i,e.get(s)):r.set(i,t.get(i)),j(o,t.shape)}return r}(this,t,n)},e.prototype.exp=function(){return G(this,(function(t){return Math.exp(t)}))},e.prototype.log=function(){return G(this,(function(t){return Math.log(t)}))},e.prototype.sqrt=function(){return G(this,(function(t){return Math.sqrt(t)}))},e.prototype.abs=function(){return G(this,(function(t){return Math.abs(t)}))},e.prototype.floor=function(){return G(this,(function(t){return Math.floor(t)}))},e.prototype.ceil=function(){return G(this,(function(t){return Math.ceil(t)}))},e.prototype.negate=function(){return G(this,(function(t){return-t}))},e.prototype.multiplyScalar=function(t){return E(this,t,0)},e.prototype.addScalar=function(t){return E(this,1,t)},e.prototype.addMultiplyScalar=function(t,e){return E(this,t,e)},e.prototype.sign=function(){return G(this,(function(t){return t<0?-1:1}))},e.prototype.clip=function(t,e){return function(t,e,n){var r=function(t){return t};return void 0!==e&&void 0!==n?r=function(t){return Math.min(n,Math.max(e,t))}:void 0!==n?r=function(t){return Math.min(n,t)}:void 0!==e&&(r=function(t){return Math.max(e,t)}),G(t,r)}(this,t,e)},e.prototype.clipBackward=function(t,n,r){if(!(t instanceof e))throw new Error("Can only do clipBackward with CPUTensor");return function(t,e,n,r,o){return R(t,e,(function(t,e){return void 0!==r&&t<r||void 0!==o&&t>o?0:e}),n)}(this,t,this.getShape(),n,r)},e.prototype.sigmoid=function(){return G(this,(function(t){return 1/(1+Math.exp(-t))}))},e.prototype.add_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,e,n,r,o){return R(t,e,(function(t,e){return t*r+e*o}),n)}(t,n,r,o,i)},e.prototype.subtract_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only subtract CPU tensor to CPU tensor");return function(t,e,n,r,o){return R(t,e,(function(t,e){return t*r-e*o}),n)}(t,n,r,o,i)},e.prototype.multiply_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,e,n,r){return R(t,e,(function(t,e){return t*e*r}),n)}(t,n,r,o)},e.prototype.divide_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,e,n,r){return R(t,e,(function(t,e){return t/e*r}),n)}(t,n,r,o)},e.prototype.power_impl=function(t,n,r){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only take CPU tensor to power of CPU tensor");return function(t,e,n){return R(t,e,(function(t,e){return Math.pow(t,e)}),n)}(t,n,r)},e.prototype.matMul=function(t){if(!(t instanceof e))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,e){if(2!==t.shape.length||2!==e.shape.length)throw new Error("Matmul expects both operands to have rank 2");if(t.shape[1]!==e.shape[0])throw new Error("Matmul expects dimension 1 of operand 1 to equal dimension 0 of operand 2");for(var n=t.shape[0],r=t.shape[1],o=e.shape[1],i=new $([n,o]),a=0;a<n;a+=1)for(var s=0;s<o;s+=1){for(var u=0,p=0;p<r;p+=1)u+=t.get([a,p])*e.get([p,s]);i.set([a,s],u)}return i}(this,t)},e.prototype.gemm_impl=function(t,n,r,o,i,a){if(!(t instanceof e&&(void 0===a||a instanceof e)))throw new Error("Can only do gemm with CPU tensors");return function(t,e,n,r,o,i,a){var s=t.shape.length,u=n?t.shape[s-1]:t.shape[s-2],p=n?t.shape[s-2]:t.shape[s-1],c=r?e.shape[s-2]:e.shape[s-1],h=u*p,l=p*c,f=u*c,d=n?u:1,y=n?1:p,v=r?1:c,m=r?p:1,g=0,w=0,b=0;void 0!==a&&(g=a.strides[s-2],w=a.strides[s-1],k(a.shape.slice(0,s-2))>1?1===(b=a.shape[s-2]*a.shape[s-1])&&(b=0):b=0);var x=t.shape.slice(0,s-2),_=k(x);0===_&&(_=1);for(var O=z(x,[u,c]),A=new $(O),S=0;S<_;S++)for(var P=S*h,j=S*l,I=S*f,M=S*b,V=0;V<u;V++)for(var T=0;T<c;T++){for(var C=0,X=0;X<p;X++)C+=t.get(P+V*y+X*d)*e.get(j+X*v+T*m);C*=o,void 0!==a&&(C+=i*a.get(M+V*g+T*w)),A.set(I+V*c+T,C)}return A}(this,t,n,r,o,i,a)},e.prototype.sum_impl=function(t,e){return function(t,e,n){return F(t,e,(function(t,e){return t+(void 0!==e?e:0)}),n)}(this,t,e)},e.prototype.sumSquare_impl=function(t,e){return function(t,e,n){return F(t,e,(function(t,e){return t*t+(void 0!==e?e:0)}),n)}(this,t,e)},e.prototype.product_impl=function(t,e){return function(t,e,n){return F(t,e,(function(t,e){return t*(void 0!==e?e:1)}),n)}(this,t,e)},e.prototype.max_impl=function(t,e){return function(t,e,n){return F(t,e,(function(t,e){return Math.max(t,void 0!==e?e:t)}),n)}(this,t,e)},e.prototype.min_impl=function(t,e){return function(t,e,n){return F(t,e,(function(t,e){return Math.min(t,void 0!==e?e:t)}),n)}(this,t,e)},e.prototype.reduceMean_impl=function(t,e){return function(t,e,n){for(var r=1,o=0;o<e.length;o++)r*=t.shape[e[o]];return F(t,e,(function(t,e){return t+(void 0!==e?e:0)}),n,(function(t){return t/r}))}(this,t,e)},e.prototype.reduceMeanSquare_impl=function(t,e){return function(t,e,n){for(var r=1,o=0;o<e.length;o++)r*=t.shape[e[o]];return F(t,e,(function(t,e){return t*t+(void 0!==e?e:0)}),n,(function(t){return t/r}))}(this,t,e)},e.prototype.conv_impl=function(t,n,r,o,i,a,s){if(!(t instanceof e)||void 0!==s&&!(s instanceof e))throw new Error("Can only do convolution of CPU tensor with CPU tensor");return function(t,e,n,r,o,i,a,s){var u=t.shape[0],p=t.shape[1],c=t.shape.slice(2),h=e.shape.slice(2),l=e.shape[0],f=p/r,d=k(h),y=X(c,h,o.slice(0,o.length/2),o.slice(o.length/2),n,i),v=k(y),m=[u,l];m=m.concat(y);for(var g=new $(m),w=y.length,b=0;b<u;b++)for(var x=0;x<l;x++){if(s){var _=s?s.get([x]):0;(U=new Array(y.length).fill(0)).unshift(b,x);for(var O=0;O<v;O++)g.set(U,_),j(U,g.shape)}for(var A=0;A<f;A++){var S=(x*f+A)%p;for((U=new Array(y.length).fill(0)).unshift(b,x),O=0;O<v;O++){var P=g.get(U),I=new Array(y.length).fill(0);I.unshift(x,A);for(var M=0;M<d;M++){for(var V=[b,S],T=!1,C=0;C<w;C++){var G=0===i.length?1:i[C],R=0===o.length?0:o[C],E=0===n.length?1:n[C],D=U[C+2]*G-R+I[C+2]*E;if(D<0||D>=c[C]){T=!0;break}V.push(D)}T||(P+=e.get(I)*t.get(V)),j(I,e.shape)}g.set(U,P),j(U,g.shape)}}var U;if("id"!==a)for((U=new Array(y.length).fill(0)).unshift(b,x),O=0;O<v;O++)P=g.get(U),"relu"===a?P=Math.max(0,P):"relu6"===a&&(P=Math.min(Math.max(0,P),6)),g.set(U,P),j(U,g.shape)}return g}(this,t,n,r,o,i,a,s)},e.prototype.convTranspose_impl=function(t,n,r,o,i){if(!(t instanceof e))throw new Error("Can only do transpose convolution of CPU tensor with CPU tensor");return function(t,e,n,r,o,i){var a=t.shape[0],s=t.shape[1],u=t.shape.slice(2),p=e.shape.slice(2),c=e.shape[0],h=s/r,l=k(p),f=U(u,p,o.slice(0,o.length/2),o.slice(o.length/2),n,i),d=k(f),y=[a,c];y=y.concat(f);for(var v=new $(y),m=f.length,g=0;g<a;g++)for(var w=0;w<c;w++)for(var b=0;b<h;b++){var x=(w*h+b)%s,_=new Array(f.length).fill(0);_.unshift(g,w);for(var O=0;O<d;O++){var A=v.get(_),S=new Array(f.length).fill(0);S.unshift(w,b);for(var P=0;P<l;P++){for(var I=[g,x],M=!1,V=0;V<m;V++){var T=0===i.length?1:i[V],C=0===o.length?0:o[V],X=0===n.length?1:n[V],G=_[V+2]-C+S[V+2]*X;if(0!==G%T){M=!0;break}if((G/=T)<0||G>=u[V]){M=!0;break}I.push(G)}if(!M){for(var R=[w,b],E=0;E<m;E++)R.push(p[E]-S[E+2]-1);A+=e.get(R)*t.get(I)}j(S,e.shape)}v.set(_,A),j(_,v.shape)}}return v}(this,t,n,r,o,i)},e.prototype.pad_impl=function(t,e,n){return function(t,e,n,r){for(var o=t.shape.length,i=L(t.shape),a=0;a<o;a++)i[a]+=e[a]+e[a+o];var s=new $(i),u=new Array(o).fill(0),p=new Array(o).fill(0);for(a=0;a<s.size;a++){for(var c=!0,h=0;h<o;h++)p[h]=u[h]-e[h],(p[h]<0||p[h]>=t.shape[h])&&(c=!1);s.set(a,q(t,p,n,r,c)),j(u,i)}return s}(this,t,e,n)},e.prototype.averagePool_impl=function(t,e,n,r){return function(t,e,n,r,o){var i=t.shape[0],a=t.shape[1],s=t.shape.slice(2),u=s.length,p=k(e),c=X(s,e,n.slice(0,n.length/2),n.slice(n.length/2),new Array(u).fill(1),r),h=k(c),l=[i,a];l=l.concat(c);for(var f=new $(l),d=0;d<i;d++)for(var y=0;y<a;y++){var v=new Array(c.length).fill(0);v.unshift(d,y);for(var m=0;m<h;m++){for(var g=0,w=new Array(c.length).fill(0),b=0,x=0;x<p;x++){for(var _=[d,y],O=!1,A=0;A<u;A++){var S=0===r.length?1:r[A],P=0===n.length?0:n[A],I=v[A+2]*S-P+w[A];if(I<0||I>=s[A]){O=!0;break}_.push(I)}O||(g+=t.get(_)),O&&!o||(b+=1),j(w,e)}g/=b,f.set(v,g),j(v,f.shape)}}return f}(this,t,e,n,r)},e.prototype.reshape_impl=function(t,n){return n?this.copy(t):new e(t,this.values,this.type)},e.prototype.concat=function(t,n){if(!(t instanceof e))throw new Error("Can only concat CPU tensor to CPU tensor");return function(t,e,n){var r=D(t.shape);r[n]+=e.shape[n];for(var o=new $(r),i=0,a=0,s=0,u=o.strides[n]*t.shape[n],p=o.strides[n]*e.shape[n],c=o.size/(n>0?o.strides[n-1]:o.size),h=0;h<c;h++){for(var l=0;l<u;l++)o.set(s,t.get(i)),s++,i++;for(l=0;l<p;l++)o.set(s,e.get(a)),s++,a++}return o}(this,t,n)},e.prototype.transpose_impl=function(t){return function(t,e){for(var n=t.shape.length,r=new Array(n),o=new Array(n),i=0;i<n;i++)r[i]=t.shape[e[i]],o[e[i]]=i;var a=new $(r),s=a.strides,u=new Array(n);for(i=0;i<n;i++)u[i]=s[o[i]];var p=new Array(n).fill(0);for(i=0;i<t.size;i++){for(var c=0,h=0;h<n;h++)c+=p[h]*u[h];a.set(c,t.get(i)),j(p,t.shape)}return a}(this,t)},e.prototype.repeat=function(t){return function(t,e){for(var n=t.shape.length,r=new Array(n),o=0;o<n;o++)r[o]=t.shape[o]*e[o];var i=new $(r),a=new Array(n).fill(0);for(o=0;o<i.size;o++){for(var s=new Array(n),u=0;u<n;u++)s[u]=a[u]%t.shape[u];i.set(o,t.get(s)),j(a,i.shape)}return i}(this,t)},e.prototype.expand=function(t){var e=this.alignShapes(this.shape,t),n=e[0],r=(e[1],e[2]);return P(this.shape,r)?this.copy():function(t,e){for(var n=t.shape.length,r=new $(e),o=new Array(n).fill(0),i=0;i<r.size;i++)r.set(i,t.get(o)),j(o,r.shape);return r}(this.reshape(n,!1),r)},e.prototype.gather=function(t,e){return function(t,e,n){for(var r=t.shape.length,o=n.shape.length,i=r+o-1,a=new Array(i),s=0;s<e;s++)a[s]=t.shape[s];for(s=0;s<o;s++)a[s+e]=n.shape[s];for(s=e+1;s<r;s++)a[s+o-1]=t.shape[s];var u,p,c=new $(a,void 0,t.type),h=new Array(i).fill(0);for(s=0;s<c.size;s++){u=h.slice(e,e+o);var l=n.get(u);p=B(h.slice(0,e),[l],h.slice(e+o)),c.set(s,t.get(p)),j(h,a)}return c}(this,t,e)},e.prototype.slice_impl=function(t,e,n){return function(t,e,n,r){for(var o=t.shape.length,i=H(t.shape),a=0,s=0;s<o&&a<r.length;s++)s===r[a]&&(i[s]=n[a]-e[a],a++);var u,p=new $(i,void 0,t.type),c=new Array(o).fill(0);for(s=0;s<p.size;s++){u=H(c);for(var h=0;h<r.length;h++)u[r[h]]+=e[h];p.set(s,t.get(u)),j(c,i)}return p}(this,t,e,n)},e.prototype.upsample=function(t){return function(t,e){for(var n=t.shape.length,r=Y(t.shape),o=0;o<n;o++)r[o]=Math.floor(r[o]*e[o]);var i=new $(r,void 0,t.type),a=new Array(n).fill(0),s=new Array(n);for(o=0;o<i.size;o++){for(var u=0;u<n;u++)s[u]=Math.floor(a[u]/e[u]);i.set(o,t.get(s)),j(a,r)}return i}(this,t)},e.prototype.normalize=function(t,n,r,o,i){if(!(t instanceof e)||!(n instanceof e)||!(o instanceof e)||!(i instanceof e))throw new Error("Can only normalize with CPU tensors");return function(t,e,n,r,o,i){for(var a=t.shape.length,s=N(t.shape),u=new $(s,void 0,t.type),p=new Array(a).fill(0),c=0;c<u.size;c++){var h=(t.get(p)-e.get(p))/Math.sqrt(n.get(p)+r);h=h*o.get(p)+i.get(p),u.set(c,h),j(p,s)}return u}(this,t,n,r,o,i)},e}(T),tt=n(48),et=n.n(tt),nt=function(){function t(t){this.toNumber=t,this.numEntries=0,this.dict={}}return t.prototype.betweenBoundsFirst=function(t){if(void 0!==t.gte){var e=this.toNumber(t.gte);return void 0!==this.dict[e]&&this.dict[e].length>0?[{key:t.gte,value:this.dict[e][this.dict[e].length-1]}]:[]}if(void 0!==t.lte){e=this.toNumber(t.lte);return void 0!==this.dict[e]&&this.dict[e].length>0?[{key:t.lte,value:this.dict[e][this.dict[e].length-1]}]:[]}return[]},t.prototype.deleteFirst=function(t){var e=this.toNumber(t);void 0!==this.dict[e]&&(this.dict[e].pop(),this.numEntries--)},t.prototype.insert=function(t,e){var n=this.toNumber(t);void 0===this.dict[n]&&(this.dict[n]=[]),this.dict[n].push(e),this.numEntries++},t}();function rt(t){return ot(t)}function ot(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!0),!Number.isInteger(t))return e;var r=Math.abs(t);if(r<2)return e;var o=Math.sqrt(r),i=2;if(r%i&&r%(i=3)){i=5;for(var a=2;r%i&&i<o;)i+=a,a=6-a}(i=i<=o?i:r,n)?e.push(i):e.indexOf(i)<0&&e.push(i);return i===r?e:ot(r/i,e,n)}function it(){for(var t=0,e=0;0===t;)t=Math.random();for(;0===e;)e=Math.random();return[Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*e),Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*e)]}var at,st,ut,pt=function(){function t(t,e,n){this.totalAllocations=0,this.trees={16:e(),32:e()},this.regl=t,this.entryId=0,this.maxSizeFactor=n||2}return t.prototype.allocate=function(t,e){var n=t*this.maxSizeFactor,r=4*Math.ceil(t/4);r<n&&(n=r);var o=this.trees[e].betweenBoundsFirst({gte:r,lte:n});if(0===o.length){var i=Math.ceil(t/4),a=this.getTextureDims(i),s=a.width,u=a.height,p={width:s,height:u,size:s*u*4,frameBuffer:this.regl.framebuffer({width:s,height:u,depthStencil:!1,colorFormat:"rgba",colorType:32===e?"float":"half float"}),id:this.entryId++,precision:e};return this.totalAllocations++,p}var c=o[0];return this.trees[e].deleteFirst(c.key),c.value},t.prototype.getAllocationDimensions=function(t,e){var n=t*this.maxSizeFactor,r=4*Math.ceil(t/4);r<n&&(n=r);var o=this.trees[e].betweenBoundsFirst({gte:t,lte:n});if(0===o.length){var i=Math.ceil(t/4);return this.getTextureDims(i)}var a=o[0];return{width:a.value.width,height:a.value.height}},t.prototype.deallocate=function(t){this.trees[t.precision].insert(t.size,t)},t.prototype.allocateTexture=function(t,e){for(var n=Math.ceil(t.length/4),r=this.getTextureDims(n),o=r.width,i=r.height,a=o*i*4,s=new Float32Array(a),u=0;u<t.length;u++)s[u]=t[u];for(u=t.length;u<a;u++)s[u]=0;var p=this.regl.texture({width:o,height:i,format:"rgba",type:32===e?"float":"half float",data:32===e?s:Array.from(s)}),c=this.regl.framebuffer({color:p,width:o,height:i,depthStencil:!1});return this.totalAllocations++,{width:o,height:i,size:a,frameBuffer:c,id:this.entryId++,precision:e}},t.prototype.allocateOfDimensions=function(t,e,n){var r=t*e*4,o=this.regl.texture({width:t,height:e,format:"rgba",type:32===n?"float":"half float"}),i=this.regl.framebuffer({color:o,width:t,height:e,depthStencil:!1});return this.totalAllocations++,{width:t,height:e,size:r,frameBuffer:i,id:this.entryId++,precision:n}},t.prototype.allocateFramebuffer=function(t,e){var n=this.regl.framebuffer({color:t,width:t.width,height:t.height,depthStencil:!1});return this.totalAllocations++,{width:t.width,height:t.height,size:t.width*t.height*4,frameBuffer:n,id:this.entryId++,precision:e}},t.prototype.getTextureDims=function(t){for(var e=rt(t),n=1,r=1,o=0;o<e.length;o+=2)n*=e[o],o+1<e.length&&(r*=e[o+1]);return{width:n,height:r}},t.prototype.getNumEntries=function(){return this.trees[16].numEntries+this.trees[32].numEntries},t}(),ct=document.createElement("canvas");at=ct.getContext("webgl",{failIfMajorPerformanceCaveat:!1}),st=et()({gl:at,extensions:["OES_texture_float","WEBGL_color_buffer_float","OES_texture_half_float"]}),ut=new pt(st,(function(){return new nt((function(t){return t}))}));var ht,lt=function(){return(lt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},ft=function(){function t(t,e,n){this.statics=new Set,this.copyCounter=0,this.fullyStatic=!1,void 0===e&&(e=ut),void 0===n&&(n=10),this.allocator=e,this.maxRank=n,this.gpuTensorConstructor=t}return t.prototype.registerStatics=function(t){var e=0,n=0;for(var r in t)if(r.startsWith("shape")){var o=r.slice("shape".length);this.statics.add("shape"+o),this.statics.add("size"+o),this.statics.add("rank"+o),this.statics.add("strides"+o),e++}else this.statics.add(r),r.startsWith("width")||r.startsWith("height")||n++;e-1===this.getTextureNames().length&&n===this.getUniformAttrs().length&&(this.fullyStatic=!0,this.outputShape=t.shapeOutput)},t.prototype.getVarModifier=function(t){return this.statics.has(t)?"":"uniform"},t.prototype.pad=function(t,e){for(void 0===e&&(e=this.maxRank);t.length<e;)t.push(-1);return t},t.prototype.copyPad=function(t,e){void 0===e&&(e=this.maxRank);for(var n=Array.from(t);n.length<e;)n.push(-1);return n},t.prototype.getVariables=function(){return""},t.prototype.getVariableDeclarations=function(){var t=this,e=this.getTextureNames();return e.push("Output"),"\n      "+e.map((function(e){return"\n        "+("Output"===e?"":"uniform sampler2D "+e+";")+"\n        "+t.getVarModifier("size"+e)+" int size"+e+";\n        "+t.getVarModifier("width"+e)+" int width"+e+";\n        "+t.getVarModifier("height"+e)+" int height"+e+";\n        "+t.getVarModifier("strides"+e)+" int strides"+e+"["+t.maxRank+"];\n        "+t.getVarModifier("shape"+e)+" int shape"+e+"["+t.maxRank+"];\n        "+t.getVarModifier("rank"+e)+" int rank"+e+";\n        "})).join("\n")+"\n      varying vec2 uv;\n\n      "+this.getVariables()},t.prototype.getVariableInitializations=function(t){var e=this.getTextureNames();e.push("Output");for(var n="",r=0,o=e;r<o.length;r++){var i=o[r];if("shape"+i in t){var a=t["shape"+i],s=A(a),u=k(a),p=a.length;n+=this.getArrayInit("shape"+i,a),n+=this.getArrayInit("strides"+i,s),n+="\nsize"+i+" = "+u+";",n+="\nrank"+i+" = "+p+";"}}for(var c in t){if(!c.startsWith("shape"))if(Array.isArray(t[c]))n+=this.getArrayInit(c,t[c]);else n+="int"===this.getVarType(c)?"\n"+c+" = "+t[c]+";":"\n"+c+" = "+t[c].toPrecision(20)+";"}return n},t.prototype.getVarType=function(t){var e=this.getUniformAttrs().find((function(e){return e.name===t}));return void 0!==e&&e.type?e.type:"int"},t.prototype.getArrayInit=function(t,e,n,r){void 0===n&&(n=this.maxRank);var o=this.getVarType(t);void 0===r&&("int"===o?r="-1":"float"===o&&(r="-1.0"));for(var i="",a=0;a<n;a++)a<e.length?"int"===o?i+="\n "+t+"["+a+"] = "+e[a]+";":"float"===o&&(i+="\n "+t+"["+a+"] = "+e[a].toPrecision(20)+";"):i+="\n "+t+"["+a+"] = "+r+";";return i},t.prototype.getUtilFunctions=function(){return"\n    int fromFloat(float f) {\n      return int(floor(f+0.5));\n    }\n\n    int coordinateToPos(vec2 coordinate, int textureWidth, int textureHeight) {\n      int x = (fromFloat(coordinate.x*float(textureWidth*2))-1)/2;\n      int y = (fromFloat(coordinate.y*float(textureHeight*2))-1)/2;\n\n      int pos = x + y*textureWidth;\n\n      return pos*4;\n    }\n\n    vec2 posToCoordinate(int pos, int textureWidth, int textureHeight) {\n      // 4 positions map to the same coordinate\n      pos = pos/4;\n\n      int y = pos/textureWidth;\n      int x = pos - y*textureWidth;\n\n      return vec2(float(x*2+1)/float(textureWidth*2), float(y*2+1)/float(textureHeight*2));\n    }\n\n    int indexToPos(int index["+this.maxRank+"], int strides["+this.maxRank+"]) {\n      int pos = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (strides[i] == -1) {\n          break;\n        }\n        pos += index[i]*strides[i];\n      }\n      return pos;\n    }\n\n    float getValueAtPos(int pos, int textureWidth, int textureHeight, sampler2D tex) {\n      vec2 coord = posToCoordinate(pos, textureWidth, textureHeight);\n      int res = pos - (pos/4)*4;\n      vec4 val = texture2D(tex, coord);\n      if (res == 0) {\n        return val.r;\n      } else if (res == 1) {\n        return val.g;\n      } else if (res == 2) {\n        return val.b;\n      } else {\n        return val.a;\n      }\n    }\n\n    float getValueAt(int index["+this.maxRank+"], int strides["+this.maxRank+"], int textureWidth, int textureHeight, sampler2D tex) {\n      int pos = indexToPos(index, strides);\n      return getValueAtPos(pos, textureWidth, textureHeight, tex);\n    }"},t.prototype.getTextureFunctions=function(){var t=this;return this.getTextureNames().map((function(e){return"\n      float _"+e+"(int indices["+t.maxRank+"]) {\n        return getValueAt(indices, strides"+e+", width"+e+", height"+e+", "+e+");\n      }\n      "})).join("\n")},t.prototype.getCompleteFragmentShader=function(t,e){var n=this.getFragmentShader(t),r=this.getVariableDeclarations(),o=this.getVariableInitializations(t),i=this.getUtilFunctions(),a=this.getTextureFunctions();return"\n    precision "+this.precisionString(e)+" float;\n\n    "+r+"\n\n    "+i+"\n    "+a+"\n\n    void initVars() {\n      "+o+"\n    }\n\n    "+n},t.prototype.getUniforms=function(t){for(var e=[],n=0,r=this.getUniformAttrs();n<r.length;n++){var o=r[n];void 0===t[o.name]&&e.push(o)}var i=this.getTextureNames();i.push("Output");for(var a=0,s=i;a<s.length;a++){var u=s[a];e.push({name:u}),void 0===t["shape"+u]&&(e.push({name:"size"+u}),e.push({name:"strides"+u,length:this.maxRank}),e.push({name:"shape"+u,length:this.maxRank}),e.push({name:"rank"+u})),void 0===t["width"+u]&&e.push({name:"width"+u}),void 0===t["height"+u]&&e.push({name:"height"+u})}for(var p={},c=0,h=e;c<h.length;c++){var l=h[c];if(void 0===t[l.name])if(void 0!==l.length)for(var f=0;f<l.length;f++){var d=l.name+"["+f+"]";p[d]=st.prop(d)}else p[l.name]=st.prop(l.name)}return p},t.prototype.posToIndex=function(t,e,n){var r=n+"_"+this.copyCounter++;return"\n    int "+r+" = "+n+";\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if ("+t+"[i] == -1) {\n        "+e+"[i] = -1;\n      } else {\n        if ("+t+"[i] == 0) {\n          "+e+"[i] = 0;\n        } else {\n          "+e+"[i] = "+r+"/"+t+"[i];\n          "+r+" = "+r+" - "+t+"[i]*"+e+"[i]; // Stupid modulo hack\n        }\n      }\n    }"},t.prototype.initIndex=function(t,e){return void 0===e?"\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          "+t+"[i] = -1;\n        }":"\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (i < "+e+") {\n            "+t+"[i] = 0;\n          } else {\n            "+t+"[i] = -1;\n          }\n        }"},t.prototype.incrementIndex=function(t,e){return"\n    for (int i = "+this.maxRank+" - 1; i >= 0; i--) {\n      if ("+e+"[i] != -1) {\n        "+t+"[i] += 1;\n        if ("+t+"[i] >= "+e+"[i]) {\n          "+t+"[i] = 0;\n        } else {\n          break;\n        }\n      }\n    }\n    "},t.prototype.incrementConditional=function(t,e,n){return"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if ("+n+"[i] == 1) {\n        "+t+"[i] += 1;\n        if ("+t+"[i] >= "+e+"[i]) {\n          "+t+"[i] = 0;\n        } else {\n          break;\n        }\n      } else if ("+n+"[i] == -1) {\n        break;\n      }\n    }\n    "},t.prototype.getDefaultMain=function(){return"\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      vec4 result = vec4(0,0,0,0);\n\n      if (pos < sizeOutput) {\n        int index["+this.maxRank+"];\n        "+this.posToIndex("stridesOutput","index","pos")+"\n        result.r = process(index);\n\n        pos += 1;\n\n        if (pos < sizeOutput) {\n          "+this.posToIndex("stridesOutput","index","pos")+"\n          result.g = process(index);\n\n          pos += 1;\n\n          if (pos < sizeOutput) {\n            "+this.posToIndex("stridesOutput","index","pos")+"\n            result.b = process(index);\n\n            pos += 1;\n\n            if (pos < sizeOutput) {\n              "+this.posToIndex("stridesOutput","index","pos")+"\n              result.a = process(index);\n            }\n          }\n        }\n      }\n\n      gl_FragColor = result;\n    }"},t.prototype.precisionString=function(t){return 32===t?"highp":"mediump"},t.prototype.getDrawCommand=function(t,e){var n=this.getCompleteFragmentShader(t,e),r=this.getUniforms(t);return st({frag:n,vert:"\n        precision "+this.precisionString(e)+" float;\n        attribute vec2 position;\n        varying vec2 uv;\n        void main() {\n          uv = 0.5 * (position + 1.0);\n          gl_Position = vec4(position, 0, 1);\n        }",attributes:{position:[-4,-4,4,-4,0,4]},uniforms:r,framebuffer:st.prop("framebuffer"),depth:{enable:!1},count:3})},t.prototype.compile=function(t,e){this.registerStatics(t),this.precision=e,this.drawCommand=this.getDrawCommand(t,e)},t.prototype.compute=function(t,e,n){void 0===this.drawCommand&&this.compile({},32);var r=k(t),o=this.allocator.allocate(r,this.precision);for(var i in e){if(e[i].memory.id===o.id)throw new Error("Allocator returned a framebuffer that is also an input\n                         Did you delete a GPU tensor that was still used elsewhere?")}var a={};for(var s in e)a[s]=e[s].memory.frameBuffer;if(void 0===n&&(n={}),!this.fullyStatic){for(var u in e)this.statics.has("shape"+u)||(n["size"+u]=e[u].size,n["strides"+u]=this.pad(A(e[u].shape)),n["shape"+u]=this.copyPad(e[u].shape),n["rank"+u]=e[u].shape.length),this.statics.has("width"+u)||(n["width"+u]=e[u].memory.width),this.statics.has("height"+u)||(n["height"+u]=e[u].memory.height);this.statics.has("shapeOutput")||(n.sizeOutput=r,n.stridesOutput=this.pad(A(t)),n.shapeOutput=this.copyPad(t),n.rankOutput=t.length),this.statics.has("widthOutput")||(n.widthOutput=o.width),this.statics.has("heightOutput")||(n.heightOutput=o.height)}return this.drawCommand(lt(lt({framebuffer:o.frameBuffer},a),n)),this.gpuTensorConstructor(o,t,this.precision)},t.prototype.getUniformAttrs=function(){return[]},t}(),dt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r.maxRank=2,r}return dt(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int ix1["+this.maxRank+"];\n      "+this.initIndex("ix1")+"\n      ix1[0] = index[0];\n\n      int ix2["+this.maxRank+"];\n      "+this.initIndex("ix2")+"\n      ix2[1] = index[1];\n\n      int k = shapeA[1];\n\n      float res = 0.0;\n\n      for (int i = 0; i < "+this.maxIterations+"; i++) {\n        if (i >= k) {\n          break;\n        }\n        ix1[1] = i;\n        ix2[0] = i;\n\n        float v1 = _A(ix1);\n        float v2 = _B(ix2);\n        res += v1*v2;\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["A","B"]},e.prototype.calc=function(t){var e=this.getOutputShape(t);return this.compute(e,{A:t.A,B:t.B})},e.prototype.getOutputShape=function(t){return[t.A.shape[0],t.B.shape[1]]},e.prototype.compile=function(e,n){void 0!==e.shapeA?this.maxIterations=e.shapeA[1]:void 0!==e.shapeB&&(this.maxIterations=e.shapeB[0]),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.A.shape,widthB:t.A.memory.width,heightB:t.A.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height}},e.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape},e}(ft),vt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mt=function(t){function e(e,n){return t.call(this,e,n)||this}return vt(e,t),e.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = "+this.operation("texture2D(X, uv)")+";\n    }\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.calc=function(t){return this.compute(t.input.shape,{X:t.input})},e.prototype.getOutputShape=function(t){return t.input.shape},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:this.getOutputShape(t),widthOutput:r.width,heightOutput:r.height}},e.prototype.getInputInfoString=function(t){return""+t.input.shape},e}(ft),gt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wt=function(t){function e(e,n){return t.call(this,e,n)||this}return gt(e,t),e.prototype.operation=function(t){return"exp("+t+")"},e}(mt),bt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xt=function(){return(xt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},_t=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return bt(e,t),e.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      int dilation = dilations[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d+2]*dilation;\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},e.prototype.getMainBody=function(){return"\n    int n = index[0];\n    int m = index[1];\n\n    int kernelIx["+this.maxRank+"];\n    "+this.initIndex("kernelIx")+"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if (i >= dataRank) {\n        break;\n      }\n      kernelIx[i+2] = 0;\n    }\n    kernelIx[0] = m;\n    int inputIx["+this.maxRank+"];\n    "+this.initIndex("inputIx")+"\n    inputIx[0] = n;\n\n    for (int cg = 0; cg < "+this.maxIterations+"; cg++) {\n      if (cg >= CG) {\n        break;\n      }\n      int c = m * CG + cg;\n      int d = c/C;\n      c = c - d*C;\n      inputIx[1] = c;\n      kernelIx[1] = cg;\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx) * _W(kernelIx);\n        }\n\n        "+this.incrementIndex("kernelIx","shapeW")+"\n      }\n    }\n    "},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("CG")+" int CG;\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("C")+" int C;\n    "+this.getVarModifier("dilations")+" int dilations["+this.maxRank+"];\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "+this.getVarModifier("activation")+" int activation;\n    "},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n\n      "+this.getMainBody()+"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      } else if (activation == 2) {\n        res = max(0.0, min(res,6.0));\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X","W"]},e.prototype.getUniformAttrs=function(){return[{name:"CG"},{name:"kernelSize"},{name:"C"},{name:"dataRank"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"dilations",length:this.maxRank},{name:"activation"}]},e.prototype.getActivationFlag=function(t){return"id"===t?0:"relu"===t?1:2},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X,W:t.W});var e=t.X.shape[0],n=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],s=k(o),u=X(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[e,i];return p=p.concat(u),this.compute(p,{X:t.X,W:t.W},{CG:a,kernelSize:s,C:n,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations),activation:this.getActivationFlag(t.activation)})},e.prototype.getOutputShape=function(t){var e=t.X.shape[0],n=t.X.shape.slice(2),r=t.W.shape.slice(2),o=t.W.shape[0],i=X(n,r,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),a=[e,o];return a=a.concat(i)},e.prototype.compile=function(e,n){void 0!==e.shapeW&&(e.CG=e.shapeW[1],e.kernelSize=k(e.shapeW.slice(2)),e.dataRank=e.shapeW.length-2,this.maxRank=e.shapeW.length),void 0!==e.shapeX&&(e.C=e.shapeX[1],e.dataRank=e.shapeX.length-2,this.maxRank=e.shapeX.length),void 0!==e.activation&&"string"===typeof e.activation&&(e.activation=this.getActivationFlag(e.activation)),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e),o=k(t.W.shape.slice(2)),i=t.X.shape[1],a=t.X.shape.slice(2);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeW:t.W.shape,widthW:t.W.memory.width,heightW:t.W.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,pads:t.pads,dilations:t.dilations,strides:t.strides,CG:t.W.shape[1],kernelSize:o,dataRank:a.length,C:i,activation:this.getActivationFlag(t.activation)}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.W.shape+"-"+t.dilations+"-"+t.pads+"-"+t.dilations+"-"+t.strides+"-"+t.activation},e}(ft),Ot=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return bt(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int biasIndex["+this.maxRank+"];\n      "+this.initIndex("biasIndex")+"\n      biasIndex[0] = index[1];\n      float res = _B(biasIndex);\n\n      "+this.getMainBody()+"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      } else if (activation == 2) {\n        res = max(0.0, min(res,6.0));\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X","W","B"]},e.prototype.calc=function(t){var e=t.X.shape[0],n=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],s=k(o),u=X(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[e,i];return p=p.concat(u),this.compute(p,{X:t.X,W:t.W,B:t.B},{CG:a,kernelSize:s,C:n,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations),activation:this.getActivationFlag(t.activation)})},e.prototype.getCompilationInfo=function(e,n){var r=t.prototype.getCompilationInfo.call(this,e,n);return xt(xt({},r),{shapeB:e.B.shape,widthB:e.B.memory.width,heightB:e.B.memory.height})},e.prototype.getInputInfoString=function(e){return t.prototype.getInputInfoString.call(this,e)+"-"+e.B.shape},e}(_t),kt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),At=function(t){function e(e,n){return t.call(this,e,n)||this}return kt(e,t),e.prototype.operation=function(t){return"abs("+t+")"},e}(mt),St=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pt=function(t){function e(e,n){return t.call(this,e,n)||this}return St(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int["+this.maxRank+"] index) {\n      return "+this.getOp("_A(index)","_B(index)")+";\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getOutputShape=function(t){return t.outputShape},e.prototype.getTextureNames=function(){return["A","B"]},e.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B})},e.prototype.compile=function(e,n){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),void 0!==e.shapeB&&(this.maxRank=e.shapeB.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=ut.getAllocationDimensions(k(t.outputShape),e);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.B.shape,widthB:t.B.memory.width,heightB:t.B.memory.height,shapeOutput:t.outputShape,widthOutput:n.width,heightOutput:n.height}},e.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape},e}(ft),jt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),It=function(){return(It=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Mt=function(t){function e(e,n){return t.call(this,e,n)||this}return jt(e,t),e.prototype.getOp=function(t,e){return"alpha*"+t+" + beta*"+e},e.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha,beta:t.beta})},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]},e.prototype.getCompilationInfo=function(e,n){var r=t.prototype.getCompilationInfo.call(this,e,n);return It(It({},r),{alpha:e.alpha,beta:e.beta})},e.prototype.getInputInfoString=function(e){return t.prototype.getInputInfoString.call(this,e)+"-"+e.alpha+"-"+e.beta},e}(Pt),Vt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Tt=function(){return(Tt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Ct=function(t){function e(e,n){return t.call(this,e,n)||this}return Vt(e,t),e.prototype.getOp=function(t,e){return"alpha*"+t+" * "+e},e.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha})},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"}]},e.prototype.getCompilationInfo=function(e,n){var r=t.prototype.getCompilationInfo.call(this,e,n);return Tt(Tt({},r),{alpha:e.alpha})},e.prototype.getInputInfoString=function(e){return t.prototype.getInputInfoString.call(this,e)+"-"+e.alpha},e}(Pt),Xt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gt=function(){return(Gt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Rt=function(t){function e(e,n){return t.call(this,e,n)||this}return Xt(e,t),e.prototype.getOp=function(t,e){return"alpha*"+t+" - beta*"+e},e.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha,beta:t.beta})},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]},e.prototype.getCompilationInfo=function(e,n){var r=t.prototype.getCompilationInfo.call(this,e,n);return Gt(Gt({},r),{alpha:e.alpha,beta:e.beta})},e.prototype.getInputInfoString=function(e){return t.prototype.getInputInfoString.call(this,e)+"-"+e.alpha+"-"+e.beta},e}(Pt),Et=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dt=function(){return(Dt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Ut=function(t){function e(e,n){return t.call(this,e,n)||this}return Et(e,t),e.prototype.getOp=function(t,e){return"alpha*"+t+" / "+e},e.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha})},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"}]},e.prototype.getCompilationInfo=function(e,n){var r=t.prototype.getCompilationInfo.call(this,e,n);return Dt(Dt({},r),{alpha:e.alpha})},e.prototype.getInputInfoString=function(e){return t.prototype.getInputInfoString.call(this,e)+"-"+e.alpha},e}(Pt),Bt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return Bt(e,t),e.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d];\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("includePad")+" int includePad;\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "+this.getVarModifier("kernelShape")+" int kernelShape["+this.maxRank+"];\n    "},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n      int count = 0;\n\n      int n = index[0];\n      int c = index[1];\n\n      int kernelIx["+this.maxRank+"];\n      "+this.initIndex("kernelIx")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i >= dataRank) {\n          break;\n        }\n        kernelIx[i] = 0;\n      }\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n      inputIx[0] = n;\n      inputIx[1] = c;\n\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx);\n        }\n\n        if (!skip || includePad == 1) {\n          count += 1;\n        }\n\n        "+this.incrementIndex("kernelIx","kernelShape")+"\n      }\n\n      res = res / float(count);\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.getUniformAttrs=function(){return[{name:"kernelSize"},{name:"dataRank"},{name:"includePad"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"kernelShape",length:this.maxRank}]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});var e=t.X.shape[0],n=t.X.shape[1],r=t.X.shape.slice(2),o=k(t.kernelShape),i=X(r,t.kernelShape,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),new Array(r.length).fill(1),t.strides),a=[e,n];return a=a.concat(i),this.compute(a,{X:t.X},{kernelSize:o,includePad:t.includePad?1:0,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),kernelShape:this.copyPad(t.kernelShape)})},e.prototype.getOutputShape=function(t){var e=t.X.shape[0],n=t.X.shape[1],r=t.X.shape.slice(2),o=X(r,t.kernelShape,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),new Array(r.length).fill(1),t.strides),i=[e,n];return i=i.concat(o)},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(e.dataRank=e.shapeX.length-2,this.maxRank=e.shapeX.length),!0===e.includePad?e.includePad=1:!1===e.includePad&&(e.includePad=0),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e),o=k(t.kernelShape);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,kernelShape:t.kernelShape,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,pads:t.pads,strides:t.strides,kernelSize:o,dataRank:t.X.shape.length-2,includePad:t.includePad?1:0}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.kernelShape+"-"+t.pads+"-"+t.strides+"-"+t.includePad},e}(ft),Wt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ft=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return Wt(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("mappedInputStrides")+" int mappedInputStrides["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int sumDims["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int sumSize;\n    "},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n\n      int inputPos = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (mappedInputStrides[i] == -1 || index[i] == -1) {\n          break;\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n      }\n\n      "+this.posToIndex("stridesX","inputIx","inputPos")+"\n\n      float res = 0.0;\n\n      for (int i = 0; i < "+this.maxIterations+"; i++) {\n        if (i >= sumSize) {\n          break;\n        }\n        float curr = _X(inputIx);\n        if (i == 0) {\n          res = "+this.init("curr")+";\n        } else {\n          res = "+this.update("curr","res")+";\n        }\n\n        "+this.incrementConditional("inputIx","shapeX","sumDims")+"\n      }\n\n      "+this.post("res")+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.post=function(t){return""},e.prototype.init=function(t){return t},e.prototype.getTextureNames=function(){return["X"]},e.prototype.getUniformAttrs=function(){return[{name:"mappedInputStrides",length:this.maxRank},{name:"sumDims",length:this.maxRank},{name:"sumSize"}]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});for(var e=W(t.X.shape,t.axes,t.keepDims),n=e[0],r=e[1],o=A(t.X.shape),i=[],a=0,s=r;a<s.length;a++){var u=s[a];i.push(o[u])}var p=1,c=new Array(t.X.shape.length).fill(0);for(u=0;u<t.axes.length;u++)c[t.axes[u]]=1,p*=t.X.shape[t.axes[u]];return this.compute(n,{X:t.X},{mappedInputStrides:this.pad(i),sumDims:this.pad(c),sumSize:p})},e.prototype.getOutputShape=function(t){var e=W(t.X.shape,t.axes,t.keepDims),n=e[0];e[1];return n},e.prototype.compile=function(e,n){if(void 0!==e.shapeX&&void 0!==e.axes&&void 0!==e.keepDims){for(var r=W(e.shapeX,e.axes,e.keepDims),o=r[0],i=r[1],a=A(e.shapeX),s=[],u=0,p=i;u<p.length;u++){var c=p[u];s.push(a[c])}var h=1,l=new Array(e.shapeX.length).fill(0);for(c=0;c<e.axes.length;c++)l[e.axes[c]]=1,h*=e.shapeX[e.axes[c]];e.sumDims=l,e.shapeOutput=o,e.mappedInputStrides=s,e.sumSize=h,delete e.keepDims,delete e.axes,this.maxRank=e.shapeX.length}t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){for(var n=W(t.X.shape,t.axes,t.keepDims),r=n[0],o=n[1],i=A(t.X.shape),a=[],s=0,u=o;s<u.length;s++){var p=u[s];a.push(i[p])}var c=1,h=new Array(t.X.shape.length).fill(0);for(p=0;p<t.axes.length;p++)h[t.axes[p]]=1,c*=t.X.shape[t.axes[p]];var l=ut.getAllocationDimensions(k(r),e);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:r,widthOutput:l.width,heightOutput:l.height,mappedInputStrides:a,sumDims:h,sumSize:c}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axes+"-"+t.keepDims},e}(ft),Nt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Nt(e,t),e.prototype.update=function(t,e){return t+" + "+e},e.prototype.post=function(t){return t+" = "+t+"/float(sumSize);"},e}(Ft),qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return qt(e,t),e.prototype.update=function(t,e){return"("+t+"*"+t+") + "+e},e.prototype.post=function(t){return t+" = "+t+"/float(sumSize);"},e.prototype.init=function(t){return t+"*"+t},e}(Ft),Yt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Yt(e,t),e.prototype.update=function(t,e){return"("+t+"*"+t+") + "+e},e.prototype.init=function(t){return t+"*"+t},e.prototype.compile=function(e,n){t.prototype.compile.call(this,e,32)},e}(Ft),Kt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Kt(e,t),e.prototype.update=function(t,e){return t+" + "+e},e}(Ft),Zt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Zt(e,t),e.prototype.update=function(t,e){return t+" * "+e},e}(Ft),te=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ee=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return te(e,t),e.prototype.update=function(t,e){return"max("+t+", "+e+")"},e}(Ft),ne=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ne(e,t),e.prototype.update=function(t,e){return"min("+t+", "+e+")"},e}(Ft),oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ie=function(t){function e(e,n){return t.call(this,e,n)||this}return oe(e,t),e.prototype.operation=function(t){return"ceil("+t+")"},e}(mt),ae=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),se=function(t){function e(e,n){return t.call(this,e,n)||this}return ae(e,t),e.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      vec4 maxVec = vec4(maxVal,maxVal,maxVal,maxVal);\n      vec4 minVec = vec4(minVal,minVal,minVal,minVal);\n\n      vec4 res = texture2D(X, uv);\n      if (doMin == 1) {\n        res = max(minVec, res);\n      }\n      if (doMax == 1) {\n        res = min(maxVec, res);\n      }\n\n      gl_FragColor = res;\n    }\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("minVal")+" float minVal;\n    "+this.getVarModifier("maxVal")+" float maxVal;\n    "+this.getVarModifier("doMin")+" int doMin;\n    "+this.getVarModifier("doMax")+" int doMax;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"minVal",type:"float"},{name:"maxVal",type:"float"},{name:"doMin"},{name:"doMax"}]},e.prototype.calc=function(t){return this.fullyStatic&&void 0!==this.outputShape?this.compute(this.outputShape,{X:t.input}):this.compute(t.input.shape,{X:t.input},{minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0})},e.prototype.getOutputShape=function(t){return t.input.shape},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=ut.getAllocationDimensions(t.input.size,e);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:t.input.shape,widthOutput:n.width,heightOutput:n.height,minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0}},e.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.minVal+"-"+t.maxVal},e}(ft),ue=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pe=function(t){function e(e,n){return t.call(this,e,n)||this}return ue(e,t),e.prototype.operation=function(t){return"floor("+t+")"},e}(mt),ce=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),he=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},le=function(t){function e(e,n){return t.call(this,e,n)||this}return ce(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("axis")+" int axis;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"axis"}]},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i == axis) {\n          if (index[i] >= shapeA[i]) {\n            index[i] = index[i] - shapeA[i];\n            res = _B(index);\n          } else {\n            res = _A(index);\n          }\n          break;\n        }\n      }\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["A","B"]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A,B:t.B});var e=this.getOutputShape(t);return this.compute(e,{A:t.A,B:t.B},{axis:t.axis})},e.prototype.getOutputShape=function(t){var e=he(t.A.shape);return e[t.axis]+=t.B.shape[t.axis],e},e.prototype.compile=function(e,n){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),void 0!==e.shapeB&&(this.maxRank=e.shapeB.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.B.shape,widthB:t.B.memory.width,heightB:t.B.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,axis:t.axis}},e.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape+"-"+t.axis},e}(ft),fe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),de=function(t){function e(e,n){return t.call(this,e,n)||this}return fe(e,t),e.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = texture2D(X, uv);\n    }\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.calc=function(t){var e=this.getOutputShape(t);return this.compute(e,{X:t.input})},e.prototype.getOutputShape=function(t){var e=t.outputShape;return void 0===e&&(e=t.input.shape),e},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height}},e.prototype.getInputInfoString=function(t){return t.input+"-"+this.getOutputShape(t)},e}(ft),ye=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ve=function(t){function e(e,n){return t.call(this,e,n)||this}return ye(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      return _X(index);\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.calc=function(t){return this.compute(t.outputShape,{X:t.input})},e.prototype.getOutputShape=function(t){return t.outputShape},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height}},e.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.outputShape},e}(ft),me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ge=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.gatherMaxIxSize=10,r}return me(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("axis")+" int axis;\n    "+this.getVarModifier("indexValues")+" int indexValues["+this.gatherMaxIxSize+"];\n    "+this.getVarModifier("mappedIndexStrides")+" int mappedIndexStrides["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int mappedInputStrides["+this.maxRank+"];\n    "},e.prototype.getUniformAttrs=function(){return[{name:"axis"},{name:"indexValues",length:this.gatherMaxIxSize},{name:"mappedInputStrides",length:this.maxRank},{name:"mappedIndexStrides",length:this.maxRank}]},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputPos = 0;\n      int indexPos = 0;\n\n      int strideAxis = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n        if (i == axis) {\n          strideAxis = stridesX[i];\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n        indexPos += mappedIndexStrides[i]*index[i];\n      }\n\n      for (int i = 0; i < "+this.gatherMaxIxSize+"; i++) {\n        if (i == indexPos) {\n          inputPos += indexValues[i]*strideAxis;\n          break;\n        }\n      }\n\n      return getValueAtPos(inputPos, widthX, heightX, X);\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});if(t.indices.size>this.gatherMaxIxSize)throw new Error("Gather on GPU can deal with at most "+this.gatherMaxIxSize+" indices, input had "+t.indices.size);for(var e=t.X.shape.length,n=t.indices.shape.length,r=A(t.X.shape),o=A(t.indices.shape),i=e+n-1,a=new Array(i),s=new Array(i).fill(0),u=new Array(i).fill(0),p=0;p<t.axis;p++)a[p]=t.X.shape[p],s[p]=r[p],u[p]=0;for(p=0;p<n;p++)a[p+t.axis]=t.indices.shape[p],u[p+t.axis]=o[p],s[p+t.axis]=0;for(p=t.axis+1;p<e;p++)a[p+n-1]=t.X.shape[p],s[p+n-1]=r[p],u[p+n-1]=0;return this.compute(a,{X:t.X},{axis:t.axis,indexValues:this.pad(Array.from(t.indices.values),this.gatherMaxIxSize),mappedInputStrides:this.pad(s),mappedIndexStrides:this.pad(u)})},e.prototype.getOutputShape=function(t){for(var e=t.X.shape.length,n=t.indices.shape.length,r=new Array(e+n-1),o=0;o<t.axis;o++)r[o]=t.X.shape[o];for(o=0;o<n;o++)r[o+t.axis]=t.indices.shape[o];for(o=t.axis+1;o<e;o++)r[o+n-1]=t.X.shape[o];return r},e.prototype.compile=function(e,n){if(void 0!==e.shapeX&&(this.maxRank=e.shapeX.length,void 0!==e.indices&&void 0!==e.axis)){for(var r=e.shapeX.length,o=e.indices.shape.length,i=A(e.shapeX),a=A(e.indices.shape),s=r+o-1,u=new Array(s),p=new Array(s).fill(0),c=new Array(s).fill(0),h=0;h<e.axis;h++)u[h]=e.shapeX[h],p[h]=i[h],c[h]=0;for(h=0;h<o;h++)u[h+e.axis]=e.indices.shape[h],c[h+e.axis]=a[h],p[h+e.axis]=0;for(h=e.axis+1;h<r;h++)u[h+o-1]=e.shapeX[h],p[h+o-1]=i[h],c[h+o-1]=0;e.mappedIndexStrides=c,e.mappedInputStrides=p,e.indexValues=Array.from(e.indices.values),delete e.indices}t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){for(var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e),o=t.X.shape.length,i=t.indices.shape.length,a=A(t.X.shape),s=A(t.indices.shape),u=o+i-1,p=new Array(u),c=new Array(u).fill(0),h=new Array(u).fill(0),l=0;l<t.axis;l++)p[l]=t.X.shape[l],c[l]=a[l],h[l]=0;for(l=0;l<i;l++)p[l+t.axis]=t.indices.shape[l],h[l+t.axis]=s[l],c[l+t.axis]=0;for(l=t.axis+1;l<o;l++)p[l+i-1]=t.X.shape[l],c[l+i-1]=a[l],h[l+i-1]=0;return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,axis:t.axis,indexValues:Array.from(t.indices.values),mappedIndexStrides:h,mappedInputStrides:c}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axis+"-"+Array.from(t.indices.values)+"-"+t.indices.shape},e}(ft),we=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),be=function(){return(be=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},xe=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},_e=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return we(e,t),e.prototype.getMainBody=function(){return"\n      int ixA["+this.maxRank+"];\n      "+this.initIndex("ixA")+"\n      int ixB["+this.maxRank+"];\n      "+this.initIndex("ixA")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i >= rank - 2) {\n          break;\n        }\n        ixA[i] = index[i];\n        ixB[i] = index[i];\n      }\n\n      int m = 0;\n      int o = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i == rank-2) {\n          m = index[i];\n          o = index[i+1];\n\n          if (aTranspose == 0) {\n            ixA[i] = m;\n          } else {\n            ixA[i+1] = m;\n          }\n\n          if (bTranspose == 0) {\n            ixB[i+1] = o;\n          } else {\n            ixB[i] = o;\n          }\n\n          break;\n        }\n      }\n\n      float res = 0.0;\n\n      for (int n = 0; n < "+this.maxIterations+"; n++) {\n        if (n >= N) {\n          break;\n        }\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (i == rank-2) {\n            if (aTranspose == 0) {\n              ixA[i+1] = n;\n            } else {\n              ixA[i] = n;\n            }\n\n            if (bTranspose == 0) {\n              ixB[i] = n;\n            } else {\n              ixB[i+1] = n;\n            }\n\n            break;\n          }\n        }\n        res += _A(ixA) * _B(ixB);\n      }\n\n      res = res*alpha;\n    "},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("M")+" int M;\n    "+this.getVarModifier("N")+" int N;\n    "+this.getVarModifier("O")+" int O;\n    "+this.getVarModifier("rank")+" int rank;\n    "+this.getVarModifier("aTranspose")+" int aTranspose;\n    "+this.getVarModifier("bTranspose")+" int bTranspose;\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      "+this.getMainBody()+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["A","B"]},e.prototype.getUniformAttrs=function(){return[{name:"M"},{name:"N"},{name:"O"},{name:"rank"},{name:"aTranspose"},{name:"bTranspose"},{name:"alpha",type:"float"},{name:"beta",type:"float"}]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.a,B:t.b});var e=t.a.shape.length,n=t.aTranspose?t.a.shape[e-1]:t.a.shape[e-2],r=t.aTranspose?t.a.shape[e-2]:t.a.shape[e-1],o=t.bTranspose?t.b.shape[e-2]:t.b.shape[e-1],i=t.a.shape.slice(0,e-2),a=xe(i,[n,o]),s={M:n,N:r,O:o,rank:e,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta};return this.compute(a,{A:t.a,B:t.b},s)},e.prototype.getOutputShape=function(t){var e=t.a.shape.length,n=t.aTranspose?t.a.shape[e-1]:t.a.shape[e-2],r=t.bTranspose?t.b.shape[e-2]:t.b.shape[e-1],o=t.a.shape.slice(0,e-2);return xe(o,[n,r])},e.prototype.compile=function(e,n){if(void 0!==e.shapeA){var r=e.shapeA.length;if(e.rank=r,this.maxRank=r,void 0!==e.aTranspose){var o=e.aTranspose?e.shapeA[r-1]:e.shapeA[r-2],i=e.aTranspose?e.shapeA[r-2]:e.shapeA[r-1];e.M=o,e.N=i,e.aTranspose=e.aTranspose?1:0}}if(void 0!==e.shapeB&&void 0!==e.bTranspose){r=e.shapeB.length;var a=e.bTranspose?e.shapeB[r-2]:e.shapeB[r-1];e.O=a,e.bTranspose=e.bTranspose?1:0}t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e),o=t.a.shape.length,i=t.aTranspose?t.a.shape[o-1]:t.a.shape[o-2],a=t.aTranspose?t.a.shape[o-2]:t.a.shape[o-1],s=t.bTranspose?t.b.shape[o-2]:t.b.shape[o-1];return{shapeA:t.a.shape,widthA:t.a.memory.width,heightA:t.a.memory.height,shapeB:t.b.shape,widthB:t.b.memory.width,heightB:t.b.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,M:i,N:a,O:s,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta,rank:o}},e.prototype.getInputInfoString=function(t){return t.a.shape+"-"+t.b.shape+"-"+t.aTranspose+"-"+t.bTranspose+"-"+t.alpha+"-"+t.beta},e}(ft),Oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return we(e,t),e.prototype.getTextureNames=function(){return["A","B","C"]},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      "+this.getMainBody()+"\n\n      res += beta*_C(index);\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.a,B:t.b,C:t.c});var e=t.a.shape.length,n=t.aTranspose?t.a.shape[e-1]:t.a.shape[e-2],r=t.aTranspose?t.a.shape[e-2]:t.a.shape[e-1],o=t.bTranspose?t.b.shape[e-2]:t.b.shape[e-1],i=t.a.shape.slice(0,e-2),a=xe(i,[n,o]),s={M:n,N:r,O:o,rank:e,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta};return this.compute(a,{A:t.a,B:t.b,C:t.c},s)},e.prototype.getCompilationInfo=function(e,n){var r=t.prototype.getCompilationInfo.call(this,e,n);return be(be({},r),{shapeC:e.c.shape,widthC:e.c.memory.width,heightC:e.c.memory.height})},e.prototype.getInputInfoString=function(e){return t.prototype.getInputInfoString.call(this,e)+"-"+e.c.shape},e}(_e),ke=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ae=function(t){function e(e,n){return t.call(this,e,n)||this}return ke(e,t),e.prototype.getOp=function(t,e){return"pow("+t+", "+e+")"},e}(Pt),Se=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Pe=function(t){function e(e,n){return t.call(this,e,n)||this}return Se(e,t),e.prototype.operation=function(t){return"sqrt("+t+")"},e}(mt),je=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ie=function(t){function e(e,n){return t.call(this,e,n)||this}return je(e,t),e.prototype.operation=function(t){return"log("+t+")"},e}(mt),Me=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ve=function(t){function e(e,n){return t.call(this,e,n)||this}return Me(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("mappedStrides")+" int mappedStrides["+this.maxRank+"];\n    "},e.prototype.getUniformAttrs=function(){return[{name:"mappedStrides",length:this.maxRank}]},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      return getValueAt(index, mappedStrides, widthA, heightA, A);\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["A"]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A});for(var e=t.A.shape.length,n=this.getOutputShape(t),r=A(t.A.shape),o=new Array(e),i=0;i<e;i++)o[i]=r[t.permutation[i]];return this.compute(n,{A:t.A},{mappedStrides:this.pad(o)})},e.prototype.getOutputShape=function(t){for(var e=t.A.shape.length,n=new Array(e),r=0;r<e;r++)n[r]=t.A.shape[t.permutation[r]];return n},e.prototype.compile=function(e,n){if(void 0!==e.shapeA&&(this.maxRank=e.shapeA.length,void 0!==e.permutation)){for(var r=e.shapeA.length,o=A(e.shapeA),i=new Array(r),a=0;a<r;a++)i[a]=o[e.permutation[a]];e.mappedStrides=i,delete e.permutation}t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){for(var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e),o=t.A.shape.length,i=A(t.A.shape),a=new Array(o),s=0;s<o;s++)a[s]=i[t.permutation[s]];return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,mappedStrides:a}},e.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.permutation},e}(ft),Te=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ce=function(t){function e(e,n){return t.call(this,e,n)||this}return Te(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("repeats")+" int repeats["+this.maxRank+"];\n    "},e.prototype.getUniformAttrs=function(){return[{name:"repeats",length:this.maxRank}]},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIndex["+this.maxRank+"];\n      "+this.initIndex("inIndex")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (repeats[i] == -1) {\n          break;\n        }\n        int d = index[i] / shapeA[i];\n        inIndex[i] = index[i] - d*shapeA[i];\n      }\n\n      return _A(inIndex);\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getOutputShape=function(t){for(var e=t.A.shape.length,n=new Array(e),r=0;r<e;r++)n[r]=t.A.shape[r]*t.repeats[r];return n},e.prototype.getTextureNames=function(){return["A"]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A});var e=this.getOutputShape(t);return this.compute(e,{A:t.A},{repeats:this.copyPad(t.repeats)})},e.prototype.compile=function(e,n){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,repeats:t.repeats}},e.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.repeats},e}(ft),Xe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ge=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},Re=function(t){function e(e,n){return t.call(this,e,n)||this}return Xe(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n      if (mode == 0) {\n        float res = value;\n\n        int outOfBounds = 0;\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0 || inputIx[i] >= shapeX[i]) {\n            outOfBounds = 1;\n            break;\n          }\n        }\n\n        if (outOfBounds == 0) {\n          res = _X(inputIx);\n        }\n\n        return res;\n      } else if (mode == 1) {\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = -inputIx[i];\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = 2*shapeX[i] - inputIx[i] - 2;\n          }\n        }\n\n        return _X(inputIx);\n      } else {\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = 0;\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = shapeX[i] - 1;\n          }\n        }\n\n        return _X(inputIx);\n      }\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("pads")+" int pads["+2*this.maxRank+"];\n    "+this.getVarModifier("value")+" float value;\n    "+this.getVarModifier("mode")+" int mode;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"value",type:"float"},{name:"pads",length:2*this.maxRank},{name:"mode"}]},e.prototype.getModeFlag=function(t){return"constant"===t?0:"reflect"===t?1:2},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.input});var e=this.getOutputShape(t);return this.compute(e,{X:t.input},{pads:this.copyPad(t.pads,2*this.maxRank),value:t.value,mode:this.getModeFlag(t.mode)})},e.prototype.getOutputShape=function(t){for(var e=t.input.shape.length,n=Ge(t.input.shape),r=0;r<e;r++)n[r]+=t.pads[r]+t.pads[r+e];return n},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),void 0!==e.mode&&"string"===typeof e.mode&&(e.mode=this.getModeFlag(e.mode)),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,pads:t.pads,mode:this.getModeFlag(t.mode),value:t.value}},e.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.pads+"-"+t.mode+"-"+t.value},e}(ft),Ee=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),De=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},Ue=function(t){function e(e,n){return t.call(this,e,n)||this}return Ee(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIx["+this.maxRank+"];\n      "+this.initIndex("inIx")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = index[i] + offsets[i];\n      }\n\n      return _X(inIx);\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("offsets")+" int offsets["+this.maxRank+"];\n    "},e.prototype.getUniformAttrs=function(){return[{name:"offsets",length:this.maxRank}]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});for(var e=t.X.shape.length,n=De(t.X.shape),r=new Array(e).fill(0),o=0,i=0;i<e&&o<t.axes.length;i++)i===t.axes[o]&&(n[i]=t.ends[o]-t.starts[o],r[i]=t.starts[o],o++);return this.compute(n,{X:t.X},{offsets:this.pad(r)})},e.prototype.getOutputShape=function(t){for(var e=t.X.shape.length,n=De(t.X.shape),r=0,o=0;o<e&&r<t.axes.length;o++)o===t.axes[r]&&(n[o]=t.ends[r]-t.starts[r],r++);return n},e.prototype.compile=function(e,n){if(void 0!==e.shapeX&&(this.maxRank=e.shapeX.length,void 0!==e.axes&&void 0!==e.starts&&void 0!==e.starts)){for(var r=e.shapeX.length,o=new Array(r).fill(0),i=0,a=0;a<r&&i<e.axes.length;a++)a===e.axes[i]&&(o[a]=e.starts[i],i++);e.offsets=o,delete e.starts,delete e.ends,delete e.axes}t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){for(var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e),o=t.X.shape.length,i=De(t.X.shape),a=new Array(o).fill(0),s=0,u=0;u<o&&s<t.axes.length;u++)u===t.axes[s]&&(i[u]=t.ends[s]-t.starts[s],a[u]=t.starts[s],s++);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,offsets:a}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axes+"-"+t.starts+"-"+t.ends},e}(ft),Be=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ze=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},We=function(t){function e(e,n){return t.call(this,e,n)||this}return Be(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIx["+this.maxRank+"];\n      "+this.initIndex("inIx")+"\n\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = int(floor(float(index[i]) / scales[i]));\n      }\n\n      return _X(inIx);\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X"]},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("scales")+" float scales["+this.maxRank+"];\n    "},e.prototype.getUniformAttrs=function(){return[{name:"scales",length:this.maxRank,type:"float"}]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});var e=this.getOutputShape(t);return this.compute(e,{X:t.X},{scales:this.copyPad(t.scales)})},e.prototype.getOutputShape=function(t){for(var e=t.X.shape.length,n=ze(t.X.shape),r=0;r<e;r++)n[r]=Math.floor(n[r]*t.scales[r]);return n},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,scales:t.scales}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.scales},e}(ft),Fe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ne=function(t){function e(e,n){return t.call(this,e,n)||this}return Fe(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("epsilon")+" float epsilon;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"epsilon",type:"float"}]},e.prototype.getFragmentShader=function(t){return"\n    float process(int["+this.maxRank+"] index) {\n      float result = _X(index) - _Mean(index);\n      result = result / sqrt(_Variance(index) + epsilon);\n      result = result * _Scale(index) + _Bias(index);\n      return result;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getOutputShape=function(t){return t.X.shape},e.prototype.getTextureNames=function(){return["X","Mean","Variance","Scale","Bias"]},e.prototype.calc=function(t){return this.compute(t.X.shape,{X:t.X,Mean:t.Mean,Variance:t.Variance,Scale:t.Scale,Bias:t.Bias},{epsilon:t.epsilon})},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeBias:t.Bias.shape,widthBias:t.Bias.memory.width,heightBias:t.Bias.memory.height,shapeMean:t.Mean.shape,widthMean:t.Mean.memory.width,heightMean:t.Mean.memory.height,shapeScale:t.Scale.shape,widthScale:t.Scale.memory.width,heightScale:t.Scale.memory.height,shapeVariance:t.Variance.shape,widthVariance:t.Variance.memory.width,heightVariance:t.Variance.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,epsilon:t.epsilon}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.Mean.shape+"-"+t.Variance.shape+"-"+t.Scale.shape+"-"+t.Bias.shape+"-"+t.epsilon},e}(ft),Le=function(){function t(t,e){void 0===e&&(e=2),this.getOp=t,this.minCallsToCompile=e,this.opDict={}}return t.prototype.getDefault=function(t){var e="default-"+t;if(void 0===this.opDict[e]){var n=this.getOp();n.compile({},t),this.opDict[e]={infoString:e,numCalls:0,operation:n}}return this.opDict[e]},t.prototype.calc=function(t,e){var n=this.getDefault(e),r=n.operation.getInputInfoString(t);void 0===this.opDict[r]&&(this.opDict[r]={infoString:r,numCalls:0});var o=this.opDict[r];if(o.numCalls++,o.numCalls>=this.minCallsToCompile){if(void 0===o.operation){o.operation=this.getOp();var i=n.operation.getCompilationInfo(t,e);o.operation.compile(i,e)}return o.operation.calc(t)}return n.numCalls++,n.operation.calc(t)},t}(),qe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),He=function(t){function e(e,n){return t.call(this,e,n)||this}return qe(e,t),e.prototype.operation=function(t){return"sign("+t+")"},e}(mt),Ye=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Je=function(t){function e(e,n){return t.call(this,e,n)||this}return Ye(e,t),e.prototype.operation=function(t){return"-"+t},e}(mt),Ke=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qe=function(t){function e(e,n){return t.call(this,e,n)||this}return Ke(e,t),e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float val = _X(index);\n      if (doMin == 1 && val < minVal) {\n        return 0.0;\n      }\n      if (doMax == 1 && val > maxVal) {\n        return 0.0;\n      }\n      return _Grad(index);\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X","Grad"]},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("minVal")+" float minVal;\n    "+this.getVarModifier("maxVal")+" float maxVal;\n    "+this.getVarModifier("doMin")+" int doMin;\n    "+this.getVarModifier("doMax")+" int doMax;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"minVal",type:"float"},{name:"maxVal",type:"float"},{name:"doMin"},{name:"doMax"}]},e.prototype.calc=function(t){return this.fullyStatic&&void 0!==this.outputShape?this.compute(this.outputShape,{X:t.input,Grad:t.grad}):this.compute(t.input.shape,{X:t.input,Grad:t.grad},{minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0})},e.prototype.getOutputShape=function(t){return t.input.shape},e.prototype.compile=function(e,n){void 0!==e.shapeX&&(this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=ut.getAllocationDimensions(t.input.size,e);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeGrad:t.grad.shape,widthGrad:t.grad.memory.width,heightGrad:t.grad.memory.height,shapeOutput:t.input.shape,widthOutput:n.width,heightOutput:n.height,minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0}},e.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.minVal+"-"+t.maxVal},e}(ft),Ze=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$e=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return Ze(e,t),e.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      int dilation = dilations[d];\n      if (stride == -1) {\n        break;\n      }\n\n      int trans_kernel_ix = shapeW[d + 2] - kernelIx[d + 2] - 1;\n\n      inputIx[d+2] = index[d + 2] - pad + trans_kernel_ix * dilation;\n\n      int divS = inputIx[d+2] / stride;\n      int resS = inputIx[d+2] - divS*stride;\n\n      if (resS != 0) {\n        skip = true;\n        break;\n      }\n      inputIx[d+2] = divS;\n\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},e.prototype.getMainBody=function(){return"\n    int n = index[0];\n    int m = index[1];\n\n    int kernelIx["+this.maxRank+"];\n    "+this.initIndex("kernelIx")+"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if (i >= dataRank) {\n        break;\n      }\n      kernelIx[i+2] = 0;\n    }\n    kernelIx[0] = m;\n    int inputIx["+this.maxRank+"];\n    "+this.initIndex("inputIx")+"\n    inputIx[0] = n;\n\n    for (int cg = 0; cg < "+this.maxIterations+"; cg++) {\n      if (cg >= CG) {\n        break;\n      }\n      int c = m * CG + cg;\n      int d = c/C;\n      c = c - d*C;\n      inputIx[1] = c;\n      kernelIx[1] = cg;\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx) * _W(kernelIx);\n        }\n\n        "+this.incrementIndex("kernelIx","shapeW")+"\n      }\n    }\n    "},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("CG")+" int CG;\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("C")+" int C;\n    "+this.getVarModifier("dilations")+" int dilations["+this.maxRank+"];\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n\n      "+this.getMainBody()+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["X","W"]},e.prototype.getUniformAttrs=function(){return[{name:"CG"},{name:"kernelSize"},{name:"C"},{name:"dataRank"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"dilations",length:this.maxRank}]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X,W:t.W});var e=t.X.shape[0],n=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],s=k(o),u=U(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[e,i];return p=p.concat(u),this.compute(p,{X:t.X,W:t.W},{CG:a,kernelSize:s,C:n,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations)})},e.prototype.getOutputShape=function(t){var e=t.X.shape[0],n=t.X.shape.slice(2),r=t.W.shape.slice(2),o=t.W.shape[0],i=U(n,r,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),a=[e,o];return a=a.concat(i)},e.prototype.compile=function(e,n){void 0!==e.shapeW&&(e.CG=e.shapeW[1],e.kernelSize=k(e.shapeW.slice(2)),e.dataRank=e.shapeW.length-2,this.maxRank=e.shapeW.length),void 0!==e.shapeX&&(e.C=e.shapeX[1],e.dataRank=e.shapeX.length-2,this.maxRank=e.shapeX.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e),o=k(t.W.shape.slice(2)),i=t.X.shape[1],a=t.X.shape.slice(2);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeW:t.W.shape,widthW:t.W.memory.width,heightW:t.W.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,pads:t.pads,dilations:t.dilations,strides:t.strides,CG:t.W.shape[1],kernelSize:o,dataRank:a.length,C:i}},e.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.W.shape+"-"+t.dilations+"-"+t.pads+"-"+t.dilations+"-"+t.strides},e}(ft),tn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),en=function(t){function e(e,n){return t.call(this,e,n)||this}return tn(e,t),e.prototype.operation=function(t){return"1.0/(1.0 + exp(-"+t+"))"},e}(mt),nn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rn=function(){return(rn=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},on=function(t){function e(e,n){return t.call(this,e,n)||this}return nn(e,t),e.prototype.operation=function(t){return"factor*"+t+" + add"},e.prototype.calc=function(t){return this.compute(t.input.shape,{X:t.input},{factor:t.factor,add:t.add})},e.prototype.getCompilationInfo=function(e,n){var r=t.prototype.getCompilationInfo.call(this,e,n);return rn(rn({},r),{factor:e.factor,add:e.add})},e.prototype.getInputInfoString=function(e){return t.prototype.getInputInfoString.call(this,e)+"-"+e.factor+"-"+e.add},e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("factor")+" float factor;\n    "+this.getVarModifier("add")+" float add;\n    "},e.prototype.getUniformAttrs=function(){return[{name:"factor",type:"float"},{name:"add",type:"float"}]},e}(mt),an=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),sn=function(t){function e(e,n){return t.call(this,e,n)||this}return an(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("starts")+" int starts["+this.maxRank+"];\n    "},e.prototype.getUniformAttrs=function(){return[{name:"starts",length:this.maxRank}]},e.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int valueIx["+this.maxRank+"];\n      "+this.initIndex("valueIx")+"\n\n      int inValues = 1;\n\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        if (index[i] < starts[i] || index[i] >= (starts[i] + shapeValues[i])) {\n          inValues = 0;\n          break;\n        } else {\n          valueIx[i] = index[i] - starts[i];\n        }\n      }\n\n      if (inValues == 1) {\n        return _Values(valueIx);\n      } else {\n        return _A(index);\n      }\n    }\n\n    "+this.getDefaultMain()+"\n    "},e.prototype.getTextureNames=function(){return["A","Values"]},e.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A,Values:t.Values});var e=this.getOutputShape(t);return this.compute(e,{A:t.A,Values:t.Values},{starts:this.pad(t.starts)})},e.prototype.getOutputShape=function(t){return t.A.shape},e.prototype.compile=function(e,n){void 0!==e.shapeA&&(this.maxRank=e.shapeA.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeValues:t.Values.shape,widthValues:t.Values.memory.width,heightValues:t.Values.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,starts:t.starts}},e.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.Values.shape+"-"+t.starts},e}(ft),un=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pn=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},cn=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},hn=function(t){function e(e,n,r){var o=t.call(this)||this;return o.shape=n,o.precision=r,o.deleted=!1,o.size=k(n),e instanceof Float32Array?o.memory=ut.allocateTexture(e,r):o.memory=e,o}return un(e,t),e.fromData=function(t,n){var r=st.texture({data:t,format:"rgba",type:32===n?"float":"half float"}),o=ut.allocateFramebuffer(r,n),i=r.width;return new e(o,[r.height,i,4],n)},e.prototype.getValues=function(){var t=this;return new Promise((function(e){st({framebuffer:t.memory.frameBuffer})((function(){var n=new Float32Array(t.memory.size);n=st.read(n),e(n.subarray(0,t.size))}))}))},e.prototype.getShape=function(){return this.shape},e.prototype.gpu=function(){return pn(this,void 0,void 0,(function(){return cn(this,(function(t){return[2,this]}))}))},e.prototype.constantLike=function(t){return new e(new Float32Array(this.size).fill(t),this.shape,this.precision)},e.prototype.singleConstant=function(t){return new e(new Float32Array([t]),[1],this.precision)},e.prototype.delete=function(){this.deleted||(this.deleted=!0,ut.deallocate(this.memory),this.memory=void 0)},e.prototype.copy=function(t){return Yn.calc({input:this},t||this.precision)},e.prototype.exp=function(){return vn.calc({input:this},this.precision)},e.prototype.log=function(){return kn.calc({input:this},this.precision)},e.prototype.sqrt=function(){return On.calc({input:this},this.precision)},e.prototype.abs=function(){return mn.calc({input:this},this.precision)},e.prototype.sigmoid=function(){return gn.calc({input:this},this.precision)},e.prototype.floor=function(){return bn.calc({input:this},this.precision)},e.prototype.ceil=function(){return wn.calc({input:this},this.precision)},e.prototype.negate=function(){return An.calc({input:this},this.precision)},e.prototype.addMultiplyScalar=function(t,e){return Sn.calc({input:this,factor:t,add:e},this.precision)},e.prototype.sign=function(){return Pn.calc({input:this},this.precision)},e.prototype.setValues=function(t,n){if(!(t instanceof e))throw new Error("Can only set GPU values to GPU tensor");return Hn.calc({A:this,Values:t,starts:n},this.precision)},e.prototype.add_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add GPU tensor to GPU tensor");return Xn.calc({A:t,B:n,outputShape:r,alpha:o,beta:i},this.precision)},e.prototype.subtract_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only subtract GPU tensor from GPU tensor");return Gn.calc({A:t,B:n,outputShape:r,alpha:o,beta:i},this.precision)},e.prototype.multiply_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only multiply GPU tensor with GPU tensor");return Rn.calc({A:t,B:n,outputShape:r,alpha:o},this.precision)},e.prototype.divide_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only divide GPU tensor by GPU tensor");return En.calc({A:t,B:n,outputShape:r,alpha:o},this.precision)},e.prototype.power_impl=function(t,n,r){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only take GPU tensor to power of GPU tensor");return Dn.calc({A:t,B:n,outputShape:r},this.precision)},e.prototype.matMul=function(t){if(!(t instanceof e))throw new Error("Can only matrix multiply GPU tensor to GPU tensor");return fn.calc({A:this,B:t},this.precision)},e.prototype.gemm_impl=function(t,n,r,o,i,a){if(!(t instanceof e&&(void 0===a||a instanceof e)))throw new Error("Can only do gemm with CPU tensors");return void 0===a?dn.calc({a:this,b:t,aTranspose:n,bTranspose:r,alpha:o,beta:i},this.precision):yn.calc({a:this,b:t,c:a,aTranspose:n,bTranspose:r,alpha:o,beta:i},this.precision)},e.prototype.sum_impl=function(t,e){return Wn.calc({X:this,axes:t,keepDims:e},this.precision)},e.prototype.sumSquare_impl=function(t,e){return zn.calc({X:this,axes:t,keepDims:e},this.precision)},e.prototype.reduceMean_impl=function(t,e){return Un.calc({X:this,axes:t,keepDims:e},this.precision)},e.prototype.reduceMeanSquare_impl=function(t,e){return Bn.calc({X:this,axes:t,keepDims:e},this.precision)},e.prototype.product_impl=function(t,e){return Fn.calc({X:this,axes:t,keepDims:e},this.precision)},e.prototype.max_impl=function(t,e){return Nn.calc({X:this,axes:t,keepDims:e},this.precision)},e.prototype.min_impl=function(t,e){return Ln.calc({X:this,axes:t,keepDims:e},this.precision)},e.prototype.conv_impl=function(t,n,r,o,i,a,s){if(!(t instanceof e)||void 0!==s&&!(s instanceof e))throw new Error("Can only do convolution of GPU tensor with GPU tensor");return void 0===s?jn.calc({X:this,W:t,pads:o,dilations:n,strides:i,activation:a},this.precision):Mn.calc({X:this,W:t,B:s,pads:o,dilations:n,strides:i,activation:a},this.precision)},e.prototype.convTranspose_impl=function(t,n,r,o,i){if(!(t instanceof e))throw new Error("Can only do transpose convolution of GPU tensor with GPU tensor");return Vn.calc({X:this,W:t,pads:o,dilations:n,strides:i},this.precision)},e.prototype.averagePool_impl=function(t,e,n,r){return In.calc({X:this,includePad:r,kernelShape:t,pads:e,strides:n},this.precision)},e.prototype.reshape_impl=function(t,n){return n?Yn.calc({input:this,outputShape:t},this.precision):new e(this.memory,t,this.precision)},e.prototype.concat=function(t,n){if(!(t instanceof e))throw new Error("Can only concat GPU tensor to GPU tensor");return qn.calc({A:this,B:t,axis:n},this.precision)},e.prototype.transpose_impl=function(t){return Qn.calc({A:this,permutation:t},this.precision)},e.prototype.clip=function(t,e){return xn.calc({input:this,minVal:t,maxVal:e},this.precision)},e.prototype.clipBackward=function(t,e,n){return _n.calc({input:this,minVal:e,maxVal:n,grad:t},this.precision)},e.prototype.repeat=function(t){return Zn.calc({A:this,repeats:t},this.precision)},e.prototype.expand=function(t){var e=this.alignShapes(this.shape,t),n=e[0],r=(e[1],e[2]);return P(this.shape,r)?this.copy():Jn.calc({input:this.reshape(n,!1),outputShape:r},this.precision)},e.prototype.pad_impl=function(t,e,n){return Tn.calc({input:this,pads:t,mode:e,value:n},this.precision)},e.prototype.gather=function(t,e){return Kn.calc({X:this,axis:t,indices:e},this.precision)},e.prototype.slice_impl=function(t,e,n){return $n.calc({X:this,starts:t,ends:e,axes:n},this.precision)},e.prototype.upsample=function(t){return Cn.calc({X:this,scales:t},this.precision)},e.prototype.normalize=function(t,n,r,o,i){if(!(t instanceof e)||!(n instanceof e)||!(o instanceof e)||!(i instanceof e))throw new Error("Can only normalize with CPU tensors");return tr.calc({X:this,Mean:t,Variance:n,Scale:o,Bias:i,epsilon:r},this.precision)},e}(T),ln=function(t,e,n){return new hn(t,e,n)},fn=new Le((function(){return new yt(ln)})),dn=new Le((function(){return new _e(ln)})),yn=new Le((function(){return new Oe(ln)})),vn=new Le((function(){return new wt(ln)})),mn=new Le((function(){return new At(ln)})),gn=new Le((function(){return new en(ln)})),wn=new Le((function(){return new ie(ln)})),bn=new Le((function(){return new pe(ln)})),xn=new Le((function(){return new se(ln)})),_n=new Le((function(){return new Qe(ln)})),On=new Le((function(){return new Pe(ln)})),kn=new Le((function(){return new Ie(ln)})),An=new Le((function(){return new Je(ln)})),Sn=new Le((function(){return new on(ln)})),Pn=new Le((function(){return new He(ln)})),jn=new Le((function(){return new _t(ln)})),In=new Le((function(){return new zt(ln)})),Mn=new Le((function(){return new Ot(ln)})),Vn=new Le((function(){return new $e(ln)})),Tn=new Le((function(){return new Re(ln)})),Cn=new Le((function(){return new We(ln)})),Xn=new Le((function(){return new Mt(ln)})),Gn=new Le((function(){return new Rt(ln)})),Rn=new Le((function(){return new Ct(ln)})),En=new Le((function(){return new Ut(ln)})),Dn=new Le((function(){return new Ae(ln)})),Un=new Le((function(){return new Lt(ln)})),Bn=new Le((function(){return new Ht(ln)})),zn=new Le((function(){return new Jt(ln)})),Wn=new Le((function(){return new Qt(ln)})),Fn=new Le((function(){return new $t(ln)})),Nn=new Le((function(){return new ee(ln)})),Ln=new Le((function(){return new re(ln)})),qn=new Le((function(){return new le(ln)})),Hn=new Le((function(){return new sn(ln)})),Yn=new Le((function(){return new de(ln)})),Jn=new Le((function(){return new ve(ln)})),Kn=new Le((function(){return new ge(ln)})),Qn=new Le((function(){return new Ve(ln)})),Zn=new Le((function(){return new Ce(ln)})),$n=new Le((function(){return new Ue(ln)})),tr=new Le((function(){return new Ne(ln)})),er=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),nr=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},rr=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},or=new Promise((function(t){n.e(3).then(n.bind(null,130)).then((function(e){ht=e.Tensor,t()}))})),ir=function(t){function e(e,n){var r=t.call(this)||this;if(e instanceof Float32Array){if(void 0===n)throw new Error("Need the shape when creating a Wasm tensor from values");r.wasmTensor=ht.create(n,e)}else r.wasmTensor=e;return r}return er(e,t),e.prototype.getValues=function(){return Promise.resolve(this.wasmTensor.get_vals())},e.prototype.getShape=function(){return Array.from(this.wasmTensor.get_shape())},e.prototype.constantLike=function(t){return new e(new Float32Array(this.wasmTensor.size).fill(t),this.wasmTensor.get_shape())},e.prototype.singleConstant=function(t){return new e(new Float32Array([t]),new Uint32Array([1]))},e.prototype.wasm=function(){return nr(this,void 0,void 0,(function(){return rr(this,(function(t){return[2,this]}))}))},e.prototype.delete=function(){void 0!==this.wasmTensor&&(this.wasmTensor.free(),this.wasmTensor=void 0)},e.prototype.copy=function(){return new e(this.wasmTensor.copy())},e.prototype.exp=function(){return new e(this.wasmTensor.exp())},e.prototype.log=function(){return new e(this.wasmTensor.log())},e.prototype.sqrt=function(){return new e(this.wasmTensor.sqrt())},e.prototype.abs=function(){return new e(this.wasmTensor.abs())},e.prototype.sigmoid=function(){return new e(this.wasmTensor.sigmoid())},e.prototype.negate=function(){return new e(this.wasmTensor.negate())},e.prototype.addMultiplyScalar=function(t,n){return new e(this.wasmTensor.add_multiply_scalar(t,n))},e.prototype.sign=function(){return new e(this.wasmTensor.sign())},e.prototype.setValues=function(t,n){if(!(t instanceof e))throw new Error("Can only set WASM values to WASM values");return new e(this.wasmTensor.set_values(t.wasmTensor,new Uint32Array(n)))},e.prototype.add_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add WASM tensor to WASM tensor");return new e(t.wasmTensor.addition(n.wasmTensor,o,i))},e.prototype.subtract_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only subtract WASM tensor from WASM tensor");return new e(t.wasmTensor.subtraction(n.wasmTensor,o,i))},e.prototype.multiply_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only multiply WASM tensor with WASM tensor");return new e(t.wasmTensor.multiply(n.wasmTensor,o))},e.prototype.divide_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only divide WASM tensor by WASM tensor");return new e(t.wasmTensor.divide(n.wasmTensor,o))},e.prototype.power_impl=function(t,n,r){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only take WASM tensor to power of WASM tensor");return new e(t.wasmTensor.power(n.wasmTensor))},e.prototype.matMul=function(t){if(!(t instanceof e))throw new Error("Can only add WASM tensor to WASM tensor");return new e(this.wasmTensor.matmul(t.wasmTensor))},e.prototype.gemm_impl=function(t,n,r,o,i,a){if(!(t instanceof e&&(void 0===a||a instanceof e)))throw new Error("Can only do gemm with CPU tensors");return new e(void 0!==a?this.wasmTensor.gemm_with_c(t.wasmTensor,n,r,o,a.wasmTensor,i):this.wasmTensor.gemm(t.wasmTensor,n,r,o))},e.prototype.sum_impl=function(t,n){return new e(this.wasmTensor.sum(new Uint32Array(t),n))},e.prototype.sumSquare_impl=function(t,n){return new e(this.wasmTensor.sum_square(new Uint32Array(t),n))},e.prototype.product_impl=function(t,n){return new e(this.wasmTensor.product(new Uint32Array(t),n))},e.prototype.max_impl=function(t,n){return new e(this.wasmTensor.max(new Uint32Array(t),n))},e.prototype.min_impl=function(t,n){return new e(this.wasmTensor.min(new Uint32Array(t),n))},e.prototype.reduceMean_impl=function(t,n){return new e(this.wasmTensor.reduce_mean(new Uint32Array(t),n))},e.prototype.reduceMeanSquare_impl=function(t,n){return new e(this.wasmTensor.reduce_mean_square(new Uint32Array(t),n))},e.prototype.getActivationFlag=function(t){return"id"===t?0:"relu"===t?1:2},e.prototype.conv_impl=function(t,n,r,o,i,a,s){if(!(t instanceof e)||void 0!==s&&!(s instanceof e))throw new Error("Can only do convolution of WASM tensor with WASM tensor");var u=this.getActivationFlag(a);return new e(void 0!==s?this.wasmTensor.conv_with_bias(t.wasmTensor,s.wasmTensor,new Uint32Array(n),r,new Uint32Array(o),new Uint32Array(i),u):this.wasmTensor.conv(t.wasmTensor,new Uint32Array(n),r,new Uint32Array(o),new Uint32Array(i),u))},e.prototype.convTranspose_impl=function(t,n,r,o,i){if(!(t instanceof e))throw new Error("Can only do transpose convolution of WASM tensor with WASM tensor");return new e(this.wasmTensor.conv_transpose(t.wasmTensor,new Uint32Array(n),r,new Uint32Array(o),new Uint32Array(i)))},e.prototype.averagePool_impl=function(t,n,r,o){return new e(this.wasmTensor.average_pool(new Uint32Array(t),new Uint32Array(n),new Uint32Array(r),o))},e.prototype.reshape_impl=function(t){var n=new Uint32Array(t);return new e(this.wasmTensor.reshape(n),n)},e.prototype.concat=function(t,n){if(!(t instanceof e))throw new Error("Can only concat WASM tensor to WASM tensor");return new e(this.wasmTensor.concat(t.wasmTensor,n))},e.prototype.transpose_impl=function(t){return new e(this.wasmTensor.transpose(new Uint32Array(t)))},e.prototype.clip=function(t,n){return void 0!==t&&void 0!==n?new e(this.wasmTensor.clip(t,n)):void 0!==t?new e(this.wasmTensor.clip_min(t)):void 0!==n?new e(this.wasmTensor.clip_max(n)):this.copy()},e.prototype.clipBackward=function(t,n,r){if(!(t instanceof e))throw new Error("Can only do grad backward with Wasm tensor");return void 0!==n&&void 0!==r?new e(this.wasmTensor.clip_backward(n,r,t.wasmTensor)):void 0!==n?new e(this.wasmTensor.clip_min_backward(n,t.wasmTensor)):void 0!==r?new e(this.wasmTensor.clip_max_backward(r,t.wasmTensor)):this.copy()},e.prototype.repeat=function(t){return new e(this.wasmTensor.repeat(new Uint32Array(t)))},e.prototype.expand=function(t){var n=this.getShape(),r=this.alignShapes(n,t),o=r[0],i=(r[1],r[2]);return P(n,i)?this.copy():new e(this.reshape(o,!1).wasmTensor.expand(new Uint32Array(i)))},e.prototype.pad_impl=function(t,n,r){return new e(this.wasmTensor.pad(new Uint32Array(t),e.padModeToInt[n],r))},e.prototype.gather=function(t,n){return new e(this.wasmTensor.gather(t,n.values,new Uint32Array(n.shape)))},e.prototype.floor=function(){return new e(this.wasmTensor.floor())},e.prototype.ceil=function(){return new e(this.wasmTensor.ceil())},e.prototype.slice_impl=function(t,n,r){return new e(this.wasmTensor.slice(new Uint32Array(t),new Uint32Array(n),new Uint32Array(r)))},e.prototype.upsample=function(t){return new e(this.wasmTensor.upsample(new Float32Array(t)))},e.prototype.normalize=function(t,n,r,o,i){if(!(t instanceof e)||!(n instanceof e)||!(o instanceof e)||!(i instanceof e))throw new Error("Can only normalize with CPU tensors");return new e(this.wasmTensor.normalize(t.wasmTensor,n.wasmTensor,r,o.wasmTensor,i.wasmTensor))},e.padModeToInt={constant:0,reflect:1,edge:2},e}(T),ar=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var e=this.input.value.sign(),n=t.multiply(e);e.delete(),this.input.backward(n)||n.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),sr=function(){function t(t,e){this.input=t,this.exp=e}return t.prototype.backward=function(t){var e=t.multiply(this.exp);this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),ur=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var e=t.divide(this.input.value);this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),pr=function(){function t(t,e){this.a=t,this.b=e}return t.prototype.backward=function(t){if(!this.b.noGrad){var e=this.a.value.gemm(t,!0,!1);this.b.backward(e)||e.delete()}if(!this.a.noGrad){var n=t.gemm(this.b.value,!1,!0);this.a.backward(n)||n.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),cr=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var e=t.negate();this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),hr=function(){function t(t,e){this.input=t,this.sqrt=e}return t.prototype.backward=function(t){var e=t.divide(this.sqrt,.5);this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),lr=function(){function t(t,e,n){this.a=t,this.b=e,this.axis=n}return t.prototype.backward=function(t){if(!this.a.noGrad){var e=t.slice([0],[this.a.getShape()[this.axis]],[this.axis]);this.a.backward(e)||e.delete()}if(!this.b.noGrad){var n=t.slice([this.a.getShape()[this.axis]],[t.getShape()[this.axis]],[this.axis]);this.b.backward(n)||n.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),fr=function(){function t(t,e,n){this.input=t,this.min=e,this.max=n}return t.prototype.backward=function(t){var e=this.input.value.clipBackward(t,this.min,this.max);this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),dr=function(){function t(t,e){this.a=t,this.repeats=e}return t.prototype.backward=function(t){for(var e=this.a.getShape(),n=[],r=[],o=0;o<e.length;o++)n.push(this.repeats[o],e[o]),r.push(2*o);var i=t.reshape(n,!1).sum(r,!1);this.a.backward(i)||i.delete()},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),yr=function(){function t(t,e){this.a=t,this.shape=e}return t.prototype.backward=function(t){for(var e=this.a.value.alignShapes(this.a.getShape(),this.shape),n=e[0],r=e[1],o=(e[2],[]),i=0;i<n.length;i++)n[i]<r[i]&&o.push(i);var a=t.sum(o).reshape(this.a.getShape());this.a.backward(a)||a.delete()},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),vr=function(){function t(t){this.a=t}return t.prototype.backward=function(t){var e=this.a.getShape();if(!this.a.noGrad){var n=t.reshape(e);this.a.backward(n)||n.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),mr=function(){function t(t,e,n,r,o){this.a=t,this.b=e,this.shape=n,this.alpha=r,this.beta=o}return t.prototype.backward=function(t){for(var e=this.a.getShape(),n=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)e[i]<this.shape[i]&&r.push(i),n[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=1===this.alpha?t.reshape(e):t.multiplyScalar(this.alpha).reshape(e,!1);else if(1===this.alpha)a=t.sum(r).reshape(e,!1);else{var s=(p=t.sum(r)).multiplyScalar(this.alpha);p.delete(),a=s.reshape(e,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var u=void 0;if(0===o.length)u=1===this.beta?t.reshape(n):t.multiplyScalar(this.beta).reshape(n,!1);else if(1===this.beta)u=t.sum(o).reshape(n,!1);else{var p;s=(p=t.sum(o)).multiplyScalar(this.beta);p.delete(),u=s.reshape(n,!1)}this.b.backward(u)||u.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),gr=function(){function t(t,e,n,r,o){this.a=t,this.b=e,this.shape=n,this.alpha=r,this.beta=o}return t.prototype.backward=function(t){for(var e=this.a.getShape(),n=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)e[i]<this.shape[i]&&r.push(i),n[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=1===this.alpha?t.reshape(e):t.multiplyScalar(this.alpha).reshape(e,!1);else if(1===this.alpha)a=t.sum(r).reshape(e,!1);else{var s=(p=t.sum(r)).multiplyScalar(this.alpha);p.delete(),a=s.reshape(e,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var u=void 0;if(0===o.length)u=t.multiplyScalar(-this.beta).reshape(n,!1);else{var p;s=(p=t.sum(o)).multiplyScalar(-this.beta);p.delete(),u=s.reshape(n,!1)}this.b.backward(u)||u.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),wr=function(){function t(t,e,n,r){this.a=t,this.b=e,this.shape=n,this.alpha=r}return t.prototype.backward=function(t){for(var e=this.a.getShape(),n=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)e[i]<this.shape[i]&&r.push(i),n[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=t.multiply(this.b.value,this.alpha).reshape(e,!1);else{var s=(p=t.multiply(this.b.value,this.alpha)).sum(r);p.delete(),a=s.reshape(e,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var u=void 0;if(0===o.length)u=t.multiply(this.a.value,this.alpha).reshape(n,!1);else{var p;s=(p=t.multiply(this.a.value,this.alpha)).sum(o);p.delete(),u=s.reshape(n,!1)}this.b.backward(u)||u.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),br=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},xr=function(){function t(t,e,n,r,o,i,a){this.x=t,this.w=e,this.strides=n,this.padding=r,this.dilations=o,this.group=i,this.b=a}return t.prototype.backward=function(t){if(!this.w.noGrad){var e=this.x.value.conv(t,void 0,this.strides,this.group,this.padding,this.dilations);this.w.backward(e)||e.delete()}if(void 0!==this.b&&!this.b.noGrad){for(var n=[0],r=0;r<this.dilations.length;r++)n.push(r+2);var o=t.sum(n);this.b.backward(o)||o.delete()}if(!this.x.noGrad){var i=this.w.getShape(),a=[];for(r=0;r<this.dilations.length;r++)a.push(i[r+2]-this.padding[r]+this.dilations[r]-2);a=br(a,a);var s=t.convTranspose(this.w.value,this.dilations,this.group,a,this.strides);this.x.backward(s)||s.delete()}},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete(),this.w.isLeaf()||this.w.delete(),void 0===this.b||this.b.isLeaf()||this.b.delete()},t}(),_r=function(){function t(t,e,n,r,o){this.a=t,this.b=e,this.divResult=n,this.shape=r,this.alpha=o}return t.prototype.backward=function(t){for(var e=this.a.getShape(),n=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)e[i]<this.shape[i]&&r.push(i),n[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=t.divide(this.b.value,this.alpha).reshape(e,!1);else{var s=t.divide(this.b.value,this.alpha),u=s.sum(r);s.delete(),a=u.reshape(e,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var p=void 0;if(0===o.length){var c=(h=t.multiply(this.divResult)).divide(this.b.value,-this.alpha);h.delete(),p=c.reshape(n,!1)}else{var h;c=(h=t.multiply(this.divResult)).divide(this.b.value,-this.alpha);h.delete();u=c.sum(o);c.delete(),p=u.reshape(n,!1)}this.b.backward(p)||p.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),Or=function(){function t(t,e,n,r){this.a=t,this.b=e,this.powerResult=n,this.shape=r}return t.prototype.backward=function(t){for(var e=this.a.getShape(),n=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)e[i]<this.shape[i]&&r.push(i),n[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length){var s=(p=this.powerResult.multiply(this.b.value)).divide(this.a.value);p.delete();var u=t.multiply(s);s.delete(),a=u.reshape(e,!1)}else{var p;s=(p=this.powerResult.multiply(this.b.value)).divide(this.a.value);p.delete();u=t.multiply(s);s.delete();var c=u.sum(r);u.delete(),a=c.reshape(e,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var h=void 0;if(0===o.length){var l=this.a.value.log(),f=this.powerResult.multiply(l);l.delete(),h=t.multiply(f),f.delete(),h=h.reshape(n,!1)}else{l=this.a.value.log(),f=this.powerResult.multiply(l);l.delete();var d=t.multiply(f);f.delete();c=d.sum(o);d.delete(),h=c.reshape(n,!1)}this.b.backward(h)||h.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),kr=function(){function t(t,e,n,r,o,i,a){this.a=t,this.b=e,this.transA=n,this.transB=r,this.alpha=o,this.beta=i,this.c=a}return t.prototype.backward=function(t){if(!this.b.noGrad){var e=void 0;e=this.transB?t.gemm(this.a.value,!0,this.transA,this.alpha):this.a.value.gemm(t,!this.transA,!1,this.alpha),this.b.backward(e)||e.delete()}if(!this.a.noGrad){var n=void 0;n=this.transA?this.b.value.gemm(t,this.transB,!0,this.alpha):t.gemm(this.b.value,!1,!this.transB,this.alpha),this.a.backward(n)||n.delete()}if(void 0!==this.c&&!this.c.noGrad){for(var r=t.getShape(),o=this.c.getShape(),i=[],a=0;a<r.length;a++)o[a]<r[a]&&i.push(a);var s=t.sum(i).reshape(o,!1);if(1!==this.beta){var u=s;s=s.multiplyScalar(this.beta),u.delete()}this.c.backward(s)||s.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete(),void 0===this.c||this.c.isLeaf()||this.c.delete()},t}(),Ar=function(){function t(t,e){this.a=t,this.permutation=e}return t.prototype.backward=function(t){for(var e=new Array(this.permutation.length),n=0;n<this.permutation.length;n++)e[this.permutation[n]]=n;var r=t.transpose(e);this.a.backward(r)||r.delete()},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),Sr=function(){function t(t,e,n){this.input=t,this.sumDims=e,this.keepDims=n}return t.prototype.backward=function(t){var e=this.input.value.getShape();if(!this.keepDims){for(var n=[],r=0,o=0;o<e.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(n.push(1),r++):n.push(e[o]);t=t.reshape(n,!1)}t=t.expand(e),this.input.backward(t)||t.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Pr=function(){function t(t,e,n){this.input=t,this.sumDims=e,this.keepDims=n}return t.prototype.backward=function(t){var e=this.input.value.getShape();if(!this.keepDims){for(var n=[],r=0,o=0;o<e.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(n.push(1),r++):n.push(e[o]);t=t.reshape(n,!1)}var i=t.expand(e),a=i.multiply(this.input.value,2);i.delete(),this.input.backward(a)||a.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),jr=function(){function t(t,e){this.input=t,this.scalar=e}return t.prototype.backward=function(t){var e=t.multiplyScalar(this.scalar);this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Ir=function(){function t(t,e,n){this.input=t,this.sumDims=e,this.keepDims=n}return t.prototype.backward=function(t){var e=this.input.value.getShape();if(!this.keepDims){for(var n=[],r=0,o=0;o<e.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(n.push(1),r++):n.push(e[o]);t=t.reshape(n,!1)}var i=1;for(o=0;o<this.sumDims.length;o++)i*=e[this.sumDims[o]];var a=t.multiplyScalar(1/i),s=a.expand(e);a.delete,this.input.backward(s)||t.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Mr=function(){function t(t,e,n){this.input=t,this.sumDims=e,this.keepDims=n}return t.prototype.backward=function(t){var e=this.input.value.getShape();if(!this.keepDims){for(var n=[],r=0,o=0;o<e.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(n.push(1),r++):n.push(e[o]);t=t.reshape(n,!1)}var i=1;for(o=0;o<this.sumDims.length;o++)i*=e[this.sumDims[o]];var a=t.expand(e),s=a.multiply(this.input.value,2/i);a.delete(),this.input.backward(s)||s.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Vr=function(){function t(t,e,n,r){this.a=t,this.starts=e,this.ends=n,this.axes=r}return t.prototype.backward=function(t){if(!this.a.noGrad){for(var e=this.a.getShape(),n=e.length,r=new Array(2*n).fill(0),o=0;o<this.axes.length;o++)r[this.axes[o]]=this.starts[o],r[n+this.axes[o]]=e[this.axes[o]]-this.ends[o];var i=t.pad(r,"constant",0);this.a.backward(i)||i.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),Tr=function(){function t(t,e,n,r,o){this.x=t}return t.prototype.backward=function(t){throw new Error("Backward pass not implemented for average pool")},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete()},t}(),Cr=function(){function t(t,e,n,r){this.x=t,this.pads=e,this.mode=n,this.value=r}return t.prototype.backward=function(t){throw new Error("Backward pass not implemented for pad")},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete()},t}(),Xr=function(){function t(t,e,n,r){this.input=t,this.product=e,this.sumDims=n,this.keepDims=r}return t.prototype.backward=function(t){var e=this.input.value.getShape(),n=t.multiply(this.product);if(!this.keepDims){for(var r=[],o=0,i=0;i<e.length;i++)o<this.sumDims.length&&this.sumDims[o]===i?(r.push(1),o++):r.push(e[i]);n=n.reshape(r,!1)}var a=n.expand(e);n.delete();var s=a.divide(this.input.value);a.delete(),this.input.backward(s)||s.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Gr=function(){function t(t,e){this.input=t,this.sigmoid=e}return t.prototype.backward=function(t){var e=this.sigmoid.addMultiplyScalar(-1,1),n=this.sigmoid.multiply(e);e.delete();var r=n.multiply(t);n.delete(),this.input.backward(r)||r.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Rr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Er=function(t){function e(e,n){var r=t.call(this)||this;return r.value=e,void 0===n&&(n={}),r.grad=n.grad,void 0!==n.backEdge&&(r.backEdge=n.backEdge),r.noGrad=n.noGrad||!1,r}return Rr(e,t),e.create=function(t,n,r,o,i){var a;return"CPU"===r?a=new $(t,n):"WASM"===r?(n instanceof Float32Array||(n=Float32Array.from(n)),a=new ir(n,new Uint32Array(t))):(n instanceof Float32Array||(n=Float32Array.from(n)),a=new hn(n,t,void 0===i?32:i)),new e(a,o)},e.fromData=function(t,n,r){return new e(hn.fromData(t,void 0===r?32:r),n)},e.prototype.backward=function(t){if(void 0===t){var e=this.value.getShape();if(1!==e.length||1!==e[0])throw new Error("Backward without an input gradient can only be done for tensors with shape [1]");t=this.value}var n=!1;if(void 0!==this.grad){var r=this.grad;this.grad=this.grad.add(t),r.delete()}else this.grad=t,n=!0;return void 0!==this.backEdge&&this.backEdge.backward(t),n},e.prototype.isLeaf=function(){return void 0===this.backEdge},e.prototype.constantLike=function(t){return new e(this.value.constantLike(t),{noGrad:!0})},e.prototype.singleConstant=function(t){return new e(this.value.singleConstant(t),{noGrad:!0})},e.prototype.getValues=function(){return this.value.getValues()},e.prototype.getShape=function(){return this.value.getShape()},e.prototype.delete=function(){this.value.delete(),void 0!==this.grad&&this.grad.delete(),void 0!==this.backEdge&&this.backEdge.delete()},e.prototype.reshape_impl=function(t,n){return new e(this.value.reshape(t),{backEdge:this.noGrad?void 0:new vr(this),noGrad:this.noGrad})},e.prototype.exp=function(){var t=this.value.exp();return new e(t,{backEdge:this.noGrad?void 0:new sr(this,t),noGrad:this.noGrad})},e.prototype.log=function(){return new e(this.value.log(),{backEdge:this.noGrad?void 0:new ur(this),noGrad:this.noGrad})},e.prototype.sqrt=function(){var t=this.value.sqrt();return new e(t,{backEdge:this.noGrad?void 0:new hr(this,t),noGrad:this.noGrad})},e.prototype.abs=function(){return new e(this.value.abs(),{backEdge:this.noGrad?void 0:new ar(this),noGrad:this.noGrad})},e.prototype.sigmoid=function(){var t=this.value.sigmoid();return new e(t,{backEdge:this.noGrad?void 0:new Gr(this,t),noGrad:this.noGrad})},e.prototype.sign=function(){return new e(this.value.sqrt())},e.prototype.negate=function(){return new e(this.value.negate(),{backEdge:this.noGrad?void 0:new cr(this),noGrad:this.noGrad})},e.prototype.addMultiplyScalar=function(t,n){return new e(this.value.addMultiplyScalar(t,n),{backEdge:this.noGrad?void 0:new jr(this,t),noGrad:this.noGrad})},e.prototype.setValues=function(t,e){throw new Error("Method not implemented.")},e.prototype.matMul=function(t){if(!(t instanceof e))throw new Error("MatMul can only be done with another variable");var n=this.noGrad&&t.noGrad;return new e(this.value.matMul(t.value),{backEdge:n?void 0:new pr(this,t),noGrad:n})},e.prototype.concat=function(t,n){if(!(t instanceof e))throw new Error("Concat can only be done with another variable");var r=this.noGrad&&t.noGrad;return new e(this.value.concat(t.value,n),{backEdge:r?void 0:new lr(this,t,n),noGrad:r})},e.prototype.clip=function(t,n){return new e(this.value.clip(t,n),{backEdge:this.noGrad?void 0:new fr(this,t,n),noGrad:this.noGrad})},e.prototype.clipBackward=function(t,e,n){throw new Error("Clip backward not implemented for Variable")},e.prototype.repeat=function(t){return new e(this.value.repeat(t),{backEdge:this.noGrad?void 0:new dr(this,t),noGrad:this.noGrad})},e.prototype.expand=function(t){return new e(this.value.expand(t),{backEdge:this.noGrad?void 0:new yr(this,t),noGrad:this.noGrad})},e.prototype.copy=function(){return new e(this.value.copy(),{grad:void 0!==this.grad?this.grad.copy():void 0})},e.prototype.gather=function(t,e){throw new Error("Method not implemented.")},e.prototype.floor=function(){return new e(this.value.floor())},e.prototype.ceil=function(){return new e(this.value.ceil())},e.prototype.upsample=function(t){throw new Error("Method not implemented.")},e.prototype.normalize=function(t,e,n,r,o){throw new Error("Method not implemented.")},e.prototype.add_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add Variable tensor to Variable tensor");var a=t.noGrad&&n.noGrad;return new e(t.value.add_impl(t.value,n.value,r,o,i),{backEdge:a?void 0:new mr(t,n,r,o,i),noGrad:a})},e.prototype.subtract_impl=function(t,n,r,o,i){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add Variable tensor to Variable tensor");var a=t.noGrad&&n.noGrad;return new e(t.value.subtract_impl(t.value,n.value,r,o,i),{backEdge:a?void 0:new gr(t,n,r,o,i),noGrad:a})},e.prototype.multiply_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only add Variable tensor to Variable tensor");var i=t.noGrad&&n.noGrad;return new e(t.value.multiply_impl(t.value,n.value,r,o),{backEdge:i?void 0:new wr(t,n,r,o),noGrad:i})},e.prototype.divide_impl=function(t,n,r,o){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only divide Variable tensor by Variable tensor");var i=t.value.divide_impl(t.value,n.value,r,o),a=t.noGrad&&n.noGrad;return new e(i,{backEdge:a?void 0:new _r(t,n,i,r,o),noGrad:a})},e.prototype.power_impl=function(t,n,r){if(!(n instanceof e)||!(t instanceof e))throw new Error("Can only take Variable tensor to power of Variable tensor");var o=t.value.power_impl(t.value,n.value,r),i=t.noGrad&&n.noGrad;return new e(o,{backEdge:i?void 0:new Or(t,n,o,r),noGrad:i})},e.prototype.gemm_impl=function(t,n,r,o,i,a){if(!(t instanceof e)||void 0!==a&&!(a instanceof e))throw new Error("Can only do gemm with variable tensors");var s=this.noGrad&&t.noGrad&&(void 0===a||a.noGrad);return new e(this.value.gemm_impl(t.value,n,r,o,i,void 0!==a?a.value:void 0),{backEdge:s?void 0:new kr(this,t,n,r,o,i,a),noGrad:s})},e.prototype.sum_impl=function(t,n){return new e(this.value.sum(t,n),{backEdge:this.noGrad?void 0:new Sr(this,t,n),noGrad:this.noGrad})},e.prototype.sumSquare_impl=function(t,n){return new e(this.value.sumSquare(t,n),{backEdge:this.noGrad?void 0:new Pr(this,t,n),noGrad:this.noGrad})},e.prototype.product_impl=function(t,n){var r=this.value.product(t,n);return new e(r,{backEdge:this.noGrad?void 0:new Xr(this,r,t,n),noGrad:this.noGrad})},e.prototype.max_impl=function(t,e){throw new Error("Method not implemented.")},e.prototype.min_impl=function(t,e){throw new Error("Method not implemented.")},e.prototype.reduceMean_impl=function(t,n){return new e(this.value.reduceMean(t,n),{backEdge:this.noGrad?void 0:new Ir(this,t,n),noGrad:this.noGrad})},e.prototype.reduceMeanSquare_impl=function(t,n){return new e(this.value.reduceMeanSquare(t,n),{backEdge:this.noGrad?void 0:new Mr(this,t,n),noGrad:this.noGrad})},e.prototype.conv_impl=function(t,n,r,o,i,a,s){if(!(t instanceof e)||void 0!==s&&!(s instanceof e))throw new Error("Can only do convolution with variable as kernel and bias");if("id"!==a)throw new Error("Activation has to be ID for convolution with variables");var u=this.noGrad&&t.noGrad&&(void 0===s||s.noGrad);return new e(this.value.conv(t.value,void 0!==s?s.value:void 0,n,r,o,i),{backEdge:u?void 0:new xr(this,t,i,o,n,r,s),noGrad:u})},e.prototype.convTranspose_impl=function(t,e,n,r,o){throw new Error("Method not implemented.")},e.prototype.pad_impl=function(t,n,r){return new e(this.value.pad(t,n,r),{backEdge:this.noGrad?void 0:new Cr(this,t,n,r),noGrad:this.noGrad})},e.prototype.averagePool_impl=function(t,n,r,o){return new e(this.value.averagePool(t,n,r,o),{backEdge:this.noGrad?void 0:new Tr(this,t,n,r,o),noGrad:this.noGrad})},e.prototype.transpose_impl=function(t){return new e(this.value.transpose(t),{backEdge:this.noGrad?void 0:new Ar(this,t),noGrad:this.noGrad})},e.prototype.slice_impl=function(t,n,r){return new e(this.value.slice(t,n,r),{backEdge:this.noGrad?void 0:new Vr(this,t,n,r),noGrad:this.noGrad})},e}(T),Dr=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Ur=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function Br(t){return Dr(this,void 0,void 0,(function(){var e,n,r,o,i;return Ur(this,(function(a){switch(a.label){case 0:return t instanceof Er?(e=Er.bind,[4,Br(t.value)]):[3,5];case 1:return n=[void 0,a.sent()],i={},void 0===t.grad?[3,3]:[4,Br(t.grad)];case 2:return r=a.sent(),[3,4];case 3:r=void 0,a.label=4;case 4:return[2,new(e.apply(Er,n.concat([(i.grad=r,i)])))];case 5:return t instanceof $?[2,t]:[4,t.getValues()];case 6:return o=a.sent(),[2,new $(t.getShape(),o)]}}))}))}function zr(t){return Dr(this,void 0,void 0,(function(){var e,n,r,o,i;return Ur(this,(function(a){switch(a.label){case 0:return t instanceof Er?(e=Er.bind,[4,zr(t.value)]):[3,5];case 1:return n=[void 0,a.sent()],i={},void 0===t.grad?[3,3]:[4,zr(t.grad)];case 2:return r=a.sent(),[3,4];case 3:r=void 0,a.label=4;case 4:return[2,new(e.apply(Er,n.concat([(i.grad=r,i)])))];case 5:return t instanceof ir?[2,t]:[4,t.getValues()];case 6:return o=a.sent(),t instanceof $&&o instanceof Int32Array?[2,t]:[2,new ir(o,new Uint32Array(t.getShape()))]}}))}))}function Wr(t,e){return Dr(this,void 0,void 0,(function(){var n,r,o,i,a;return Ur(this,(function(s){switch(s.label){case 0:return t instanceof Er?(n=Er.bind,[4,Wr(t.value,e)]):[3,5];case 1:return r=[void 0,s.sent()],a={},void 0===t.grad?[3,3]:[4,Wr(t.grad,e)];case 2:return o=s.sent(),[3,4];case 3:o=void 0,s.label=4;case 4:return[2,new(n.apply(Er,r.concat([(a.grad=o,a)])))];case 5:return t instanceof hn?[2,t]:[4,t.getValues()];case 6:return i=s.sent(),t instanceof $&&i instanceof Int32Array?[2,t]:[2,new hn(i,t.getShape(),e)]}}))}))}function Fr(t,e){return t instanceof Er&&e instanceof Er?Fr(t.value,e.value):t instanceof $&&e instanceof $||(t instanceof ir&&e instanceof ir||t instanceof hn&&e instanceof hn)}var Nr=n(18),Lr=n.n(Nr),qr=n(49),Hr=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Yr=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Jr=function(){function t(){this.backend="CPU",this.mode="train"}return t.prototype.getSubModules=function(){for(var e=[],n=0,r=Object.keys(this);n<r.length;n++){var o=r[n];this[o]instanceof t&&e.push(this[o])}return e},t.prototype.getParameters=function(){for(var t=[],e=0,n=Object.keys(this);e<n.length;e++){var r=n[e];this[r]instanceof Er&&t.push(this[r])}for(var o=0,i=this.getSubModules();o<i.length;o++){var a=i[o].getParameters();t=t.concat(a)}return t},t.prototype.toBackend=function(t){return"CPU"===t?this.toCPU():"WASM"===t?this.toWASM():this.toGPU(32)},t.prototype.toCPU=function(){return Hr(this,void 0,void 0,(function(){var t,e,n,r,o,i,a,s;return Yr(this,(function(u){switch(u.label){case 0:t=this.getSubModules(),e=0,n=t,u.label=1;case 1:return e<n.length?[4,n[e].toCPU()]:[3,4];case 2:u.sent(),u.label=3;case 3:return e++,[3,1];case 4:r=0,o=Object.keys(this),u.label=5;case 5:return r<o.length?this[i=o[r]]instanceof T?(a=this,s=i,[4,Br(this[i])]):[3,7]:[3,8];case 6:a[s]=u.sent(),u.label=7;case 7:return r++,[3,5];case 8:return this.backend="CPU",[2]}}))}))},t.prototype.toWASM=function(){return Hr(this,void 0,void 0,(function(){var t,e,n,r,o,i,a,s;return Yr(this,(function(u){switch(u.label){case 0:t=this.getSubModules(),e=0,n=t,u.label=1;case 1:return e<n.length?[4,n[e].toWASM()]:[3,4];case 2:u.sent(),u.label=3;case 3:return e++,[3,1];case 4:r=0,o=Object.keys(this),u.label=5;case 5:return r<o.length?this[i=o[r]]instanceof T?(a=this,s=i,[4,zr(this[i])]):[3,7]:[3,8];case 6:a[s]=u.sent(),u.label=7;case 7:return r++,[3,5];case 8:return this.backend="WASM",[2]}}))}))},t.prototype.toGPU=function(t){return Hr(this,void 0,void 0,(function(){var e,n,r,o,i,a,s,u;return Yr(this,(function(p){switch(p.label){case 0:e=this.getSubModules(),n=0,r=e,p.label=1;case 1:return n<r.length?[4,r[n].toGPU(t)]:[3,4];case 2:p.sent(),p.label=3;case 3:return n++,[3,1];case 4:o=0,i=Object.keys(this),p.label=5;case 5:return o<i.length?this[a=i[o]]instanceof T?(s=this,u=a,[4,Wr(this[a],t)]):[3,7]:[3,8];case 6:s[u]=p.sent(),p.label=7;case 7:return o++,[3,5];case 8:return this.backend="GPU",[2]}}))}))},t}(),Kr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qr=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Zr=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},$r=function(t){function e(e,n,r,o,i,a){var s=t.call(this)||this;s.attributes={},s.mode=a;for(var u=0;u<e.length;u++)s.attributes[e[u].name]=e[u];s.inputs=n,s.outputs=r,s.onnxVersion=i,s.variableInputs=0;for(u=0;u<s.inputs.length;u++)void 0===o[s.inputs[u]]&&s.variableInputs++;return s}return Kr(e,t),e.prototype.initialize=function(t){},e.prototype.getAttribute=function(t){return this.attributes[t]},e.prototype.getAttributeString=function(t){var e=this.attributes[t];if(void 0!==e){var n=e.s;return void 0!==n&&null!==n?new TextDecoder("utf-8").decode(n):void 0}},e.prototype.getAttributeInts=function(t){if(void 0!==this.attributes[t]){var e=this.attributes[t].ints;if(void 0!==e&&null!==e){for(var n=0;n<e.length;n++)Lr.a.isLong(e[n])&&(e[n]=e[n].toNumber());return e}}},e.prototype.getAttributeInt=function(t){var e=this.attributes[t];if(void 0!==e){var n=e.i;return Lr.a.isLong(n)&&(n=n.toNumber()),n}},e.prototype.getAttributeFloat=function(t){var e=this.attributes[t];if(void 0!==e)return e.f},e.prototype.getAttributeTensor=function(t){var e=this.attributes[t];if(void 0!==e)return e.t},e.prototype.toCPU=function(){return Qr(this,void 0,void 0,(function(){return Zr(this,(function(t){return[2]}))}))},e.prototype.toWASM=function(){return Qr(this,void 0,void 0,(function(){return Zr(this,(function(t){return[2]}))}))},e.prototype.toGPU=function(t){return Qr(this,void 0,void 0,(function(){return Zr(this,(function(t){return[2]}))}))},e}(Jr);function to(t){if(void 0!==t.segment&&null!==t.segment)throw new Error("Handling of tensor proto segment not yet implemented");var e=t.dims;if(void 0===e||null===e)throw new Error("Tensor shape must be specified");for(var n=0;n<e.length;n++)Lr.a.isLong(e[n])&&(e[n]=e[n].toNumber());0===e.length&&(e=[1]);var r=k(e);if(1===t.dataType){if(t.floatData&&t.floatData.length>0)return new $(e,t.floatData);if(t.rawData&&t.rawData.length>0){var o=t.rawData.buffer.slice(t.rawData.byteOffset,t.rawData.byteOffset+t.rawData.byteLength),i=new Float32Array(o);return new $(e,i)}if(0===r)return new $(e);throw new Error("Cant process float tensor without float or raw data")}if(7===t.dataType){if(t.rawData&&t.rawData.length>0){for(i=new Int32Array(t.rawData.length/8),n=0;n<t.rawData.length;n+=8){var a=Lr.a.fromBytesLE(Array.from(t.rawData.slice(n,n+8))).toNumber();i[n/8]=a}return new $(e,i,"int")}throw new Error("Cant process int64 tensor without raw data")}throw new Error("Handling of tensor type "+t.dataType+" not yet implemented")}var eo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),no=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},ro=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},oo=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;if(i<11){var u=s.getAttributeTensor("value");void 0!==u&&null!==u&&(s.tensor=to(u),"train"===a&&(s.tensor=new Er(s.tensor)))}return s}return eo(e,t),e.prototype.forward=function(t){return no(this,void 0,void 0,(function(){return ro(this,(function(t){if(this.onnxVersion<11&&void 0!==this.tensor)return[2,[this.tensor]];throw new Error("Constant with onnx version >= 11 not yet implemented")}))}))},e.prototype.toCPU=function(){return no(this,void 0,void 0,(function(){var t;return ro(this,(function(e){switch(e.label){case 0:return void 0===this.tensor?[3,2]:(t=this,[4,Br(this.tensor)]);case 1:t.tensor=e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.toWASM=function(){return no(this,void 0,void 0,(function(){var t;return ro(this,(function(e){switch(e.label){case 0:return void 0===this.tensor?[3,2]:(t=this,[4,zr(this.tensor)]);case 1:t.tensor=e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.toGPU=function(t){return no(this,void 0,void 0,(function(){var e;return ro(this,(function(n){switch(n.label){case 0:return void 0===this.tensor?[3,2]:(e=this,[4,Wr(this.tensor,t)]);case 1:e.tensor=n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype.getType=function(){return"Constant"},e.prototype.delete=function(){void 0!==this.tensor&&this.tensor.delete()},e}($r),io=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ao=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},so=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},uo=function(t){function e(e,n,r,o,i,a,s,u,p){var c=t.call(this,e,n,r,o,i,a)||this;if(void 0!==c.getAttributeString("autoPad"))throw new Error("Autopad in conv not supported yet");return void 0===p&&(p="id"),c.activation=p,c.group=c.getAttributeInt("group")||1,c.dilations=c.getAttributeInts("dilations"),c.pads=c.getAttributeInts("pads"),c.strides=c.getAttributeInts("strides"),c.kernel=s,c.bias=u,"train"===a&&void 0!==c.kernel&&(c.kernel=new Er(c.kernel)),"train"===a&&void 0!==c.bias&&(c.bias=new Er(c.bias)),c}return io(e,t),e.prototype.forward=function(t){return ao(this,void 0,void 0,(function(){var e,n,r;return so(this,(function(o){return e=t[0],n=void 0!==this.kernel?this.kernel:t[1],r=t.length>2?t[2]:this.bias,[2,[e.conv(n,r,this.dilations,this.group,this.pads,this.strides,this.activation)]]}))}))},e.prototype.getDilations=function(t){return void 0!==this.dilations?this.dilations:new Array(t).fill(1)},e.prototype.getPads=function(t){return void 0!==this.pads?this.pads:new Array(2*t).fill(0)},e.prototype.getStrides=function(t){return void 0!==this.strides?this.strides:new Array(t).fill(1)},e.prototype.getType=function(){return"Conv"},e.prototype.toCPU=function(){return ao(this,void 0,void 0,(function(){var t,e;return so(this,(function(n){switch(n.label){case 0:return void 0===this.kernel?[3,2]:(t=this,[4,Br(this.kernel)]);case 1:t.kernel=n.sent(),n.label=2;case 2:return void 0===this.bias?[3,4]:(e=this,[4,Br(this.bias)]);case 3:e.bias=n.sent(),n.label=4;case 4:return[2]}}))}))},e.prototype.toWASM=function(){return ao(this,void 0,void 0,(function(){var t,e;return so(this,(function(n){switch(n.label){case 0:return void 0===this.kernel?[3,2]:(t=this,[4,zr(this.kernel)]);case 1:t.kernel=n.sent(),n.label=2;case 2:return void 0===this.bias?[3,4]:(e=this,[4,zr(this.bias)]);case 3:e.bias=n.sent(),n.label=4;case 4:return[2]}}))}))},e.prototype.toGPU=function(t){return ao(this,void 0,void 0,(function(){var e,n;return so(this,(function(r){switch(r.label){case 0:return void 0===t&&(t=32),void 0===this.kernel?[3,2]:(e=this,[4,Wr(this.kernel,t)]);case 1:e.kernel=r.sent(),r.label=2;case 2:return void 0===this.bias?[3,4]:(n=this,[4,Wr(this.bias,t)]);case 3:n.bias=r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.delete=function(){void 0!==this.kernel&&this.kernel.delete(),void 0!==this.bias&&this.bias.delete()},e}($r),po=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),co=function(t){function e(e){var n=t.call(this)||this;return n.nodeTypes=e,n}return po(e,t),e.prototype.findApplications=function(t){var e=[],n=t.getNodes();for(var r in Object.keys(n)){var o=n[r];if(void 0!==o&&o.getType()===this.nodeTypes[0]){var i=this.checkApplication(t,r);void 0!==i&&e.push(i)}}return e},e.prototype.checkApplication=function(t,e){for(var n=t.getNodes(),r=[e],o=n[e],i=[o],a=1;a<this.nodeTypes.length;a++){var s=t.getNodeWithInput(o.outputs[0]);if(void 0===s)return;var u=n[s];if(u.getType()!==this.nodeTypes[a])return;r.push(s),o=u,i.push(o)}return this.canApply(i)?r:void 0},e.prototype.canApply=function(t){return!0},e}((function(){})),ho=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),lo=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},fo=function(t){function e(){return t.call(this,["Conv","BatchNormalization"])||this}return ho(e,t),e.prototype.apply=function(t,e,n,r){var o=t[0],i=t[1],a=e(o.inputs[1]),s=e(o.inputs[2]),u=e(i.inputs[1]),p=e(i.inputs[2]),c=e(i.inputs[3]),h=e(i.inputs[4]).add(i.epsTensor).sqrt(),l=u.divide(h);h.delete();var f=p.subtract(c.multiply(l)),d=lo(l.getShape(),new Array(a.getShape().length-l.getShape().length).fill(1)),y=a.multiply(l.reshape(d,!1)),v=f;if(void 0!==s){var m=s.multiply(l);v=v.add(m),m.delete()}return new uo(Object.entries(o.attributes).map((function(t){return t[1]})),[o.inputs[0]],i.outputs,n,r,o.mode,y,v)},e}(co),yo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vo=function(t){function e(){return t.call(this,["Conv","Relu"])||this}return yo(e,t),e.prototype.apply=function(t,e,n,r){var o=t[0],i=t[1];return new uo(Object.entries(o.attributes).map((function(t){return t[1]})),o.inputs,i.outputs,n,r,o.mode,o.kernel,o.bias,"relu")},e}(co),mo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),go=function(t){function e(){return t.call(this,["Conv","Clip"])||this}return mo(e,t),e.prototype.apply=function(t,e,n,r){var o=t[0],i=t[1];return new uo(Object.entries(o.attributes).map((function(t){return t[1]})),o.inputs,i.outputs,n,r,o.mode,o.kernel,o.bias,"relu6")},e.prototype.canApply=function(t){var e=t[1];return 0===e.min&&6===e.max},e}(co),wo=[new fo,new vo,new go],bo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xo=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},_o=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Oo=function(t){function e(e,n,r,o,i,a,s){var u=t.call(this,e,n,r,o,i,s)||this;return u.name=a,u}return bo(e,t),e.prototype.forward=function(t){return xo(this,void 0,void 0,(function(){var e,n;return _o(this,(function(r){if(this.onnxVersion<13&&this.onnxVersion>=7)return e=t[0],n=t[1],[2,[this.compute(e,n)]];throw new Error(this.name+" not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return this.name},e.prototype.delete=function(){},e}($r),ko=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ao=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"Add",a)||this}return ko(e,t),e.prototype.compute=function(t,e){return t.add(e)},e}(Oo),So=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Po=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},jo=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Io=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},Mo=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.epsilon=s.getAttributeFloat("epsilon")||1e-5,s.momentum=s.getAttributeFloat("momentum")||.9,s.epsTensor=new $([1],[s.epsilon]),"train"===a&&(s.epsTensor=new Er(s.epsTensor)),s}return So(e,t),e.prototype.defaultForward=function(t){return Po(this,void 0,void 0,(function(){var e,n,r,o,i,a,s;return jo(this,(function(u){return e=t[0],n=t[1],r=t[2],o=t[3],i=t[4],a=n.getShape()[0],s=Io([1,a],new Array(e.getShape().length-2).fill(1)),n=n.reshape(s,!1),r=r.reshape(s,!1),o=o.reshape(s,!1),i=i.reshape(s,!1),[2,[e.normalize(o,i,this.epsilon,n,r)]]}))}))},e.prototype.forward=function(t){return Po(this,void 0,void 0,(function(){return jo(this,(function(e){return[2,this.defaultForward(t)]}))}))},e.prototype.getType=function(){return"BatchNormalization"},e.prototype.toCPU=function(){return Po(this,void 0,void 0,(function(){var t;return jo(this,(function(e){switch(e.label){case 0:return t=this,[4,Br(this.epsTensor)];case 1:return t.epsTensor=e.sent(),[2]}}))}))},e.prototype.toWASM=function(){return Po(this,void 0,void 0,(function(){var t;return jo(this,(function(e){switch(e.label){case 0:return t=this,[4,zr(this.epsTensor)];case 1:return t.epsTensor=e.sent(),[2]}}))}))},e.prototype.toGPU=function(t){return Po(this,void 0,void 0,(function(){var e;return jo(this,(function(n){switch(n.label){case 0:return e=this,[4,Wr(this.epsTensor,t)];case 1:return e.epsTensor=n.sent(),[2]}}))}))},e.prototype.delete=function(){this.epsTensor.delete()},e}($r);function Vo(t,e){if(t.type===e)return t;if("float"===e){for(var n=new Float32Array(t.size),r=0;r<t.size;r++)n[r]=t.get(r);return new $(t.shape,n,e)}for(n=new Int32Array(t.size),r=0;r<t.size;r++)n[r]=t.get(r);return new $(t.shape,n,e)}var To=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Co=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Xo=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Go=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.to=s.getAttributeString("to"),s}return To(e,t),e.prototype.forward=function(t){return Co(this,void 0,void 0,(function(){var e;return Xo(this,(function(n){if((e=t[0])instanceof $)return[2,[Vo(e,this.to)]];throw new Error("Can only cast CPU tensors right now")}))}))},e.prototype.getType=function(){return"Cast"},e.prototype.delete=function(){},e}($r),Ro=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Eo=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Do=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Uo=function(t){function e(e,n,r,o,i,a,s){var u=t.call(this,e,n,r,o,i,s)||this;return u.name=a,u}return Ro(e,t),e.prototype.forward=function(t){return Eo(this,void 0,void 0,(function(){var e;return Do(this,(function(n){return e=t[0],[2,[this.compute(e)]]}))}))},e.prototype.getType=function(){return this.name},e.prototype.delete=function(){},e}($r),Bo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zo=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"Ceil",a)||this}return Bo(e,t),e.prototype.compute=function(t){return t.ceil()},e}(Uo),Wo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fo=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},No=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Lo=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return i<11&&(s.min=s.getAttributeFloat("min"),s.max=s.getAttributeFloat("max")),s}return Wo(e,t),e.prototype.forward=function(t){return Fo(this,void 0,void 0,(function(){var e,n,r;return No(this,(function(o){if(e=t[0],this.onnxVersion<11)return[2,[e.clip(this.min,this.max)]];if(n=t.length>1?t[1]:void 0,r=t.length>2?t[2]:void 0,void 0===n&&void 0===r)return[2,[e.copy()]];throw new Error("Clip with onnx version >= 11 not yet implemented")}))}))},e.prototype.getType=function(){return"Clip"},e.prototype.delete=function(){},e}($r),qo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ho=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Yo=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Jo=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return i<13&&(s.axis=s.getAttributeInt("axis")),s}return qo(e,t),e.prototype.forward=function(t){return Ho(this,void 0,void 0,(function(){var e,n,r;return Yo(this,(function(o){if(t.length,this.onnxVersion<13&&void 0!==this.axis){for(e=t[0],n=1;n<t.length;n++)r=e.concat(t[n],this.axis),n>1&&e.delete(),e=r;return[2,[e]]}throw new Error("Concat not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return"Concat"},e.prototype.delete=function(){},e}($r),Ko=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qo=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Zo=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},$o=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;if(i<11){var u=s.getAttributeTensor("value");null!==u&&void 0!==u&&(s.tensor=to(u))}return s}return Ko(e,t),e.prototype.forward=function(t){return Qo(this,void 0,void 0,(function(){var e,n,r,o,i;return Zo(this,(function(a){if(e=t[0],this.onnxVersion<11&&void 0!==this.tensor){if(!(e instanceof $))throw new Error("ConstantOfShape needs cpu tensor as shape tensor");for(n=new Array(e.size),r=0;r<e.size;r++)n[r]=e.get(r);return o=k(n),i=new Float32Array(o).fill(this.tensor.get(0)),[2,[new $(n,i,this.tensor.type)]]}throw new Error("ConstantOfShape not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return"ConstantOfShape"},e.prototype.delete=function(){void 0!==this.tensor&&this.tensor.delete()},e}($r),ti=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ei=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"Div",a)||this}return ti(e,t),e.prototype.compute=function(t,e){return t.divide(e)},e}(Oo),ni=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ri=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"Exp",a)||this}return ni(e,t),e.prototype.compute=function(t){return t.exp()},e}(Uo),oi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ii=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},ai=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},si=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,a)||this}return oi(e,t),e.prototype.forward=function(t){return ii(this,void 0,void 0,(function(){var e,n,r,o;return ai(this,(function(i){if(this.onnxVersion<13){if(e=t[0],!((n=t[1])instanceof $))throw new Error("Expand needs cpu tensor as shape tensor");for(r=new Array(n.size),o=0;o<n.size;o++)r[o]=n.get(o);return[2,[e.expand(r)]]}throw new Error("Expand not yet implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return"Expand"},e.prototype.delete=function(){},e}($r),ui=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pi=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"Floor",a)||this}return ui(e,t),e.prototype.compute=function(t){return t.floor()},e}(Uo),ci=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),hi=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},li=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},fi=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.axis=s.getAttributeInt("axis")||0,s}return ci(e,t),e.prototype.forward=function(t){return hi(this,void 0,void 0,(function(){var e,n;return li(this,(function(r){if(e=t[0],!((n=t[1])instanceof $))throw new Error("Gather requires CPU tensor for the indices");return[2,[e.gather(this.axis,n)]]}))}))},e.prototype.getType=function(){return"Gather"},e.prototype.delete=function(){},e}($r),di=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yi=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},vi=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},mi=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;s.alpha=s.getAttributeFloat("alpha")||1,s.beta=s.getAttributeFloat("beta")||1;var u=s.getAttributeInt("transA"),p=s.getAttributeInt("transB");return s.transA=1===u,s.transB=1===p,s}return di(e,t),e.prototype.forward=function(t){return yi(this,void 0,void 0,(function(){var e,n,r;return vi(this,(function(o){if(this.onnxVersion>=9&&this.onnxVersion<11)return e=t[0],n=t[1],r=t[2],[2,[e.gemm(n,this.transA,this.transB,this.alpha,r,this.beta)]];throw new Error("Gemm is not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return"Gemm"},e.prototype.delete=function(){},e}($r),gi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wi=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},bi=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},xi=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},_i=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.epsilon=s.getAttributeFloat("epsilon")||1e-5,s}return gi(e,t),e.prototype.defaultForward=function(t){return wi(this,void 0,void 0,(function(){var e,n,r,o,i,a,s,u,p,c,h,l;return bi(this,(function(f){for(e=t[0],n=t[1],r=t[2],o=e.getShape().length-2,i=n.getShape()[0],a=xi([1,i],new Array(o).fill(1)),n=n.reshape(a,!1),r=r.reshape(a,!1),s=new Array(e.getShape().length-2),u=0;u<o;u++)s[u]=u+2;return p=e.reduceMean(s,!0),at.flush(),c=e.subtract(p),at.flush(),h=c.reduceMeanSquare(s,!0),at.flush(),l=e.normalize(p,h,this.epsilon,n,r),p.delete(),c.delete(),h.delete(),[2,[l]]}))}))},e.prototype.forward=function(t){return wi(this,void 0,void 0,(function(){return bi(this,(function(e){return[2,this.defaultForward(t)]}))}))},e.prototype.getType=function(){return"InstanceNormalization"},e.prototype.delete=function(){},e}($r),Oi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ki=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Ai=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Si=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,a)||this}return Oi(e,t),e.prototype.forward=function(t){return ki(this,void 0,void 0,(function(){var e,n;return Ai(this,(function(r){if(e=t[0],n=t[1],this.onnxVersion<13&&this.onnxVersion>=9){if(e.getShape().length!==n.getShape().length)throw new Error("Automatic broadcasting in MatMul not supported yet");return[2,[e.gemm(n)]]}throw new Error("Matmul with onnx version "+this.onnxVersion+" not yet implemented")}))}))},e.prototype.getType=function(){return"MatMul"},e.prototype.delete=function(){},e}($r),Pi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ji=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"Mul",a)||this}return Pi(e,t),e.prototype.compute=function(t,e){return t.multiply(e)},e}(Oo),Ii=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Mi=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Vi=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Ti=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.padMode=s.getAttributeString("mode")||"constant",s.pads=s.getAttributeInts("pads"),s.value=s.getAttributeFloat("value")||0,s}return Ii(e,t),e.prototype.forward=function(t){return Mi(this,void 0,void 0,(function(){return Vi(this,(function(e){if(this.onnxVersion<11)return[2,[t[0].pad(this.pads,this.padMode,this.value)]];throw new Error("Pad not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return"Pad"},e.prototype.delete=function(){},e}($r),Ci=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xi=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Gi=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Ri=function(t){function e(e,n,r,o,i,a,s){var u=t.call(this,e,n,r,o,i,s)||this;u.axes=u.getAttributeInts("axes");var p=u.getAttributeInt("keepdims");return u.keepDims=1===p||void 0===p,u.name=a,u}return Ci(e,t),e.prototype.getAxes=function(t){if(void 0!==this.axes)return this.axes;for(var e=t.getShape().length,n=new Array(e),r=0;r<e;r++)n[r]=r;return n},e.prototype.forward=function(t){return Xi(this,void 0,void 0,(function(){return Gi(this,(function(e){if(this.onnxVersion<11)return[2,[this.calc(t[0])]];throw new Error(this.name+" is not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return this.name},e.prototype.delete=function(){},e}($r),Ei=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Di=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"ReduceMax",a)||this}return Ei(e,t),e.prototype.calc=function(t){return t.max(this.axes,this.keepDims)},e}(Ri),Ui=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bi=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"ReduceMean",a)||this}return Ui(e,t),e.prototype.calc=function(t){return t.reduceMean(this.axes,this.keepDims)},e}(Ri),zi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wi=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"ReduceSum",a)||this}return zi(e,t),e.prototype.calc=function(t){return t.sum(this.axes,this.keepDims)},e}(Ri),Fi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ni=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"ReduceSumSquare",a)||this}return Fi(e,t),e.prototype.calc=function(t){return t.sumSquare(this.axes,this.keepDims)},e}(Ri),Li=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qi=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.max=void 0,s.min=0,s}return Li(e,t),e.prototype.getType=function(){return"Relu"},e}(Lo),Hi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yi=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Ji=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Ki=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,a)||this}return Hi(e,t),e.prototype.forward=function(t){return Yi(this,void 0,void 0,(function(){var e,n,r,o;return Ji(this,(function(i){if(e=t[0],!((n=t[1])instanceof $))throw new Error("Reshape only works with CPU tensor as shape tensor");if(this.onnxVersion<13){for(r=new Array(n.size),o=0;o<n.size;o++)r[o]=n.get(o);return[2,[e.reshape(r)]]}throw new Error("Reshape with onnx version "+this.onnxVersion+" not yet implemented")}))}))},e.prototype.getType=function(){return"Reshape"},e.prototype.delete=function(){},e}($r),Qi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zi=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},$i=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ta=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},ea=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,a)||this}return Qi(e,t),e.prototype.forward=function(t){return Zi(this,void 0,void 0,(function(){var e,n;return $i(this,(function(r){if(this.onnxVersion<13)return e=t[0],n=e.getShape(),[2,[new $([n.length],ta(n),"int")]];throw new Error("Shape not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return"Shape"},e.prototype.delete=function(){},e}($r),na=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ra=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},oa=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ia=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.axes=s.getAttributeInts("axes"),s.starts=s.getAttributeInts("starts"),s.ends=s.getAttributeInts("ends"),s}return na(e,t),e.prototype.forward=function(t){return ra(this,void 0,void 0,(function(){return oa(this,(function(e){if(this.onnxVersion<11)return[2,[t[0].slice(this.starts,this.ends,this.axes)]];throw new Error("Slice not implemented for onnx version "+this.onnxVersion)}))}))},e.prototype.getType=function(){return"Slice"},e.prototype.delete=function(){},e}($r),aa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),sa=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},ua=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},pa=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.axis=s.getAttributeInt("axis"),s}return aa(e,t),e.prototype.defaultForward=function(t){return sa(this,void 0,void 0,(function(){var e,n,r,o,i,a,s,u,p,c;return ua(this,(function(h){return e=t[0],n=e.getShape(),void 0===(r=this.axis)&&(r=this.onnxVersion<13?1:n.length-1),o=n.slice(0,r).reduce((function(t,e){return t*e}),1),i=e.reshape([o,-1],!1),a=i.max(1,!0),s=i.subtract(a),u=s.exp(),p=u.sum(1,!0),c=u.divide(p),a.delete(),s.delete(),u.delete(),p.delete(),[2,[c.reshape(n,!1)]]}))}))},e.prototype.forward=function(t){return sa(this,void 0,void 0,(function(){return ua(this,(function(e){return[2,this.defaultForward(t)]}))}))},e.prototype.getType=function(){return"Softmax"},e.prototype.delete=function(){},e}($r),ca=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ha=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,"Sub",a)||this}return ca(e,t),e.prototype.compute=function(t,e){return t.subtract(e)},e}(Oo),la=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fa=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},da=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},ya=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,a)||this}return la(e,t),e.prototype.forward=function(t){return fa(this,void 0,void 0,(function(){var e,n,r,o;return da(this,(function(i){if(e=t[0],!((n=t[1])instanceof $))throw new Error("Tile only works with CPU tensor as repeats");if(this.onnxVersion<13&&this.onnxVersion>=6){for(r=new Array(n.size),o=0;o<n.size;o++)r[o]=n.get(o);return[2,[e.repeat(r)]]}throw new Error("Tile with onnx version "+this.onnxVersion+" not yet implemented")}))}))},e.prototype.getType=function(){return"Tile"},e.prototype.delete=function(){},e}($r),va=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ma=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},ga=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},wa=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return s.permutation=s.getAttributeInts("perm"),s}return va(e,t),e.prototype.forward=function(t){return ma(this,void 0,void 0,(function(){return ga(this,(function(e){return[2,[t[0].transpose(this.permutation)]]}))}))},e.prototype.getType=function(){return"Transpose"},e.prototype.delete=function(){},e}($r),ba=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xa=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},_a=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Oa=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;return i<13&&(s.axes=s.getAttributeInts("axes")),s}return ba(e,t),e.prototype.forward=function(t){return xa(this,void 0,void 0,(function(){var e,n,r,o,i;return _a(this,(function(a){if(e=t[0],this.onnxVersion<13&&void 0!==this.axes){for(n=e.getShape(),r=[],o=0,i=0;i<n.length;i++)o<this.axes.length&&this.axes[o]===i&&(r.push(1),o++),r.push(n[i]);return this.axes[this.axes.length-1]===n.length&&r.push(1),[2,[e.reshape(r)]]}throw new Error("Unsqueeze with onnx version "+this.onnxVersion+" not yet implemented")}))}))},e.prototype.getType=function(){return"Unsqueeze"},e.prototype.delete=function(){},e}($r),ka=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Aa=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Sa=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Pa=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,o,i,a)||this;if(s.sampleMode=s.getAttributeString("mode"),"nearest"!==s.sampleMode)throw new Error("Upsampling only supported with nearest neighbor sampling");return s}return ka(e,t),e.prototype.getScales=function(t){return Aa(this,void 0,void 0,(function(){var e,n,r;return Sa(this,(function(o){switch(o.label){case 0:return t instanceof $?[3,2]:(console.warn("Scales tensor for upsample not on CPU, need to transfer!"),[4,Br(t)]);case 1:t=o.sent(),o.label=2;case 2:for(e=t,n=new Array(e.size),r=0;r<e.size;r++)n[r]=e.get(r);return[2,n]}}))}))},e.prototype.forward=function(t){return Aa(this,void 0,void 0,(function(){var e,n,r;return Sa(this,(function(o){switch(o.label){case 0:return e=t[0],n=t[1],[4,this.getScales(n)];case 1:return r=o.sent(),[2,[e.upsample(r)]]}}))}))},e.prototype.getType=function(){return"Upsample"},e.prototype.delete=function(){},e}($r),ja=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ia=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Ma=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Va=function(t){function e(e,n,r,o,i,a){return t.call(this,e,n,r,o,i,a)||this}return ja(e,t),e.prototype.forward=function(t){return Ia(this,void 0,void 0,(function(){var e,n,r;return Ma(this,(function(o){for(e=t[0],n=new Array(e.getShape().length-2),r=0;r<e.getShape().length-2;r++)n[r]=r+2;return[2,[e.reduceMean(n,!0)]]}))}))},e.prototype.getType=function(){return"GlobalAveragePool"},e.prototype.delete=function(){},e}($r),Ta={Conv:function(t,e,n,r,o,i){return new uo(t,e,n,r,o,i)},BatchNormalization:function(t,e,n,r,o,i){return new Mo(t,e,n,r,o,i)},Clip:function(t,e,n,r,o,i){return new Lo(t,e,n,r,o,i)},Add:function(t,e,n,r,o,i){return new Ao(t,e,n,r,o,i)},ReduceMean:function(t,e,n,r,o,i){return new Bi(t,e,n,r,o,i)},Gemm:function(t,e,n,r,o,i){return new mi(t,e,n,r,o,i)},Constant:function(t,e,n,r,o,i){return new oo(t,e,n,r,o,i)},Reshape:function(t,e,n,r,o,i){return new Ki(t,e,n,r,o,i)},Tile:function(t,e,n,r,o,i){return new ya(t,e,n,r,o,i)},MatMul:function(t,e,n,r,o,i){return new Si(t,e,n,r,o,i)},Exp:function(t,e,n,r,o,i){return new ri(t,e,n,r,o,i)},ReduceSum:function(t,e,n,r,o,i){return new Wi(t,e,n,r,o,i)},ReduceMax:function(t,e,n,r,o,i){return new Di(t,e,n,r,o,i)},ReduceSumSquare:function(t,e,n,r,o,i){return new Ni(t,e,n,r,o,i)},Sub:function(t,e,n,r,o,i){return new ha(t,e,n,r,o,i)},Mul:function(t,e,n,r,o,i){return new ji(t,e,n,r,o,i)},Div:function(t,e,n,r,o,i){return new ei(t,e,n,r,o,i)},Unsqueeze:function(t,e,n,r,o,i){return new Oa(t,e,n,r,o,i)},Concat:function(t,e,n,r,o,i){return new Jo(t,e,n,r,o,i)},ConstantOfShape:function(t,e,n,r,o,i){return new $o(t,e,n,r,o,i)},Expand:function(t,e,n,r,o,i){return new si(t,e,n,r,o,i)},InstanceNormalization:function(t,e,n,r,o,i){return new _i(t,e,n,r,o,i)},Pad:function(t,e,n,r,o,i){return new Ti(t,e,n,r,o,i)},Relu:function(t,e,n,r,o,i){return new qi(t,e,n,r,o,i)},Shape:function(t,e,n,r,o,i){return new ea(t,e,n,r,o,i)},Gather:function(t,e,n,r,o,i){return new fi(t,e,n,r,o,i)},Cast:function(t,e,n,r,o,i){return new Go(t,e,n,r,o,i)},Floor:function(t,e,n,r,o,i){return new pi(t,e,n,r,o,i)},Ceil:function(t,e,n,r,o,i){return new zo(t,e,n,r,o,i)},Slice:function(t,e,n,r,o,i){return new ia(t,e,n,r,o,i)},Upsample:function(t,e,n,r,o,i){return new Pa(t,e,n,r,o,i)},Transpose:function(t,e,n,r,o,i){return new wa(t,e,n,r,o,i)},Softmax:function(t,e,n,r,o,i){return new pa(t,e,n,r,o,i)},GlobalAveragePool:function(t,e,n,r,o,i){return new Va(t,e,n,r,o,i)}},Ca=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xa=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Ga=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Ra=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},Ea=function(t){function e(e,n){var r,o=t.call(this)||this;o.inputSet=new Set,o.nodes={},o.nodeIds=[],o.defaultReady=[],o.intermediaries={},o.constants={},o.nodeIdCounter=1e4,void 0===n&&(n={}),o.noConvertConstants=new Set(void 0!==n.noConvertConstants?n.noConvertConstants:[]),o.noConvertNodes=new Set(void 0!==n.noConvertNodes?n.noConvertNodes:[]),o.mode=n.mode||"inference",o.precision=n.precision||32,r=e instanceof ArrayBuffer?new Uint8Array(e):e,o.modelProto=qr.onnx.ModelProto.decode(r);var i=o.modelProto.opsetImport[0].version;Lr.a.isLong(i)&&(i=i.toNumber()),o.version=i,o.inputs=o.modelProto.graph.input;for(var a=0;a<o.inputs.length;a++)o.inputSet.add(o.inputs[a].name);return o.outputs=o.modelProto.graph.output.map((function(t){return t.name})),o.initializer(o.modelProto.graph.initializer),o.initNodes(o.modelProto),o}return Ca(e,t),e.prototype.initNodes=function(t){for(var e=this,n=0;n<t.graph.node.length;n++){var r=t.graph.node[n],o=Ta[r.opType];if(void 0===o)throw new Error("Node operator "+r.opType+" can not be resolved");var i=r.attribute||[],a=r.input||[],s=o(i,a,r.output||[],this.constants,this.version,this.mode);this.nodes[n]=s,this.nodeIds.push(n);for(var u=0;u<a.length;u++){var p=a[u];void 0===this.intermediaries[p]&&(this.intermediaries[p]={to:[],deletable:!0}),this.intermediaries[p].to.push(n)}0===s.variableInputs&&this.defaultReady.push(n),"Constant"===r.opType&&(void 0===this.intermediaries[r.output[0]]?this.intermediaries[r.output[0]]={to:[],deletable:!1}:this.intermediaries[r.output[0]].deletable=!1)}for(var c=0,h=this.nodeIds;c<h.length;c++){var l=h[c];this.nodes[l].initialize((function(t){return e.resolveConstant(t)}))}},e.prototype.initializer=function(t){for(var e=0;e<t.length;e++){var n=t[e],r=to(n);"train"===this.mode&&(r=new Er(r)),this.constants[n.name]=r}},e.prototype.forward=function(t,e){return Xa(this,void 0,void 0,(function(){var n,r,o,i,a,s,u,p,c,h,l,f,d,y,v=this;return Ga(this,(function(m){switch(m.label){case 0:for(n={},r={},o=0,i=this.nodeIds;o<i.length;o++)y=i[o],r[y]={variableInputs:0};a=Ra(this.defaultReady),this.initializeForward(t,n,r,a),m.label=1;case 1:if(!(a.length>0))return[3,8];s=a.shift(),u=this.nodes[s],p=this.getInputsToNode(u,n),c=p.inputs,h=p.toDelete,l=void 0,m.label=2;case 2:return m.trys.push([2,4,,5]),[4,u.forward(c)];case 3:return l=m.sent(),[3,5];case 4:throw f=m.sent(),console.error("Error occurred in node "+s+" with inputs "+u.inputs+" from nodes "+u.inputs.map((function(t){return v.getNodeWithOutput(t)}))),f;case 5:for(at.flush(),this.propagateResults(u,n,l,r,a),y=0;y<h.length;y++)this.inputSet.has(h[y])||(n[h[y]].value.delete(),delete n[h[y]]);return void 0===e?[3,7]:[4,new Promise((function(t){setTimeout(t,e)}))];case 6:m.sent(),m.label=7;case 7:return[3,1];case 8:for(d=[],y=0;y<this.outputs.length;y++)d.push(n[this.outputs[y]].value);return[2,d]}}))}))},e.prototype.initializeForward=function(t,e,n,r){for(var o=0;o<t.length;o++){e[this.inputs[o].name]={value:t[o],used:0};for(var i=this.intermediaries[this.inputs[o].name],a=0;a<i.to.length;a++){var s=i.to[a];n[s].variableInputs++,n[s].variableInputs===this.nodes[s].variableInputs&&(r.push(s),delete n[s])}}},e.prototype.getInputsToNode=function(t,e){for(var n=[],r=[],o=0;o<t.inputs.length;o++){var i=t.inputs[o];if(void 0!==this.constants[i])n.push(this.constants[i]);else{var a=e[i];a.used++,a.used>=this.intermediaries[i].to.length&&this.intermediaries[i].deletable&&r.push(i),n.push(a.value)}}return{inputs:n,toDelete:r}},e.prototype.propagateResults=function(t,e,n,r,o){for(var i=0;i<t.outputs.length;i++){var a=t.outputs[i];e[a]={value:n[i],used:0};var s=this.intermediaries[a];if(void 0!==s)for(var u=0;u<s.to.length;u++){var p=s.to[u];r[p].variableInputs++,r[p].variableInputs===this.nodes[p].variableInputs&&(o.push(p),delete r[p])}}},e.prototype.toCPU=function(){return Xa(this,void 0,void 0,(function(){var t,e,n,r,o,i,a,s;return Ga(this,(function(u){switch(u.label){case 0:for(e in t=[],this.constants)t.push(e);n=0,u.label=1;case 1:return n<t.length?(s=t[n],this.noConvertConstants.has(s)?[3,3]:(r=this.constants,o=s,[4,Br(this.constants[s])])):[3,4];case 2:r[o]=u.sent(),u.label=3;case 3:return n++,[3,1];case 4:i=0,a=this.nodeIds,u.label=5;case 5:return i<a.length?(s=a[i],this.noConvertNodes.has(s)?[3,7]:[4,this.nodes[s].toCPU()]):[3,8];case 6:u.sent(),u.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},e.prototype.toWASM=function(){return Xa(this,void 0,void 0,(function(){var t,e,n,r,o,i,a,s;return Ga(this,(function(u){switch(u.label){case 0:for(e in t=[],this.constants)t.push(e);n=0,u.label=1;case 1:return n<t.length?(s=t[n],this.noConvertConstants.has(s)?[3,3]:(r=this.constants,o=s,[4,zr(this.constants[s])])):[3,4];case 2:r[o]=u.sent(),u.label=3;case 3:return n++,[3,1];case 4:i=0,a=this.nodeIds,u.label=5;case 5:return i<a.length?(s=a[i],this.noConvertNodes.has(s)?[3,7]:[4,this.nodes[s].toWASM()]):[3,8];case 6:u.sent(),u.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},e.prototype.toGPU=function(){return Xa(this,void 0,void 0,(function(){var t,e,n,r,o,i,a,s;return Ga(this,(function(u){switch(u.label){case 0:for(e in t=[],this.constants)t.push(e);n=0,u.label=1;case 1:return n<t.length?(s=t[n],this.noConvertConstants.has(s)?[3,3]:(r=this.constants,o=s,[4,Wr(this.constants[s],this.precision)])):[3,4];case 2:r[o]=u.sent(),u.label=3;case 3:return n++,[3,1];case 4:i=0,a=this.nodeIds,u.label=5;case 5:return i<a.length?(s=a[i],this.noConvertNodes.has(s)?[3,7]:[4,this.nodes[s].toGPU(this.precision)]):[3,8];case 6:u.sent(),u.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},e.prototype.optimize=function(){for(var t=this,e=0,n=wo;e<n.length;e++)for(var r=n[e],o=0,i=r.findApplications(this);o<i.length;o++){for(var a=i[o],s=a.map((function(e){return t.nodes[e]})),u=r.apply(s,(function(e){return t.resolveConstant(e)}),this.constants,this.version),p=new Set(u.outputs),c=0,h=a;c<h.length;c++){var l=h[c];this.removeNode(l,p)}this.insertNode(u)}this.prune()},e.prototype.prune=function(t){for(var e=this;;){var n=this.pruneIntermediaries(t);if(t=[],!(n.size>0))break;n.forEach((function(n){var r=e.removeNode(n,new Set);t=null===t||void 0===t?void 0:t.concat(r)}))}},e.prototype.pruneIntermediaries=function(t){var e=new Set;void 0===t&&(t=[]);for(var n=0;n<t.length;n++){var r=t[n],o=this.getNodeWithOutput(r);void 0!==o&&e.add(o);var i=this.getNodeWithInput(r);void 0!==i&&e.add(i)}var a=function(n){if(0===s.intermediaries[n].to.length&&void 0===s.outputs.find((function(t){return t===n}))){t.push(n);var r=s.getNodeWithOutput(n);void 0!==r&&e.add(r);var o=s.getNodeWithInput(n);void 0!==o&&e.add(o)}},s=this;for(var r in this.intermediaries)a(r);for(var u=0,p=t;u<p.length;u++){r=p[u];delete this.intermediaries[r]}return e},e.prototype.removeNode=function(t,e){for(var n=this.nodes[t],r=0,o=n.inputs;r<o.length;r++){var i=o[r];void 0!==this.intermediaries[i]&&(this.intermediaries[i].to=this.intermediaries[i].to.filter((function(e){return e.toString()!==t.toString()})))}var a=[];return e.has(n.outputs[0])||a.push(n.outputs[0]),this.nodeIds=this.nodeIds.filter((function(e){return e.toString()!==t.toString()})),this.nodes[t].delete(),delete this.nodes[t],this.defaultReady=this.defaultReady.filter((function(e){return e!==t})),a},e.prototype.insertNode=function(t){var e=this.nodeIdCounter++;this.nodeIds.push(e),this.nodes[e]=t;for(var n=0,r=t.inputs;n<r.length;n++){var o=r[n];this.intermediaries[o].to.push(e)}},e.prototype.getNodeWithOutput=function(t){for(var e=0,n=this.nodeIds;e<n.length;e++){var r=n[e];if(-1!==this.nodes[r].outputs.findIndex((function(e){return e===t})))return r}},e.prototype.getNodeWithInput=function(t){for(var e=0,n=this.nodeIds;e<n.length;e++){var r=n[e];if(-1!==this.nodes[r].inputs.findIndex((function(e){return e===t})))return r}},e.prototype.resolveConstant=function(t){if(void 0!==this.constants[t])return this.constants[t];var e=this.getNodeWithOutput(t),n=this.nodes[e];return n instanceof oo?n.tensor:void 0},e.prototype.getNodes=function(){return this.nodes},e.prototype.delete=function(){for(var t in this.constants)this.constants[t].delete();for(var e=0,n=this.nodeIds;e<n.length;e++){var r=n[e];this.nodes[r].delete()}},e.prototype.getSubModules=function(){for(var e=t.prototype.getSubModules.call(this),n=0,r=this.nodeIds;n<r.length;n++){var o=r[n];e.push(this.nodes[o])}return e},e.prototype.getParameters=function(){var e=t.prototype.getParameters.call(this);for(var n in this.constants)this.constants[n]instanceof Er&&e.push(this.constants[n]);return e},e}(Jr),Da=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ua=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(e){i(e)}}function s(t){try{u(r.throw(t))}catch(e){i(e)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Ba=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},za=function(t){function e(e,n,r){var o=t.call(this)||this;r=void 0===r||r;var i=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=1);for(var r=[],o=0;o<t;o+=2){var i=it(),a=i[0],s=i[1];r.push(a*n+e),o<t-1&&r.push(s*n+e)}return r}(e*n,0,2/(e+n)),a=new $([e,n],i);if(o.weights=new Er(a),r){var s=new Array(n).fill(0),u=new $([1,n],s);o.bias=new Er(u)}return o}return Da(e,t),e.prototype.forward=function(t){return Ua(this,void 0,void 0,(function(){return Ba(this,(function(e){return[2,[t[0].gemm(this.weights,!1,!1,1,this.bias)]]}))}))},e}(Jr),Wa=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Da(e,t),e.prototype.forward=function(t){return Ua(this,void 0,void 0,(function(){return Ba(this,(function(e){return[2,[t[0].clip(0)]]}))}))}}(Jr),function(t){function e(e){var n=t.call(this)||this;return n.modules=e,n}Da(e,t),e.prototype.forward=function(t){return Ua(this,void 0,void 0,(function(){var e,n,r,o;return Ba(this,(function(i){switch(i.label){case 0:e=t,n=0,i.label=1;case 1:return n<this.modules.length?(r=e,[4,this.modules[n].forward(e)]):[3,4];case 2:if(e=i.sent(),"inference"===this.mode&&n>0)for(o=0;o<r.length;o++)r[o].delete();i.label=3;case 3:return n++,[3,1];case 4:return[2,e]}}))}))},e.prototype.getSubModules=function(){return t.prototype.getSubModules.call(this).concat(this.modules)}}(Jr),function(t){function e(e){void 0===e&&(e={});var n=t.call(this)||this;return n.modules=e,n}Da(e,t),e.prototype.forward=function(t){return Ua(this,void 0,void 0,(function(){return Ba(this,(function(t){throw new Error("Module dict does not support forward")}))}))},e.prototype.getSubModules=function(){var t=[];for(var e in this.modules)t.push(this.modules[e]);return t},e.prototype.get=function(t){return this.modules[t]},e.prototype.set=function(t,e){this.modules[t]=e}}(Jr),function(t){function e(e){void 0===e&&(e=[]);var n=t.call(this)||this;return n.modules=e,n}Da(e,t),e.prototype.forward=function(t){return Ua(this,void 0,void 0,(function(){return Ba(this,(function(t){throw new Error("Module list does not support forward")}))}))},e.prototype.getSubModules=function(){return this.modules},e.prototype.get=function(t){return this.modules[t]},e.prototype.set=function(t,e){this.modules[t]=e},e.prototype.push=function(t){this.modules.push(t)},e.prototype.pop=function(){return this.modules.pop()}}(Jr),function(){function t(t){this.model=t,this.parameters=t.getParameters()}return t.prototype.zeroGrads=function(){for(var t=0,e=this.parameters;t<e.length;t++){var n=e[t];void 0!==n.grad&&(n.grad.delete(),n.grad=void 0)}},t}()),Fa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Na=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return Fa(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("beta1")+" float beta1;\n    "+this.getVarModifier("beta2")+" float beta2;\n    "+this.getVarModifier("t")+" int t;\n    "},e.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      float m1 = getValueAtPos(pos, widthMoments, heightMoments, Moments);\n      float m2 = getValueAtPos(pos+2, widthMoments, heightMoments, Moments);\n      float grad = getValueAtPos(pos/4, widthGrad, heightGrad, Grad);\n\n      m1 = beta1*m1 + (1.0-beta1)*grad;\n      m2 = beta2*m2 + (1.0-beta2)*grad*grad;\n\n      float m1Corr = m1/(1.0-pow(beta1, float(t)));\n      float m2Corr = m2/(1.0-pow(beta2, float(t)));\n\n      gl_FragColor = vec4(m1,m1Corr,m2,m2Corr);\n    }\n    "},e.prototype.getTextureNames=function(){return["Grad","Moments"]},e.prototype.getUniformAttrs=function(){return[{name:"beta1",type:"float"},{name:"beta2",type:"float"},{name:"t",type:"int"}]},e.prototype.calc=function(t){return this.compute(t.Moments.shape,{Grad:t.Grad,Moments:t.Moments},{beta1:t.beta1,beta2:t.beta2,t:t.t})},e.prototype.getOutputShape=function(t){return t.Moments.shape},e.prototype.compile=function(e,n){void 0!==e.shapeMoments&&(this.maxRank=e.shapeMoments.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeGrad:t.Grad.shape,widthGrad:t.Grad.memory.width,heightGrad:t.Grad.memory.height,shapeMoments:t.Moments.shape,widthMoments:t.Moments.memory.width,heightMoments:t.Moments.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,beta1:t.beta1,beta2:t.beta2}},e.prototype.getInputInfoString=function(t){return t.Grad.shape+"-"+t.Moments.shape+"-"+t.beta1+"-"+t.beta2},e}(ft),La=new Le((function(){return new Na(ln)})),qa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ha=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.maxIterations=1e6,r}return qa(e,t),e.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("epsilon")+" float epsilon;\n    "},e.prototype.getFragmentShader=function(t){return"\n    float newVal(float m1Corr, float m2Corr, float value) {\n      return value - alpha*(m1Corr/(sqrt(m2Corr)+epsilon));\n    }\n\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      vec4 result = vec4(0,0,0,0);\n\n      float m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      float m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      float value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.r = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.g = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.b = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.a = newVal(m1Corr, m2Corr, value);\n\n\n      gl_FragColor = result;\n    }\n    "},e.prototype.getTextureNames=function(){return["Value","Moments"]},e.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"},{name:"epsilon",type:"float"}]},e.prototype.calc=function(t){return this.compute(t.Value.shape,{Value:t.Value,Moments:t.Moments},{alpha:t.alpha,epsilon:t.epsilon})},e.prototype.getOutputShape=function(t){return t.Value.shape},e.prototype.compile=function(e,n){void 0!==e.shapeMoments&&(this.maxRank=e.shapeMoments.length),t.prototype.compile.call(this,e,n)},e.prototype.getCompilationInfo=function(t,e){var n=this.getOutputShape(t),r=ut.getAllocationDimensions(k(n),e);return{shapeValue:t.Value.shape,widthValue:t.Value.memory.width,heightValue:t.Value.memory.height,shapeMoments:t.Moments.shape,widthMoments:t.Moments.memory.width,heightMoments:t.Moments.memory.height,shapeOutput:n,widthOutput:r.width,heightOutput:r.height,alpha:t.alpha,epsilon:t.epsilon}},e.prototype.getInputInfoString=function(t){return t.Value.shape+"-"+t.Moments.shape+"-"+t.alpha+"-"+t.epsilon},e}(ft),Ya=new Le((function(){return new Ha(ln)})),Ja=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ka=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r},Qa=function(t){function e(e,n,r,o,i){void 0===n&&(n=.001),void 0===r&&(r=.9),void 0===o&&(o=.999),void 0===i&&(i=1e-7);var a=t.call(this,e)||this;a.lr=n,a.beta1=r,a.beta2=o,a.epsilon=i,a.t=0;var s=a.parameters;if(s[0].value instanceof hn){a.moments=new Array(s.length);for(var u=0;u<s.length;u++)a.moments[u]=new hn(new Float32Array(4*s[u].value.size).fill(0),Ka(s[u].getShape(),[4]),s[u].value.precision)}else a.moment1=new Array(s.length).fill(void 0),a.moment2=new Array(s.length).fill(void 0);return a}return Ja(e,t),e.prototype.step=function(){if(this.t++,void 0!==this.moment1&&void 0!==this.moment2)for(var t=0;t<this.parameters.length;t++){if(void 0!==(a=this.parameters[t]).grad){var e=a.value,n=this.paramStep(a.value,a.grad,this.moment1[t],this.moment2[t]),r=n.newValue,o=n.moment1,i=n.moment2;a.value=r,this.moment1[t]=o,this.moment2[t]=i,e.delete()}}else if(void 0!==this.moments)for(t=0;t<this.parameters.length;t++){var a;if(void 0!==(a=this.parameters[t]).grad){e=a.value;var s=this.gpuParamStep(a.value,a.grad,this.moments[t]),u=(r=s.newValue,s.moments);a.value=r,this.moments[t]=u,e.delete()}}},e.prototype.updateMoments=function(t,e,n){var r,o;if(void 0===e)r=t.multiplyScalar(1-this.beta1);else{var i=e;r=e.add(t,this.beta1,1-this.beta1),i.delete()}if(void 0===n)o=t.multiply(t,1-this.beta2);else{var a=t.multiply(t),s=n;o=n.add(a,this.beta2,1-this.beta2),a.delete(),s.delete()}return{moment1New:r,moment2New:o}},e.prototype.getCorrectedMoments=function(t,e){return{correctMoment1:t.addMultiplyScalar(1/(1-Math.pow(this.beta1,this.t)),0),correctMoment2:e.addMultiplyScalar(1/(1-Math.pow(this.beta2,this.t)),0)}},e.prototype.paramStep=function(t,e,n,r){var o=this.updateMoments(e,n,r),i=o.moment1New,a=o.moment2New.addMultiplyScalar(1/(1-Math.pow(this.beta2,this.t)),this.epsilon),s=a.sqrt();a.delete();var u=i.divide(s,-this.lr/(1-Math.pow(this.beta1,this.t)));s.delete();var p=t.add(u);return u.delete(),{newValue:p,moment1:n,moment2:r}},e.prototype.gpuParamStep=function(t,e,n){var r=La.calc({Grad:e,Moments:n,beta1:this.beta1,beta2:this.beta2,t:this.t},t.precision);return n.delete(),{newValue:Ya.calc({Value:t,Moments:r,alpha:this.lr,epsilon:this.epsilon},t.precision),moments:r}},e}(Wa),Za=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){function e(e,n){void 0===n&&(n=.001);var r=t.call(this,e)||this;return r.lr=n,r}Za(e,t),e.prototype.step=function(){for(var t=0,e=this.parameters;t<e.length;t++){var n=e[t];if(void 0!==n.grad){var r=n.value;n.value=n.value.subtract(n.grad,1,this.lr),r.delete()}}}}(Wa);var $a=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ts=function(t){function e(e,n){return t.call(this,e,n)||this}return $a(e,t),e.prototype.getOp=function(t,e){return e+" == 1.0 ? -1.0/"+t+" : 1.0/(1.0-"+t+")"},e}(Pt),es=new Le((function(){return new ts(ln)})),ns=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.backward=function(t){var e,n,r;if(t instanceof $){var o=(n=this.x.value,r=this.y.value,R(n,r,(function(t,e){return 1===e?-1/t:1/(1-t)}),n.shape));e=t.multiply(o),o.delete()}else if(t instanceof ir){o=this.x.value.wasmTensor.bce_back(this.y.value.wasmTensor);e=new ir(t.wasmTensor.multiply(o,1)),o.free()}else{o=es.calc({A:this.x.value,B:this.y.value,outputShape:this.x.getShape()},this.x.value.precision);e=t.multiply(o),o.delete()}this.x.backward(e)||e.delete()},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete(),this.y.isLeaf()||this.y.delete()},t}();var rs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),os=function(t){function e(e,n){return t.call(this,e,n)||this}return rs(e,t),e.prototype.getOp=function(t,e){return e+" == 1.0 ? -log("+t+") : -log(1.0-"+t+")"},e}(Pt),is=new Le((function(){return new os(ln)}));function as(t,e){if(!Fr(t,e))throw new Error("BCE can only be computed for tensors of the same type");return t instanceof $&&e instanceof $?function(t,e){return R(t,e,(function(t,e){return 1===e?-Math.log(t):-Math.log(1-t)}),t.shape)}(t,e):t instanceof ir&&e instanceof ir?new ir(t.wasmTensor.bce(e.wasmTensor)):t instanceof hn&&e instanceof hn?is.calc({A:t,B:e,outputShape:t.getShape()},t.precision):new Er(as(t.value,e.value),{noGrad:t.noGrad,backEdge:t.noGrad?void 0:new ns(t,e)})}(function(){function t(t,e){this.model=t,this.gamma=e,this.parameters=t.getParameters()}t.prototype.getLoss=function(){for(var t=this.parameters[0].sumSquare(),e=this.gamma,n=1;n<this.parameters.length;n++)t=t.add(this.parameters[n].sumSquare(),e,this.gamma),e/=e;return t}})(),function(){function t(t,e){this.model=t,this.gamma=e,this.parameters=t.getParameters()}t.prototype.getLoss=function(){for(var t=this.parameters[0].abs().sum(),e=this.gamma,n=1;n<this.parameters.length;n++)t=t.add(this.parameters[n].abs().sum(),e,this.gamma),e/=e;return t}}();var ss=!1;function us(){return(us=Object(O.a)(g.a.mark((function t(e){var n,r,o;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ss){t.next=12;break}return ss=!0,t.next=4,fetch("models/".concat(e,".onnx"));case 4:return n=t.sent,t.next=7,n.arrayBuffer();case 7:return r=t.sent,o=new u.model.OnnxModel(r),t.next=11,o.toGPU();case 11:return t.abrupt("return",o);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var ps=n(122),cs=n(116),hs=n(89),ls=n(123),fs=n(125),ds=n(118),ys=n(119),vs=n(126),ms=n(120),gs=n(121),ws=n(124),bs=64,xs=64,_s=1280;function Os(t){return new Promise((function(e,n){setTimeout((function(){e()}),t)}))}function ks(t,e,n){return As.apply(this,arguments)}function As(){return(As=Object(O.a)(g.a.mark((function t(e,n,r){var o;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=0;case 1:if(!(o<e)){t.next=8;break}return r(e-o),t.next=5,Os(n);case 5:o++,t.next=1;break;case 8:r(0);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Ss=function(t){Object(x.a)(n,t);var e=Object(_.a)(n);function n(t){var r;return Object(w.a)(this,n),(r=e.call(this,t)).model=void 0,r.classifier=void 0,r.modelCompiled=!1,r.mean=void 0,r.varSqrt=void 0,r.meanMobilenet=new a.gpu.GPUTensor(new Float32Array([.485,.456,.406]),[3,1,1],16),r.stdMobilenet=new a.gpu.GPUTensor(new Float32Array([.229,.224,.225]),[3,1,1],16),r.data=new a.gpu.GPUTensor(new Float32Array(81920).fill(0),[xs,_s],32),r.trainingResultsCollected=0,r.videoTensor=void 0,r.start=Date.now().valueOf(),r.audio=void 0,r.numIts=0,r.state={stage:"start",numIterations:3,threshold:.5,sound:!0,notification:!1},r}return Object(b.a)(n,[{key:"componentWillMount",value:function(){var t=this;(function(t){return us.apply(this,arguments)})("mobilenet050").then((function(e){void 0!==e&&(t.model=e,t.getVideo())})),this.audio=new Audio("alerts/beep.wav")}},{key:"getVideo",value:function(){var t=Object(O.a)(g.a.mark((function t(){var e,n;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.querySelector("#videoElement"),!navigator.mediaDevices.getUserMedia){t.next=6;break}return t.next=4,navigator.mediaDevices.getUserMedia({video:{height:240,width:320}});case 4:n=t.sent,e.srcObject=n;case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"prepareVideo",value:function(){if(void 0!==this.videoTensor){var t=document.querySelector("#videoElement");this.videoTensor=a.gpu.GPUTensor.fromData(t,32);var e=this.videoTensor.shape.slice(0,2),n=Object(v.a)(e,2),r=n[0],o=n[1],i=this.videoTensor.slice([0],[3],[2]);this.videoTensor.delete();var s=i.transpose([2,0,1]);i.delete();var u=s.subtract(this.meanMobilenet);s.delete();var p=u.divide(this.stdMobilenet);return u.delete(),p.reshape([1,3,r,o],!1)}}},{key:"compileModel",value:function(){var t=Object(O.a)(g.a.mark((function t(){var e,n,r,o,i=this;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.querySelector("#videoElement"),this.videoTensor=a.gpu.GPUTensor.fromData(e,32),void 0===this.videoTensor||this.modelCompiled){t.next=14;break}return this.setState(Object(y.a)(Object(y.a)({},this.state),{},{stage:"compiling"})),this.modelCompiled=!0,o=this.prepareVideo(),void 0!==this.model&&(this.model.outputs=["472"],this.model.prune(["473"])),null===(n=this.model)||void 0===n||n.optimize(),console.log("Compiled"),console.log("Doing forward pass"),t.next=12,ks(3,1e3,(function(t){i.setState({countDown:t})}));case 12:this.setState({stage:"trainData-1",progress:0}),null===(r=this.model)||void 0===r||r.forward([o]).then((function(t){o.delete(),i.handleResult(t)}));case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"processResult",value:function(t){var e=t[0];return console.log(e),e}},{key:"handleResult",value:function(){var t=Object(O.a)(g.a.mark((function t(e){var n,r,o,i,a,s,u,p,c=this;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.processResult(e),r=this.data,this.data=this.data.setValues(n,[this.trainingResultsCollected,0]),n.delete(),r.delete(),this.trainingResultsCollected++,console.log("Collected ".concat(this.trainingResultsCollected," of ").concat(xs)),!(this.trainingResultsCollected<32)){t.next=15;break}return this.setState({progress:this.trainingResultsCollected/32*100}),t.next=11,Os(50);case 11:i=this.prepareVideo(),null===(o=this.model)||void 0===o||o.forward([i]).then((function(t){i.delete(),c.handleResult(t)})),t.next=37;break;case 15:if(32!==this.trainingResultsCollected){t.next=25;break}return console.log("Second batch"),this.setState({stage:"between-stages"}),t.next=20,ks(3,1e3,(function(t){c.setState({countDown:t})}));case 20:this.setState({stage:"trainData-2",progress:0}),s=this.prepareVideo(),null===(a=this.model)||void 0===a||a.forward([s]).then((function(t){s.delete(),c.handleResult(t)})),t.next=37;break;case 25:if(!(this.trainingResultsCollected<xs)){t.next=33;break}return this.setState({progress:100*(this.trainingResultsCollected/32-1)}),t.next=29,Os(50);case 29:p=this.prepareVideo(),null===(u=this.model)||void 0===u||u.forward([p]).then((function(t){p.delete(),c.handleResult(t)})),t.next=37;break;case 33:return this.setState(Object(y.a)(Object(y.a)({},this.state),{},{stage:"training",progress:0})),t.next=36,Os(50);case 36:this.trainClassifier();case 37:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"normalizeResults",value:function(){var t=Object(O.a)(g.a.mark((function t(e){var n,r,o;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.mean=e.reduceMean(0),n=e.subtract(this.mean),r=n.sumSquare(0),this.varSqrt=r.sqrt(),r.delete(),o=n.divide(this.varSqrt),n.delete(),t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"prepareData",value:function(){var t=Object(O.a)(g.a.mark((function t(){var e,n,r,o,i,a,s,u,p,c,h,l,f;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.data.slice([0],[32],[0]),n=this.data.slice([32],[64],[0]),r=e.concat(n,0),o=this.data.slice([32],[32],[0]),i=this.data.slice([64],[xs],[0]),a=o.concat(i,0),t.next=8,this.normalizeResults(r);case 8:return r=t.sent,s=a.subtract(this.mean),u=s.divide(this.varSqrt),a.delete(),s.delete(),a=u,p=new Er(r,{noGrad:!0}),c=[].concat(Object(d.a)(new Array(32).fill(0)),Object(d.a)(new Array(32).fill(1))),h=Er.create([bs,1],new Float32Array(c),"GPU",{noGrad:!0}),l=new Er(a,{noGrad:!0}),f=[].concat(Object(d.a)(new Array(0).fill(0)),Object(d.a)(new Array(0).fill(1))),t.abrupt("return",{trainX:p,trainYs:c,trainY:h,valX:l,valYs:f});case 20:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"trainClassifier",value:function(){var t=Object(O.a)(g.a.mark((function t(){var e,n,r,o,i,a,s,u,p,c,h,l,f,d,v,m,w,b,x,_,O=this;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.classifier=new za(_s,1,!0),t.next=3,this.classifier.toGPU(32);case 3:return t.next=5,this.prepareData();case 5:n=t.sent,r=n.trainX,o=n.trainYs,i=n.trainY,a=n.valX,s=n.valYs,u=new Qa(this.classifier),p=200,c=0;case 14:if(!(c<p)){t.next=56;break}return this.setState(Object(y.a)(Object(y.a)({},this.state),{},{progress:c/p*100})),t.next=18,Os(10);case 18:return t.next=20,this.classifier.forward([r]);case 20:if(h=t.sent[0],l=h.sigmoid(),f=as(l,i).reduceMean(),c%50!==0){t.next=49;break}return t.t0=console,t.t1=c,t.next=28,f.getValues();case 28:return t.t2=t.sent[0],t.t0.log.call(t.t0,t.t1,t.t2),t.t3=Array,t.next=33,l.getValues();case 33:return t.t4=t.sent,d=t.t3.from.call(t.t3,t.t4),v=this.getCorrect(d,o),console.log("".concat(v," of ").concat(d.length," predicted correctly")),t.next=39,this.classifier.forward([a]);case 39:return m=t.sent[0],w=m.sigmoid(),t.t5=Array,t.next=44,w.getValues();case 44:t.t6=t.sent,b=t.t5.from.call(t.t5,t.t6),x=this.getCorrect(b,s),console.log("".concat(x," of ").concat(b.length," predicted correctly")),w.delete();case 49:f.backward(),u.step(),f.delete(),u.zeroGrads();case 53:c++,t.next=14;break;case 56:return this.setState(Object(y.a)(Object(y.a)({},this.state),{},{stage:"monitoring",prediction:0})),t.next=59,Os(1e3);case 59:_=this.prepareVideo(),null===(e=this.model)||void 0===e||e.forward([_]).then((function(t){_.delete(),O.process(t)}));case 61:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"toggleNotification",value:function(t){var e=this;t?"denied"!==Notification.permission&&"granted"!==Notification.permission?Notification.requestPermission().then((function(t){"granted"===t&&(new Notification("I will notify you like this."),e.setState({notification:!0}))})):"granted"===Notification.permission&&this.setState({notification:!0}):this.setState({notification:!1})}},{key:"process",value:function(){var t=Object(O.a)(g.a.mark((function t(e){var n,r,o,i,a,s,u,p,c,h=this;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.processResult(e),o=r.subtract(this.mean),r.delete(),i=new Er(o.divide(this.varSqrt),{noGrad:!0}),o.delete(),t.next=7,this.classifier.forward([i]);case 7:return a=t.sent[0],i.delete(),t.next=11,a.getValues();case 11:return s=t.sent,a.delete(),u=1/(1+Math.exp(-s[0])),this.setState(Object(y.a)(Object(y.a)({},this.state),{},{prediction:u})),u>this.state.threshold?(this.numIts++,this.numIts===this.state.numIterations&&(this.state.sound&&(null===(p=this.audio)||void 0===p||p.play()),this.state.notification&&new Notification("Stop touching your face"))):this.numIts=0,t.next=18,Os(1e3);case 18:c=this.prepareVideo(),null===(n=this.model)||void 0===n||n.forward([c]).then((function(t){c.delete(),h.process(t)}));case 20:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getCorrect",value:function(t,e){for(var n=0,r=0;r<t.length;r++)(1===e[r]&&t[r]>.5||0===e[r]&&t[r]<.5)&&n++;return n}},{key:"render",value:function(){return Object(p.jsx)("div",{className:"App",children:Object(p.jsxs)(cs.a,{elevation:3,style:{padding:"10px"},children:[this.renderSettings(),Object(p.jsx)(hs.a,{variant:"h3",component:"h2",children:"Dont touch your face"}),"This app will teach you not to touch your face.",Object(p.jsx)("br",{}),Object(p.jsxs)("div",{className:"mainContent",children:[Object(p.jsx)("video",{autoPlay:!0,id:"videoElement"}),Object(p.jsx)("br",{}),this.renderState()]})]})})}},{key:"renderSettings",value:function(){var t=this;return Object(p.jsxs)(fs.a,{className:"settings",children:[Object(p.jsx)(ds.a,{"aria-controls":"panel1a-content",id:"panel1a-header",children:Object(p.jsx)(hs.a,{variant:"h5",children:"Settings"})}),Object(p.jsx)(ys.a,{children:Object(p.jsxs)(ms.a,{container:!0,spacing:1,children:[Object(p.jsxs)(ms.a,{item:!0,xs:12,children:[Object(p.jsx)(hs.a,{id:"slider-threshold-label",gutterBottom:!0,children:"Threshold"}),Object(p.jsx)("div",{})]}),Object(p.jsx)(ms.a,{item:!0,xs:12,children:Object(p.jsx)(vs.a,{"aria-labelledby":"slider-threshold-label",value:this.state.threshold,min:0,max:1,step:.1,onChange:function(e,n){return t.setState({threshold:n})},valueLabelDisplay:"auto"})}),Object(p.jsxs)(ms.a,{item:!0,xs:12,children:[Object(p.jsx)(hs.a,{id:"slider-threshold-label",gutterBottom:!0,children:"Seconds until alert"}),Object(p.jsx)("div",{})]}),Object(p.jsx)(ms.a,{item:!0,xs:12,children:Object(p.jsx)(vs.a,{"aria-labelledby":"slider-threshold-label",value:this.state.numIterations,min:1,max:10,step:1,onChange:function(e,n){return t.setState({numIterations:n})},valueLabelDisplay:"auto"})}),Object(p.jsx)(ms.a,{item:!0,xs:6,children:Object(p.jsx)(gs.a,{control:Object(p.jsx)(ws.a,{checked:this.state.sound,onChange:function(e){return t.setState({sound:e.target.checked})},name:"checkedB",color:"primary"}),label:"Play sound"})}),Object(p.jsx)(ms.a,{item:!0,xs:6,children:Object(p.jsx)(gs.a,{control:Object(p.jsx)(ws.a,{checked:this.state.notification,onChange:function(e){return t.toggleNotification(e.target.checked)},name:"checkedB",color:"primary"}),label:"Show notification"})})]})})]})}},{key:"renderState",value:function(){var t=this;if("start"===this.state.stage)return Object(p.jsx)(ps.a,{variant:"contained",color:"primary",onClick:function(){return t.compileModel()},children:"Start"});if("compiling"===this.state.stage)return Object(p.jsxs)(p.Fragment,{children:[" Dont touch your face until the bar is full. Starting in ",this.state.countDown," seconds. "]});if("trainData-1"===this.state.stage||"trainData-2"===this.state.stage)return Object(p.jsx)(ls.a,{variant:"determinate",value:this.state.progress,className:"progress"});if("between-stages"===this.state.stage)return Object(p.jsxs)(p.Fragment,{children:[" Next, touch your face until the bar is full. Starting in ",this.state.countDown," seconds. "]});if("training"===this.state.stage)return Object(p.jsxs)("div",{children:[" Done. Training face touch recognition model",Object(p.jsx)(ls.a,{variant:"indeterminate",className:"progress"})]});if("monitoring"===this.state.stage){var e=this.state.prediction,n="rgb(".concat(Math.round(200*e),",").concat(200-Math.round(200*e),",0)");return Object(p.jsxs)("div",{children:[" Done. I will alert you when i think you are touching your face",Object(p.jsx)("div",{style:{width:320,height:20,backgroundColor:"#AAA",borderRadius:5,overflow:"hidden",margin:"auto"},children:Object(p.jsx)("div",{style:{width:320*e,height:20,backgroundColor:n}})})]})}}}]),n}(h.a.Component),Ps=function(t){t&&t instanceof Function&&n.e(4).then(n.bind(null,131)).then((function(e){var n=e.getCLS,r=e.getFID,o=e.getFCP,i=e.getLCP,a=e.getTTFB;n(t),r(t),o(t),i(t),a(t)}))};f.a.render(Object(p.jsx)(h.a.StrictMode,{children:Object(p.jsx)(Ss,{})}),document.getElementById("root")),Ps()}},[[88,1,2]]]);
//# sourceMappingURL=main.80955726.chunk.js.map