(this.webpackJsonpstyle=this.webpackJsonpstyle||[]).push([[0],{23:function(t,n,e){},25:function(t,n,e){},42:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"CPUTensor",(function(){return K}));var o={};e.r(o),e.d(o,"GPUTensor",(function(){return Gn})),e.d(o,"gpuConstructor",(function(){return Wn}));var i={};e.r(i),e.d(i,"wasmLoaded",(function(){return je})),e.d(i,"WASMTensor",(function(){return Ie}));var a={};e.r(a),e.d(a,"cpu",(function(){return r})),e.d(a,"gpu",(function(){return o})),e.d(a,"wasm",(function(){return i}));var u={};e.r(u),e.d(u,"OnnxModel",(function(){return Oi}));var s={};e.r(s),e.d(s,"model",(function(){return u}));var p=e(0),c=e(4),f=e.n(c),h=e(10),l=e.n(h),y=(e(23),e(5)),d=e.n(y),v=e(6),m=e(1),g=e(15),w=e(11),b=e(12),x=e(17),_=e(16);e(25);function O(t){if(0===t.length)return 0;for(var n=1,e=0;e<t.length;e+=1)n*=t[e];return n}function A(t){var n=t.length;if(0===n)return[];if(1===n)return 1===t[0]?[0]:[1];var e=new Array(n);e[n-1]=1,1===t[n-1]&&(e[n-1]=0);for(var r=1,o=n-2;o>=0;o-=1)r=t[o+1]*r,1===t[o]?e[o]=0:e[o]=r;return e}function k(t,n,e){for(var r=0,o=0;o<t.length;o+=1){if(e&&(t[o]<0||t[o]>=e[o]&&1!==e[o]))throw new Error("Invalid index");r+=t[o]*n[o]}return r}function S(t,n){if(t.length!==n.length)return!1;for(var e=0;e<t.length;e+=1)if(t[e]!==n[e])return!1;return!0}function P(t,n){for(var e=t.length-1;e>=0&&(t[e]+=1,t[e]>=n[e]);e--)t[e]=0}var j=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},I=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},T=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},X=function(){function t(){}return t.prototype.compare=function(t,n){return j(this,void 0,void 0,(function(){var e,r,o;return I(this,(function(i){switch(i.label){case 0:return S(this.getShape(),t.getShape())?[4,this.getValues()]:[2,!1];case 1:return e=i.sent(),[4,t.getValues()];case 2:if(r=i.sent(),void 0!==n){for(o=0;o<e.length;o+=1)if(Math.abs(e[o]-r[o])>n)return[2,!1]}else for(o=0;o<e.length;o+=1)if(e[o]!==r[o])return[2,!1];return[2,!0]}}))}))},t.prototype.getAxes=function(t){var n,e=this.getShape();if(void 0===t){n=[];for(var r=0;r<e.length;r++)n.push(r)}else n=t instanceof Array?t:[t];return n},t.prototype.sum=function(t,n){var e=this.getAxes(t);return n=n||!1,this.sum_impl(e,n)},t.prototype.sumSquare=function(t,n){var e=this.getAxes(t);return n=n||!1,this.sumSquare_impl(e,n)},t.prototype.product=function(t,n){var e=this.getAxes(t);return n=n||!1,this.product_impl(e,n)},t.prototype.max=function(t,n){var e=this.getAxes(t);return n=n||!1,this.max_impl(e,n)},t.prototype.min=function(t,n){var e=this.getAxes(t);return n=n||!1,this.min_impl(e,n)},t.prototype.reduceMean=function(t,n){var e=this.getAxes(t);return n=n||!1,this.reduceMean_impl(e,n)},t.prototype.reduceMeanSquare=function(t,n){var e=this.getAxes(t);return n=n||!1,this.reduceMeanSquare_impl(e,n)},t.prototype.conv=function(t,n,e,r,o,i,a){var u=this.getShape().length-2;return e=e||new Array(u).fill(1),r=r||1,o=o||new Array(2*u).fill(0),i=i||new Array(u).fill(1),void 0===a&&(a="id"),this.conv_impl(t,e,r,o,i,n,a)},t.prototype.pad=function(t,n,e){return void 0===n&&(n="constant"),void 0===e&&(e=0),this.pad_impl(t,n,e)},t.prototype.averagePool=function(t,n,e,r){var o=this.getShape().length-2;return n=n||new Array(2*o).fill(0),e=e||new Array(o).fill(1),r=r||!1,this.averagePool_impl(t,n,e,r)},t.prototype.reshape=function(t,n){for(var e=1,r=-1,o=0;o<t.length;o++)-1===t[o]?r=o:e*=t[o];if(void 0===n&&(n=!0),-1!==r){var i=O(this.getShape()),a=T(t);return a[r]=i/e,this.reshape_impl(a,n)}return this.reshape_impl(t,n)},t.prototype.alignShapes=function(t,n){var e,r;if(S(t,n))return[t,n,t];if(t.length<n.length){t=T(t);var o=n.length-t.length;(e=t).unshift.apply(e,new Array(o).fill(1))}else if(n.length<t.length){n=T(n);o=t.length-n.length;(r=n).unshift.apply(r,new Array(o).fill(1))}for(var i=new Array(t.length).fill(1),a=0;a<t.length;a++)i[a]=Math.max(t[a],n[a]);return[t,n,i]},t.prototype.alignTensor=function(t){var n,e,r=this.getShape(),o=t.getShape();if(S(r,o))return[this,t,r];var i=this;if(r.length<o.length){r=T(r);var a=o.length-r.length;(n=r).unshift.apply(n,new Array(a).fill(1)),i=this.reshape(r,!1)}else if(o.length<r.length){o=T(o);a=r.length-o.length;(e=o).unshift.apply(e,new Array(a).fill(1)),t=t.reshape(o,!1)}for(var u=new Array(r.length).fill(1),s=0;s<r.length;s++)u[s]=Math.max(r[s],o[s]);return[i,t,u]},t.prototype.add=function(t){var n=this.alignTensor(t),e=n[0],r=n[1],o=n[2];return this.add_impl(e,r,o)},t.prototype.subtract=function(t){var n=this.alignTensor(t),e=n[0],r=n[1],o=n[2];return this.subtract_impl(e,r,o)},t.prototype.multiply=function(t){var n=this.alignTensor(t),e=n[0],r=n[1],o=n[2];return this.multiply_impl(e,r,o)},t.prototype.divide=function(t){var n=this.alignTensor(t),e=n[0],r=n[1],o=n[2];return this.divide_impl(e,r,o)},t.prototype.power=function(t){var n=this.alignTensor(t),e=n[0],r=n[1],o=n[2];return this.power_impl(e,r,o)},t.prototype.transpose=function(t){if(void 0===t){var n=this.getShape().length;t=[];for(var e=0;e<n;e++)t.push(n-e-1)}return this.transpose_impl(t)},t.prototype.softmax=function(t){var n=this.max(t,!0),e=this.subtract(n),r=e.exp(),o=r.sum(t,!0),i=r.divide(o);return n.delete(),e.delete(),r.delete(),o.delete(),i},t.prototype.gemm=function(t,n,e,r,o,i){if(n=n||!1,e=e||!1,r=void 0!==r?r:1,i=void 0!==i?i:1,void 0!==o){var a=this.getShape(),u=o.getShape(),s=a.length,p=u.length;u=T(new Array(s-p).fill(1),u),o=o.reshape(u,!1)}return this.gemm_impl(t,n,e,r,i,o)},t.prototype.slice=function(t,n,e){var r=this.getShape(),o=r.length;if(void 0===e){e=[];for(var i=0;i<o;i++)e.push(i)}t=T(t),n=T(n);for(i=0;i<e.length;i++){var a=r[e[i]];t[i]<0?t[i]+=a:t[i]>=a&&(t[i]=a),n[i]<0?n[i]+=a:n[i]>=a&&(n[i]=a)}return this.slice_impl(t,n,e)},t}();function M(t,n,e,r,o,i){var a=o*(n-1)+1;return Math.floor((t+e+r-a)/i+1)}function C(t,n,e,r,o,i){for(var a=[],u=0;u<t.length;u++)a.push(M(t[u],n[u],e[u],r[u],o[u],i[u]));return a}function V(t,n){for(var e=new K(t.shape),r=0;r<e.size;r+=1)e.set(r,n(t.get(r)));return e}function R(t,n,e,r){if(!function(t,n){if(t.length!==n.length)return!1;for(var e=0;e<t.length;e+=1)if(t[e]!==n[e]&&1!==t[e]&&1!==n[e])return!1;return!0}(t.shape,n.shape))throw new Error("The shapes of the two tensors should be the same for a binary operation");for(var o=new K(r),i=new Array(r.length).fill(0),a=0;a<o.size;a+=1)o.set(i,e(t.get(i),n.get(i))),P(i,r);return o}var B=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var E=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var z=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};function U(t,n,e){for(var r=[],o=[],i=[],a=0;a<t.length;a++)n.includes(a)?(e&&(r.push(1),i.push(a)),o.push(t[a])):(r.push(t[a]),i.push(a));return 0===r.length&&r.push(1),[r,i]}function D(t,n,e,r,o){for(var i=t.getShape(),a=O(i),u=U(i,n,r),s=u[0],p=u[1],c=O(s),f=A(s),h=new K(s),l=new Array(c).fill(!1),y=new Array(i.length).fill(0),d=new Array(s.length).fill(0),v=0;v<a;v++){for(var m=0;m<p.length;m++)d[m]=y[p[m]];var g=k(d,f);l[g]?h.set(d,e(t.get(v),h.get(d))):(l[g]=!0,h.set(d,e(t.get(v)))),P(y,i)}if(o)for(v=0;v<h.size;v++)h.set(v,o(h.get(v)));return h}var F=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var G=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};function W(t,n,e,r,o){if(o)return t.get(n);var i=t.shape.length;if("constant"===e)return r;if("edge"===e)for(var a=0;a<i;a++)n[a]<0?n[a]=0:n[a]>=t.shape[a]&&(n[a]=t.shape[a]-1);else for(a=0;a<i;a++)n[a]<0?n[a]=-n[a]:n[a]>=t.shape[a]&&(n[a]=2*t.shape[a]-n[a]-2);return t.get(n)}var N=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var q=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var J=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),L=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},H=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Y=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},K=function(t){function n(n,e,r){var o=t.call(this)||this;return o.deleted=!1,o.shape=n,o.strides=A(n),o.size=O(n),void 0!==e?e instanceof Float32Array||e instanceof Int32Array?(o.values=e,o.type=e instanceof Float32Array?"float":"int"):"int"===r?(o.values=Int32Array.from(e),o.type="int"):null===e?o.values=null:(o.values=Float32Array.from(e),o.type="float"):"int"===r?(o.values=new Int32Array(o.size),o.type="int"):(o.values=new Float32Array(o.size),o.type="float"),o}return J(n,t),n.prototype.getValues=function(){return Promise.resolve(this.values)},n.prototype.getShape=function(){return this.shape},n.prototype.cpu=function(){return L(this,void 0,void 0,(function(){return H(this,(function(t){return[2,this]}))}))},n.prototype.delete=function(){this.values=void 0,this.deleted=!0},n.prototype.copy=function(t){void 0===t&&(t=Y(this.shape));for(var e=new Float32Array(this.size),r=0;r<this.size;r++)e[r]=this.values[r];return new n(t,e)},n.prototype.get=function(t){var n;return n=Array.isArray(t)?k(t,this.strides,this.shape):t,this.values[n]},n.prototype.set=function(t,n){var e;e=Array.isArray(t)?k(t,this.strides):t,this.values[e]=n},n.prototype.exp=function(){return V(this,(function(t){return Math.exp(t)}))},n.prototype.log=function(){return V(this,(function(t){return Math.log(t)}))},n.prototype.sqrt=function(){return V(this,(function(t){return Math.sqrt(t)}))},n.prototype.abs=function(){return V(this,(function(t){return Math.abs(t)}))},n.prototype.floor=function(){return V(this,(function(t){return Math.floor(t)}))},n.prototype.ceil=function(){return V(this,(function(t){return Math.ceil(t)}))},n.prototype.clip=function(t,n){return function(t,n,e){var r=function(t){return t};return void 0!==n&&void 0!==e?r=function(t){return Math.min(e,Math.max(n,t))}:void 0!==e?r=function(t){return Math.min(e,t)}:void 0!==n&&(r=function(t){return Math.max(n,t)}),V(t,r)}(this,t,n)},n.prototype.add_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n,e){return R(t,n,(function(t,n){return t+n}),e)}(t,e,r)},n.prototype.subtract_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only subtract CPU tensor to CPU tensor");return function(t,n,e){return R(t,n,(function(t,n){return t-n}),e)}(t,e,r)},n.prototype.multiply_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n,e){return R(t,n,(function(t,n){return t*n}),e)}(t,e,r)},n.prototype.divide_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n,e){return R(t,n,(function(t,n){return t/n}),e)}(t,e,r)},n.prototype.power_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only take CPU tensor to power of CPU tensor");return function(t,n,e){return R(t,n,(function(t,n){return Math.pow(t,n)}),e)}(t,e,r)},n.prototype.matMul=function(t){if(!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n){if(2!==t.shape.length||2!==n.shape.length)throw new Error("Matmul expects both operands to have rank 2");if(t.shape[1]!==n.shape[0])throw new Error("Matmul expects dimension 1 of operand 1 to equal dimension 0 of operand 2");for(var e=t.shape[0],r=t.shape[1],o=n.shape[1],i=new K([e,o]),a=0;a<e;a+=1)for(var u=0;u<o;u+=1){for(var s=0,p=0;p<r;p+=1)s+=t.get([a,p])*n.get([p,u]);i.set([a,u],s)}return i}(this,t)},n.prototype.gemm_impl=function(t,e,r,o,i,a){if(!(t instanceof n&&(void 0===a||a instanceof n)))throw new Error("Can only do gemm with CPU tensors");return function(t,n,e,r,o,i,a){var u=t.shape.length,s=e?t.shape[u-1]:t.shape[u-2],p=e?t.shape[u-2]:t.shape[u-1],c=r?n.shape[u-2]:n.shape[u-1],f=s*p,h=p*c,l=s*c,y=e?s:1,d=e?1:p,v=r?1:c,m=r?p:1,g=0,w=0,b=0;void 0!==a&&(g=a.strides[u-2],w=a.strides[u-1],O(a.shape.slice(0,u-2))>1?1===(b=a.shape[u-2]*a.shape[u-1])&&(b=0):b=0);var x=t.shape.slice(0,u-2),_=O(x);0===_&&(_=1);for(var A=z(x,[s,c]),k=new K(A),S=0;S<_;S++)for(var P=S*f,j=S*h,I=S*l,T=S*b,X=0;X<s;X++)for(var M=0;M<c;M++){for(var C=0,V=0;V<p;V++)C+=t.get(P+X*d+V*y)*n.get(j+V*v+M*m);C*=o,void 0!==a&&(C+=i*a.get(T+X*g+M*w)),k.set(I+X*c+M,C)}return k}(this,t,e,r,o,i,a)},n.prototype.sum_impl=function(t,n){return function(t,n,e){return D(t,n,(function(t,n){return t+(void 0!==n?n:0)}),e)}(this,t,n)},n.prototype.sumSquare_impl=function(t,n){return function(t,n,e){return D(t,n,(function(t,n){return t*t+(void 0!==n?n:0)}),e)}(this,t,n)},n.prototype.product_impl=function(t,n){return function(t,n,e){return D(t,n,(function(t,n){return t*(void 0!==n?n:1)}),e)}(this,t,n)},n.prototype.max_impl=function(t,n){return function(t,n,e){return D(t,n,(function(t,n){return Math.max(t,void 0!==n?n:t)}),e)}(this,t,n)},n.prototype.min_impl=function(t,n){return function(t,n,e){return D(t,n,(function(t,n){return Math.min(t,void 0!==n?n:t)}),e)}(this,t,n)},n.prototype.reduceMean_impl=function(t,n){return function(t,n,e){for(var r=1,o=0;o<n.length;o++)r*=t.shape[n[o]];return D(t,n,(function(t,n){return t+(void 0!==n?n:0)}),e,(function(t){return t/r}))}(this,t,n)},n.prototype.reduceMeanSquare_impl=function(t,n){return function(t,n,e){for(var r=1,o=0;o<n.length;o++)r*=t.shape[n[o]];return D(t,n,(function(t,n){return t*t+(void 0!==n?n:0)}),e,(function(t){return t/r}))}(this,t,n)},n.prototype.conv_impl=function(t,e,r,o,i,a){if(!(t instanceof n)||void 0!==a&&!(a instanceof n))throw new Error("Can only do convolution of CPU tensor with CPU tensor");return function(t,n,e,r,o,i,a){var u=t.shape[0],s=t.shape[1],p=t.shape.slice(2),c=n.shape.slice(2),f=n.shape[0],h=s/r,l=O(c),y=C(p,c,o.slice(0,o.length/2),o.slice(o.length/2),e,i),d=O(y),v=[u,f];v=v.concat(y);for(var m=new K(v),g=y.length,w=0;w<u;w++)for(var b=0;b<f;b++){if(a){var x=a?a.get([b]):0;(k=new Array(y.length).fill(0)).unshift(w,b);for(var _=0;_<d;_++)m.set(k,x),P(k,m.shape)}for(var A=0;A<h;A++){var k,S=(b*h+A)%s;for((k=new Array(y.length).fill(0)).unshift(w,b),_=0;_<d;_++){var j=m.get(k),I=new Array(y.length).fill(0);I.unshift(b,A);for(var T=0;T<l;T++){for(var X=[w,S],M=!1,V=0;V<g;V++){var R=0===i.length?1:i[V],B=0===o.length?0:o[V],E=0===e.length?1:e[V],z=k[V+2]*R-B+I[V+2]*E;if(z<0||z>=p[V]){M=!0;break}X.push(z)}M||(j+=n.get(I)*t.get(X)),P(I,n.shape)}m.set(k,j),P(k,m.shape)}}}return m}(this,t,e,r,o,i,a)},n.prototype.pad_impl=function(t,n,e){return function(t,n,e,r){for(var o=t.shape.length,i=G(t.shape),a=0;a<o;a++)i[a]+=n[a]+n[a+o];var u=new K(i),s=new Array(o).fill(0),p=new Array(o).fill(0);for(a=0;a<u.size;a++){for(var c=!0,f=0;f<o;f++)p[f]=s[f]-n[f],(p[f]<0||p[f]>=t.shape[f])&&(c=!1);u.set(a,W(t,p,e,r,c)),P(s,i)}return u}(this,t,n,e)},n.prototype.averagePool_impl=function(t,n,e,r){return function(t,n,e,r,o){var i=t.shape[0],a=t.shape[1],u=t.shape.slice(2),s=u.length,p=O(n),c=C(u,n,e.slice(0,e.length/2),e.slice(e.length/2),new Array(s).fill(1),r),f=O(c),h=[i,a];h=h.concat(c);for(var l=new K(h),y=0;y<i;y++)for(var d=0;d<a;d++){var v=new Array(c.length).fill(0);v.unshift(y,d);for(var m=0;m<f;m++){for(var g=0,w=new Array(c.length).fill(0),b=0,x=0;x<p;x++){for(var _=[y,d],A=!1,k=0;k<s;k++){var S=0===r.length?1:r[k],j=0===e.length?0:e[k],I=v[k+2]*S-j+w[k];if(I<0||I>=u[k]){A=!0;break}_.push(I)}A||(g+=t.get(_)),A&&!o||(b+=1),P(w,n)}g/=b,l.set(v,g),P(v,l.shape)}}return l}(this,t,n,e,r)},n.prototype.reshape_impl=function(t,e){return e?this.copy(t):new n(t,this.values,this.type)},n.prototype.concat=function(t,e){if(!(t instanceof n))throw new Error("Can only concat CPU tensor to CPU tensor");return function(t,n,e){var r=B(t.shape);r[e]+=n.shape[e];for(var o=new K(r),i=0,a=0,u=0,s=o.strides[e]*t.shape[e],p=o.strides[e]*n.shape[e],c=o.size/(e>0?o.strides[e-1]:o.size),f=0;f<c;f++){for(var h=0;h<s;h++)o.set(u,t.get(i)),u++,i++;for(h=0;h<p;h++)o.set(u,n.get(a)),u++,a++}return o}(this,t,e)},n.prototype.transpose_impl=function(t){return function(t,n){for(var e=t.shape.length,r=new Array(e),o=new Array(e),i=0;i<e;i++)r[i]=t.shape[n[i]],o[n[i]]=i;var a=new K(r),u=a.strides,s=new Array(e);for(i=0;i<e;i++)s[i]=u[o[i]];var p=new Array(e).fill(0);for(i=0;i<t.size;i++){for(var c=0,f=0;f<e;f++)c+=p[f]*s[f];a.set(c,t.get(i)),P(p,t.shape)}return a}(this,t)},n.prototype.repeat=function(t){return function(t,n){for(var e=t.shape.length,r=new Array(e),o=0;o<e;o++)r[o]=t.shape[o]*n[o];var i=new K(r),a=new Array(e).fill(0);for(o=0;o<i.size;o++){for(var u=new Array(e),s=0;s<e;s++)u[s]=a[s]%t.shape[s];i.set(o,t.get(u)),P(a,i.shape)}return i}(this,t)},n.prototype.expand=function(t){var n=this.alignShapes(this.shape,t),e=n[0],r=(n[1],n[2]);return S(this.shape,r)?this.copy():function(t,n){for(var e=t.shape.length,r=new K(n),o=new Array(e).fill(0),i=0;i<r.size;i++)r.set(i,t.get(o)),P(o,r.shape);return r}(this.reshape(e,!1),r)},n.prototype.gather=function(t,n){return function(t,n,e){for(var r=t.shape.length,o=e.shape.length,i=r+o-1,a=new Array(i),u=0;u<n;u++)a[u]=t.shape[u];for(u=0;u<o;u++)a[u+n]=e.shape[u];for(u=n+1;u<r;u++)a[u+o-1]=t.shape[u];var s,p,c=new K(a,void 0,t.type),f=new Array(i).fill(0);for(u=0;u<c.size;u++){s=f.slice(n,n+o);var h=e.get(s);p=E(f.slice(0,n),[h],f.slice(n+o)),c.set(u,t.get(p)),P(f,a)}return c}(this,t,n)},n.prototype.slice_impl=function(t,n,e){return function(t,n,e,r){for(var o=t.shape.length,i=N(t.shape),a=0,u=0;u<o&&a<r.length;u++)u==r[a]&&(i[u]=e[a]-n[a],a++);var s,p=new K(i,void 0,t.type),c=new Array(o).fill(0);for(u=0;u<p.size;u++){s=N(c);for(var f=0;f<r.length;f++)s[r[f]]+=n[f];p.set(u,t.get(s)),P(c,i)}return p}(this,t,n,e)},n.prototype.upsample=function(t){return function(t,n){for(var e=t.shape.length,r=q(t.shape),o=0;o<e;o++)r[o]=Math.floor(r[o]*n[o]);var i=new K(r,void 0,t.type),a=new Array(e).fill(0),u=new Array(e);for(o=0;o<i.size;o++){for(var s=0;s<e;s++)u[s]=Math.floor(a[s]/n[s]);i.set(o,t.get(u)),P(a,r)}return i}(this,t)},n.prototype.normalize=function(t,e,r,o,i){if(!(t instanceof n)||!(e instanceof n)||!(o instanceof n)||!(i instanceof n))throw new Error("Can only normalize with CPU tensors");return function(t,n,e,r,o,i){for(var a=t.shape.length,u=F(t.shape),s=new K(u,void 0,t.type),p=new Array(a).fill(0),c=0;c<s.size;c++){var f=(t.get(p)-n.get(p))/Math.sqrt(e.get(p)+r);f=f*o.get(p)+i.get(p),s.set(c,f),P(p,u)}return s}(this,t,e,r,o,i)},n}(X),Q=e(13),Z=e.n(Q),$=function(){function t(t){this.toNumber=t,this.dict={}}return t.prototype.betweenBoundsFirst=function(t){if(void 0!==t.gte){var n=this.toNumber(t.gte);return void 0!==this.dict[n]&&this.dict[n].length>0?[{key:t.gte,value:this.dict[n][this.dict[n].length-1]}]:[]}if(void 0!==t.lte){n=this.toNumber(t.lte);return void 0!==this.dict[n]&&this.dict[n].length>0?[{key:t.lte,value:this.dict[n][this.dict[n].length-1]}]:[]}return[]},t.prototype.deleteFirst=function(t){var n=this.toNumber(t);void 0!==this.dict[n]&&this.dict[n].pop()},t.prototype.insert=function(t,n){var e=this.toNumber(t);void 0===this.dict[e]&&(this.dict[e]=[]),this.dict[e].push(n)},t}();function tt(t){return nt(t)}function nt(t,n,e){if(void 0===n&&(n=[]),void 0===e&&(e=!0),!Number.isInteger(t))return n;var r=Math.abs(t);if(r<2)return n;var o=Math.sqrt(r),i=2;if(r%i&&r%(i=3)){i=5;for(var a=2;r%i&&i<o;)i+=a,a=6-a}(i=i<=o?i:r,e)?n.push(i):n.indexOf(i)<0&&n.push(i);return i===r?n:nt(r/i,n,e)}var et,rt,ot,it=function(){function t(t,n,e){this.trees={16:n(),32:n()},this.regl=t,this.entryId=0,this.maxSizeFactor=e||2}return t.prototype.allocate=function(t,n){var e=t*this.maxSizeFactor,r=4*Math.ceil(t/4);r<e&&(e=r);var o=this.trees[n].betweenBoundsFirst({gte:t,lte:e});if(0===o.length){var i=Math.ceil(t/4),a=this.getTextureDims(i),u=a.width,s=a.height;return{width:u,height:s,size:u*s*4,frameBuffer:this.regl.framebuffer({width:u,height:s,depthStencil:!1,colorFormat:"rgba",colorType:32===n?"float":"half float"}),id:this.entryId++,precision:n}}var p=o[0];return this.trees[n].deleteFirst(p.key),p.value},t.prototype.getAllocationDimensions=function(t,n){var e=t*this.maxSizeFactor,r=4*Math.ceil(t/4);r<e&&(e=r);var o=this.trees[n].betweenBoundsFirst({gte:t,lte:e});if(0===o.length){var i=Math.ceil(t/4);return this.getTextureDims(i)}var a=o[0];return{width:a.value.width,height:a.value.height}},t.prototype.deallocate=function(t){this.trees[t.precision].insert(t.size,t)},t.prototype.allocateTexture=function(t,n){for(var e=Math.ceil(t.length/4),r=this.getTextureDims(e),o=r.width,i=r.height,a=o*i*4,u=new Float32Array(a),s=0;s<t.length;s++)u[s]=t[s];for(s=t.length;s<a;s++)u[s]=0;var p=this.regl.texture({width:o,height:i,format:"rgba",type:32===n?"float":"half float",data:32===n?u:Array.from(u)});return{width:o,height:i,size:a,frameBuffer:this.regl.framebuffer({color:p,width:o,height:i,depthStencil:!1}),id:this.entryId++,precision:n}},t.prototype.allocateOfDimensions=function(t,n,e){var r=t*n*4,o=this.regl.texture({width:t,height:n,format:"rgba",type:32===e?"float":"half float"});return{width:t,height:n,size:r,frameBuffer:this.regl.framebuffer({color:o,width:t,height:n,depthStencil:!1}),id:this.entryId++,precision:e}},t.prototype.allocateFramebuffer=function(t,n){var e=this.regl.framebuffer({color:t,width:t.width,height:t.height,depthStencil:!1});return{width:t.width,height:t.height,size:t.width*t.height*4,frameBuffer:e,id:this.entryId++,precision:n}},t.prototype.getTextureDims=function(t){for(var n=tt(t),e=1,r=1,o=0;o<n.length;o+=2)e*=n[o],o+1<n.length&&(r*=n[o+1]);return{width:e,height:r}},t}(),at=document.createElement("canvas");et=at.getContext("webgl",{failIfMajorPerformanceCaveat:!1}),rt=Z()({gl:et,extensions:["OES_texture_float","WEBGL_color_buffer_float","OES_texture_half_float"]}),ot=new it(rt,(function(){return new $((function(t){return t}))}));var ut,st=function(){return(st=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},pt=function(){function t(t,n,e){this.statics=new Set,this.copyCounter=0,this.fullyStatic=!1,void 0===n&&(n=ot),void 0===e&&(e=10),this.allocator=n,this.maxRank=e,this.gpuTensorConstructor=t}return t.prototype.registerStatics=function(t){var n=0,e=0;for(var r in t)if(r.startsWith("shape")){var o=r.slice("shape".length);this.statics.add("shape"+o),this.statics.add("size"+o),this.statics.add("rank"+o),this.statics.add("strides"+o),n++}else this.statics.add(r),r.startsWith("width")||r.startsWith("height")||e++;n-1===this.getTextureNames().length&&e===this.getUniformAttrs().length&&(this.fullyStatic=!0,this.outputShape=t.shapeOutput)},t.prototype.getVarModifier=function(t){return this.statics.has(t)?"":"uniform"},t.prototype.pad=function(t,n){for(void 0===n&&(n=this.maxRank);t.length<n;)t.push(-1);return t},t.prototype.copyPad=function(t,n){void 0===n&&(n=this.maxRank);for(var e=Array.from(t);e.length<n;)e.push(-1);return e},t.prototype.getVariables=function(){return""},t.prototype.getVariableDeclarations=function(t){var n=this,e=this.getTextureNames();return e.push("Output"),"\n      "+e.map((function(t){return"\n        "+("Output"===t?"":"uniform sampler2D "+t+";")+"\n        "+n.getVarModifier("size"+t)+" int size"+t+";\n        "+n.getVarModifier("width"+t)+" int width"+t+";\n        "+n.getVarModifier("height"+t)+" int height"+t+";\n        "+n.getVarModifier("strides"+t)+" int strides"+t+"["+n.maxRank+"];\n        "+n.getVarModifier("shape"+t)+" int shape"+t+"["+n.maxRank+"];\n        "+n.getVarModifier("rank"+t)+" int rank"+t+";\n        "})).join("\n")+"\n      varying vec2 uv;\n\n      "+this.getVariables()},t.prototype.getVariableInitializations=function(t){var n=this.getTextureNames();n.push("Output");for(var e="",r=0,o=n;r<o.length;r++){var i=o[r];if("shape"+i in t){var a=t["shape"+i],u=A(a),s=O(a),p=a.length;e+=this.getArrayInit("shape"+i,a),e+=this.getArrayInit("strides"+i,u),e+="\nsize"+i+" = "+s+";",e+="\nrank"+i+" = "+p+";"}}for(var c in t){if(!c.startsWith("shape"))if(Array.isArray(t[c]))e+=this.getArrayInit(c,t[c]);else e+="int"===this.getVarType(c)?"\n"+c+" = "+t[c]+";":"\n"+c+" = "+t[c].toPrecision(20)+";"}return e},t.prototype.getVarType=function(t){var n=this.getUniformAttrs().find((function(n){return n.name===t}));return void 0!==n&&n.type?n.type:"int"},t.prototype.getArrayInit=function(t,n,e,r){void 0===e&&(e=this.maxRank);var o=this.getVarType(t);void 0===r&&("int"===o?r="-1":"float"===o&&(r="-1.0"));for(var i="",a=0;a<e;a++)a<n.length?"int"===o?i+="\n "+t+"["+a+"] = "+n[a]+";":"float"===o&&(i+="\n "+t+"["+a+"] = "+n[a].toPrecision(20)+";"):i+="\n "+t+"["+a+"] = "+r+";";return i},t.prototype.getUtilFunctions=function(){return"\n    int fromFloat(float f) {\n      return int(floor(f+0.5));\n    }\n\n    int coordinateToPos(vec2 coordinate, int textureWidth, int textureHeight) {\n      int x = (fromFloat(coordinate.x*float(textureWidth*2))-1)/2;\n      int y = (fromFloat(coordinate.y*float(textureHeight*2))-1)/2;\n\n      int pos = x + y*textureWidth;\n\n      return pos*4;\n    }\n\n    vec2 posToCoordinate(int pos, int textureWidth, int textureHeight) {\n      // 4 positions map to the same coordinate\n      pos = pos/4;\n\n      int y = pos/textureWidth;\n      int x = pos - y*textureWidth;\n\n      return vec2(float(x*2+1)/float(textureWidth*2), float(y*2+1)/float(textureHeight*2));\n    }\n\n    int indexToPos(int index["+this.maxRank+"], int strides["+this.maxRank+"]) {\n      int pos = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (strides[i] == -1) {\n          break;\n        }\n        pos += index[i]*strides[i];\n      }\n      return pos;\n    }\n\n    float getValueAtPos(int pos, int textureWidth, int textureHeight, sampler2D tex) {\n      vec2 coord = posToCoordinate(pos, textureWidth, textureHeight);\n      int res = pos - (pos/4)*4;\n      vec4 val = texture2D(tex, coord);\n      if (res == 0) {\n        return val.r;\n      } else if (res == 1) {\n        return val.g;\n      } else if (res == 2) {\n        return val.b;\n      } else {\n        return val.a;\n      }\n    }\n\n    float getValueAt(int index["+this.maxRank+"], int strides["+this.maxRank+"], int textureWidth, int textureHeight, sampler2D tex) {\n      int pos = indexToPos(index, strides);\n      return getValueAtPos(pos, textureWidth, textureHeight, tex);\n    }"},t.prototype.getTextureFunctions=function(){var t=this;return this.getTextureNames().map((function(n){return"\n      float _"+n+"(int indices["+t.maxRank+"]) {\n        return getValueAt(indices, strides"+n+", width"+n+", height"+n+", "+n+");\n      }\n      "})).join("\n")},t.prototype.getCompleteFragmentShader=function(t,n){var e=this.getFragmentShader(t),r=this.getVariableDeclarations(t),o=this.getVariableInitializations(t),i=this.getUtilFunctions(),a=this.getTextureFunctions();return"\n    precision "+this.precisionString(n)+" float;\n\n    "+r+"\n\n    "+i+"\n    "+a+"\n\n    void initVars() {\n      "+o+"\n    }\n\n    "+e},t.prototype.getUniforms=function(t){for(var n=[],e=0,r=this.getUniformAttrs();e<r.length;e++){var o=r[e];void 0===t[o.name]&&n.push(o)}var i=this.getTextureNames();i.push("Output");for(var a=0,u=i;a<u.length;a++){var s=u[a];n.push({name:s}),void 0===t["shape"+s]&&(n.push({name:"size"+s}),n.push({name:"strides"+s,length:this.maxRank}),n.push({name:"shape"+s,length:this.maxRank}),n.push({name:"rank"+s})),void 0===t["width"+s]&&n.push({name:"width"+s}),void 0===t["height"+s]&&n.push({name:"height"+s})}for(var p={},c=0,f=n;c<f.length;c++){var h=f[c];if(void 0===t[h.name])if(void 0!==h.length)for(var l=0;l<h.length;l++){var y=h.name+"["+l+"]";p[y]=rt.prop(y)}else p[h.name]=rt.prop(h.name)}return p},t.prototype.posToIndex=function(t,n,e){var r=e+"_"+this.copyCounter++;return"\n    int "+r+" = "+e+";\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if ("+t+"[i] == -1) {\n        "+n+"[i] = -1;\n      } else {\n        if ("+t+"[i] == 0) {\n          "+n+"[i] = 0;\n        } else {\n          "+n+"[i] = "+r+"/"+t+"[i];\n          "+r+" = "+r+" - "+t+"[i]*"+n+"[i]; // Stupid modulo hack\n        }\n      }\n    }"},t.prototype.initIndex=function(t,n){return void 0===n?"\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          "+t+"[i] = -1;\n        }":"\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (i < "+n+") {\n            "+t+"[i] = 0;\n          } else {\n            "+t+"[i] = -1;\n          }\n        }"},t.prototype.incrementIndex=function(t,n){return"\n    for (int i = "+this.maxRank+" - 1; i >= 0; i--) {\n      if ("+n+"[i] != -1) {\n        "+t+"[i] += 1;\n        if ("+t+"[i] >= "+n+"[i]) {\n          "+t+"[i] = 0;\n        } else {\n          break;\n        }\n      }\n    }\n    "},t.prototype.incrementConditional=function(t,n,e){return"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if ("+e+"[i] == 1) {\n        "+t+"[i] += 1;\n        if ("+t+"[i] >= "+n+"[i]) {\n          "+t+"[i] = 0;\n        } else {\n          break;\n        }\n      } else if ("+e+"[i] == -1) {\n        break;\n      }\n    }\n    "},t.prototype.getDefaultMain=function(){return"\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      vec4 result = vec4(0,0,0,0);\n\n      if (pos < sizeOutput) {\n        int index["+this.maxRank+"];\n        "+this.posToIndex("stridesOutput","index","pos")+"\n        result.r = process(index);\n\n        pos += 1;\n\n        if (pos < sizeOutput) {\n          "+this.posToIndex("stridesOutput","index","pos")+"\n          result.g = process(index);\n\n          pos += 1;\n\n          if (pos < sizeOutput) {\n            "+this.posToIndex("stridesOutput","index","pos")+"\n            result.b = process(index);\n\n            pos += 1;\n\n            if (pos < sizeOutput) {\n              "+this.posToIndex("stridesOutput","index","pos")+"\n              result.a = process(index);\n            }\n          }\n        }\n      }\n\n      gl_FragColor = result;\n    }"},t.prototype.precisionString=function(t){return 32===t?"highp":"mediump"},t.prototype.getDrawCommand=function(t,n){var e=this.getCompleteFragmentShader(t,n),r=this.getUniforms(t);return rt({frag:e,vert:"\n        precision "+this.precisionString(n)+" float;\n        attribute vec2 position;\n        varying vec2 uv;\n        void main() {\n          uv = 0.5 * (position + 1.0);\n          gl_Position = vec4(position, 0, 1);\n        }",attributes:{position:[-4,-4,4,-4,0,4]},uniforms:r,framebuffer:rt.prop("framebuffer"),depth:{enable:!1},count:3})},t.prototype.compile=function(t,n){this.registerStatics(t),this.precision=n,this.drawCommand=this.getDrawCommand(t,n)},t.prototype.compute=function(t,n,e){void 0===this.drawCommand&&this.compile({},32);var r=O(t),o=this.allocator.allocate(r,this.precision),i={};for(var a in n)i[a]=n[a].memory.frameBuffer;if(void 0===e&&(e={}),!this.fullyStatic){for(var u in n)this.statics.has("shape"+u)||(e["size"+u]=n[u].size,e["strides"+u]=this.pad(A(n[u].shape)),e["shape"+u]=this.copyPad(n[u].shape),e["rank"+u]=n[u].shape.length),this.statics.has("width"+u)||(e["width"+u]=n[u].memory.width),this.statics.has("height"+u)||(e["height"+u]=n[u].memory.height);this.statics.has("shapeOutput")||(e.sizeOutput=r,e.stridesOutput=this.pad(A(t)),e.shapeOutput=this.copyPad(t),e.rankOutput=t.length),this.statics.has("widthOutput")||(e.widthOutput=o.width),this.statics.has("heightOutput")||(e.heightOutput=o.height)}return this.drawCommand(st(st({framebuffer:o.frameBuffer},i),e)),this.gpuTensorConstructor(o,t,this.precision)},t.prototype.getUniformAttrs=function(){return[]},t}(),ct=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ft=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.maxIterations=1e6,r.maxRank=2,r}return ct(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int ix1["+this.maxRank+"];\n      "+this.initIndex("ix1")+"\n      ix1[0] = index[0];\n\n      int ix2["+this.maxRank+"];\n      "+this.initIndex("ix2")+"\n      ix2[1] = index[1];\n\n      int k = shapeA[1];\n\n      float res = 0.0;\n\n      for (int i = 0; i < "+this.maxIterations+"; i++) {\n        if (i >= k) {\n          break;\n        }\n        ix1[1] = i;\n        ix2[0] = i;\n\n        float v1 = _A(ix1);\n        float v2 = _B(ix2);\n        res += v1*v2;\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.calc=function(t){var n=this.getOutputShape(t);return this.compute(n,{A:t.A,B:t.B})},n.prototype.getOutputShape=function(t){return[t.A.shape[0],t.B.shape[1]]},n.prototype.compile=function(n,e){void 0!==n.shapeA?this.maxIterations=n.shapeA[1]:void 0!==n.shapeB&&(this.maxIterations=n.shapeB[0]),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.A.shape,widthB:t.A.memory.width,heightB:t.A.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape},n}(pt),ht=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),lt=function(t){function n(n,e){return t.call(this,n,e)||this}return ht(n,t),n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = "+this.operation("texture2D(X, uv)")+";\n    }\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){return this.compute(t.input.shape,{X:t.input})},n.prototype.getOutputShape=function(t){return t.input.shape},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:this.getOutputShape(t),widthOutput:r.width,heightOutput:r.height}},n.prototype.getInputInfoString=function(t){return""+t.input.shape},n}(pt),yt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),dt=function(t){function n(n,e){return t.call(this,n,e)||this}return yt(n,t),n.prototype.operation=function(t){return"exp("+t+")"},n}(lt),vt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),mt=function(){return(mt=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},gt=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.maxIterations=1e6,r}return vt(n,t),n.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      int dilation = dilations[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d+2]*dilation;\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},n.prototype.getMainBody=function(){return"\n    int n = index[0];\n    int m = index[1];\n\n    int kernelIx["+this.maxRank+"];\n    "+this.initIndex("kernelIx")+"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if (i >= dataRank) {\n        break;\n      }\n      kernelIx[i+2] = 0;\n    }\n    kernelIx[0] = m;\n    int inputIx["+this.maxRank+"];\n    "+this.initIndex("inputIx")+"\n    inputIx[0] = n;\n\n    for (int cg = 0; cg < "+this.maxIterations+"; cg++) {\n      if (cg >= CG) {\n        break;\n      }\n      int c = m * CG + cg;\n      int d = c/C;\n      c = c - d*C;\n      inputIx[1] = c;\n      kernelIx[1] = cg;\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx) * _W(kernelIx);\n        }\n\n        "+this.incrementIndex("kernelIx","shapeW")+"\n      }\n    }\n    "},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("CG")+" int CG;\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("C")+" int C;\n    "+this.getVarModifier("dilations")+" int dilations["+this.maxRank+"];\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "+this.getVarModifier("activation")+" int activation;\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n\n      "+this.getMainBody()+"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      } else if (activation == 2) {\n        res = max(0.0, min(res,6.0));\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X","W"]},n.prototype.getUniformAttrs=function(){return[{name:"CG"},{name:"kernelSize"},{name:"C"},{name:"dataRank"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"dilations",length:this.maxRank},{name:"activation"}]},n.prototype.getActivationFlag=function(t){return"id"===t?0:"relu"===t?1:"relu6"===t?2:void 0},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{X:t.X,W:t.W});var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],u=O(o),s=C(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[n,i];return p=p.concat(s),this.compute(p,{X:t.X,W:t.W},{CG:a,kernelSize:u,C:e,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations),activation:this.getActivationFlag(t.activation)})},n.prototype.getOutputShape=function(t){var n=t.X.shape[0],e=t.X.shape.slice(2),r=t.W.shape.slice(2),o=t.W.shape[0],i=C(e,r,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),a=[n,o];return a=a.concat(i)},n.prototype.compile=function(n,e){void 0!==n.shapeW&&(n.CG=n.shapeW[1],n.kernelSize=O(n.shapeW.slice(2)),n.dataRank=n.shapeW.length-2,this.maxRank=n.shapeW.length),void 0!==n.shapeX&&(n.C=n.shapeX[1],n.dataRank=n.shapeX.length-2,this.maxRank=n.shapeX.length),void 0!==n.activation&&"string"===typeof n.activation&&(n.activation=this.getActivationFlag(n.activation)),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n),o=O(t.W.shape.slice(2)),i=t.X.shape[1],a=t.X.shape.slice(2);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeW:t.W.shape,widthW:t.W.memory.width,heightW:t.W.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,pads:t.pads,dilations:t.dilations,strides:t.strides,CG:t.W.shape[1],kernelSize:o,dataRank:a.length,C:i,activation:this.getActivationFlag(t.activation)}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.W.shape+"-"+t.dilations+"-"+t.pads+"-"+t.dilations+"-"+t.strides+"-"+t.activation},n}(pt),wt=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.maxIterations=1e6,r}return vt(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int biasIndex["+this.maxRank+"];\n      "+this.initIndex("biasIndex")+"\n      biasIndex[0] = index[1];\n      float res = _B(biasIndex);\n\n      "+this.getMainBody()+"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X","W","B"]},n.prototype.calc=function(t){var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],u=O(o),s=C(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[n,i];return p=p.concat(s),this.compute(p,{X:t.X,W:t.W,B:t.B},{CG:a,kernelSize:u,C:e,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations),activation:this.getActivationFlag(t.activation)})},n.prototype.getCompilationInfo=function(n,e){var r=t.prototype.getCompilationInfo.call(this,n,e);return mt(mt({},r),{shapeB:n.B.shape,widthB:n.B.memory.width,heightB:n.B.memory.height})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.B.shape},n}(gt),bt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),xt=function(t){function n(n,e){return t.call(this,n,e)||this}return bt(n,t),n.prototype.operation=function(t){return"abs("+t+")"},n}(lt),_t=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ot=function(t){function n(n,e){return t.call(this,n,e)||this}return _t(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int["+this.maxRank+"] index) {\n      return "+this.getOp("_A(index)","_B(index)")+";\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getOutputShape=function(t){return t.outputShape},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B})},n.prototype.compile=function(n,e){void 0!==n.shapeA&&(this.maxRank=n.shapeA.length),void 0!==n.shapeB&&(this.maxRank=n.shapeB.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=ot.getAllocationDimensions(O(t.outputShape),n);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.B.shape,widthB:t.B.memory.width,heightB:t.B.memory.height,shapeOutput:t.outputShape,widthOutput:e.width,heightOutput:e.height}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape},n}(pt),At=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),kt=function(t){function n(n,e){return t.call(this,n,e)||this}return At(n,t),n.prototype.getOp=function(t,n){return t+" + "+n},n}(Ot),St=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Pt=function(t){function n(n,e){return t.call(this,n,e)||this}return St(n,t),n.prototype.getOp=function(t,n){return t+"*"+n},n}(Ot),jt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),It=function(t){function n(n,e){return t.call(this,n,e)||this}return jt(n,t),n.prototype.getOp=function(t,n){return t+" - "+n},n}(Ot),Tt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Xt=function(t){function n(n,e){return t.call(this,n,e)||this}return Tt(n,t),n.prototype.getOp=function(t,n){return t+"/"+n},n}(Ot),Mt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ct=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.maxIterations=1e6,r}return Mt(n,t),n.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d];\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("includePad")+" int includePad;\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "+this.getVarModifier("kernelShape")+" int kernelShape["+this.maxRank+"];\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n      int count = 0;\n\n      int n = index[0];\n      int c = index[1];\n\n      int kernelIx["+this.maxRank+"];\n      "+this.initIndex("kernelIx")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i >= dataRank) {\n          break;\n        }\n        kernelIx[i] = 0;\n      }\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n      inputIx[0] = n;\n      inputIx[1] = c;\n\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx);\n        }\n\n        if (!skip || includePad == 1) {\n          count += 1;\n        }\n\n        "+this.incrementIndex("kernelIx","kernelShape")+"\n      }\n\n      res = res / float(count);\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getUniformAttrs=function(){return[{name:"kernelSize"},{name:"dataRank"},{name:"includePad"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"kernelShape",length:this.maxRank}]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{X:t.X});var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=O(t.kernelShape),i=C(r,t.kernelShape,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),new Array(r.length).fill(1),t.strides),a=[n,e];return a=a.concat(i),this.compute(a,{X:t.X},{kernelSize:o,includePad:t.includePad?1:0,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),kernelShape:this.copyPad(t.kernelShape)})},n.prototype.getOutputShape=function(t){var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=C(r,t.kernelShape,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),new Array(r.length).fill(1),t.strides),i=[n,e];return i=i.concat(o)},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(n.dataRank=n.shapeX.length-2,this.maxRank=n.shapeX.length),!0===n.includePad?n.includePad=1:!1===n.includePad&&(n.includePad=0),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n),o=O(t.kernelShape);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,kernelShape:t.kernelShape,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,pads:t.pads,strides:t.strides,kernelSize:o,dataRank:t.X.shape.length-2,includePad:t.includePad?1:0}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.kernelShape+"-"+t.pads+"-"+t.strides+"-"+t.includePad},n}(pt),Vt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Rt=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.maxIterations=1e6,r}return Vt(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("mappedInputStrides")+" int mappedInputStrides["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int sumDims["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int sumSize;\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n\n      int inputPos = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (mappedInputStrides[i] == -1 || index[i] == -1) {\n          break;\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n      }\n\n      "+this.posToIndex("stridesX","inputIx","inputPos")+"\n\n      float res = 0.0;\n\n      for (int i = 0; i < "+this.maxIterations+"; i++) {\n        if (i >= sumSize) {\n          break;\n        }\n        float curr = _X(inputIx);\n        if (i == 0) {\n          res = "+this.init("curr")+";\n        } else {\n          res = "+this.update("curr","res")+";\n        }\n\n        "+this.incrementConditional("inputIx","shapeX","sumDims")+"\n      }\n\n      "+this.post("res")+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.post=function(t){return""},n.prototype.init=function(t){return t},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getUniformAttrs=function(){return[{name:"mappedInputStrides",length:this.maxRank},{name:"sumDims",length:this.maxRank},{name:"sumSize"}]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{X:t.X});for(var n=U(t.X.shape,t.axes,t.keepDims),e=n[0],r=n[1],o=A(t.X.shape),i=[],a=0,u=r;a<u.length;a++){var s=u[a];i.push(o[s])}var p=1,c=new Array(t.X.shape.length).fill(0);for(s=0;s<t.axes.length;s++)c[t.axes[s]]=1,p*=t.X.shape[t.axes[s]];return this.compute(e,{X:t.X},{mappedInputStrides:this.pad(i),sumDims:this.pad(c),sumSize:p})},n.prototype.getOutputShape=function(t){var n=U(t.X.shape,t.axes,t.keepDims),e=n[0];n[1];return e},n.prototype.compile=function(n,e){if(void 0!==n.shapeX&&void 0!==n.axes&&void 0!==n.keepDims){for(var r=U(n.shapeX,n.axes,n.keepDims),o=r[0],i=r[1],a=A(n.shapeX),u=[],s=0,p=i;s<p.length;s++){var c=p[s];u.push(a[c])}var f=1,h=new Array(n.shapeX.length).fill(0);for(c=0;c<n.axes.length;c++)h[n.axes[c]]=1,f*=n.shapeX[n.axes[c]];n.sumDims=h,n.shapeOutput=o,n.mappedInputStrides=u,n.sumSize=f,delete n.keepDims,delete n.axes,this.maxRank=n.shapeX.length}t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){for(var e=U(t.X.shape,t.axes,t.keepDims),r=e[0],o=e[1],i=A(t.X.shape),a=[],u=0,s=o;u<s.length;u++){var p=s[u];a.push(i[p])}var c=1,f=new Array(t.X.shape.length).fill(0);for(p=0;p<t.axes.length;p++)f[t.axes[p]]=1,c*=t.X.shape[t.axes[p]];var h=ot.getAllocationDimensions(O(r),n);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:r,widthOutput:h.width,heightOutput:h.height,mappedInputStrides:a,sumDims:f,sumSize:c}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axes+"-"+t.keepDims},n}(pt),Bt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Et=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Bt(n,t),n.prototype.update=function(t,n){return t+" + "+n},n.prototype.post=function(t){return t+" = "+t+"/float(sumSize);"},n}(Rt),zt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ut=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return zt(n,t),n.prototype.update=function(t,n){return"("+t+"*"+t+") + "+n},n.prototype.post=function(t){return t+" = "+t+"/float(sumSize);"},n.prototype.init=function(t){return t+"*"+t},n}(Rt),Dt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ft=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Dt(n,t),n.prototype.update=function(t,n){return"("+t+"*"+t+") + "+n},n.prototype.init=function(t){return t+"*"+t},n.prototype.compile=function(n,e){t.prototype.compile.call(this,n,32)},n}(Rt),Gt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Wt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Gt(n,t),n.prototype.update=function(t,n){return t+" + "+n},n}(Rt),Nt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),qt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Nt(n,t),n.prototype.update=function(t,n){return t+" * "+n},n}(Rt),Jt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Lt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Jt(n,t),n.prototype.update=function(t,n){return"max("+t+", "+n+")"},n}(Rt),Ht=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Yt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Ht(n,t),n.prototype.update=function(t,n){return"min("+t+", "+n+")"},n}(Rt),Kt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Qt=function(t){function n(n,e){return t.call(this,n,e)||this}return Kt(n,t),n.prototype.operation=function(t){return"ceil("+t+")"},n}(lt),Zt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),$t=function(t){function n(n,e){return t.call(this,n,e)||this}return Zt(n,t),n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      vec4 maxVec = vec4(maxVal,maxVal,maxVal,maxVal);\n      vec4 minVec = vec4(minVal,minVal,minVal,minVal);\n\n      vec4 res = texture2D(X, uv);\n      if (doMin == 1) {\n        res = max(minVec, res);\n      }\n      if (doMax == 1) {\n        res = min(maxVec, res);\n      }\n\n      gl_FragColor = res;\n    }\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("minVal")+" float minVal;\n    "+this.getVarModifier("maxVal")+" float maxVal;\n    "+this.getVarModifier("doMin")+" int doMin;\n    "+this.getVarModifier("doMax")+" int doMax;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"minVal",type:"float"},{name:"maxVal",type:"float"},{name:"doMin"},{name:"doMax"}]},n.prototype.calc=function(t){return this.fullyStatic?this.compute(this.outputShape,{X:t.input}):this.compute(t.input.shape,{X:t.input},{minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0})},n.prototype.getOutputShape=function(t){return t.input.shape},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=ot.getAllocationDimensions(t.input.size,n);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:t.input.shape,widthOutput:e.width,heightOutput:e.height,minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0}},n.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.minVal+"-"+t.maxVal},n}(pt),tn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),nn=function(t){function n(n,e){return t.call(this,n,e)||this}return tn(n,t),n.prototype.operation=function(t){return"floor("+t+")"},n}(lt),en=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),rn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},on=function(t){function n(n,e){return t.call(this,n,e)||this}return en(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("axis")+" int axis;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"axis"}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i == axis) {\n          if (index[i] >= shapeA[i]) {\n            index[i] = index[i] - shapeA[i];\n            res = _B(index);\n          } else {\n            res = _A(index);\n          }\n          break;\n        }\n      }\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{A:t.A,B:t.B});var n=this.getOutputShape(t);return this.compute(n,{A:t.A,B:t.B},{axis:t.axis})},n.prototype.getOutputShape=function(t){var n=rn(t.A.shape);return n[t.axis]+=t.B.shape[t.axis],n},n.prototype.compile=function(n,e){void 0!==n.shapeA&&(this.maxRank=n.shapeA.length),void 0!==n.shapeB&&(this.maxRank=n.shapeB.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.B.shape,widthB:t.B.memory.width,heightB:t.B.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,axis:t.axis}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape+"-"+t.axis},n}(pt),an=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),un=function(t){function n(n,e){return t.call(this,n,e)||this}return an(n,t),n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = texture2D(X, uv);\n    }\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){var n=this.getOutputShape(t);return this.compute(n,{X:t.input})},n.prototype.getOutputShape=function(t){var n=t.outputShape;return void 0===n&&(n=t.input.shape),n},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height}},n.prototype.getInputInfoString=function(t){return t.input+"-"+this.getOutputShape(t)},n}(pt),sn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),pn=function(t){function n(n,e){return t.call(this,n,e)||this}return sn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      return _X(index);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){return this.compute(t.outputShape,{X:t.input})},n.prototype.getOutputShape=function(t){return t.outputShape},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height}},n.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.outputShape},n}(pt),cn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),fn=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.gatherMaxIxSize=10,r}return cn(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("axis")+" int axis;\n    "+this.getVarModifier("indexValues")+" int indexValues["+this.gatherMaxIxSize+"];\n    "+this.getVarModifier("mappedIndexStrides")+" int mappedIndexStrides["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int mappedInputStrides["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"axis"},{name:"indexValues",length:this.gatherMaxIxSize},{name:"mappedInputStrides",length:this.maxRank},{name:"mappedIndexStrides",length:this.maxRank}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputPos = 0;\n      int indexPos = 0;\n\n      int strideAxis = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n        if (i == axis) {\n          strideAxis = stridesX[i];\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n        indexPos += mappedIndexStrides[i]*index[i];\n      }\n\n      for (int i = 0; i < "+this.gatherMaxIxSize+"; i++) {\n        if (i == indexPos) {\n          inputPos += indexValues[i]*strideAxis;\n          break;\n        }\n      }\n\n      return getValueAtPos(inputPos, widthX, heightX, X);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{X:t.X});if(t.indices.size>this.gatherMaxIxSize)throw new Error("Gather on GPU can deal with at most "+this.gatherMaxIxSize+" indices, input had "+t.indices.size);for(var n=t.X.shape.length,e=t.indices.shape.length,r=A(t.X.shape),o=A(t.indices.shape),i=n+e-1,a=new Array(i),u=new Array(i).fill(0),s=new Array(i).fill(0),p=0;p<t.axis;p++)a[p]=t.X.shape[p],u[p]=r[p],s[p]=0;for(p=0;p<e;p++)a[p+t.axis]=t.indices.shape[p],s[p+t.axis]=o[p],u[p+t.axis]=0;for(p=t.axis+1;p<n;p++)a[p+e-1]=t.X.shape[p],u[p+e-1]=r[p],s[p+e-1]=0;return this.compute(a,{X:t.X},{axis:t.axis,indexValues:this.pad(Array.from(t.indices.values),this.gatherMaxIxSize),mappedInputStrides:this.pad(u),mappedIndexStrides:this.pad(s)})},n.prototype.getOutputShape=function(t){for(var n=t.X.shape.length,e=t.indices.shape.length,r=new Array(n+e-1),o=0;o<t.axis;o++)r[o]=t.X.shape[o];for(o=0;o<e;o++)r[o+t.axis]=t.indices.shape[o];for(o=t.axis+1;o<n;o++)r[o+e-1]=t.X.shape[o];return r},n.prototype.compile=function(n,e){if(void 0!==n.shapeX&&(this.maxRank=n.shapeX.length,void 0!==n.indices&&void 0!==n.axis)){for(var r=n.shapeX.length,o=n.indices.shape.length,i=A(n.shapeX),a=A(n.indices.shape),u=r+o-1,s=new Array(u),p=new Array(u).fill(0),c=new Array(u).fill(0),f=0;f<n.axis;f++)s[f]=n.shapeX[f],p[f]=i[f],c[f]=0;for(f=0;f<o;f++)s[f+n.axis]=n.indices.shape[f],c[f+n.axis]=a[f],p[f+n.axis]=0;for(f=n.axis+1;f<r;f++)s[f+o-1]=n.shapeX[f],p[f+o-1]=i[f],c[f+o-1]=0;n.mappedIndexStrides=c,n.mappedInputStrides=p,n.indexValues=Array.from(n.indices.values),delete n.indices}t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){for(var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n),o=t.X.shape.length,i=t.indices.shape.length,a=A(t.X.shape),u=A(t.indices.shape),s=o+i-1,p=new Array(s),c=new Array(s).fill(0),f=new Array(s).fill(0),h=0;h<t.axis;h++)p[h]=t.X.shape[h],c[h]=a[h],f[h]=0;for(h=0;h<i;h++)p[h+t.axis]=t.indices.shape[h],f[h+t.axis]=u[h],c[h+t.axis]=0;for(h=t.axis+1;h<o;h++)p[h+i-1]=t.X.shape[h],c[h+i-1]=a[h],f[h+i-1]=0;return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,axis:t.axis,indexValues:Array.from(t.indices.values),mappedIndexStrides:f,mappedInputStrides:c}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axis+"-"+Array.from(t.indices.values)+"-"+t.indices.shape},n}(pt),hn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ln=function(){return(ln=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},yn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},dn=function(t){function n(n,e){var r=t.call(this,n,e)||this;return r.maxIterations=1e6,r}return hn(n,t),n.prototype.getMainBody=function(){return"\n      int ixA["+this.maxRank+"];\n      "+this.initIndex("ixA")+"\n      int ixB["+this.maxRank+"];\n      "+this.initIndex("ixA")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i >= rank - 2) {\n          break;\n        }\n        ixA[i] = index[i];\n        ixB[i] = index[i];\n      }\n\n      int m = 0;\n      int o = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i == rank-2) {\n          m = index[i];\n          o = index[i+1];\n\n          if (aTranspose == 0) {\n            ixA[i] = m;\n          } else {\n            ixA[i+1] = m;\n          }\n\n          if (bTranspose == 0) {\n            ixB[i+1] = o;\n          } else {\n            ixB[i] = o;\n          }\n\n          break;\n        }\n      }\n\n      float res = 0.0;\n\n      for (int n = 0; n < "+this.maxIterations+"; n++) {\n        if (n >= N) {\n          break;\n        }\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (i == rank-2) {\n            if (aTranspose == 0) {\n              ixA[i+1] = n;\n            } else {\n              ixA[i] = n;\n            }\n\n            if (bTranspose == 0) {\n              ixB[i] = n;\n            } else {\n              ixB[i+1] = n;\n            }\n\n            break;\n          }\n        }\n        res += _A(ixA) * _B(ixB);\n      }\n\n      res = res*alpha;\n    "},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("M")+" int M;\n    "+this.getVarModifier("N")+" int N;\n    "+this.getVarModifier("O")+" int O;\n    "+this.getVarModifier("rank")+" int rank;\n    "+this.getVarModifier("aTranspose")+" int aTranspose;\n    "+this.getVarModifier("bTranspose")+" int bTranspose;\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      "+this.getMainBody()+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.getUniformAttrs=function(){return[{name:"M"},{name:"N"},{name:"O"},{name:"rank"},{name:"aTranspose"},{name:"bTranspose"},{name:"alpha",type:"float"},{name:"beta",type:"float"}]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{A:t.a,B:t.b});var n=t.a.shape.length,e=t.aTranspose?t.a.shape[n-1]:t.a.shape[n-2],r=t.aTranspose?t.a.shape[n-2]:t.a.shape[n-1],o=t.bTranspose?t.b.shape[n-2]:t.b.shape[n-1],i=t.a.shape.slice(0,n-2),a=yn(i,[e,o]),u={M:e,N:r,O:o,rank:n,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta};return this.compute(a,{A:t.a,B:t.b},u)},n.prototype.getOutputShape=function(t){var n=t.a.shape.length,e=t.aTranspose?t.a.shape[n-1]:t.a.shape[n-2],r=t.bTranspose?t.b.shape[n-2]:t.b.shape[n-1],o=t.a.shape.slice(0,n-2);return yn(o,[e,r])},n.prototype.compile=function(n,e){if(void 0!==n.shapeA){var r=n.shapeA.length;if(n.rank=r,this.maxRank=r,void 0!==n.aTranspose){var o=n.aTranspose?n.shapeA[r-1]:n.shapeA[r-2],i=n.aTranspose?n.shapeA[r-2]:n.shapeA[r-1];n.M=o,n.N=i,n.aTranspose=n.aTranspose?1:0}}if(void 0!==n.shapeB&&void 0!==n.bTranspose){r=n.shapeB.length;var a=n.bTranspose?n.shapeB[r-2]:n.shapeB[r-1];n.O=a,n.bTranspose=n.bTranspose?1:0}t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n),o=t.a.shape.length,i=t.aTranspose?t.a.shape[o-1]:t.a.shape[o-2],a=t.aTranspose?t.a.shape[o-2]:t.a.shape[o-1],u=t.bTranspose?t.b.shape[o-2]:t.b.shape[o-1];return{shapeA:t.a.shape,widthA:t.a.memory.width,heightA:t.a.memory.height,shapeB:t.b.shape,widthB:t.b.memory.width,heightB:t.b.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,M:i,N:a,O:u,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta,rank:o}},n.prototype.getInputInfoString=function(t){return t.a.shape+"-"+t.b.shape+"-"+t.aTranspose+"-"+t.bTranspose+"-"+t.alpha+"-"+t.beta},n}(pt),vn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return hn(n,t),n.prototype.getTextureNames=function(){return["A","B","C"]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      "+this.getMainBody()+"\n\n      res += beta*_C(index);\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{A:t.a,B:t.b,C:t.c});var n=t.a.shape.length,e=t.aTranspose?t.a.shape[n-1]:t.a.shape[n-2],r=t.aTranspose?t.a.shape[n-2]:t.a.shape[n-1],o=t.bTranspose?t.b.shape[n-2]:t.b.shape[n-1],i=t.a.shape.slice(0,n-2),a=yn(i,[e,o]),u={M:e,N:r,O:o,rank:n,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta};return this.compute(a,{A:t.a,B:t.b,C:t.c},u)},n.prototype.getCompilationInfo=function(n,e){var r=t.prototype.getCompilationInfo.call(this,n,e);return ln(ln({},r),{shapeC:n.c.shape,widthC:n.c.memory.width,heightC:n.c.memory.height})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.c.shape},n}(dn),mn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),gn=function(t){function n(n,e){return t.call(this,n,e)||this}return mn(n,t),n.prototype.getOp=function(t,n){return"pow("+t+", "+n+")"},n}(Ot),wn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),bn=function(t){function n(n,e){return t.call(this,n,e)||this}return wn(n,t),n.prototype.operation=function(t){return"sqrt("+t+")"},n}(lt),xn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),_n=function(t){function n(n,e){return t.call(this,n,e)||this}return xn(n,t),n.prototype.operation=function(t){return"log("+t+")"},n}(lt),On=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),An=function(t){function n(n,e){return t.call(this,n,e)||this}return On(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("mappedStrides")+" int mappedStrides["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"mappedStrides",length:this.maxRank}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      return getValueAt(index, mappedStrides, widthA, heightA, A);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A"]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{A:t.A});for(var n=t.A.shape.length,e=this.getOutputShape(t),r=A(t.A.shape),o=new Array(n),i=0;i<n;i++)o[i]=r[t.permutation[i]];return this.compute(e,{A:t.A},{mappedStrides:this.pad(o)})},n.prototype.getOutputShape=function(t){for(var n=t.A.shape.length,e=new Array(n),r=0;r<n;r++)e[r]=t.A.shape[t.permutation[r]];return e},n.prototype.compile=function(n,e){if(void 0!==n.shapeA&&(this.maxRank=n.shapeA.length,void 0!==n.permutation)){for(var r=n.shapeA.length,o=A(n.shapeA),i=new Array(r),a=0;a<r;a++)i[a]=o[n.permutation[a]];n.mappedStrides=i,delete n.permutation}t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){for(var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n),o=t.A.shape.length,i=A(t.A.shape),a=new Array(o),u=0;u<o;u++)a[u]=i[t.permutation[u]];return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,mappedStrides:a}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.permutation},n}(pt),kn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Sn=function(t){function n(n,e){return t.call(this,n,e)||this}return kn(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("repeats")+" int repeats["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"repeats",length:this.maxRank}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIndex["+this.maxRank+"];\n      "+this.initIndex("inIndex")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (repeats[i] == -1) {\n          break;\n        }\n        int d = index[i] / shapeA[i];\n        inIndex[i] = index[i] - d*shapeA[i];\n      }\n\n      return _A(inIndex);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getOutputShape=function(t){for(var n=t.A.shape.length,e=new Array(n),r=0;r<n;r++)e[r]=t.A.shape[r]*t.repeats[r];return e},n.prototype.getTextureNames=function(){return["A"]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{A:t.A});var n=this.getOutputShape(t);return this.compute(n,{A:t.A},{repeats:this.copyPad(t.repeats)})},n.prototype.compile=function(n,e){void 0!==n.shapeA&&(this.maxRank=n.shapeA.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,repeats:t.repeats}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.repeats},n}(pt),Pn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),jn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},In=function(t){function n(n,e){return t.call(this,n,e)||this}return Pn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n      if (mode == 0) {\n        float res = value;\n\n        int outOfBounds = 0;\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0 || inputIx[i] >= shapeX[i]) {\n            outOfBounds = 1;\n            break;\n          }\n        }\n\n        if (outOfBounds == 0) {\n          res = _X(inputIx);\n        }\n\n        return res;\n      } else if (mode == 1) {\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = -inputIx[i];\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = 2*shapeX[i] - inputIx[i] - 2;\n          }\n        }\n\n        return _X(inputIx);\n      } else {\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = 0;\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = shapeX[i] - 1;\n          }\n        }\n\n        return _X(inputIx);\n      }\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("pads")+" int pads["+2*this.maxRank+"];\n    "+this.getVarModifier("value")+" float value;\n    "+this.getVarModifier("mode")+" int mode;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"value",type:"float"},{name:"pads",length:2*this.maxRank},{name:"mode"}]},n.prototype.getModeFlag=function(t){return"constant"===t?0:"reflect"===t?1:2},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{X:t.input});var n=this.getOutputShape(t);return this.compute(n,{X:t.input},{pads:this.copyPad(t.pads,2*this.maxRank),value:t.value,mode:this.getModeFlag(t.mode)})},n.prototype.getOutputShape=function(t){for(var n=t.input.shape.length,e=jn(t.input.shape),r=0;r<n;r++)e[r]+=t.pads[r]+t.pads[r+n];return e},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),void 0!==n.mode&&"string"===typeof n.mode&&(n.mode=this.getModeFlag(n.mode)),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,pads:t.pads,mode:this.getModeFlag(t.mode),value:t.value}},n.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.pads+"-"+t.mode+"-"+t.value},n}(pt),Tn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Xn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Mn=function(t){function n(n,e){return t.call(this,n,e)||this}return Tn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIx["+this.maxRank+"];\n      "+this.initIndex("inIx")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = index[i] + offsets[i];\n      }\n\n      return _X(inIx);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("offsets")+" int offsets["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"offsets",length:this.maxRank}]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{X:t.X});for(var n=t.X.shape.length,e=Xn(t.X.shape),r=new Array(n).fill(0),o=0,i=0;i<n&&o<t.axes.length;i++)i==t.axes[o]&&(e[i]=t.ends[o]-t.starts[o],r[i]=t.starts[o],o++);return this.compute(e,{X:t.X},{offsets:this.pad(r)})},n.prototype.getOutputShape=function(t){for(var n=t.X.shape.length,e=Xn(t.X.shape),r=0,o=0;o<n&&r<t.axes.length;o++)o==t.axes[r]&&(e[o]=t.ends[r]-t.starts[r],r++);return e},n.prototype.compile=function(n,e){if(void 0!==n.shapeX&&(this.maxRank=n.shapeX.length,void 0!==n.axes&&void 0!==n.starts&&void 0!==n.starts)){for(var r=n.shapeX.length,o=new Array(r).fill(0),i=0,a=0;a<r&&i<n.axes.length;a++)a==n.axes[i]&&(o[a]=n.starts[i],i++);n.offsets=o,delete n.starts,delete n.ends,delete n.axes}t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){for(var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n),o=t.X.shape.length,i=Xn(t.X.shape),a=new Array(o).fill(0),u=0,s=0;s<o&&u<t.axes.length;s++)s==t.axes[u]&&(i[s]=t.ends[u]-t.starts[u],a[s]=t.starts[u],u++);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,offsets:a}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axes+"-"+t.starts+"-"+t.ends},n}(pt),Cn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Vn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Rn=function(t){function n(n,e){return t.call(this,n,e)||this}return Cn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIx["+this.maxRank+"];\n      "+this.initIndex("inIx")+"\n\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = int(floor(float(index[i]) / scales[i]));\n      }\n\n      return _X(inIx);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("scales")+" float scales["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"scales",length:this.maxRank,type:"float"}]},n.prototype.calc=function(t){if(this.fullyStatic)return this.compute(this.outputShape,{X:t.X});var n=this.getOutputShape(t);return this.compute(n,{X:t.X},{scales:this.copyPad(t.scales)})},n.prototype.getOutputShape=function(t){for(var n=t.X.shape.length,e=Vn(t.X.shape),r=0;r<n;r++)e[r]=Math.floor(e[r]*t.scales[r]);return e},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,scales:t.scales}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.scales},n}(pt),Bn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),En=function(t){function n(n,e){return t.call(this,n,e)||this}return Bn(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("epsilon")+" float epsilon;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"epsilon",type:"float"}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int["+this.maxRank+"] index) {\n      float result = _X(index) - _Mean(index);\n      result = result / sqrt(_Variance(index) + epsilon);\n      result = result * _Scale(index) + _Bias(index);\n      return result;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getOutputShape=function(t){return t.X.shape},n.prototype.getTextureNames=function(){return["X","Mean","Variance","Scale","Bias"]},n.prototype.calc=function(t){return this.compute(t.X.shape,{X:t.X,Mean:t.Mean,Variance:t.Variance,Scale:t.Scale,Bias:t.Bias},{epsilon:t.epsilon})},n.prototype.compile=function(n,e){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n,e)},n.prototype.getCompilationInfo=function(t,n){var e=this.getOutputShape(t),r=ot.getAllocationDimensions(O(e),n);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeBias:t.Bias.shape,widthBias:t.Bias.memory.width,heightBias:t.Bias.memory.height,shapeMean:t.Mean.shape,widthMean:t.Mean.memory.width,heightMean:t.Mean.memory.height,shapeScale:t.Scale.shape,widthScale:t.Scale.memory.width,heightScale:t.Scale.memory.height,shapeVariance:t.Variance.shape,widthVariance:t.Variance.memory.width,heightVariance:t.Variance.memory.height,shapeOutput:e,widthOutput:r.width,heightOutput:r.height,epsilon:t.epsilon}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.Mean.shape+"-"+t.Variance.shape+"-"+t.Scale.shape+"-"+t.Bias.shape+"-"+t.epsilon},n}(pt),zn=function(){function t(t,n){void 0===n&&(n=2),this.getOp=t,this.minCallsToCompile=n,this.opDict={}}return t.prototype.getDefault=function(t){var n="default-"+t;if(void 0===this.opDict[n]){var e=this.getOp();e.compile({},t),this.opDict[n]={infoString:n,numCalls:0,operation:e}}return this.opDict[n]},t.prototype.calc=function(t,n){var e=this.getDefault(n),r=e.operation.getInputInfoString(t);void 0===this.opDict[r]&&(this.opDict[r]={infoString:r,numCalls:0});var o=this.opDict[r];if(o.numCalls++,o.numCalls===this.minCallsToCompile){o.operation=this.getOp();var i=e.operation.getCompilationInfo(t,n);o.operation.compile(i,n)}return o.numCalls>=this.minCallsToCompile?o.operation.calc(t):(e.numCalls++,e.operation.calc(t))},t}(),Un=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Dn=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Fn=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Gn=function(t){function n(n,e,r){var o=t.call(this)||this;return o.shape=e,o.precision=r,o.deleted=!1,o.size=O(e),n instanceof Float32Array?o.memory=ot.allocateTexture(n,r):o.memory=n,o}return Un(n,t),n.fromData=function(t,e){var r=rt.texture({data:t,format:"rgba",type:32===e?"float":"half float"}),o=ot.allocateFramebuffer(r,e),i=r.width;return new n(o,[r.height,i,4],e)},n.prototype.getValues=function(){var t=this;return new Promise((function(n,e){rt({framebuffer:t.memory.frameBuffer})((function(){var e=new Float32Array(t.memory.size);e=rt.read(e),n(e.subarray(0,t.size))}))}))},n.prototype.getShape=function(){return this.shape},n.prototype.gpu=function(){return Dn(this,void 0,void 0,(function(){return Fn(this,(function(t){return[2,this]}))}))},n.prototype.delete=function(){this.deleted=!0,ot.deallocate(this.memory),this.memory=void 0},n.prototype.copy=function(t){return ge.calc({input:this},t||this.precision)},n.prototype.exp=function(){return Ln.calc({input:this},this.precision)},n.prototype.log=function(){return $n.calc({input:this},this.precision)},n.prototype.sqrt=function(){return Zn.calc({input:this},this.precision)},n.prototype.abs=function(){return Hn.calc({input:this},this.precision)},n.prototype.floor=function(){return Kn.calc({input:this},this.precision)},n.prototype.ceil=function(){return Yn.calc({input:this},this.precision)},n.prototype.add_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add GPU tensor to GPU tensor");return ie.calc({A:t,B:e,outputShape:r},this.precision)},n.prototype.subtract_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only subtract GPU tensor from GPU tensor");return ae.calc({A:t,B:e,outputShape:r},this.precision)},n.prototype.multiply_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only multiply GPU tensor with GPU tensor");return ue.calc({A:t,B:e,outputShape:r},this.precision)},n.prototype.divide_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only divide GPU tensor by GPU tensor");return se.calc({A:t,B:e,outputShape:r},this.precision)},n.prototype.power_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only take GPU tensor to power of GPU tensor");return pe.calc({A:t,B:e,outputShape:r},this.precision)},n.prototype.matMul=function(t){if(!(t instanceof n))throw new Error("Can only matrix multiply GPU tensor to GPU tensor");return Nn.calc({A:this,B:t},this.precision)},n.prototype.gemm_impl=function(t,e,r,o,i,a){if(!(t instanceof n&&(void 0===a||a instanceof n)))throw new Error("Can only do gemm with CPU tensors");return void 0===a?qn.calc({a:this,b:t,aTranspose:e,bTranspose:r,alpha:o,beta:i},this.precision):Jn.calc({a:this,b:t,c:a,aTranspose:e,bTranspose:r,alpha:o,beta:i},this.precision)},n.prototype.sum_impl=function(t,n){return le.calc({X:this,axes:t,keepDims:n},this.precision)},n.prototype.sumSquare_impl=function(t,n){return he.calc({X:this,axes:t,keepDims:n},this.precision)},n.prototype.reduceMean_impl=function(t,n){return ce.calc({X:this,axes:t,keepDims:n},this.precision)},n.prototype.reduceMeanSquare_impl=function(t,n){return fe.calc({X:this,axes:t,keepDims:n},this.precision)},n.prototype.product_impl=function(t,n){return ye.calc({X:this,axes:t,keepDims:n},this.precision)},n.prototype.max_impl=function(t,n){return de.calc({X:this,axes:t,keepDims:n},this.precision)},n.prototype.min_impl=function(t,n){return ve.calc({X:this,axes:t,keepDims:n},this.precision)},n.prototype.conv_impl=function(t,e,r,o,i,a,u){if(!(t instanceof n)||void 0!==a&&!(a instanceof n))throw new Error("Can only do convolution of GPU tensor with GPU tensor");return void 0===a?te.calc({X:this,W:t,pads:o,dilations:e,strides:i,activation:u},this.precision):ee.calc({X:this,W:t,B:a,pads:o,dilations:e,strides:i,activation:u},this.precision)},n.prototype.averagePool_impl=function(t,n,e,r){return ne.calc({X:this,includePad:r,kernelShape:t,pads:n,strides:e},this.precision)},n.prototype.reshape_impl=function(t,e){return e?ge.calc({input:this,outputShape:t},this.precision):new n(this.memory,t,this.precision)},n.prototype.concat=function(t,e){if(!(t instanceof n))throw new Error("Can only concat GPU tensor to GPU tensor");return me.calc({A:this,B:t,axis:e},this.precision)},n.prototype.transpose_impl=function(t){return xe.calc({A:this,permutation:t},this.precision)},n.prototype.clip=function(t,n){return Qn.calc({input:this,minVal:t,maxVal:n},this.precision)},n.prototype.repeat=function(t){return _e.calc({A:this,repeats:t},this.precision)},n.prototype.expand=function(t){var n=this.alignShapes(this.shape,t),e=n[0],r=(n[1],n[2]);return S(this.shape,r)?this.copy():we.calc({input:this.reshape(e,!1),outputShape:r},this.precision)},n.prototype.pad_impl=function(t,n,e){return re.calc({input:this,pads:t,mode:n,value:e},this.precision)},n.prototype.gather=function(t,n){return be.calc({X:this,axis:t,indices:n},this.precision)},n.prototype.slice_impl=function(t,n,e){return Oe.calc({X:this,starts:t,ends:n,axes:e},this.precision)},n.prototype.upsample=function(t){return oe.calc({X:this,scales:t},this.precision)},n.prototype.normalize=function(t,e,r,o,i){if(!(t instanceof n)||!(e instanceof n)||!(o instanceof n)||!(i instanceof n))throw new Error("Can only normalize with CPU tensors");return Ae.calc({X:this,Mean:t,Variance:e,Scale:o,Bias:i,epsilon:r},this.precision)},n}(X),Wn=function(t,n,e){return new Gn(t,n,e)},Nn=new zn((function(){return new ft(Wn)})),qn=new zn((function(){return new dn(Wn)})),Jn=new zn((function(){return new vn(Wn)})),Ln=new zn((function(){return new dt(Wn)})),Hn=new zn((function(){return new xt(Wn)})),Yn=new zn((function(){return new Qt(Wn)})),Kn=new zn((function(){return new nn(Wn)})),Qn=new zn((function(){return new $t(Wn)})),Zn=new zn((function(){return new bn(Wn)})),$n=new zn((function(){return new _n(Wn)})),te=new zn((function(){return new gt(Wn)})),ne=new zn((function(){return new Ct(Wn)})),ee=new zn((function(){return new wt(Wn)})),re=new zn((function(){return new In(Wn)})),oe=new zn((function(){return new Rn(Wn)})),ie=new zn((function(){return new kt(Wn)})),ae=new zn((function(){return new It(Wn)})),ue=new zn((function(){return new Pt(Wn)})),se=new zn((function(){return new Xt(Wn)})),pe=new zn((function(){return new gn(Wn)})),ce=new zn((function(){return new Et(Wn)})),fe=new zn((function(){return new Ut(Wn)})),he=new zn((function(){return new Ft(Wn)})),le=new zn((function(){return new Wt(Wn)})),ye=new zn((function(){return new qt(Wn)})),de=new zn((function(){return new Lt(Wn)})),ve=new zn((function(){return new Yt(Wn)})),me=new zn((function(){return new on(Wn)})),ge=new zn((function(){return new un(Wn)})),we=new zn((function(){return new pn(Wn)})),be=new zn((function(){return new fn(Wn)})),xe=new zn((function(){return new An(Wn)})),_e=new zn((function(){return new Sn(Wn)})),Oe=new zn((function(){return new Mn(Wn)})),Ae=new zn((function(){return new En(Wn)})),ke=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Se=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Pe=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},je=new Promise((function(t,n){e.e(3).then(e.bind(null,46)).then((function(n){ut=n.Tensor,t()}))})),Ie=function(t){function n(n,e){var r=t.call(this)||this;if(n instanceof Float32Array){if(void 0===e)throw new Error("Need the shape when creating a Wasm tensor from values");r.wasmTensor=ut.create(e,n)}else r.wasmTensor=n;return r}return ke(n,t),n.prototype.getValues=function(){return Promise.resolve(this.wasmTensor.get_vals())},n.prototype.getShape=function(){return Array.from(this.wasmTensor.get_shape())},n.prototype.wasm=function(){return Se(this,void 0,void 0,(function(){return Pe(this,(function(t){return[2,this]}))}))},n.prototype.delete=function(){this.wasmTensor.free(),this.wasmTensor=void 0},n.prototype.copy=function(){return new n(this.wasmTensor.copy())},n.prototype.exp=function(){return new n(this.wasmTensor.exp())},n.prototype.log=function(){return new n(this.wasmTensor.log())},n.prototype.sqrt=function(){return new n(this.wasmTensor.sqrt())},n.prototype.abs=function(){return new n(this.wasmTensor.abs())},n.prototype.add_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add WASM tensor to WASM tensor");return new n(t.wasmTensor.addition(e.wasmTensor))},n.prototype.subtract_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only subtract WASM tensor from WASM tensor");return new n(t.wasmTensor.subtraction(e.wasmTensor))},n.prototype.multiply_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only multiply WASM tensor with WASM tensor");return new n(t.wasmTensor.multiply(e.wasmTensor))},n.prototype.divide_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only divide WASM tensor by WASM tensor");return new n(t.wasmTensor.divide(e.wasmTensor))},n.prototype.power_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only take WASM tensor to power of WASM tensor");return new n(t.wasmTensor.power(e.wasmTensor))},n.prototype.matMul=function(t){if(!(t instanceof n))throw new Error("Can only add WASM tensor to WASM tensor");return new n(this.wasmTensor.matmul(t.wasmTensor))},n.prototype.gemm_impl=function(t,e,r,o,i,a){if(!(t instanceof n&&(void 0===a||a instanceof n)))throw new Error("Can only do gemm with CPU tensors");return new n(void 0!==a?this.wasmTensor.gemm_with_c(t.wasmTensor,e,r,o,a.wasmTensor,i):this.wasmTensor.gemm(t.wasmTensor,e,r,o))},n.prototype.sum_impl=function(t,e){return new n(this.wasmTensor.sum(new Uint32Array(t),e))},n.prototype.sumSquare_impl=function(t,e){return new n(this.wasmTensor.sum_square(new Uint32Array(t),e))},n.prototype.product_impl=function(t,e){return new n(this.wasmTensor.product(new Uint32Array(t),e))},n.prototype.max_impl=function(t,e){return new n(this.wasmTensor.max(new Uint32Array(t),e))},n.prototype.min_impl=function(t,e){return new n(this.wasmTensor.min(new Uint32Array(t),e))},n.prototype.reduceMean_impl=function(t,e){return new n(this.wasmTensor.reduce_mean(new Uint32Array(t),e))},n.prototype.reduceMeanSquare_impl=function(t,e){return new n(this.wasmTensor.reduce_mean_square(new Uint32Array(t),e))},n.prototype.conv_impl=function(t,e,r,o,i,a){if(!(t instanceof n)||void 0!==a&&!(a instanceof n))throw new Error("Can only do convolution of CPU tensor with CPU tensor");return new n(void 0!==a?this.wasmTensor.conv_with_bias(t.wasmTensor,a.wasmTensor,new Uint32Array(e),r,new Uint32Array(o),new Uint32Array(i)):this.wasmTensor.conv(t.wasmTensor,new Uint32Array(e),r,new Uint32Array(o),new Uint32Array(i)))},n.prototype.averagePool_impl=function(t,e,r,o){return new n(this.wasmTensor.average_pool(new Uint32Array(t),new Uint32Array(e),new Uint32Array(r),o))},n.prototype.reshape_impl=function(t){var e=new Uint32Array(t);return new n(this.wasmTensor.reshape(e),e)},n.prototype.concat=function(t,e){if(!(t instanceof n))throw new Error("Can only concat WASM tensor to WASM tensor");return new n(this.wasmTensor.concat(t.wasmTensor,e))},n.prototype.transpose_impl=function(t){return new n(this.wasmTensor.transpose(new Uint32Array(t)))},n.prototype.clip=function(t,e){return void 0!==t&&void 0!==e?new n(this.wasmTensor.clip(t,e)):void 0!==t?new n(this.wasmTensor.clip_min(t)):void 0!==e?new n(this.wasmTensor.clip_max(e)):this.copy()},n.prototype.repeat=function(t){return new n(this.wasmTensor.repeat(new Uint32Array(t)))},n.prototype.expand=function(t){var e=this.getShape(),r=this.alignShapes(e,t),o=r[0],i=(r[1],r[2]);return S(e,i)?this.copy():new n(this.reshape(o,!1).wasmTensor.expand(new Uint32Array(i)))},n.prototype.pad_impl=function(t,e,r){return new n(this.wasmTensor.pad(new Uint32Array(t),n.padModeToInt[e],r))},n.prototype.gather=function(t,e){return new n(this.wasmTensor.gather(t,e.values,new Uint32Array(e.shape)))},n.prototype.floor=function(){return new n(this.wasmTensor.floor())},n.prototype.ceil=function(){return new n(this.wasmTensor.ceil())},n.prototype.slice_impl=function(t,e,r){return new n(this.wasmTensor.slice(new Uint32Array(t),new Uint32Array(e),new Uint32Array(r)))},n.prototype.upsample=function(t){return new n(this.wasmTensor.upsample(new Float32Array(t)))},n.prototype.normalize=function(t,e,r,o,i){if(!(t instanceof n)||!(e instanceof n)||!(o instanceof n)||!(i instanceof n))throw new Error("Can only normalize with CPU tensors");return new n(this.wasmTensor.normalize(t.wasmTensor,e.wasmTensor,r,o.wasmTensor,i.wasmTensor))},n.padModeToInt={constant:0,reflect:1,edge:2},n}(X),Te=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Xe=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function Me(t){return Te(this,void 0,void 0,(function(){var n;return Xe(this,(function(e){switch(e.label){case 0:return t instanceof K?[2,t]:[4,t.getValues()];case 1:return n=e.sent(),[2,new K(t.getShape(),n)]}}))}))}function Ce(t){return Te(this,void 0,void 0,(function(){var n;return Xe(this,(function(e){switch(e.label){case 0:return t instanceof Ie?[2,t]:[4,t.getValues()];case 1:return n=e.sent(),t instanceof K&&n instanceof Int32Array?[2,t]:[2,new Ie(n,new Uint32Array(t.getShape()))]}}))}))}function Ve(t,n){return Te(this,void 0,void 0,(function(){var e;return Xe(this,(function(r){switch(r.label){case 0:return t instanceof Gn?[2,t]:[4,t.getValues()];case 1:return e=r.sent(),t instanceof K&&e instanceof Int32Array?[2,t]:[2,new Gn(e,t.getShape(),n)]}}))}))}var Re=e(2),Be=e.n(Re),Ee=e(14),ze=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ue=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},De=function(){function t(t,n,e,r,o){this.attributes={};for(var i=0;i<t.length;i++)this.attributes[t[i].name]=t[i];this.inputs=n,this.outputs=e,this.onnxVersion=o,this.variableInputs=0;for(i=0;i<this.inputs.length;i++)void 0===r[this.inputs[i]]&&this.variableInputs++}return t.prototype.initialize=function(t){},t.prototype.getAttribute=function(t){return this.attributes[t]},t.prototype.getAttributeString=function(t){var n=this.attributes[t];if(void 0!==n){var e=n.s;return void 0!==e?new TextDecoder("utf-8").decode(e):void 0}},t.prototype.getAttributeInts=function(t){if(void 0!==this.attributes[t]){for(var n=this.attributes[t].ints,e=0;e<n.length;e++)Be.a.isLong(n[e])&&(n[e]=n[e].toNumber());return n}},t.prototype.getAttributeInt=function(t){var n=this.attributes[t];if(void 0!==n){var e=n.i;return Be.a.isLong(e)&&(e=e.toNumber()),e}},t.prototype.getAttributeFloat=function(t){var n=this.attributes[t];if(void 0!==n)return n.f},t.prototype.getAttributeTensor=function(t){var n=this.attributes[t];if(void 0!==n)return n.t},t.prototype.toCPU=function(){return ze(this,void 0,void 0,(function(){return Ue(this,(function(t){return[2]}))}))},t.prototype.toWASM=function(){return ze(this,void 0,void 0,(function(){return Ue(this,(function(t){return[2]}))}))},t.prototype.toGPU=function(t){return ze(this,void 0,void 0,(function(){return Ue(this,(function(t){return[2]}))}))},t}();function Fe(t){if(void 0!==t.segment&&null!==t.segment)throw new Error("Handling of tensor proto segment not yet implemented");var n=t.dims;if(void 0===n||null===n)throw new Error("Tensor shape must be specified");for(var e=0;e<n.length;e++)Be.a.isLong(n[e])&&(n[e]=n[e].toNumber());0===n.length&&(n=[1]);var r=O(n);if(1===t.dataType){if(t.floatData&&t.floatData.length>0)return new K(n,t.floatData);if(t.rawData&&t.rawData.length>0){var o=t.rawData.buffer.slice(t.rawData.byteOffset,t.rawData.byteOffset+t.rawData.byteLength),i=new Float32Array(o);return new K(n,i)}if(0===r)return new K(n);throw new Error("Cant process float tensor without float or raw data")}if(7===t.dataType){if(t.rawData&&t.rawData.length>0){for(i=new Int32Array(t.rawData.length/8),e=0;e<t.rawData.length;e+=8){var a=Be.a.fromBytesLE(Array.from(t.rawData.slice(e,e+8))).toNumber();i[e/8]=a}return new K(n,i,"int")}throw new Error("Cant process int64 tensor without raw data")}throw new Error("Handling of tensor type "+t.dataType+" not yet implemented")}var Ge=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),We=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ne=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},qe=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;if(i<11){var u=a.getAttributeTensor("value");a.tensor=Fe(u)}return a}return Ge(n,t),n.prototype.forward=function(t){return We(this,void 0,void 0,(function(){return Ne(this,(function(t){if(this.onnxVersion<11)return[2,[this.tensor]];throw new Error("Constant with onnx version >= 11 not yet implemented")}))}))},n.prototype.toCPU=function(){return We(this,void 0,void 0,(function(){var t;return Ne(this,(function(n){switch(n.label){case 0:return t=this,[4,Me(this.tensor)];case 1:return t.tensor=n.sent(),[2]}}))}))},n.prototype.toWASM=function(){return We(this,void 0,void 0,(function(){var t;return Ne(this,(function(n){switch(n.label){case 0:return t=this,[4,Ce(this.tensor)];case 1:return t.tensor=n.sent(),[2]}}))}))},n.prototype.toGPU=function(t){return We(this,void 0,void 0,(function(){var n;return Ne(this,(function(e){switch(e.label){case 0:return n=this,[4,Ve(this.tensor,t)];case 1:return n.tensor=e.sent(),[2]}}))}))},n.prototype.getType=function(){return"Constant"},n.prototype.delete=function(){this.tensor.delete()},n}(De),Je=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Le=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},He=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ye=function(t){function n(n,e,r,o,i,a,u,s){var p=t.call(this,n,e,r,o,i)||this;if(void 0!==p.getAttributeString("autoPad"))throw new Error("Autopad in conv not supported yet");return void 0===s&&(s="id"),p.activation=s,p.group=p.getAttributeInt("group")||1,p.dilations=p.getAttributeInts("dilations"),p.pads=p.getAttributeInts("pads"),p.strides=p.getAttributeInts("strides"),p.kernel=a,p.bias=u,p}return Je(n,t),n.prototype.forward=function(t){return Le(this,void 0,void 0,(function(){var n,e,r;return He(this,(function(o){return n=t[0],e=void 0!==this.kernel?this.kernel:t[1],r=t.length>2?t[2]:this.bias,[2,[n.conv(e,r,this.dilations,this.group,this.pads,this.strides,this.activation)]]}))}))},n.prototype.getDilations=function(t){return void 0!==this.dilations?this.dilations:new Array(t).fill(1)},n.prototype.getPads=function(t){return void 0!==this.pads?this.pads:new Array(2*t).fill(0)},n.prototype.getStrides=function(t){return void 0!==this.strides?this.strides:new Array(t).fill(1)},n.prototype.getType=function(){return"Conv"},n.prototype.toCPU=function(){return Le(this,void 0,void 0,(function(){var t,n;return He(this,(function(e){switch(e.label){case 0:return void 0===this.kernel?[3,2]:(t=this,[4,Me(this.kernel)]);case 1:t.kernel=e.sent(),e.label=2;case 2:return void 0===this.bias?[3,4]:(n=this,[4,Me(this.bias)]);case 3:n.bias=e.sent(),e.label=4;case 4:return[2]}}))}))},n.prototype.toWASM=function(){return Le(this,void 0,void 0,(function(){var t,n;return He(this,(function(e){switch(e.label){case 0:return void 0===this.kernel?[3,2]:(t=this,[4,Ce(this.kernel)]);case 1:t.kernel=e.sent(),e.label=2;case 2:return void 0===this.bias?[3,4]:(n=this,[4,Ce(this.bias)]);case 3:n.bias=e.sent(),e.label=4;case 4:return[2]}}))}))},n.prototype.toGPU=function(t){return Le(this,void 0,void 0,(function(){var n,e;return He(this,(function(r){switch(r.label){case 0:return void 0===this.kernel?[3,2]:(n=this,[4,Ve(this.kernel,t)]);case 1:n.kernel=r.sent(),r.label=2;case 2:return void 0===this.bias?[3,4]:(e=this,[4,Ve(this.bias,t)]);case 3:e.bias=r.sent(),r.label=4;case 4:return[2]}}))}))},n.prototype.delete=function(){void 0!==this.kernel&&this.kernel.delete(),void 0!==this.bias&&this.bias.delete()},n}(De),Ke=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Qe=function(t){function n(n){var e=t.call(this)||this;return e.nodeTypes=n,e}return Ke(n,t),n.prototype.findApplications=function(t){var n=[],e=t.getNodes();for(var r in Object.keys(e)){var o=e[r];if(void 0!==o&&o.getType()===this.nodeTypes[0]){var i=this.checkApplication(t,r);void 0!==i&&n.push(i)}}return n},n.prototype.checkApplication=function(t,n){for(var e=t.getNodes(),r=[n],o=e[n],i=[o],a=1;a<this.nodeTypes.length;a++){var u=t.getNodeWithInput(o.outputs[0]);if(void 0===u)return;var s=e[u];if(s.getType()!==this.nodeTypes[a])return;r.push(u),o=s,i.push(o)}return this.canApply(i)?r:void 0},n.prototype.canApply=function(t){return!0},n}((function(){})),Ze=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),$e=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},tr=function(t){function n(){return t.call(this,["Conv","BatchNormalization"])||this}return Ze(n,t),n.prototype.apply=function(t,n,e,r){var o=t[0],i=t[1],a=n(o.inputs[1]),u=n(o.inputs[2]),s=n(i.inputs[1]),p=n(i.inputs[2]),c=n(i.inputs[3]),f=n(i.inputs[4]).add(i.epsTensor).sqrt(),h=s.divide(f);f.delete();var l=p.subtract(c.multiply(h)),y=$e(h.getShape(),new Array(a.getShape().length-h.getShape().length).fill(1)),d=a.multiply(h.reshape(y,!1)),v=l;if(void 0!==u){var m=u.multiply(h);v=v.add(m),m.delete()}return new Ye(Object.entries(o.attributes).map((function(t){return t[1]})),[o.inputs[0]],i.outputs,e,r,d,v)},n}(Qe),nr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),er=function(t){function n(){return t.call(this,["Conv","Relu"])||this}return nr(n,t),n.prototype.apply=function(t,n,e,r){var o=t[0],i=t[1];return new Ye(Object.entries(o.attributes).map((function(t){return t[1]})),o.inputs,i.outputs,e,r,o.kernel,o.bias,"relu")},n}(Qe),rr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),or=function(t){function n(){return t.call(this,["Conv","Clip"])||this}return rr(n,t),n.prototype.apply=function(t,n,e,r){var o=t[0],i=t[1];return new Ye(Object.entries(o.attributes).map((function(t){return t[1]})),o.inputs,i.outputs,e,r,o.kernel,o.bias,"relu6")},n.prototype.canApply=function(t){var n=t[1];return 0===n.min&&6===n.max},n}(Qe),ir=[new tr,new er,new or],ar=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ur=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},sr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},pr=function(t){function n(n,e,r,o,i){return t.call(this,n,e,r,o,i)||this}return ar(n,t),n.prototype.forward=function(t){return ur(this,void 0,void 0,(function(){var n,e;return sr(this,(function(r){if(this.onnxVersion<13&&this.onnxVersion>=7)return n=t[0],e=t[1],[2,[this.compute(n,e)]];throw new Error(this.name+" not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return this.name},n.prototype.delete=function(){},n}(De),cr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),fr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="Add",a}return cr(n,t),n.prototype.compute=function(t,n){return t.add(n)},n}(pr),hr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),lr=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},yr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},dr=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},vr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.epsilon=a.getAttributeFloat("epsilon")||1e-5,a.momentum=a.getAttributeFloat("momentum")||.9,a.epsTensor=new K([1],[a.epsilon]),a}return hr(n,t),n.prototype.initialize=function(t){var n=t(this.inputs[1]),e=t(this.inputs[2]),r=t(this.inputs[3]),o=t(this.inputs[4]);void 0!==n&&void 0!==e&&void 0!==r&&void 0!==o&&o.add(this.epsTensor).sqrt().delete()},n.prototype.defaultForward=function(t){return lr(this,void 0,void 0,(function(){var n,e,r,o,i,a,u;return yr(this,(function(s){return n=t[0],e=t[1],r=t[2],o=t[3],i=t[4],a=e.getShape()[0],u=dr([1,a],new Array(n.getShape().length-2).fill(1)),e=e.reshape(u,!1),r=r.reshape(u,!1),o=o.reshape(u,!1),i=i.reshape(u,!1),[2,[n.normalize(o,i,this.epsilon,e,r)]]}))}))},n.prototype.forward=function(t){return lr(this,void 0,void 0,(function(){return yr(this,(function(n){return[2,this.defaultForward(t)]}))}))},n.prototype.getType=function(){return"BatchNormalization"},n.prototype.toCPU=function(){return lr(this,void 0,void 0,(function(){var t;return yr(this,(function(n){switch(n.label){case 0:return t=this,[4,Me(this.epsTensor)];case 1:return t.epsTensor=n.sent(),[2]}}))}))},n.prototype.toWASM=function(){return lr(this,void 0,void 0,(function(){var t;return yr(this,(function(n){switch(n.label){case 0:return t=this,[4,Ce(this.epsTensor)];case 1:return t.epsTensor=n.sent(),[2]}}))}))},n.prototype.toGPU=function(t){return lr(this,void 0,void 0,(function(){var n;return yr(this,(function(e){switch(e.label){case 0:return n=this,[4,Ve(this.epsTensor,t)];case 1:return n.epsTensor=e.sent(),[2]}}))}))},n.prototype.delete=function(){this.epsTensor.delete()},n}(De);function mr(t,n){if(t.type===n)return t;if("float"===n){for(var e=new Float32Array(t.size),r=0;r<t.size;r++)e[r]=t.get(r);return new K(t.shape,e,n)}for(e=new Int32Array(t.size),r=0;r<t.size;r++)e[r]=t.get(r);return new K(t.shape,e,n)}var gr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),wr=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},br=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},xr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.to=a.getAttributeString("to"),a}return gr(n,t),n.prototype.forward=function(t){return wr(this,void 0,void 0,(function(){var n;return br(this,(function(e){if((n=t[0])instanceof K)return[2,[mr(n,this.to)]];throw new Error("Can only cast CPU tensors right now")}))}))},n.prototype.getType=function(){return"Cast"},n.prototype.delete=function(){},n}(De),_r=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Or=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ar=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},kr=function(t){function n(n,e,r,o,i){return t.call(this,n,e,r,o,i)||this}return _r(n,t),n.prototype.forward=function(t){return Or(this,void 0,void 0,(function(){var n;return Ar(this,(function(e){return n=t[0],[2,[this.compute(n)]]}))}))},n.prototype.getType=function(){return this.name},n.prototype.delete=function(){},n}(De),Sr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Pr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="Ceil",a}return Sr(n,t),n.prototype.compute=function(t){return t.ceil()},n}(kr),jr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ir=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Tr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Xr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return i<11&&(a.min=a.getAttributeFloat("min"),a.max=a.getAttributeFloat("max")),a}return jr(n,t),n.prototype.forward=function(t){return Ir(this,void 0,void 0,(function(){var n,e,r;return Tr(this,(function(o){if(n=t[0],this.onnxVersion<11)return[2,[n.clip(this.min,this.max)]];if(e=t.length>1?t[1]:void 0,r=t.length>2?t[2]:void 0,void 0===e&&void 0===r)return[2,[n.copy()]];throw new Error("Clip with onnx version >= 11 not yet implemented")}))}))},n.prototype.getType=function(){return"Clip"},n.prototype.delete=function(){},n}(De),Mr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Cr=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Vr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Rr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return i<13&&(a.axis=a.getAttributeInt("axis")),a}return Mr(n,t),n.prototype.forward=function(t){return Cr(this,void 0,void 0,(function(){var n,e,r;return Vr(this,(function(o){for(t.length,n=t[0],e=1;e<t.length;e++)r=n.concat(t[e],this.axis),e>1&&n.delete(),n=r;return[2,[n]]}))}))},n.prototype.getType=function(){return"Concat"},n.prototype.delete=function(){},n}(De),Br=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Er=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},zr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ur=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;if(i<11){var u=a.getAttributeTensor("value");a.tensor=Fe(u)}return a}return Br(n,t),n.prototype.forward=function(t){return Er(this,void 0,void 0,(function(){var n,e,r,o,i;return zr(this,(function(a){if(!((n=t[0])instanceof K))throw new Error("ConstantOfShape needs cpu tensor as shape tensor");for(e=new Array(n.size),r=0;r<n.size;r++)e[r]=n.get(r);return o=O(e),i=new Float32Array(o).fill(this.tensor.get(0)),[2,[new K(e,i,this.tensor.type)]]}))}))},n.prototype.getType=function(){return"ConstantOfShape"},n.prototype.delete=function(){this.tensor.delete()},n}(De),Dr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="Div",a}return Dr(n,t),n.prototype.compute=function(t,n){return t.divide(n)},n}(pr),Gr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Wr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="Exp",a}return Gr(n,t),n.prototype.compute=function(t){return t.exp()},n}(kr),Nr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),qr=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Jr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Lr=function(t){function n(n,e,r,o,i){return t.call(this,n,e,r,o,i)||this}return Nr(n,t),n.prototype.forward=function(t){return qr(this,void 0,void 0,(function(){var n,e,r,o;return Jr(this,(function(i){if(this.onnxVersion<13){if(n=t[0],!((e=t[1])instanceof K))throw new Error("Expand needs cpu tensor as shape tensor");for(r=new Array(e.size),o=0;o<e.size;o++)r[o]=e.get(o);return[2,[n.expand(r)]]}throw new Error("Expand not yet implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Expand"},n.prototype.delete=function(){},n}(De),Hr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Yr=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="Floor",a}return Hr(n,t),n.prototype.compute=function(t){return t.floor()},n}(kr),Kr=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Qr=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Zr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},$r=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.axis=a.getAttributeInt("axis")||0,a}return Kr(n,t),n.prototype.forward=function(t){return Qr(this,void 0,void 0,(function(){var n,e;return Zr(this,(function(r){if(n=t[0],!((e=t[1])instanceof K))throw new Error("Gather requires CPU tensor for the indices");return[2,[n.gather(this.axis,e)]]}))}))},n.prototype.getType=function(){return"Gather"},n.prototype.delete=function(){},n}(De),to=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),no=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},eo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ro=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;a.alpha=a.getAttributeFloat("alpha")||1,a.beta=a.getAttributeFloat("beta")||1;var u=a.getAttributeInt("transA"),s=a.getAttributeInt("transB");return a.transA=1===u,a.transB=1===s,a}return to(n,t),n.prototype.forward=function(t){return no(this,void 0,void 0,(function(){var n,e,r;return eo(this,(function(o){if(this.onnxVersion>=9&&this.onnxVersion<11)return n=t[0],e=t[1],r=t[2],[2,[n.gemm(e,this.transA,this.transB,this.alpha,r,this.beta)]];throw new Error("Gemm is not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Gemm"},n.prototype.delete=function(){},n}(De),oo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),io=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ao=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},uo=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},so=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.epsilon=a.getAttributeFloat("epsilon")||1e-5,a}return oo(n,t),n.prototype.defaultForward=function(t){return io(this,void 0,void 0,(function(){var n,e,r,o,i,a,u,s,p,c,f,h;return ao(this,(function(l){for(n=t[0],e=t[1],r=t[2],o=n.getShape().length-2,i=e.getShape()[0],a=uo([1,i],new Array(o).fill(1)),e=e.reshape(a,!1),r=r.reshape(a,!1),u=new Array(n.getShape().length-2),s=0;s<o;s++)u[s]=s+2;return p=n.reduceMean(u,!0),et.flush(),c=n.subtract(p),et.flush(),f=c.reduceMeanSquare(u,!0),et.flush(),h=n.normalize(p,f,this.epsilon,e,r),p.delete(),c.delete(),f.delete(),[2,[h]]}))}))},n.prototype.forward=function(t){return io(this,void 0,void 0,(function(){return ao(this,(function(n){return[2,this.defaultForward(t)]}))}))},n.prototype.getType=function(){return"InstanceNormalization"},n.prototype.delete=function(){},n}(De),po=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),co=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},fo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ho=function(t){function n(n,e,r,o,i){return t.call(this,n,e,r,o,i)||this}return po(n,t),n.prototype.forward=function(t){return co(this,void 0,void 0,(function(){var n,e;return fo(this,(function(r){if(n=t[0],e=t[1],this.onnxVersion<13&&this.onnxVersion>=9){if(n.getShape().length!==e.getShape().length)throw new Error("Automatic broadcasting in MatMul not supported yet");return[2,[n.gemm(e)]]}throw new Error("Matmul with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"MatMul"},n.prototype.delete=function(){},n}(De),lo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),yo=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="Mul",a}return lo(n,t),n.prototype.compute=function(t,n){return t.multiply(n)},n}(pr),vo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),mo=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},go=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},wo=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.mode=a.getAttributeString("mode")||"constant",a.pads=a.getAttributeInts("pads"),a.value=a.getAttributeFloat("value")||0,a}return vo(n,t),n.prototype.forward=function(t){return mo(this,void 0,void 0,(function(){return go(this,(function(n){if(this.onnxVersion<11)return[2,[t[0].pad(this.pads,this.mode,this.value)]];throw new Error("Pad not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Pad"},n.prototype.delete=function(){},n}(De),bo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),xo=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},_o=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Oo=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;a.axes=a.getAttributeInts("axes");var u=a.getAttributeInt("keepdims");return a.keepDims=1===u||void 0===u,a}return bo(n,t),n.prototype.getAxes=function(t){if(void 0!==this.axes)return this.axes;for(var n=t.getShape().length,e=new Array(n),r=0;r<n;r++)e[r]=r;return e},n.prototype.forward=function(t){return xo(this,void 0,void 0,(function(){return _o(this,(function(n){if(this.onnxVersion<11)return[2,[this.calc(t[0])]];throw new Error(this.name+" is not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return this.name},n.prototype.delete=function(){},n}(De),Ao=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ko=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="ReduceMax",a}return Ao(n,t),n.prototype.calc=function(t){return t.max(this.axes,this.keepDims)},n}(Oo),So=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Po=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="ReduceMean",a}return So(n,t),n.prototype.calc=function(t){return t.reduceMean(this.axes,this.keepDims)},n}(Oo),jo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Io=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="ReduceSum",a}return jo(n,t),n.prototype.calc=function(t){return t.sum(this.axes,this.keepDims)},n}(Oo),To=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Xo=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="ReduceSumSquare",a}return To(n,t),n.prototype.calc=function(t){return t.sumSquare(this.axes,this.keepDims)},n}(Oo),Mo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Co=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.max=void 0,a.min=0,a}return Mo(n,t),n.prototype.getType=function(){return"Relu"},n}(Xr),Vo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ro=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Bo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Eo=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return i<13&&(a.shape=a.getAttributeInts("shape")),a}return Vo(n,t),n.prototype.forward=function(t){return Ro(this,void 0,void 0,(function(){var n,e,r,o;return Bo(this,(function(i){if(n=t[0],!((e=t[1])instanceof K))throw new Error("Reshape only works with CPU tensor as shape tensor");if(this.onnxVersion<13){for(r=new Array(e.size),o=0;o<e.size;o++)r[o]=e.get(o);return[2,[n.reshape(r)]]}throw new Error("Reshape with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"Reshape"},n.prototype.delete=function(){},n}(De),zo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Uo=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Do=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Fo=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Go=function(t){function n(n,e,r,o,i){return t.call(this,n,e,r,o,i)||this}return zo(n,t),n.prototype.forward=function(t){return Uo(this,void 0,void 0,(function(){var n,e;return Do(this,(function(r){if(this.onnxVersion<13)return n=t[0],e=n.getShape(),[2,[new K([e.length],Fo(e),"int")]];throw new Error("Shape not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Shape"},n.prototype.delete=function(){},n}(De),Wo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),No=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},qo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Jo=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.axes=a.getAttributeInts("axes"),a.starts=a.getAttributeInts("starts"),a.ends=a.getAttributeInts("ends"),a}return Wo(n,t),n.prototype.forward=function(t){return No(this,void 0,void 0,(function(){return qo(this,(function(n){if(this.onnxVersion<11)return[2,[t[0].slice(this.starts,this.ends,this.axes)]];throw new Error("Slice not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Slice"},n.prototype.delete=function(){},n}(De),Lo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ho=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Yo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ko=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.axis=a.getAttributeInt("axis"),a}return Lo(n,t),n.prototype.defaultForward=function(t){return Ho(this,void 0,void 0,(function(){var n,e,r,o,i,a,u,s,p,c;return Yo(this,(function(f){return n=t[0],e=n.getShape(),void 0===(r=this.axis)&&(r=this.onnxVersion<13?1:e.length-1),o=e.slice(0,r).reduce((function(t,n){return t*n}),1),i=n.reshape([o,-1],!1),a=i.max(1,!0),u=i.subtract(a),s=u.exp(),p=s.sum(1,!0),c=s.divide(p),a.delete(),u.delete(),s.delete(),p.delete(),[2,[c.reshape(e,!1)]]}))}))},n.prototype.forward=function(t){return Ho(this,void 0,void 0,(function(){return Yo(this,(function(n){return[2,this.defaultForward(t)]}))}))},n.prototype.getType=function(){return"Softmax"},n.prototype.delete=function(){},n}(De),Qo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Zo=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.name="Sub",a}return Qo(n,t),n.prototype.compute=function(t,n){return t.subtract(n)},n}(pr),$o=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ti=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ni=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ei=function(t){function n(n,e,r,o,i){return t.call(this,n,e,r,o,i)||this}return $o(n,t),n.prototype.forward=function(t){return ti(this,void 0,void 0,(function(){var n,e,r,o;return ni(this,(function(i){if(n=t[0],!((e=t[1])instanceof K))throw new Error("Tile only works with CPU tensor as repeats");if(this.onnxVersion<13&&this.onnxVersion>=6){for(r=new Array(e.size),o=0;o<e.size;o++)r[o]=e.get(o);return[2,[n.repeat(r)]]}throw new Error("Tile with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"Tile"},n.prototype.delete=function(){},n}(De),ri=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),oi=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ii=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ai=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return a.permutation=a.getAttributeInts("perm"),a}return ri(n,t),n.prototype.forward=function(t){return oi(this,void 0,void 0,(function(){return ii(this,(function(n){return[2,[t[0].transpose(this.permutation)]]}))}))},n.prototype.getType=function(){return"Transpose"},n.prototype.delete=function(){},n}(De),ui=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),si=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},pi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ci=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;return i<13&&(a.axes=a.getAttributeInts("axes")),a}return ui(n,t),n.prototype.forward=function(t){return si(this,void 0,void 0,(function(){var n,e,r,o,i;return pi(this,(function(a){if(n=t[0],this.onnxVersion<13){for(e=n.getShape(),r=[],o=0,i=0;i<e.length;i++)o<this.axes.length&&this.axes[o]===i&&(r.push(1),o++),r.push(e[i]);return this.axes[this.axes.length-1]===e.length&&r.push(1),[2,[n.reshape(r)]]}throw new Error("Unsqueeze with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"Unsqueeze"},n.prototype.delete=function(){},n}(De),fi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),hi=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},li=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},yi=function(t){function n(n,e,r,o,i){var a=t.call(this,n,e,r,o,i)||this;if(a.mode=a.getAttributeString("mode"),"nearest"!==a.mode)throw new Error("Upsampling only supported with nearest neighbor sampling");return a}return fi(n,t),n.prototype.getScales=function(t){return hi(this,void 0,void 0,(function(){var n,e,r;return li(this,(function(o){switch(o.label){case 0:return t instanceof K?[3,2]:(console.warn("Scales tensor for upsample not on CPU, need to transfer!"),[4,Me(t)]);case 1:t=o.sent(),o.label=2;case 2:for(n=t,e=new Array(n.size),r=0;r<n.size;r++)e[r]=n.get(r);return[2,e]}}))}))},n.prototype.forward=function(t){return hi(this,void 0,void 0,(function(){var n,e,r;return li(this,(function(o){switch(o.label){case 0:return n=t[0],e=t[1],[4,this.getScales(e)];case 1:return r=o.sent(),[2,[n.upsample(r)]]}}))}))},n.prototype.getType=function(){return"Upsample"},n.prototype.delete=function(){},n}(De),di=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),vi=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},mi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},gi=function(t){function n(n,e,r,o,i){return t.call(this,n,e,r,o,i)||this}return di(n,t),n.prototype.forward=function(t){return vi(this,void 0,void 0,(function(){var n,e,r;return mi(this,(function(o){for(n=t[0],e=new Array(n.getShape().length-2),r=0;r<n.getShape().length-2;r++)e[r]=r+2;return[2,[n.reduceMean(e,!0)]]}))}))},n.prototype.getType=function(){return"GlobalAveragePool"},n.prototype.delete=function(){},n}(De),wi={Conv:function(t,n,e,r,o){return new Ye(t,n,e,r,o)},BatchNormalization:function(t,n,e,r,o){return new vr(t,n,e,r,o)},Clip:function(t,n,e,r,o){return new Xr(t,n,e,r,o)},Add:function(t,n,e,r,o){return new fr(t,n,e,r,o)},ReduceMean:function(t,n,e,r,o){return new Po(t,n,e,r,o)},Gemm:function(t,n,e,r,o){return new ro(t,n,e,r,o)},Constant:function(t,n,e,r,o){return new qe(t,n,e,r,o)},Reshape:function(t,n,e,r,o){return new Eo(t,n,e,r,o)},Tile:function(t,n,e,r,o){return new ei(t,n,e,r,o)},MatMul:function(t,n,e,r,o){return new ho(t,n,e,r,o)},Exp:function(t,n,e,r,o){return new Wr(t,n,e,r,o)},ReduceSum:function(t,n,e,r,o){return new Io(t,n,e,r,o)},ReduceMax:function(t,n,e,r,o){return new ko(t,n,e,r,o)},ReduceSumSquare:function(t,n,e,r,o){return new Xo(t,n,e,r,o)},Sub:function(t,n,e,r,o){return new Zo(t,n,e,r,o)},Mul:function(t,n,e,r,o){return new yo(t,n,e,r,o)},Div:function(t,n,e,r,o){return new Fr(t,n,e,r,o)},Unsqueeze:function(t,n,e,r,o){return new ci(t,n,e,r,o)},Concat:function(t,n,e,r,o){return new Rr(t,n,e,r,o)},ConstantOfShape:function(t,n,e,r,o){return new Ur(t,n,e,r,o)},Expand:function(t,n,e,r,o){return new Lr(t,n,e,r,o)},InstanceNormalization:function(t,n,e,r,o){return new so(t,n,e,r,o)},Pad:function(t,n,e,r,o){return new wo(t,n,e,r,o)},Relu:function(t,n,e,r,o){return new Co(t,n,e,r,o)},Shape:function(t,n,e,r,o){return new Go(t,n,e,r,o)},Gather:function(t,n,e,r,o){return new $r(t,n,e,r,o)},Cast:function(t,n,e,r,o){return new xr(t,n,e,r,o)},Floor:function(t,n,e,r,o){return new Yr(t,n,e,r,o)},Ceil:function(t,n,e,r,o){return new Pr(t,n,e,r,o)},Slice:function(t,n,e,r,o){return new Jo(t,n,e,r,o)},Upsample:function(t,n,e,r,o){return new yi(t,n,e,r,o)},Transpose:function(t,n,e,r,o){return new ai(t,n,e,r,o)},Softmax:function(t,n,e,r,o){return new Ko(t,n,e,r,o)},GlobalAveragePool:function(t,n,e,r,o){return new gi(t,n,e,r,o)}},bi=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},xi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},_i=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Oi=function(){function t(t,n){var e;this.inputSet=new Set,this.nodes={},this.nodeIds=[],this.defaultReady=[],this.intermediaries={},this.constants={},this.nodeIdCounter=1e4,void 0===n&&(n={}),this.noConvertConstants=new Set(void 0!==n.noConvertConstants?n.noConvertConstants:[]),this.noConvertNodes=new Set(void 0!==n.noConvertNodes?n.noConvertNodes:[]),this.precision=n.precision||32,e=t instanceof ArrayBuffer?new Uint8Array(t):t,this.modelProto=Ee.onnx.ModelProto.decode(e);var r=this.modelProto.opsetImport[0].version;Be.a.isLong(r)&&(r=r.toNumber()),this.version=r,this.inputs=this.modelProto.graph.input;for(var o=0;o<this.inputs.length;o++)this.inputSet.add(this.inputs[o].name);this.outputs=this.modelProto.graph.output.map((function(t){return t.name})),this.initializer(this.modelProto.graph.initializer),this.initNodes(this.modelProto)}return t.prototype.initNodes=function(t){for(var n=this,e=0;e<t.graph.node.length;e++){var r=t.graph.node[e],o=wi[r.opType];if(void 0===o)throw new Error("Node operator "+r.opType+" can not be resolved");var i=r.attribute||[],a=r.input||[],u=o(i,a,r.output||[],this.constants,this.version);this.nodes[e]=u,this.nodeIds.push(e);for(var s=0;s<a.length;s++){var p=a[s];void 0===this.intermediaries[p]&&(this.intermediaries[p]={to:[],deletable:!0}),this.intermediaries[p].to.push(e)}0===u.variableInputs&&this.defaultReady.push(e),"Constant"===r.opType&&(void 0===this.intermediaries[r.output[0]]?this.intermediaries[r.output[0]]={to:[],deletable:!1}:this.intermediaries[r.output[0]].deletable=!1)}for(var c=0,f=this.nodeIds;c<f.length;c++){var h=f[c];this.nodes[h].initialize((function(t){return n.resolveConstant(t)}))}},t.prototype.initializer=function(t){for(var n=0;n<t.length;n++){var e=t[n],r=Fe(e);this.constants[e.name]=r}},t.prototype.forward=function(t,n){return bi(this,void 0,void 0,(function(){var e,r,o,i,a,u,s,p,c,f,h,l,y,d,v=this;return xi(this,(function(m){switch(m.label){case 0:for(e={},r={},o=0,i=this.nodeIds;o<i.length;o++)d=i[o],r[d]={variableInputs:0};a=_i(this.defaultReady),this.initializeForward(t,e,r,a),m.label=1;case 1:if(!(a.length>0))return[3,8];u=a.shift(),s=this.nodes[u],p=this.getInputsToNode(s,e),c=p.inputs,f=p.toDelete,h=void 0,m.label=2;case 2:return m.trys.push([2,4,,5]),[4,s.forward(c)];case 3:return h=m.sent(),[3,5];case 4:throw l=m.sent(),console.error("Error occurred in node "+u+" with inputs "+s.inputs+" from nodes "+s.inputs.map((function(t){return v.getNodeWithOutput(t)}))),l;case 5:for(et.flush(),this.propagateResults(s,e,h,r,a),d=0;d<f.length;d++)this.inputSet.has(f[d])||(e[f[d]].value.delete(),delete e[f[d]]);return void 0===n?[3,7]:[4,new Promise((function(t,e){setTimeout(t,n)}))];case 6:m.sent(),m.label=7;case 7:return[3,1];case 8:for(y=[],d=0;d<this.outputs.length;d++)y.push(e[this.outputs[d]].value);return[2,y]}}))}))},t.prototype.initializeForward=function(t,n,e,r){for(var o=0;o<t.length;o++){n[this.inputs[o].name]={value:t[o],used:0};for(var i=this.intermediaries[this.inputs[o].name],a=0;a<i.to.length;a++){var u=i.to[a];e[u].variableInputs++,e[u].variableInputs===this.nodes[u].variableInputs&&(r.push(u),delete e[u])}}},t.prototype.getInputsToNode=function(t,n){for(var e=[],r=[],o=0;o<t.inputs.length;o++){var i=t.inputs[o];if(void 0!==this.constants[i])e.push(this.constants[i]);else{var a=n[i];a.used++,a.used>=this.intermediaries[i].to.length&&this.intermediaries[i].deletable&&r.push(i),e.push(a.value)}}return{inputs:e,toDelete:r}},t.prototype.propagateResults=function(t,n,e,r,o){for(var i=0;i<t.outputs.length;i++){var a=t.outputs[i];n[a]={value:e[i],used:0};var u=this.intermediaries[a];if(void 0!==u)for(var s=0;s<u.to.length;s++){var p=u.to[s];r[p].variableInputs++,r[p].variableInputs===this.nodes[p].variableInputs&&(o.push(p),delete r[p])}}},t.prototype.toCPU=function(){return bi(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return xi(this,(function(s){switch(s.label){case 0:for(n in t=[],this.constants)t.push(n);e=0,s.label=1;case 1:return e<t.length?(u=t[e],this.noConvertConstants.has(u)?[3,3]:(r=this.constants,o=u,[4,Me(this.constants[u])])):[3,4];case 2:r[o]=s.sent(),s.label=3;case 3:return e++,[3,1];case 4:i=0,a=this.nodeIds,s.label=5;case 5:return i<a.length?(u=a[i],this.noConvertNodes.has(u)?[3,7]:[4,this.nodes[u].toCPU()]):[3,8];case 6:s.sent(),s.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},t.prototype.toWASM=function(){return bi(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return xi(this,(function(s){switch(s.label){case 0:for(n in t=[],this.constants)t.push(n);e=0,s.label=1;case 1:return e<t.length?(u=t[e],this.noConvertConstants.has(u)?[3,3]:(r=this.constants,o=u,[4,Ce(this.constants[u])])):[3,4];case 2:r[o]=s.sent(),s.label=3;case 3:return e++,[3,1];case 4:i=0,a=this.nodeIds,s.label=5;case 5:return i<a.length?(u=a[i],this.noConvertNodes.has(u)?[3,7]:[4,this.nodes[u].toWASM()]):[3,8];case 6:s.sent(),s.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},t.prototype.toGPU=function(){return bi(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return xi(this,(function(s){switch(s.label){case 0:for(n in t=[],this.constants)t.push(n);e=0,s.label=1;case 1:return e<t.length?(u=t[e],this.noConvertConstants.has(u)?[3,3]:(r=this.constants,o=u,[4,Ve(this.constants[u],this.precision)])):[3,4];case 2:r[o]=s.sent(),s.label=3;case 3:return e++,[3,1];case 4:i=0,a=this.nodeIds,s.label=5;case 5:return i<a.length?(u=a[i],this.noConvertNodes.has(u)?[3,7]:[4,this.nodes[u].toGPU(this.precision)]):[3,8];case 6:s.sent(),s.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},t.prototype.optimize=function(){for(var t=this,n=0,e=ir;n<e.length;n++)for(var r=e[n],o=0,i=r.findApplications(this);o<i.length;o++){for(var a=i[o],u=a.map((function(n){return t.nodes[n]})),s=r.apply(u,(function(n){return t.resolveConstant(n)}),this.constants,this.version),p=new Set(s.outputs),c=0,f=a;c<f.length;c++){var h=f[c];this.removeNode(h,p)}this.insertNode(s)}this.prune()},t.prototype.prune=function(){for(var t=this;;){var n=this.pruneIntermediaries();if(!(n.size>0))break;n.forEach((function(n){t.removeNode(n,new Set)}))}},t.prototype.pruneIntermediaries=function(){var t=new Set,n=[];for(var e in this.intermediaries){if(0===this.intermediaries[e].to.length){n.push(e);var r=this.getNodeWithOutput(e);void 0!==r&&t.add(r)}}for(var o=0,i=n;o<i.length;o++){e=i[o];delete this.intermediaries[e]}return t},t.prototype.removeNode=function(t,n){for(var e=this.nodes[t],r=0,o=e.inputs;r<o.length;r++){var i=o[r];void 0!==this.intermediaries[i]&&(this.intermediaries[i].to=this.intermediaries[i].to.filter((function(n){return n.toString()!==t.toString()})))}n.has(e.outputs[0])||delete this.intermediaries[e.outputs[0]],this.nodeIds=this.nodeIds.filter((function(n){return n.toString()!==t.toString()})),this.nodes[t].delete(),delete this.nodes[t]},t.prototype.insertNode=function(t){var n=this.nodeIdCounter++;this.nodeIds.push(n),this.nodes[n]=t;for(var e=0,r=t.inputs;e<r.length;e++){var o=r[e];this.intermediaries[o].to.push(n)}},t.prototype.getNodeWithOutput=function(t){for(var n=0,e=this.nodeIds;n<e.length;n++){var r=e[n];if(-1!==this.nodes[r].outputs.findIndex((function(n){return n===t})))return r}},t.prototype.getNodeWithInput=function(t){for(var n=0,e=this.nodeIds;n<e.length;n++){var r=e[n];if(-1!==this.nodes[r].inputs.findIndex((function(n){return n===t})))return r}},t.prototype.resolveConstant=function(t){if(void 0!==this.constants[t])return this.constants[t];var n=this.getNodeWithOutput(t),e=this.nodes[n];return e instanceof qe?e.tensor:void 0},t.prototype.getNodes=function(){return this.nodes},t.prototype.delete=function(){for(var t in this.constants)this.constants[t].delete();for(var n=0,e=this.nodeIds;n<e.length;n++){var r=e[n];this.nodes[r].delete()}},t}();function Ai(t){return ki.apply(this,arguments)}function ki(){return(ki=Object(v.a)(d.a.mark((function t(n){var e,r,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("models/".concat(n,".onnx"));case 2:return e=t.sent,t.next=5,e.arrayBuffer();case 5:return r=t.sent,o=new s.model.OnnxModel(r,{noConvertNodes:[69,98],precision:16}),t.next=9,o.toGPU();case 9:return t.abrupt("return",o);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Si=["mosaic","candy","pointilism","udnie","rain-princess"],Pi=["n01440764_tench.JPEG","n03160309_dam.JPEG","n03216828_dock.JPEG","n03670208_limousine.JPEG","n04548280_wall_clock.JPEG","n04552348_warplane.JPEG","n04599235_wool.JPEG","n06874185_traffic_light.JPEG","n07873807_pizza.JPEG","n07920052_espresso.JPEG","n09193705_alp.JPEG","n12620546_hip.JPEG"],ji=function(t){Object(x.a)(e,t);var n=Object(_.a)(e);function e(t){var r;return Object(w.a)(this,e),(r=n.call(this,t)).model=void 0,r.scale=new a.gpu.GPUTensor(new Float32Array([255]),[1],16),Ai("mosaic").then((function(t){r.model=t,console.log("Got model")})),r.setState({scale:50,model:"mosaic"}),r}return Object(b.a)(e,[{key:"getImageData",value:function(){var t,n=this,e=document.getElementById("img");console.log("Reading pixels");var r=a.gpu.GPUTensor.fromData(e,16),o=r.shape.slice(0,2),i=Object(g.a)(o,2),u=i[0],s=i[1],p=Math.min(s,u),c=Math.floor(p/2),f=Math.floor(s/2)-c,h=Math.floor(u/2)-c,l=r.slice([h,f,0],[h+p,f+p,3],[0,1,2]);r.delete();var y=this.getImageWidth(this.state.scale)/s,d=l.upsample([y,y,1]);l.delete();var v=d.getShape()[0];this.setState(Object(m.a)(Object(m.a)({},this.state),{},{croppedSize:v}));var w=d.transpose([2,0,1]);d.delete();var b=w.multiply(this.scale);w.delete();var x=b.reshape([1,3,v,v],!1);console.log("Doing forward pass"),null===(t=this.model)||void 0===t||t.forward([x],100).then((function(t){return n.handleResult(t[0])}))}},{key:"handleResult",value:function(t){console.log("Got result",t),this.setState(Object(m.a)(Object(m.a)({},this.state),{},{showResult:!0}));var n=t.getShape(),e=(t=t.reshape(n.slice(1),!1)).transpose([1,2,0]);console.log(e.getShape()),t.delete();var r=e.copy(32);e.delete(),r.getValues().then((function(t){var n=document.getElementById("canvas").getContext("2d");if(n){var e=n.createImageData(r.shape[0],r.shape[1]),o=e.data;console.log(o.length,t.length);for(var i=0;i<t.length;i++){var a=Math.floor(i/3);o[4*a+i%3]=Math.round(t[i]),o[4*a+3]=255}n.putImageData(e,0,0)}r.delete()}))}},{key:"fileSelected",value:function(t){this.setState(Object(m.a)(Object(m.a)({},this.state),{},{scale:50,img:URL.createObjectURL(t.target.files[0]),showResult:!1}))}},{key:"setImage",value:function(t){this.setState(Object(m.a)(Object(m.a)({},this.state),{},{img:"img/"+t,scale:50,showResult:!1}))}},{key:"getImageWidth",value:function(t){var n=Math.round(t/50*400+50);return 32*Math.floor(n/32)}},{key:"setModel",value:function(){var t=Object(v.a)(d.a.mark((function t(n){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState(Object(m.a)(Object(m.a)({},this.state),{},{model:n})),t.next=3,Ai(n);case 3:this.model=t.sent;case 4:case"end":return t.stop()}}),t,this)})));return function(n){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t,n=this,e=50,r=50,o=!1;this.state&&(t=this.state.img,e=this.state.scale||50,r=this.state.croppedSize,o=this.state.showResult);var i=this.getImageWidth(e);return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)("h1",{children:"Style transfer"}),Object(p.jsx)("label",{htmlFor:"model",children:"Choose a style:"})," ",Object(p.jsx)("select",{id:"model",onChange:function(t){return n.setModel(t.target.value)},children:Si.map((function(t){return Object(p.jsx)("option",{value:t,children:t},t)}))}),Object(p.jsx)("br",{}),Object(p.jsx)("label",{htmlFor:"file",children:"Choose an image:"})," ",Object(p.jsx)("input",{type:"file",id:"file",onChange:function(t){return n.fileSelected(t)}}),Object(p.jsx)("br",{}),"Or use one of the examples:",Object(p.jsx)("table",{children:Object(p.jsx)("tr",{children:Pi.map((function(t){return Object(p.jsx)("td",{children:Object(p.jsx)("img",{src:"img/"+t,height:50,onClick:function(){return n.setImage(t)},className:"exampleImage",alt:"Example"})})}))})}),void 0!==t?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{className:"slidecontainer",children:["Scale: ",Object(p.jsx)("input",{type:"range",min:"1",max:"100",defaultValue:e,className:"slider",id:"myRange",onChange:function(t){return n.setState(Object(m.a)(Object(m.a)({},n.state),{},{showResult:!1,scale:parseInt(t.currentTarget.value)}))}})]}),Object(p.jsx)("img",{id:"img",src:this.state.img,alt:"Your upload",width:i}),Object(p.jsx)("br",{}),Object(p.jsx)("button",{onClick:function(){return n.getImageData()},children:"Run"}),Object(p.jsx)("br",{}),o?Object(p.jsx)("canvas",{id:"canvas",width:r,height:r}):Object(p.jsx)(p.Fragment,{})]}):Object(p.jsx)(p.Fragment,{})]})}}]),e}(f.a.Component),Ii=function(t){t&&t instanceof Function&&e.e(4).then(e.bind(null,47)).then((function(n){var e=n.getCLS,r=n.getFID,o=n.getFCP,i=n.getLCP,a=n.getTTFB;e(t),r(t),o(t),i(t),a(t)}))};l.a.render(Object(p.jsx)(f.a.StrictMode,{children:Object(p.jsx)(ji,{})}),document.getElementById("root")),Ii()}},[[42,1,2]]]);
//# sourceMappingURL=main.c20a2884.chunk.js.map