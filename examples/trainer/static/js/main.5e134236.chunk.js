(this.webpackJsonpstyle=this.webpackJsonpstyle||[]).push([[0],{71:function(t,n,e){},73:function(t,n,e){},95:function(t,n,e){"use strict";e.r(n);var r=e(6),o=e(0),i=e.n(o),a=e(10),u=e.n(a),s=(e(71),e(43)),p=e.n(s),c=e(45),l=e(11),h=e(50),f=e(51),d=e(52),y=e(60),v=e(59),w=(e(73),e(44)),m=e.n(w);function g(t,n){if(void 0===n&&(n=0),0===t.length)return n;for(var e=1,r=0;r<t.length;r+=1)e*=t[r];return e}function b(t){var n=t.length;if(0===n)return[];if(1===n)return 1===t[0]?[0]:[1];var e=new Array(n);e[n-1]=1,1===t[n-1]&&(e[n-1]=0);for(var r=1,o=n-2;o>=0;o-=1)r=t[o+1]*r,1===t[o]?e[o]=0:e[o]=r;return e}function _(t,n,e){for(var r=0,o=0;o<t.length;o+=1){if(e&&(t[o]<0||t[o]>=e[o]&&1!==e[o]))throw new Error("Invalid index");r+=t[o]*n[o]}return r}function x(t,n){if(t.length!==n.length)return!1;for(var e=0;e<t.length;e+=1)if(t[e]!==n[e])return!1;return!0}function O(t,n){for(var e=t.length-1;e>=0&&(t[e]+=1,t[e]>=n[e]);e--)t[e]=0}var k=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},S=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},A=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},j={float64:Float64Array,float32:Float32Array,float16:Float32Array,int32:Int32Array,int16:Int16Array,int8:Int8Array,uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},P=function(){function t(t){this.dtype=t}return t.prototype.compare=function(t,n){return k(this,void 0,void 0,(function(){var e,r,o;return S(this,(function(i){switch(i.label){case 0:return x(this.getShape(),t.getShape())?[4,this.getValues()]:[2,!1];case 1:return e=i.sent(),[4,t.getValues()];case 2:if(r=i.sent(),void 0!==n){for(o=0;o<e.length;o+=1)if(Math.abs(e[o]-r[o])>n)return[2,!1]}else for(o=0;o<e.length;o+=1)if(e[o]!==r[o])return[2,!1];return[2,!0]}}))}))},t.prototype.getAxes=function(t){var n,e=this.getShape();if(void 0===t){n=[];for(var r=0;r<e.length;r++)n.push(r)}else if(t instanceof Array){n=t;for(r=0;r<n.length;r++)n[r]<0&&(n[r]+=this.getShape().length)}else n=[t];return n},t.prototype.sum=function(t,n){var e=this.getAxes(t);return n=n||!1,this.sum_impl(e,n)},t.prototype.sumSquare=function(t,n){var e=this.getAxes(t);return n=n||!1,this.sumSquare_impl(e,n)},t.prototype.product=function(t,n){var e=this.getAxes(t);return n=n||!1,this.product_impl(e,n)},t.prototype.max=function(t,n){var e=this.getAxes(t);return n=n||!1,this.max_impl(e,n)},t.prototype.min=function(t,n){var e=this.getAxes(t);return n=n||!1,this.min_impl(e,n)},t.prototype.reduceMean=function(t,n){var e=this.getAxes(t);return n=n||!1,this.reduceMean_impl(e,n)},t.prototype.reduceLogSum=function(t,n){var e=this.getAxes(t);return n=n||!1,this.reduceLogSum_impl(e.sort(),n)},t.prototype.reduceLogSumExp=function(t,n){var e=this.getAxes(t);return n=n||!1,this.reduceLogSumExp_impl(e,n)},t.prototype.reduceMeanSquare=function(t,n){var e=this.getAxes(t);return n=n||!1,this.reduceMeanSquare_impl(e,n)},t.prototype.conv=function(t,n,e,r,o,i,a){var u=this.getShape().length-2;return e=e||new Array(u).fill(1),r=r||1,o=o||new Array(2*u).fill(0),i=i||new Array(u).fill(1),void 0===a&&(a="id"),this.conv_impl(t,e,r,o,i,a,n)},t.prototype.convTranspose=function(t,n,e,r,o){var i=this.getShape().length-2;return n=n||new Array(i).fill(1),e=e||1,r=r||new Array(2*i).fill(0),o=o||new Array(i).fill(1),this.convTranspose_impl(t,n,e,r,o)},t.prototype.pad=function(t,n,e){return void 0===n&&(n="constant"),void 0===e&&(e=0),this.pad_impl(t,n,e)},t.prototype.averagePool=function(t,n,e,r){var o=this.getShape().length-2;return n=n||new Array(2*o).fill(0),e=e||new Array(o).fill(1),r=r||!1,this.averagePool_impl(t,n,e,r)},t.prototype.reshape=function(t,n){for(var e=1,r=-1,o=0;o<t.length;o++)-1===t[o]?r=o:e*=t[o];if(void 0===n&&(n=!0),-1!==r){var i=g(this.getShape()),a=A(t);return a[r]=i/e,this.reshape_impl(a,n)}return this.reshape_impl(t,n)},t.prototype.alignShapes=function(t,n){var e,r;if(x(t,n))return[t,n,t];if(t.length<n.length){t=A(t);var o=n.length-t.length;(e=t).unshift.apply(e,new Array(o).fill(1))}else if(n.length<t.length){n=A(n);o=t.length-n.length;(r=n).unshift.apply(r,new Array(o).fill(1))}for(var i=new Array(t.length).fill(1),a=0;a<t.length;a++)i[a]=Math.max(t[a],n[a]);return[t,n,i]},t.prototype.alignTensor=function(t){var n,e,r=this.getShape(),o=t.getShape();if(x(r,o))return[this,t,r];var i=this;if(r.length<o.length){r=A(r);var a=o.length-r.length;(n=r).unshift.apply(n,new Array(a).fill(1)),i=this.reshape(r,!1)}else if(o.length<r.length){o=A(o);a=r.length-o.length;(e=o).unshift.apply(e,new Array(a).fill(1)),t=t.reshape(o,!1)}for(var u=new Array(r.length).fill(1),s=0;s<r.length;s++)u[s]=Math.max(r[s],o[s]);return[i,t,u]},t.prototype.add=function(t,n,e){void 0===n&&(n=1),void 0===e&&(e=1);var r=this.alignTensor(t),o=r[0],i=r[1],a=r[2];return this.add_impl(o,i,a,n,e)},t.prototype.subtract=function(t,n,e){void 0===n&&(n=1),void 0===e&&(e=1);var r=this.alignTensor(t),o=r[0],i=r[1],a=r[2];return this.subtract_impl(o,i,a,n,e)},t.prototype.multiply=function(t,n){void 0===n&&(n=1);var e=this.alignTensor(t),r=e[0],o=e[1],i=e[2];return this.multiply_impl(r,o,i,n)},t.prototype.multiplyScalar=function(t){return this.addMultiplyScalar(t,0)},t.prototype.addScalar=function(t){return this.addMultiplyScalar(1,t)},t.prototype.divide=function(t,n){void 0===n&&(n=1);var e=this.alignTensor(t),r=e[0],o=e[1],i=e[2];return this.divide_impl(r,o,i,n)},t.prototype.power=function(t){var n=this.alignTensor(t),e=n[0],r=n[1],o=n[2];return this.power_impl(e,r,o)},t.prototype.transpose=function(t){if(void 0===t){var n=this.getShape().length;t=[];for(var e=0;e<n;e++)t.push(n-e-1)}return this.transpose_impl(t)},t.prototype.softmax=function(t){var n=this.max(t,!0),e=this.subtract(n),r=e.exp(),o=r.sum(t,!0),i=r.divide(o);return n.delete(),e.delete(),r.delete(),o.delete(),i},t.prototype.gemm=function(t,n,e,r,o,i){if(n=n||!1,e=e||!1,r=void 0!==r?r:1,i=void 0!==i?i:1,void 0!==o){var a=this.getShape(),u=o.getShape(),s=a.length,p=u.length;s>p&&(u=A(new Array(s-p).fill(1),u),o=o.reshape(u,!1))}return this.gemm_impl(t,n,e,r,i,o)},t.prototype.slice=function(t,n,e,r){var o=this.getShape(),i=o.length;if(void 0===e){e=[];for(var a=0;a<i;a++)e.push(a)}else e=e.map((function(t){return t<0?t+i:t}));void 0===r&&(r=new Array(i).fill(1)),t=A(t),n=A(n);for(a=0;a<e.length;a++){var u=o[e[a]];t[a]<0?t[a]+=u:t[a]>=u&&(r[a]>0?t[a]=u:t[a]=u-1),n[a]<0?n[a]+=u:n[a]>=u&&(n[a]=u)}return this.slice_impl(t,n,e,r)},t.prototype.squeeze=function(){for(var t=[],n=0,e=this.getShape();n<e.length;n++){var r=e[n];1!==r&&t.push(r)}return this.reshape(t)},t.prototype.flatten=function(t){void 0===t&&(t=1);var n=this.getShape();t<0&&(t+=n.length);var e=[g(n.slice(0,t),1),g(n.slice(t),1)];return this.reshape(e)},t}();function M(t,n,e,r,o,i){var a=o*(n-1)+1;return Math.floor((t+e+r-a)/i+1)}function T(t,n,e,r,o,i){for(var a=[],u=0;u<t.length;u++)a.push(M(t[u],n[u],e[u],r[u],o[u],i[u]));return a}function I(t,n){for(var e=new H(t.shape,void 0,t.dtype),r=0;r<e.size;r+=1)e.set(r,n(t.get(r)));return e}function V(t,n,e,r){if(!function(t,n){if(t.length!==n.length)return!1;for(var e=0;e<t.length;e+=1)if(t[e]!==n[e]&&1!==t[e]&&1!==n[e])return!1;return!0}(t.shape,n.shape))throw new Error("The shapes of the two tensors should be the same for a binary operation");for(var o=new H(r,void 0,t.dtype),i=new Array(r.length).fill(0),a=0;a<o.size;a+=1)o.set(i,e(t.get(i),n.get(i))),O(i,r);return o}function C(t,n,e){return I(t,(function(t){return t*n+e}))}var G=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};function X(t,n,e,r,o,i){for(var a,u,s,p,c,l=[],h=0;h<t.length;h++)l.push((a=t[h],u=n[h],s=e[h],p=r[h],c=o[h],i[h]*(a-1)+s+p-(c*(u-1)+1)+2));return l}var E=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var R=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};function D(t,n,e){for(var r=[],o=[],i=[],a=0;a<t.length;a++)n.includes(a)?(e&&(r.push(1),i.push(a)),o.push(t[a])):(r.push(t[a]),i.push(a));return 0===r.length&&r.push(1),[r,i]}function U(t,n,e,r,o){for(var i=t.getShape(),a=g(i),u=D(i,n,r),s=u[0],p=u[1],c=g(s),l=b(s),h=new H(s,void 0,t.dtype),f=new Array(c).fill(!1),d=new Array(i.length).fill(0),y=new Array(s.length).fill(0),v=0;v<a;v++){for(var w=0;w<p.length;w++)y[w]=d[p[w]];var m=_(y,l);f[m]?h.set(y,e(t.get(v),h.get(y))):(f[m]=!0,h.set(y,e(t.get(v)))),O(d,i)}if(o)for(v=0;v<h.size;v++)h.set(v,o(h.get(v)));return h}var B=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var z=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};function W(t,n,e,r,o){if(o)return t.get(n);var i=t.shape.length;if("constant"===e)return r;if("edge"===e)for(var a=0;a<i;a++)n[a]<0?n[a]=0:n[a]>=t.shape[a]&&(n[a]=t.shape[a]-1);else for(a=0;a<i;a++)n[a]<0?n[a]=-n[a]:n[a]>=t.shape[a]&&(n[a]=2*t.shape[a]-n[a]-2);return t.get(n)}var L=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var F=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r};var N=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),q=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},H=function(t){function n(n,e,r){var o=t.call(this,r||"float32")||this;return o.deleted=!1,o.shape=n,o.strides=b(n),o.size=g(n),o.values=void 0!==e?e instanceof Array?new j[o.dtype](e):e:new j[o.dtype](o.size),o}return N(n,t),n.range=function(t,e,r){for(var o=Math.max(Math.ceil((e-t)/r),0),i=new Float32Array(o),a=0;a<o;a++)i[a]=t+a*r;return new n([o],i)},n.prototype.getValues=function(){return Promise.resolve(this.values)},n.prototype.getShape=function(){return this.shape},n.prototype.constantLike=function(t){return new n(this.shape,new j[this.dtype](this.size).fill(t),this.dtype)},n.prototype.singleConstant=function(t){return new n([1],[t],this.dtype)},n.prototype.cast=function(t){return new n(this.shape,Array.from(this.values),t)},n.prototype.delete=function(){this.values=void 0,this.deleted=!0},n.prototype.copy=function(t){void 0===t&&(t=q(this.shape));for(var e=new j[this.dtype](this.size),r=0;r<this.size;r++)e[r]=this.values[r];return new n(t,e,this.dtype)},n.prototype.get=function(t){var n;return n=Array.isArray(t)?_(t,this.strides,this.shape):t,this.values[n]},n.prototype.set=function(t,n){var e;e=Array.isArray(t)?_(t,this.strides):t,this.values[e]=n},n.prototype.setValues=function(t,e){if(!(t instanceof n))throw new Error("Can only set CPU values to CPU values");return function(t,n,e){for(var r=new H(t.shape,void 0,t.dtype),o=new Array(t.shape.length).fill(0),i=0;i<r.size;i+=1){for(var a=!0,u=new Array(e.length).fill(0),s=0;s<e.length;s++){if(o[s]<e[s]||o[s]>=e[s]+n.shape[s]){a=!1;break}u[s]=o[s]-e[s]}a?r.set(i,n.get(u)):r.set(i,t.get(i)),O(o,t.shape)}return r}(this,t,e)},n.prototype.exp=function(){return I(this,(function(t){return Math.exp(t)}))},n.prototype.log=function(){return I(this,(function(t){return Math.log(t)}))},n.prototype.sqrt=function(){return I(this,(function(t){return Math.sqrt(t)}))},n.prototype.abs=function(){return I(this,(function(t){return Math.abs(t)}))},n.prototype.sin=function(){return I(this,(function(t){return Math.sin(t)}))},n.prototype.cos=function(){return I(this,(function(t){return Math.cos(t)}))},n.prototype.tan=function(){return I(this,(function(t){return Math.tan(t)}))},n.prototype.asin=function(){return I(this,(function(t){return Math.asin(t)}))},n.prototype.acos=function(){return I(this,(function(t){return Math.acos(t)}))},n.prototype.atan=function(){return I(this,(function(t){return Math.atan(t)}))},n.prototype.sinh=function(){return I(this,(function(t){return Math.sinh(t)}))},n.prototype.cosh=function(){return I(this,(function(t){return Math.cosh(t)}))},n.prototype.tanh=function(){return I(this,(function(t){return Math.tanh(t)}))},n.prototype.asinh=function(){return I(this,(function(t){return Math.asinh(t)}))},n.prototype.acosh=function(){return I(this,(function(t){return Math.acosh(t)}))},n.prototype.atanh=function(){return I(this,(function(t){return Math.atanh(t)}))},n.prototype.floor=function(){return I(this,(function(t){return Math.floor(t)}))},n.prototype.ceil=function(){return I(this,(function(t){return Math.ceil(t)}))},n.prototype.round=function(){return I(this,(function(t){return Math.round(t)}))},n.prototype.negate=function(){return I(this,(function(t){return-t}))},n.prototype.powerScalar=function(t,n){return function(t,n,e){return I(t,(function(t){return Math.pow(t,n)*e}))}(this,t,n)},n.prototype.multiplyScalar=function(t){return C(this,t,0)},n.prototype.addScalar=function(t){return C(this,1,t)},n.prototype.addMultiplyScalar=function(t,n){return C(this,t,n)},n.prototype.sign=function(){return I(this,(function(t){return t<0?-1:0===t?0:1}))},n.prototype.clip=function(t,n){return function(t,n,e){var r=function(t){return t};return void 0!==n&&void 0!==e?r=function(t){return Math.min(e,Math.max(n,t))}:void 0!==e?r=function(t){return Math.min(e,t)}:void 0!==n&&(r=function(t){return Math.max(n,t)}),I(t,r)}(this,t,n)},n.prototype.clipBackward=function(t,e,r){if(!(t instanceof n))throw new Error("Can only do clipBackward with CPUTensor");return function(t,n,e,r,o){return V(t,n,(function(t,n){return void 0!==r&&t<r||void 0!==o&&t>o?0:n}),e)}(this,t,this.getShape(),e,r)},n.prototype.sigmoid=function(){return I(this,(function(t){return 1/(1+Math.exp(-t))}))},n.prototype.hardSigmoid=function(t,n){return function(t,n,e){return I(t,(function(t){return Math.max(0,Math.min(1,n*t+e))}))}(this,t,n)},n.prototype.add_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n,e,r,o){return V(t,n,(function(t,n){return t*r+n*o}),e)}(t,e,r,o,i)},n.prototype.subtract_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only subtract CPU tensor to CPU tensor");return function(t,n,e,r,o){return V(t,n,(function(t,n){return t*r-n*o}),e)}(t,e,r,o,i)},n.prototype.multiply_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n,e,r){return V(t,n,(function(t,n){return t*n*r}),e)}(t,e,r,o)},n.prototype.divide_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n,e,r){return V(t,n,(function(t,n){return t/n*r}),e)}(t,e,r,o)},n.prototype.power_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only take CPU tensor to power of CPU tensor");return function(t,n,e){return V(t,n,(function(t,n){return Math.pow(t,n)}),e)}(t,e,r)},n.prototype.matMul=function(t){if(!(t instanceof n))throw new Error("Can only add CPU tensor to CPU tensor");return function(t,n){if(2!==t.shape.length||2!==n.shape.length)throw new Error("Matmul expects both operands to have rank 2");if(t.shape[1]!==n.shape[0])throw new Error("Matmul expects dimension 1 of operand 1 to equal dimension 0 of operand 2");for(var e=t.shape[0],r=t.shape[1],o=n.shape[1],i=new H([e,o],void 0,t.dtype),a=0;a<e;a+=1)for(var u=0;u<o;u+=1){for(var s=0,p=0;p<r;p+=1)s+=t.get([a,p])*n.get([p,u]);i.set([a,u],s)}return i}(this,t)},n.prototype.gemm_impl=function(t,e,r,o,i,a){if(!(t instanceof n&&(void 0===a||a instanceof n)))throw new Error("Can only do gemm with CPU tensors");return function(t,n,e,r,o,i,a){var u=t.shape.length,s=e?t.shape[u-1]:t.shape[u-2],p=e?t.shape[u-2]:t.shape[u-1],c=r?n.shape[u-2]:n.shape[u-1],l=s*p,h=p*c,f=s*c,d=e?s:1,y=e?1:p,v=r?1:c,w=r?p:1,m=0,b=0,_=0;void 0!==a&&(m=a.strides[u-2],b=a.strides[u-1],g(a.shape.slice(0,u-2))>1?1===(_=a.shape[u-2]*a.shape[u-1])&&(_=0):_=0);var x=t.shape.slice(0,u-2),O=g(x);0===O&&(O=1);for(var k=R(x,[s,c]),S=new H(k,void 0,t.dtype),A=0;A<O;A++)for(var j=A*l,P=A*h,M=A*f,T=A*_,I=0;I<s;I++)for(var V=0;V<c;V++){for(var C=0,G=0;G<p;G++)C+=t.get(j+I*y+G*d)*n.get(P+G*v+V*w);C*=o,void 0!==a&&(C+=i*a.get(T+I*m+V*b)),S.set(M+I*c+V,C)}return S}(this,t,e,r,o,i,a)},n.prototype.sum_impl=function(t,n){return function(t,n,e){return U(t,n,(function(t,n){return t+(void 0!==n?n:0)}),e)}(this,t,n)},n.prototype.sumSquare_impl=function(t,n){return function(t,n,e){return U(t,n,(function(t,n){return t*t+(void 0!==n?n:0)}),e)}(this,t,n)},n.prototype.product_impl=function(t,n){return function(t,n,e){return U(t,n,(function(t,n){return t*(void 0!==n?n:1)}),e)}(this,t,n)},n.prototype.max_impl=function(t,n){return function(t,n,e){return U(t,n,(function(t,n){return Math.max(t,void 0!==n?n:t)}),e)}(this,t,n)},n.prototype.min_impl=function(t,n){return function(t,n,e){return U(t,n,(function(t,n){return Math.min(t,void 0!==n?n:t)}),e)}(this,t,n)},n.prototype.reduceMean_impl=function(t,n){return function(t,n,e){for(var r=1,o=0;o<n.length;o++)r*=t.shape[n[o]];return U(t,n,(function(t,n){return t+(void 0!==n?n:0)}),e,(function(t){return t/r}))}(this,t,n)},n.prototype.reduceMeanSquare_impl=function(t,n){return function(t,n,e){for(var r=1,o=0;o<n.length;o++)r*=t.shape[n[o]];return U(t,n,(function(t,n){return t*t+(void 0!==n?n:0)}),e,(function(t){return t/r}))}(this,t,n)},n.prototype.reduceLogSum_impl=function(t,n){return function(t,n,e){return U(t,n,(function(t,n){return t+(void 0!==n?n:0)}),e,(function(t){return Math.log(t)}))}(this,t,n)},n.prototype.reduceLogSumExp_impl=function(t,n){return function(t,n,e){return U(t,n,(function(t,n){return Math.exp(t)+(void 0!==n?n:0)}),e,(function(t){return Math.log(t)}))}(this,t,n)},n.prototype.conv_impl=function(t,e,r,o,i,a,u){if(!(t instanceof n)||void 0!==u&&!(u instanceof n))throw new Error("Can only do convolution of CPU tensor with CPU tensor");return function(t,n,e,r,o,i,a,u){var s=t.shape[0],p=t.shape[1],c=t.shape.slice(2),l=n.shape.slice(2),h=n.shape[0],f=p/r,d=g(l),y=T(c,l,o.slice(0,o.length/2),o.slice(o.length/2),e,i),v=g(y),w=[s,h];w=w.concat(y);for(var m=new H(w,void 0,t.dtype),b=y.length,_=0;_<s;_++)for(var x=0;x<h;x++){if(u){var k=u?u.get([x]):0;(U=new Array(y.length).fill(0)).unshift(_,x);for(var S=0;S<v;S++)m.set(U,k),O(U,m.shape)}for(var A=0;A<f;A++){var j=(x*f+A)%p;for((U=new Array(y.length).fill(0)).unshift(_,x),S=0;S<v;S++){var P=m.get(U),M=new Array(y.length).fill(0);M.unshift(x,A);for(var I=0;I<d;I++){for(var V=[_,j],C=!1,G=0;G<b;G++){var X=0===i.length?1:i[G],E=0===o.length?0:o[G],R=0===e.length?1:e[G],D=U[G+2]*X-E+M[G+2]*R;if(D<0||D>=c[G]){C=!0;break}V.push(D)}C||(P+=n.get(M)*t.get(V)),O(M,n.shape)}m.set(U,P),O(U,m.shape)}}var U;if("id"!==a)for((U=new Array(y.length).fill(0)).unshift(_,x),S=0;S<v;S++)P=m.get(U),"relu"===a?P=Math.max(0,P):"relu6"===a&&(P=Math.min(Math.max(0,P),6)),m.set(U,P),O(U,m.shape)}return m}(this,t,e,r,o,i,a,u)},n.prototype.convTranspose_impl=function(t,e,r,o,i){if(!(t instanceof n))throw new Error("Can only do transpose convolution of CPU tensor with CPU tensor");return function(t,n,e,r,o,i){var a=t.shape[0],u=t.shape[1],s=t.shape.slice(2),p=n.shape.slice(2),c=n.shape[0],l=u/r,h=g(p),f=X(s,p,o.slice(0,o.length/2),o.slice(o.length/2),e,i),d=g(f),y=[a,c];y=y.concat(f);for(var v=new H(y,void 0,t.dtype),w=f.length,m=0;m<a;m++)for(var b=0;b<c;b++)for(var _=0;_<l;_++){var x=(b*l+_)%u,k=new Array(f.length).fill(0);k.unshift(m,b);for(var S=0;S<d;S++){var A=v.get(k),j=new Array(f.length).fill(0);j.unshift(b,_);for(var P=0;P<h;P++){for(var M=[m,x],T=!1,I=0;I<w;I++){var V=0===i.length?1:i[I],C=0===o.length?0:o[I],G=0===e.length?1:e[I],E=k[I+2]-C+j[I+2]*G;if(0!==E%V){T=!0;break}if((E/=V)<0||E>=s[I]){T=!0;break}M.push(E)}if(!T){for(var R=[b,_],D=0;D<w;D++)R.push(p[D]-j[D+2]-1);A+=n.get(R)*t.get(M)}O(j,n.shape)}v.set(k,A),O(k,v.shape)}}return v}(this,t,e,r,o,i)},n.prototype.pad_impl=function(t,n,e){return function(t,n,e,r){for(var o=t.shape.length,i=z(t.shape),a=0;a<o;a++)i[a]+=n[a]+n[a+o];var u=new H(i,void 0,t.dtype),s=new Array(o).fill(0),p=new Array(o).fill(0);for(a=0;a<u.size;a++){for(var c=!0,l=0;l<o;l++)p[l]=s[l]-n[l],(p[l]<0||p[l]>=t.shape[l])&&(c=!1);u.set(a,W(t,p,e,r,c)),O(s,i)}return u}(this,t,n,e)},n.prototype.averagePool_impl=function(t,n,e,r){return function(t,n,e,r,o){var i=t.shape[0],a=t.shape[1],u=t.shape.slice(2),s=u.length,p=g(n),c=T(u,n,e.slice(0,e.length/2),e.slice(e.length/2),new Array(s).fill(1),r),l=g(c),h=[i,a];h=h.concat(c);for(var f=new H(h,void 0,t.dtype),d=0;d<i;d++)for(var y=0;y<a;y++){var v=new Array(c.length).fill(0);v.unshift(d,y);for(var w=0;w<l;w++){for(var m=0,b=new Array(c.length).fill(0),_=0,x=0;x<p;x++){for(var k=[d,y],S=!1,A=0;A<s;A++){var j=0===r.length?1:r[A],P=0===e.length?0:e[A],M=v[A+2]*j-P+b[A];if(M<0||M>=u[A]){S=!0;break}k.push(M)}S||(m+=t.get(k)),S&&!o||(_+=1),O(b,n)}m/=_,f.set(v,m),O(v,f.shape)}}return f}(this,t,n,e,r)},n.prototype.reshape_impl=function(t,e){return e?this.copy(t):new n(t,this.values,this.dtype)},n.prototype.concat=function(t,e){if(!(t instanceof n))throw new Error("Can only concat CPU tensor to CPU tensor");return e<0&&(e+=this.shape.length),function(t,n,e){var r=G(t.shape);r[e]+=n.shape[e];for(var o=new H(r,void 0,t.dtype),i=0,a=0,u=0,s=o.strides[e]*t.shape[e],p=o.strides[e]*n.shape[e],c=o.size/(e>0?o.strides[e-1]:o.size),l=0;l<c;l++){for(var h=0;h<s;h++)o.set(u,t.get(i)),u++,i++;for(h=0;h<p;h++)o.set(u,n.get(a)),u++,a++}return o}(this,t,e)},n.prototype.transpose_impl=function(t){return function(t,n){for(var e=t.shape.length,r=new Array(e),o=new Array(e),i=0;i<e;i++)r[i]=t.shape[n[i]],o[n[i]]=i;var a=new H(r,void 0,t.dtype),u=a.strides,s=new Array(e);for(i=0;i<e;i++)s[i]=u[o[i]];var p=new Array(e).fill(0);for(i=0;i<t.size;i++){for(var c=0,l=0;l<e;l++)c+=p[l]*s[l];a.set(c,t.get(i)),O(p,t.shape)}return a}(this,t)},n.prototype.repeat=function(t){return function(t,n){for(var e=t.shape.length,r=new Array(e),o=0;o<e;o++)r[o]=t.shape[o]*n[o];var i=new H(r,void 0,t.dtype),a=new Array(e).fill(0);for(o=0;o<i.size;o++){for(var u=new Array(e),s=0;s<e;s++)u[s]=a[s]%t.shape[s];i.set(o,t.get(u)),O(a,i.shape)}return i}(this,t)},n.prototype.expand=function(t){var n=this.alignShapes(this.shape,t),e=n[0],r=(n[1],n[2]);return x(this.shape,r)?this.copy():function(t,n){for(var e=t.shape.length,r=new H(n,void 0,t.dtype),o=new Array(e).fill(0),i=0;i<r.size;i++)r.set(i,t.get(o)),O(o,r.shape);return r}(this.reshape(e,!1),r)},n.prototype.gather=function(t,n){return function(t,n,e){for(var r=t.shape.length,o=e.shape.length,i=r+o-1,a=new Array(i),u=0;u<n;u++)a[u]=t.shape[u];for(u=0;u<o;u++)a[u+n]=e.shape[u];for(u=n+1;u<r;u++)a[u+o-1]=t.shape[u];var s,p,c=new H(a,void 0,t.dtype),l=new Array(i).fill(0);for(u=0;u<c.size;u++){s=l.slice(n,n+o);var h=e.get(s);p=E(l.slice(0,n),[h],l.slice(n+o)),c.set(u,t.get(p)),O(l,a)}return c}(this,t,n)},n.prototype.slice_impl=function(t,n,e,r){return function(t,n,e,r,o){for(var i=t.shape.length,a=L(t.shape),u=0,s=0;s<i&&u<r.length;s++)s===r[u]&&(a[s]=Math.ceil((e[u]-n[u])/o[u]),u++);var p,c=new H(a,void 0,t.dtype),l=new Array(i).fill(0);for(s=0;s<c.size;s++){p=new Array(i);for(var h=0;h<r.length;h++)p[r[h]]=l[r[h]]*o[h]+n[h];c.set(s,t.get(p)),O(l,a)}return c}(this,t,n,e,r)},n.prototype.upsample=function(t){return function(t,n){for(var e=t.shape.length,r=F(t.shape),o=0;o<e;o++)r[o]=Math.floor(r[o]*n[o]);var i=new H(r,void 0,t.dtype),a=new Array(e).fill(0),u=new Array(e);for(o=0;o<i.size;o++){for(var s=0;s<e;s++)u[s]=Math.floor(a[s]/n[s]);i.set(o,t.get(u)),O(a,r)}return i}(this,t)},n.prototype.normalize=function(t,e,r,o,i){if(!(t instanceof n)||!(e instanceof n)||!(o instanceof n)||!(i instanceof n))throw new Error("Can only normalize with CPU tensors");return function(t,n,e,r,o,i){for(var a=t.shape.length,u=B(t.shape),s=new H(u,void 0,t.dtype),p=new Array(a).fill(0),c=0;c<s.size;c++){var l=(t.get(p)-n.get(p))/Math.sqrt(e.get(p)+r);l=l*o.get(p)+i.get(p),s.set(c,l),O(p,u)}return s}(this,t,e,r,o,i)},n}(P),Y=e(53),J=e.n(Y),K=function(){function t(t){this.toNumber=t,this.numEntries=0,this.dict={}}return t.prototype.betweenBoundsFirst=function(t){if(void 0!==t.gte){var n=this.toNumber(t.gte);return void 0!==this.dict[n]&&this.dict[n].length>0?[{key:t.gte,value:this.dict[n][this.dict[n].length-1]}]:[]}if(void 0!==t.lte){n=this.toNumber(t.lte);return void 0!==this.dict[n]&&this.dict[n].length>0?[{key:t.lte,value:this.dict[n][this.dict[n].length-1]}]:[]}return[]},t.prototype.deleteFirst=function(t){var n=this.toNumber(t);void 0!==this.dict[n]&&(this.dict[n].pop(),this.numEntries--)},t.prototype.insert=function(t,n){var e=this.toNumber(t);void 0===this.dict[e]&&(this.dict[e]=[]),this.dict[e].push(n),this.numEntries++},t}();function Q(t){return Z(t)}function Z(t,n,e){if(void 0===n&&(n=[]),void 0===e&&(e=!0),!Number.isInteger(t))return n;var r=Math.abs(t);if(r<2)return n;var o=Math.sqrt(r),i=2;if(r%i&&r%(i=3)){i=5;for(var a=2;r%i&&i<o;)i+=a,a=6-a}(i=i<=o?i:r,e)?n.push(i):n.indexOf(i)<0&&n.push(i);return i===r?n:Z(r/i,n,e)}function $(){for(var t=0,n=0;0===t;)t=Math.random();for(;0===n;)n=Math.random();return[Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*n),Math.sqrt(-2*Math.log(t))*Math.sin(2*Math.PI*n)]}var tt,nt,et,rt={float32:"float",float16:"half float",int32:"float",int16:"float",int8:"float",uint32:"float",uint16:"float",uint8:"float"},ot=function(){function t(t,n,e){this.orderedDictConstructor=n,this.totalAllocations=0,this.trees={},this.regl=t,this.entryId=0,this.maxSizeFactor=e||2}return t.prototype.getColorType=function(t){return rt[t]},t.prototype.dtypeGroup=function(t){return"float16"===t?"float16":"float32"},t.prototype.allocate=function(t,n){var e=this.dtypeGroup(n),r=t*this.maxSizeFactor,o=4*Math.ceil(t/4);o<r&&(r=o);var i=void 0!==this.trees[e]?this.trees[e].betweenBoundsFirst({gte:o,lte:r}):[];if(0===i.length){var a=Math.ceil(t/4),u=this.getTextureDims(a),s=u.width,p=u.height,c={width:s,height:p,size:s*p*4,frameBuffer:this.regl.framebuffer({width:s,height:p,depthStencil:!1,colorFormat:"rgba",colorType:rt[n]}),id:this.entryId++,dtype:n};return this.totalAllocations++,c}var l=i[0];return this.trees[e].deleteFirst(l.key),l.value.dtype=n,l.value},t.prototype.getAllocationDimensions=function(t,n){var e=this.dtypeGroup(n),r=t*this.maxSizeFactor,o=4*Math.ceil(t/4);o<r&&(r=o);var i=void 0!==this.trees[e]?this.trees[e].betweenBoundsFirst({gte:t,lte:r}):[];if(0===i.length){var a=Math.ceil(t/4);return this.getTextureDims(a)}var u=i[0];return{width:u.value.width,height:u.value.height}},t.prototype.deallocate=function(t){var n=this.dtypeGroup(t.dtype);void 0===this.trees[n]&&(this.trees[n]=this.orderedDictConstructor()),this.trees[n].insert(t.size,t)},t.prototype.allocateTexture=function(t,n){for(var e=Math.ceil(t.length/4),r=this.getTextureDims(e),o=r.width,i=r.height,a=o*i*4,u=new Array(a),s=0;s<t.length;s++)u[s]=t[s];for(s=t.length;s<a;s++)u[s]=0;var p=this.regl.texture({width:o,height:i,format:"rgba",type:rt[n],data:u}),c=this.regl.framebuffer({color:p,width:o,height:i,depthStencil:!1});return this.totalAllocations++,{width:o,height:i,size:a,frameBuffer:c,id:this.entryId++,dtype:n}},t.prototype.allocateOfDimensions=function(t,n,e){var r=t*n*4,o=this.regl.texture({width:t,height:n,format:"rgba",type:rt[e]}),i=this.regl.framebuffer({color:o,width:t,height:n,depthStencil:!1});return this.totalAllocations++,{width:t,height:n,size:r,frameBuffer:i,id:this.entryId++,dtype:e}},t.prototype.allocateFramebuffer=function(t,n){var e=this.regl.framebuffer({color:t,width:t.width,height:t.height,depthStencil:!1,colorType:rt[n]});return this.totalAllocations++,{width:t.width,height:t.height,size:t.width*t.height*4,frameBuffer:e,id:this.entryId++,dtype:n}},t.prototype.getTextureDims=function(t){for(var n=Q(t),e=1,r=1,o=0;o<n.length;o+=2)e*=n[o],o+1<n.length&&(r*=n[o+1]);return{width:e,height:r}},t.prototype.getNumEntries=function(){var t=0;for(var n in this.trees)t+=this.trees[n].numEntries;return t},t}(),it=document.createElement("canvas");tt=it.getContext("webgl",{failIfMajorPerformanceCaveat:!1}),nt=J()({gl:tt,extensions:["OES_texture_float","WEBGL_color_buffer_float","OES_texture_half_float"]}),et=new ot(nt,(function(){return new K((function(t){return t}))}));var at=function(){return(at=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},ut=function(){function t(t,n,e,r){this.dtype=n,this.statics=new Set,this.copyCounter=0,this.fullyStatic=!1,void 0===e&&(e=et),void 0===r&&(r=10),this.allocator=e,this.maxRank=r,this.gpuTensorConstructor=t}return t.prototype.registerStatics=function(t){var n=0,e=0;for(var r in t)if(r.startsWith("shape")){var o=r.slice("shape".length);this.statics.add("shape"+o),this.statics.add("size"+o),this.statics.add("rank"+o),this.statics.add("strides"+o),n++}else this.statics.add(r),r.startsWith("width")||r.startsWith("height")||e++;n-1===this.getTextureNames().length&&e===this.getUniformAttrs().length&&(this.fullyStatic=!0,this.outputShape=t.shapeOutput)},t.prototype.getVarModifier=function(t){return this.statics.has(t)?"":"uniform"},t.prototype.pad=function(t,n){for(void 0===n&&(n=this.maxRank);t.length<n;)t.push(-1);return t},t.prototype.copyPad=function(t,n){void 0===n&&(n=this.maxRank);for(var e=Array.from(t);e.length<n;)e.push(-1);return e},t.prototype.getVariables=function(){return""},t.prototype.getVariableDeclarations=function(){var t=this,n=this.getTextureNames();return n.push("Output"),"\n      "+n.map((function(n){return"\n        "+("Output"===n?"":"uniform sampler2D "+n+";")+"\n        "+t.getVarModifier("size"+n)+" int size"+n+";\n        "+t.getVarModifier("width"+n)+" int width"+n+";\n        "+t.getVarModifier("height"+n)+" int height"+n+";\n        "+t.getVarModifier("strides"+n)+" int strides"+n+"["+t.maxRank+"];\n        "+t.getVarModifier("shape"+n)+" int shape"+n+"["+t.maxRank+"];\n        "+t.getVarModifier("rank"+n)+" int rank"+n+";\n        "})).join("\n")+"\n      varying vec2 uv;\n\n      "+this.getVariables()},t.prototype.getVariableInitializations=function(t){var n=this.getTextureNames();n.push("Output");for(var e="",r=0,o=n;r<o.length;r++){var i=o[r];if("shape"+i in t){var a=t["shape"+i],u=b(a),s=g(a),p=a.length;e+=this.getArrayInit("shape"+i,a),e+=this.getArrayInit("strides"+i,u),e+="\nsize"+i+" = "+s+";",e+="\nrank"+i+" = "+p+";"}}for(var c in t){if(!c.startsWith("shape"))if(Array.isArray(t[c]))e+=this.getArrayInit(c,t[c]);else e+="int"===this.getVarType(c)?"\n"+c+" = "+t[c]+";":"\n"+c+" = "+t[c].toPrecision(20)+";"}return e},t.prototype.getVarType=function(t){var n=this.getUniformAttrs().find((function(n){return n.name===t}));return void 0!==n&&n.type?n.type:"int"},t.prototype.getArrayInit=function(t,n,e,r){void 0===e&&(e=this.maxRank);var o=this.getVarType(t);void 0===r&&("int"===o?r="-1":"float"===o&&(r="-1.0"));for(var i="",a=0;a<e;a++)a<n.length?"int"===o?i+="\n "+t+"["+a+"] = "+n[a]+";":"float"===o&&(i+="\n "+t+"["+a+"] = "+n[a].toPrecision(20)+";"):i+="\n "+t+"["+a+"] = "+r+";";return i},t.prototype.getUtilFunctions=function(){return"\n    int fromFloat(float f) {\n      return int(floor(f+0.5));\n    }\n\n    int coordinateToPos(vec2 coordinate, int textureWidth, int textureHeight) {\n      int x = (fromFloat(coordinate.x*float(textureWidth*2))-1)/2;\n      int y = (fromFloat(coordinate.y*float(textureHeight*2))-1)/2;\n\n      int pos = x + y*textureWidth;\n\n      return pos*4;\n    }\n\n    vec2 posToCoordinate(int pos, int textureWidth, int textureHeight) {\n      pos = pos/4;\n\n      int y = pos/textureWidth;\n      int x = pos - y*textureWidth;\n\n      return vec2(float(x*2+1)/float(textureWidth*2), float(y*2+1)/float(textureHeight*2));\n    }\n\n    int indexToPos(int index["+this.maxRank+"], int strides["+this.maxRank+"]) {\n      int pos = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (strides[i] == -1) {\n          break;\n        }\n        pos += index[i]*strides[i];\n      }\n      return pos;\n    }\n\n    // TODO: Change return type based on dtype of operation\n    // TODO: Change values per texel here\n    float getValueAtPos(int pos, int textureWidth, int textureHeight, sampler2D tex) {\n      vec2 coord = posToCoordinate(pos, textureWidth, textureHeight);\n      int res = pos - (pos/4)*4;\n      vec4 val = texture2D(tex, coord);\n      if (res == 0) {\n        return val.r;\n      } else if (res == 1) {\n        return val.g;\n      } else if (res == 2) {\n        return val.b;\n      } else {\n        return val.a;\n      }\n    }\n\n    // TODO: Change return type based on dtype of operation\n    float getValueAt(int index["+this.maxRank+"], int strides["+this.maxRank+"], int textureWidth, int textureHeight, sampler2D tex) {\n      int pos = indexToPos(index, strides);\n      return getValueAtPos(pos, textureWidth, textureHeight, tex);\n    }"},t.prototype.getTextureFunctions=function(){var t=this;return this.getTextureNames().map((function(n){return"\n        float _"+n+"(int indices["+t.maxRank+"]) {\n          return getValueAt(indices, strides"+n+", width"+n+", height"+n+", "+n+");\n        }\n      "})).join("\n")},t.prototype.getCompleteFragmentShader=function(t){var n=this.getFragmentShader(t),e=this.getVariableDeclarations(),r=this.getVariableInitializations(t),o=this.getUtilFunctions(),i=this.getTextureFunctions();return"\n    // TODO: Change between int/float here\n    precision "+this.precisionString()+" float;\n\n    "+e+"\n\n    "+o+"\n    "+i+"\n\n    void initVars() {\n      "+r+"\n    }\n\n    "+n},t.prototype.getUniforms=function(t){for(var n=[],e=0,r=this.getUniformAttrs();e<r.length;e++){var o=r[e];void 0===t[o.name]&&n.push(o)}var i=this.getTextureNames();i.push("Output");for(var a=0,u=i;a<u.length;a++){var s=u[a];n.push({name:s}),void 0===t["shape"+s]&&(n.push({name:"size"+s}),n.push({name:"strides"+s,length:this.maxRank}),n.push({name:"shape"+s,length:this.maxRank}),n.push({name:"rank"+s})),void 0===t["width"+s]&&n.push({name:"width"+s}),void 0===t["height"+s]&&n.push({name:"height"+s})}for(var p={},c=0,l=n;c<l.length;c++){var h=l[c];if(void 0===t[h.name])if(void 0!==h.length)for(var f=0;f<h.length;f++){var d=h.name+"["+f+"]";p[d]=nt.prop(d)}else p[h.name]=nt.prop(h.name)}return p},t.prototype.posToIndex=function(t,n,e){var r=e+"_"+this.copyCounter++;return"\n    int "+r+" = "+e+";\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if ("+t+"[i] == -1) {\n        "+n+"[i] = -1;\n      } else {\n        if ("+t+"[i] == 0) {\n          "+n+"[i] = 0;\n        } else {\n          "+n+"[i] = "+r+"/"+t+"[i];\n          "+r+" = "+r+" - "+t+"[i]*"+n+"[i]; // Stupid modulo hack\n        }\n      }\n    }"},t.prototype.initIndex=function(t,n){return void 0===n?"\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          "+t+"[i] = -1;\n        }":"\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (i < "+n+") {\n            "+t+"[i] = 0;\n          } else {\n            "+t+"[i] = -1;\n          }\n        }"},t.prototype.incrementIndex=function(t,n){return"\n    for (int i = "+this.maxRank+" - 1; i >= 0; i--) {\n      if ("+n+"[i] != -1) {\n        "+t+"[i] += 1;\n        if ("+t+"[i] >= "+n+"[i]) {\n          "+t+"[i] = 0;\n        } else {\n          break;\n        }\n      }\n    }\n    "},t.prototype.incrementConditional=function(t,n,e){return"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if ("+e+"[i] == 1) {\n        "+t+"[i] += 1;\n        if ("+t+"[i] >= "+n+"[i]) {\n          "+t+"[i] = 0;\n        } else {\n          break;\n        }\n      } else if ("+e+"[i] == -1) {\n        break;\n      }\n    }\n    "},t.prototype.getDefaultMain=function(){return"\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      // TODO: change number of values per pixel here\n      vec4 result = vec4(0,0,0,0);\n\n      if (pos < sizeOutput) {\n        int index["+this.maxRank+"];\n        "+this.posToIndex("stridesOutput","index","pos")+"\n        result.r = process(index);\n\n        pos += 1;\n\n        if (pos < sizeOutput) {\n          "+this.posToIndex("stridesOutput","index","pos")+"\n          result.g = process(index);\n\n          pos += 1;\n\n          if (pos < sizeOutput) {\n            "+this.posToIndex("stridesOutput","index","pos")+"\n            result.b = process(index);\n\n            pos += 1;\n\n            if (pos < sizeOutput) {\n              "+this.posToIndex("stridesOutput","index","pos")+"\n              result.a = process(index);\n            }\n          }\n        }\n      }\n\n      gl_FragColor = result;\n    }"},t.prototype.precisionString=function(){return"float16"===this.dtype?"mediump":"highp"},t.prototype.getDrawCommand=function(t){var n=this.getCompleteFragmentShader(t),e=this.getUniforms(t);return nt({frag:n,vert:"\n        // TODO: Change between float/int\n        precision "+this.precisionString()+" float;\n        attribute vec2 position;\n        varying vec2 uv;\n        void main() {\n          uv = 0.5 * (position + 1.0);\n          gl_Position = vec4(position, 0, 1);\n        }",attributes:{position:[-4,-4,4,-4,0,4]},uniforms:e,framebuffer:nt.prop("framebuffer"),depth:{enable:!1},count:3})},t.prototype.compile=function(t){this.registerStatics(t),this.drawCommand=this.getDrawCommand(t)},t.prototype.compute=function(t,n,e){void 0===this.drawCommand&&this.compile({});var r=g(t),o=this.allocator.allocate(r,this.dtype);for(var i in n){if(n[i].memory.id===o.id)throw new Error("Allocator returned a framebuffer that is also an input\n                         Did you delete a GPU tensor that was still used elsewhere?")}var a={};for(var u in n)a[u]=n[u].memory.frameBuffer;if(void 0===e&&(e={}),!this.fullyStatic){for(var s in n)this.statics.has("shape"+s)||(e["size"+s]=n[s].size,e["strides"+s]=this.pad(b(n[s].shape)),e["shape"+s]=this.copyPad(n[s].shape),e["rank"+s]=n[s].shape.length),this.statics.has("width"+s)||(e["width"+s]=n[s].memory.width),this.statics.has("height"+s)||(e["height"+s]=n[s].memory.height);this.statics.has("shapeOutput")||(e.sizeOutput=r,e.stridesOutput=this.pad(b(t)),e.shapeOutput=this.copyPad(t),e.rankOutput=t.length),this.statics.has("widthOutput")||(e.widthOutput=o.width),this.statics.has("heightOutput")||(e.heightOutput=o.height)}return this.drawCommand(at(at({framebuffer:o.frameBuffer},a),e)),this.gpuTensorConstructor(o,t,this.precision)},t.prototype.getUniformAttrs=function(){return[]},t}(),st=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),pt=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o.maxRank=2,o}return st(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int ix1["+this.maxRank+"];\n      "+this.initIndex("ix1")+"\n      ix1[0] = index[0];\n\n      int ix2["+this.maxRank+"];\n      "+this.initIndex("ix2")+"\n      ix2[1] = index[1];\n\n      int k = shapeA[1];\n\n      float res = 0.0;\n\n      for (int i = 0; i < "+this.maxIterations+"; i++) {\n        if (i >= k) {\n          break;\n        }\n        ix1[1] = i;\n        ix2[0] = i;\n\n        float v1 = _A(ix1);\n        float v2 = _B(ix2);\n        res += v1*v2;\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.calc=function(t){var n=this.getOutputShape(t);return this.compute(n,{A:t.A,B:t.B})},n.prototype.getOutputShape=function(t){return[t.A.shape[0],t.B.shape[1]]},n.prototype.compile=function(n){void 0!==n.shapeA?this.maxIterations=n.shapeA[1]:void 0!==n.shapeB&&(this.maxIterations=n.shapeB[0]),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.A.shape,widthB:t.A.memory.width,heightB:t.A.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape},n}(ut),ct=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),lt=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ct(n,t),n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = "+this.operation("texture2D(X, uv)")+";\n    }\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){return this.compute(t.input.shape,{X:t.input})},n.prototype.getOutputShape=function(t){return t.input.shape},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:this.getOutputShape(t),widthOutput:e.width,heightOutput:e.height}},n.prototype.getInputInfoString=function(t){return""+t.input.shape},n}(ut),ht=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ft=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ht(n,t),n.prototype.operation=function(t){return"exp("+t+")"},n}(lt),dt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),yt=function(){return(yt=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},vt=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return dt(n,t),n.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      int dilation = dilations[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d+2]*dilation;\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},n.prototype.getMainBody=function(){return"\n    int n = index[0];\n    int m = index[1];\n\n    int kernelIx["+this.maxRank+"];\n    "+this.initIndex("kernelIx")+"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if (i >= dataRank) {\n        break;\n      }\n      kernelIx[i+2] = 0;\n    }\n    kernelIx[0] = m;\n    int inputIx["+this.maxRank+"];\n    "+this.initIndex("inputIx")+"\n    inputIx[0] = n;\n\n    for (int cg = 0; cg < "+this.maxIterations+"; cg++) {\n      if (cg >= CG) {\n        break;\n      }\n      int c = m * CG + cg;\n      int d = c/C;\n      c = c - d*C;\n      inputIx[1] = c;\n      kernelIx[1] = cg;\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx) * _W(kernelIx);\n        }\n\n        "+this.incrementIndex("kernelIx","shapeW")+"\n      }\n    }\n    "},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("CG")+" int CG;\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("C")+" int C;\n    "+this.getVarModifier("dilations")+" int dilations["+this.maxRank+"];\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "+this.getVarModifier("activation")+" int activation;\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n\n      "+this.getMainBody()+"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      } else if (activation == 2) {\n        res = max(0.0, min(res,6.0));\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X","W"]},n.prototype.getUniformAttrs=function(){return[{name:"CG"},{name:"kernelSize"},{name:"C"},{name:"dataRank"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"dilations",length:this.maxRank},{name:"activation"}]},n.prototype.getActivationFlag=function(t){return"id"===t?0:"relu"===t?1:2},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X,W:t.W});var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],u=g(o),s=T(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[n,i];return p=p.concat(s),this.compute(p,{X:t.X,W:t.W},{CG:a,kernelSize:u,C:e,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations),activation:this.getActivationFlag(t.activation)})},n.prototype.getOutputShape=function(t){var n=t.X.shape[0],e=t.X.shape.slice(2),r=t.W.shape.slice(2),o=t.W.shape[0],i=T(e,r,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),a=[n,o];return a=a.concat(i)},n.prototype.compile=function(n){void 0!==n.shapeW&&(n.CG=n.shapeW[1],n.kernelSize=g(n.shapeW.slice(2)),n.dataRank=n.shapeW.length-2,this.maxRank=n.shapeW.length),void 0!==n.shapeX&&(n.C=n.shapeX[1],n.dataRank=n.shapeX.length-2,this.maxRank=n.shapeX.length),void 0!==n.activation&&"string"===typeof n.activation&&(n.activation=this.getActivationFlag(n.activation)),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype),r=g(t.W.shape.slice(2)),o=t.X.shape[1],i=t.X.shape.slice(2);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeW:t.W.shape,widthW:t.W.memory.width,heightW:t.W.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,pads:t.pads,dilations:t.dilations,strides:t.strides,CG:t.W.shape[1],kernelSize:r,dataRank:i.length,C:o,activation:this.getActivationFlag(t.activation)}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.W.shape+"-"+t.dilations+"-"+t.pads+"-"+t.dilations+"-"+t.strides+"-"+t.activation},n}(ut),wt=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return dt(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int biasIndex["+this.maxRank+"];\n      "+this.initIndex("biasIndex")+"\n      biasIndex[0] = index[1];\n      float res = _B(biasIndex);\n\n      "+this.getMainBody()+"\n\n      if (activation == 1) {\n        res = max(0.0, res);\n      } else if (activation == 2) {\n        res = max(0.0, min(res,6.0));\n      }\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X","W","B"]},n.prototype.calc=function(t){var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],u=g(o),s=T(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[n,i];return p=p.concat(s),this.compute(p,{X:t.X,W:t.W,B:t.B},{CG:a,kernelSize:u,C:e,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations),activation:this.getActivationFlag(t.activation)})},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return yt(yt({},e),{shapeB:n.B.shape,widthB:n.B.memory.width,heightB:n.B.memory.height})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.B.shape},n}(vt),mt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),gt=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return mt(n,t),n.prototype.operation=function(t){return"abs("+t+")"},n}(lt),bt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),_t=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return bt(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int["+this.maxRank+"] index) {\n      return "+this.getOp("_A(index)","_B(index)")+";\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getOutputShape=function(t){return t.outputShape},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B})},n.prototype.compile=function(n){void 0!==n.shapeA&&(this.maxRank=n.shapeA.length),void 0!==n.shapeB&&(this.maxRank=n.shapeB.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=et.getAllocationDimensions(g(t.outputShape),this.dtype);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.B.shape,widthB:t.B.memory.width,heightB:t.B.memory.height,shapeOutput:t.outputShape,widthOutput:n.width,heightOutput:n.height}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape},n}(ut),xt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ot=function(){return(Ot=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},kt=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return xt(n,t),n.prototype.getOp=function(t,n){return"alpha*"+t+" + beta*"+n},n.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha,beta:t.beta})},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return Ot(Ot({},e),{alpha:n.alpha,beta:n.beta})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.alpha+"-"+n.beta},n}(_t),St=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),At=function(){return(At=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},jt=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return St(n,t),n.prototype.getOp=function(t,n){return"alpha*"+t+" * "+n},n.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha})},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"}]},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return At(At({},e),{alpha:n.alpha})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.alpha},n}(_t),Pt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Mt=function(){return(Mt=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},Tt=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Pt(n,t),n.prototype.getOp=function(t,n){return"alpha*"+t+" - beta*"+n},n.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha,beta:t.beta})},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return Mt(Mt({},e),{alpha:n.alpha,beta:n.beta})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.alpha+"-"+n.beta},n}(_t),It=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Vt=function(){return(Vt=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},Ct=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return It(n,t),n.prototype.getOp=function(t,n){return"alpha*"+t+" / "+n},n.prototype.calc=function(t){return this.compute(t.outputShape,{A:t.A,B:t.B},{alpha:t.alpha})},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"}]},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return Vt(Vt({},e),{alpha:n.alpha})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.alpha},n}(_t),Gt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Xt=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return Gt(n,t),n.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      if (stride == -1) {\n        break;\n      }\n\n      inputIx[d+2] = index[d+2]*stride - pad + kernelIx[d];\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("includePad")+" int includePad;\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "+this.getVarModifier("kernelShape")+" int kernelShape["+this.maxRank+"];\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n      int count = 0;\n\n      int n = index[0];\n      int c = index[1];\n\n      int kernelIx["+this.maxRank+"];\n      "+this.initIndex("kernelIx")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i >= dataRank) {\n          break;\n        }\n        kernelIx[i] = 0;\n      }\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n      inputIx[0] = n;\n      inputIx[1] = c;\n\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx);\n        }\n\n        if (!skip || includePad == 1) {\n          count += 1;\n        }\n\n        "+this.incrementIndex("kernelIx","kernelShape")+"\n      }\n\n      res = res / float(count);\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getUniformAttrs=function(){return[{name:"kernelSize"},{name:"dataRank"},{name:"includePad"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"kernelShape",length:this.maxRank}]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=g(t.kernelShape),i=T(r,t.kernelShape,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),new Array(r.length).fill(1),t.strides),a=[n,e];return a=a.concat(i),this.compute(a,{X:t.X},{kernelSize:o,includePad:t.includePad?1:0,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),kernelShape:this.copyPad(t.kernelShape)})},n.prototype.getOutputShape=function(t){var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=T(r,t.kernelShape,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),new Array(r.length).fill(1),t.strides),i=[n,e];return i=i.concat(o)},n.prototype.compile=function(n){void 0!==n.shapeX&&(n.dataRank=n.shapeX.length-2,this.maxRank=n.shapeX.length),!0===n.includePad?n.includePad=1:!1===n.includePad&&(n.includePad=0),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype),r=g(t.kernelShape);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,kernelShape:t.kernelShape,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,pads:t.pads,strides:t.strides,kernelSize:r,dataRank:t.X.shape.length-2,includePad:t.includePad?1:0}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.kernelShape+"-"+t.pads+"-"+t.strides+"-"+t.includePad},n}(ut),Et=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Rt=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return Et(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("mappedInputStrides")+" int mappedInputStrides["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int sumDims["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int sumSize;\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n\n      int inputPos = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (mappedInputStrides[i] == -1 || index[i] == -1) {\n          break;\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n      }\n\n      "+this.posToIndex("stridesX","inputIx","inputPos")+"\n\n      float res = 0.0;\n\n      for (int i = 0; i < "+this.maxIterations+"; i++) {\n        if (i >= sumSize) {\n          break;\n        }\n        float curr = _X(inputIx);\n        if (i == 0) {\n          res = "+this.init("curr")+";\n        } else {\n          res = "+this.update("curr","res")+";\n        }\n\n        "+this.incrementConditional("inputIx","shapeX","sumDims")+"\n      }\n\n      "+this.post("res")+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.post=function(t){return""},n.prototype.init=function(t){return t},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getUniformAttrs=function(){return[{name:"mappedInputStrides",length:this.maxRank},{name:"sumDims",length:this.maxRank},{name:"sumSize"}]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});for(var n=D(t.X.shape,t.axes,t.keepDims),e=n[0],r=n[1],o=b(t.X.shape),i=[],a=0,u=r;a<u.length;a++){var s=u[a];i.push(o[s])}var p=1,c=new Array(t.X.shape.length).fill(0);for(s=0;s<t.axes.length;s++)c[t.axes[s]]=1,p*=t.X.shape[t.axes[s]];return this.compute(e,{X:t.X},{mappedInputStrides:this.pad(i),sumDims:this.pad(c),sumSize:p})},n.prototype.getOutputShape=function(t){var n=D(t.X.shape,t.axes,t.keepDims),e=n[0];n[1];return e},n.prototype.compile=function(n){if(void 0!==n.shapeX&&void 0!==n.axes&&void 0!==n.keepDims){for(var e=D(n.shapeX,n.axes,n.keepDims),r=e[0],o=e[1],i=b(n.shapeX),a=[],u=0,s=o;u<s.length;u++){var p=s[u];a.push(i[p])}var c=1,l=new Array(n.shapeX.length).fill(0);for(p=0;p<n.axes.length;p++)l[n.axes[p]]=1,c*=n.shapeX[n.axes[p]];n.sumDims=l,n.shapeOutput=r,n.mappedInputStrides=a,n.sumSize=c,delete n.keepDims,delete n.axes,this.maxRank=n.shapeX.length}t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){for(var n=D(t.X.shape,t.axes,t.keepDims),e=n[0],r=n[1],o=b(t.X.shape),i=[],a=0,u=r;a<u.length;a++){var s=u[a];i.push(o[s])}var p=1,c=new Array(t.X.shape.length).fill(0);for(s=0;s<t.axes.length;s++)c[t.axes[s]]=1,p*=t.X.shape[t.axes[s]];var l=et.getAllocationDimensions(g(e),this.dtype);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:e,widthOutput:l.width,heightOutput:l.height,mappedInputStrides:i,sumDims:c,sumSize:p}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axes+"-"+t.keepDims},n}(ut),Dt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ut=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Dt(n,t),n.prototype.update=function(t,n){return t+" + "+n},n.prototype.post=function(t){return t+" = "+t+"/float(sumSize);"},n}(Rt),Bt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),zt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Bt(n,t),n.prototype.update=function(t,n){return"("+t+"*"+t+") + "+n},n.prototype.post=function(t){return t+" = "+t+"/float(sumSize);"},n.prototype.init=function(t){return t+"*"+t},n}(Rt),Wt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Lt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Wt(n,t),n.prototype.update=function(t,n){return"("+t+"*"+t+") + "+n},n.prototype.init=function(t){return t+"*"+t},n}(Rt),Ft=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Nt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Ft(n,t),n.prototype.update=function(t,n){return t+" + "+n},n}(Rt),qt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ht=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return qt(n,t),n.prototype.update=function(t,n){return t+" * "+n},n}(Rt),Yt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Jt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Yt(n,t),n.prototype.update=function(t,n){return"max("+t+", "+n+")"},n}(Rt),Kt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Qt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Kt(n,t),n.prototype.update=function(t,n){return"min("+t+", "+n+")"},n}(Rt),Zt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),$t=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Zt(n,t),n.prototype.operation=function(t){return"ceil("+t+")"},n}(lt),tn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),nn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return tn(n,t),n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      vec4 maxVec = vec4(maxVal,maxVal,maxVal,maxVal);\n      vec4 minVec = vec4(minVal,minVal,minVal,minVal);\n\n      vec4 res = texture2D(X, uv);\n      if (doMin == 1) {\n        res = max(minVec, res);\n      }\n      if (doMax == 1) {\n        res = min(maxVec, res);\n      }\n\n      gl_FragColor = res;\n    }\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("minVal")+" float minVal;\n    "+this.getVarModifier("maxVal")+" float maxVal;\n    "+this.getVarModifier("doMin")+" int doMin;\n    "+this.getVarModifier("doMax")+" int doMax;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"minVal",type:"float"},{name:"maxVal",type:"float"},{name:"doMin"},{name:"doMax"}]},n.prototype.calc=function(t){return this.fullyStatic&&void 0!==this.outputShape?this.compute(this.outputShape,{X:t.input}):this.compute(t.input.shape,{X:t.input},{minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0})},n.prototype.getOutputShape=function(t){return t.input.shape},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=et.getAllocationDimensions(t.input.size,this.dtype);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:t.input.shape,widthOutput:n.width,heightOutput:n.height,minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0}},n.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.minVal+"-"+t.maxVal},n}(ut),en=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),rn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return en(n,t),n.prototype.operation=function(t){return"floor("+t+")"},n}(lt),on=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),an=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},un=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return on(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("axis")+" int axis;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"axis"}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i == axis) {\n          if (index[i] >= shapeA[i]) {\n            index[i] = index[i] - shapeA[i];\n            res = _B(index);\n          } else {\n            res = _A(index);\n          }\n          break;\n        }\n      }\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A,B:t.B});var n=this.getOutputShape(t);return this.compute(n,{A:t.A,B:t.B},{axis:t.axis})},n.prototype.getOutputShape=function(t){var n=an(t.A.shape);return n[t.axis]+=t.B.shape[t.axis],n},n.prototype.compile=function(n){void 0!==n.shapeA&&(this.maxRank=n.shapeA.length),void 0!==n.shapeB&&(this.maxRank=n.shapeB.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeB:t.B.shape,widthB:t.B.memory.width,heightB:t.B.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,axis:t.axis}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.B.shape+"-"+t.axis},n}(ut),sn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),pn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return sn(n,t),n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      gl_FragColor = texture2D(X, uv);\n    }\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){var n=this.getOutputShape(t);return this.compute(n,{X:t.input})},n.prototype.getOutputShape=function(t){var n=t.outputShape;return void 0===n&&(n=t.input.shape),n},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height}},n.prototype.getInputInfoString=function(t){return t.input+"-"+this.getOutputShape(t)},n}(ut),cn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ln=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return cn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      return _X(index);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){return this.compute(t.outputShape,{X:t.input})},n.prototype.getOutputShape=function(t){return t.outputShape},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height}},n.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.outputShape},n}(ut),hn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),fn=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.gatherMaxIxSize=10,o}return hn(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("axis")+" int axis;\n    "+this.getVarModifier("indexValues")+" int indexValues["+this.gatherMaxIxSize+"];\n    "+this.getVarModifier("mappedIndexStrides")+" int mappedIndexStrides["+this.maxRank+"];\n    "+this.getVarModifier("mappedInputStrides")+" int mappedInputStrides["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"axis"},{name:"indexValues",length:this.gatherMaxIxSize},{name:"mappedInputStrides",length:this.maxRank},{name:"mappedIndexStrides",length:this.maxRank}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputPos = 0;\n      int indexPos = 0;\n\n      int strideAxis = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n        if (i == axis) {\n          strideAxis = stridesX[i];\n        }\n        inputPos += mappedInputStrides[i]*index[i];\n        indexPos += mappedIndexStrides[i]*index[i];\n      }\n\n      for (int i = 0; i < "+this.gatherMaxIxSize+"; i++) {\n        if (i == indexPos) {\n          inputPos += indexValues[i]*strideAxis;\n          break;\n        }\n      }\n\n      return getValueAtPos(inputPos, widthX, heightX, X);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});if(t.indices.size>this.gatherMaxIxSize)throw new Error("Gather on GPU can deal with at most "+this.gatherMaxIxSize+" indices, input had "+t.indices.size);for(var n=t.X.shape.length,e=t.indices.shape.length,r=b(t.X.shape),o=b(t.indices.shape),i=n+e-1,a=new Array(i),u=new Array(i).fill(0),s=new Array(i).fill(0),p=0;p<t.axis;p++)a[p]=t.X.shape[p],u[p]=r[p],s[p]=0;for(p=0;p<e;p++)a[p+t.axis]=t.indices.shape[p],s[p+t.axis]=o[p],u[p+t.axis]=0;for(p=t.axis+1;p<n;p++)a[p+e-1]=t.X.shape[p],u[p+e-1]=r[p],s[p+e-1]=0;return this.compute(a,{X:t.X},{axis:t.axis,indexValues:this.pad(Array.from(t.indices.values),this.gatherMaxIxSize),mappedInputStrides:this.pad(u),mappedIndexStrides:this.pad(s)})},n.prototype.getOutputShape=function(t){for(var n=t.X.shape.length,e=t.indices.shape.length,r=new Array(n+e-1),o=0;o<t.axis;o++)r[o]=t.X.shape[o];for(o=0;o<e;o++)r[o+t.axis]=t.indices.shape[o];for(o=t.axis+1;o<n;o++)r[o+e-1]=t.X.shape[o];return r},n.prototype.compile=function(n){if(void 0!==n.shapeX&&(this.maxRank=n.shapeX.length,void 0!==n.indices&&void 0!==n.axis)){for(var e=n.shapeX.length,r=n.indices.shape.length,o=b(n.shapeX),i=b(n.indices.shape),a=e+r-1,u=new Array(a),s=new Array(a).fill(0),p=new Array(a).fill(0),c=0;c<n.axis;c++)u[c]=n.shapeX[c],s[c]=o[c],p[c]=0;for(c=0;c<r;c++)u[c+n.axis]=n.indices.shape[c],p[c+n.axis]=i[c],s[c+n.axis]=0;for(c=n.axis+1;c<e;c++)u[c+r-1]=n.shapeX[c],s[c+r-1]=o[c],p[c+r-1]=0;n.mappedIndexStrides=p,n.mappedInputStrides=s,n.indexValues=Array.from(n.indices.values),delete n.indices}t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){for(var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype),r=t.X.shape.length,o=t.indices.shape.length,i=b(t.X.shape),a=b(t.indices.shape),u=r+o-1,s=new Array(u),p=new Array(u).fill(0),c=new Array(u).fill(0),l=0;l<t.axis;l++)s[l]=t.X.shape[l],p[l]=i[l],c[l]=0;for(l=0;l<o;l++)s[l+t.axis]=t.indices.shape[l],c[l+t.axis]=a[l],p[l+t.axis]=0;for(l=t.axis+1;l<r;l++)s[l+o-1]=t.X.shape[l],p[l+o-1]=i[l],c[l+o-1]=0;return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,axis:t.axis,indexValues:Array.from(t.indices.values),mappedIndexStrides:c,mappedInputStrides:p}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axis+"-"+Array.from(t.indices.values)+"-"+t.indices.shape},n}(ut),dn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),yn=function(){return(yn=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},vn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},wn=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return dn(n,t),n.prototype.getMainBody=function(){return"\n      int ixA["+this.maxRank+"];\n      "+this.initIndex("ixA")+"\n      int ixB["+this.maxRank+"];\n      "+this.initIndex("ixA")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i >= rank - 2) {\n          break;\n        }\n        ixA[i] = index[i];\n        ixB[i] = index[i];\n      }\n\n      int m = 0;\n      int o = 0;\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (i == rank-2) {\n          m = index[i];\n          o = index[i+1];\n\n          if (aTranspose == 0) {\n            ixA[i] = m;\n          } else {\n            ixA[i+1] = m;\n          }\n\n          if (bTranspose == 0) {\n            ixB[i+1] = o;\n          } else {\n            ixB[i] = o;\n          }\n\n          break;\n        }\n      }\n\n      float res = 0.0;\n\n      for (int n = 0; n < "+this.maxIterations+"; n++) {\n        if (n >= N) {\n          break;\n        }\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (i == rank-2) {\n            if (aTranspose == 0) {\n              ixA[i+1] = n;\n            } else {\n              ixA[i] = n;\n            }\n\n            if (bTranspose == 0) {\n              ixB[i] = n;\n            } else {\n              ixB[i+1] = n;\n            }\n\n            break;\n          }\n        }\n        res += _A(ixA) * _B(ixB);\n      }\n\n      res = res*alpha;\n    "},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("M")+" int M;\n    "+this.getVarModifier("N")+" int N;\n    "+this.getVarModifier("O")+" int O;\n    "+this.getVarModifier("rank")+" int rank;\n    "+this.getVarModifier("aTranspose")+" int aTranspose;\n    "+this.getVarModifier("bTranspose")+" int bTranspose;\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      "+this.getMainBody()+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A","B"]},n.prototype.getUniformAttrs=function(){return[{name:"M"},{name:"N"},{name:"O"},{name:"rank"},{name:"aTranspose"},{name:"bTranspose"},{name:"alpha",type:"float"},{name:"beta",type:"float"}]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.a,B:t.b});var n=t.a.shape.length,e=t.aTranspose?t.a.shape[n-1]:t.a.shape[n-2],r=t.aTranspose?t.a.shape[n-2]:t.a.shape[n-1],o=t.bTranspose?t.b.shape[n-2]:t.b.shape[n-1],i=t.a.shape.slice(0,n-2),a=vn(i,[e,o]),u={M:e,N:r,O:o,rank:n,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta};return this.compute(a,{A:t.a,B:t.b},u)},n.prototype.getOutputShape=function(t){var n=t.a.shape.length,e=t.aTranspose?t.a.shape[n-1]:t.a.shape[n-2],r=t.bTranspose?t.b.shape[n-2]:t.b.shape[n-1],o=t.a.shape.slice(0,n-2);return vn(o,[e,r])},n.prototype.compile=function(n){if(void 0!==n.shapeA){var e=n.shapeA.length;if(n.rank=e,this.maxRank=e,void 0!==n.aTranspose){var r=n.aTranspose?n.shapeA[e-1]:n.shapeA[e-2],o=n.aTranspose?n.shapeA[e-2]:n.shapeA[e-1];n.M=r,n.N=o,n.aTranspose=n.aTranspose?1:0}}if(void 0!==n.shapeB&&void 0!==n.bTranspose){e=n.shapeB.length;var i=n.bTranspose?n.shapeB[e-2]:n.shapeB[e-1];n.O=i,n.bTranspose=n.bTranspose?1:0}t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype),r=t.a.shape.length,o=t.aTranspose?t.a.shape[r-1]:t.a.shape[r-2],i=t.aTranspose?t.a.shape[r-2]:t.a.shape[r-1],a=t.bTranspose?t.b.shape[r-2]:t.b.shape[r-1];return{shapeA:t.a.shape,widthA:t.a.memory.width,heightA:t.a.memory.height,shapeB:t.b.shape,widthB:t.b.memory.width,heightB:t.b.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,M:o,N:i,O:a,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta,rank:r}},n.prototype.getInputInfoString=function(t){return t.a.shape+"-"+t.b.shape+"-"+t.aTranspose+"-"+t.bTranspose+"-"+t.alpha+"-"+t.beta},n}(ut),mn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return dn(n,t),n.prototype.getTextureNames=function(){return["A","B","C"]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      "+this.getMainBody()+"\n\n      res += beta*_C(index);\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.a,B:t.b,C:t.c});var n=t.a.shape.length,e=t.aTranspose?t.a.shape[n-1]:t.a.shape[n-2],r=t.aTranspose?t.a.shape[n-2]:t.a.shape[n-1],o=t.bTranspose?t.b.shape[n-2]:t.b.shape[n-1],i=t.a.shape.slice(0,n-2),a=vn(i,[e,o]),u={M:e,N:r,O:o,rank:n,aTranspose:t.aTranspose?1:0,bTranspose:t.bTranspose?1:0,alpha:t.alpha,beta:t.beta};return this.compute(a,{A:t.a,B:t.b,C:t.c},u)},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return yn(yn({},e),{shapeC:n.c.shape,widthC:n.c.memory.width,heightC:n.c.memory.height})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.c.shape},n}(wn),gn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),bn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return gn(n,t),n.prototype.getOp=function(t,n){return"pow("+t+", "+n+")"},n}(_t),_n=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),xn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return _n(n,t),n.prototype.operation=function(t){return"sqrt("+t+")"},n}(lt),On=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),kn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return On(n,t),n.prototype.operation=function(t){return"log("+t+")"},n}(lt),Sn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),An=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Sn(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("mappedStrides")+" int mappedStrides["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"mappedStrides",length:this.maxRank}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      return getValueAt(index, mappedStrides, widthA, heightA, A);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A"]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A});for(var n=t.A.shape.length,e=this.getOutputShape(t),r=b(t.A.shape),o=new Array(n),i=0;i<n;i++)o[i]=r[t.permutation[i]];return this.compute(e,{A:t.A},{mappedStrides:this.pad(o)})},n.prototype.getOutputShape=function(t){for(var n=t.A.shape.length,e=new Array(n),r=0;r<n;r++)e[r]=t.A.shape[t.permutation[r]];return e},n.prototype.compile=function(n){if(void 0!==n.shapeA&&(this.maxRank=n.shapeA.length,void 0!==n.permutation)){for(var e=n.shapeA.length,r=b(n.shapeA),o=new Array(e),i=0;i<e;i++)o[i]=r[n.permutation[i]];n.mappedStrides=o,delete n.permutation}t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){for(var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype),r=t.A.shape.length,o=b(t.A.shape),i=new Array(r),a=0;a<r;a++)i[a]=o[t.permutation[a]];return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,mappedStrides:i}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.permutation},n}(ut),jn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Pn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return jn(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("repeats")+" int repeats["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"repeats",length:this.maxRank}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIndex["+this.maxRank+"];\n      "+this.initIndex("inIndex")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (repeats[i] == -1) {\n          break;\n        }\n        int d = index[i] / shapeA[i];\n        inIndex[i] = index[i] - d*shapeA[i];\n      }\n\n      return _A(inIndex);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getOutputShape=function(t){for(var n=t.A.shape.length,e=new Array(n),r=0;r<n;r++)e[r]=t.A.shape[r]*t.repeats[r];return e},n.prototype.getTextureNames=function(){return["A"]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A});var n=this.getOutputShape(t);return this.compute(n,{A:t.A},{repeats:this.copyPad(t.repeats)})},n.prototype.compile=function(n){void 0!==n.shapeA&&(this.maxRank=n.shapeA.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,repeats:t.repeats}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.repeats},n}(ut),Mn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Tn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},In=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Mn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inputIx["+this.maxRank+"];\n      "+this.initIndex("inputIx")+"\n      if (mode == 0) {\n        float res = value;\n\n        int outOfBounds = 0;\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0 || inputIx[i] >= shapeX[i]) {\n            outOfBounds = 1;\n            break;\n          }\n        }\n\n        if (outOfBounds == 0) {\n          res = _X(inputIx);\n        }\n\n        return res;\n      } else if (mode == 1) {\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = -inputIx[i];\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = 2*shapeX[i] - inputIx[i] - 2;\n          }\n        }\n\n        return _X(inputIx);\n      } else {\n        for (int i = 0; i < "+this.maxRank+"; i++) {\n          if (index[i] == -1) {\n            break;\n          }\n          inputIx[i] = index[i] - pads[i];\n          if (inputIx[i] < 0) {\n            inputIx[i] = 0;\n          } else if (inputIx[i] >= shapeX[i]) {\n            inputIx[i] = shapeX[i] - 1;\n          }\n        }\n\n        return _X(inputIx);\n      }\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("pads")+" int pads["+2*this.maxRank+"];\n    "+this.getVarModifier("value")+" float value;\n    "+this.getVarModifier("mode")+" int mode;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"value",type:"float"},{name:"pads",length:2*this.maxRank},{name:"mode"}]},n.prototype.getModeFlag=function(t){return"constant"===t?0:"reflect"===t?1:2},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.input});var n=this.getOutputShape(t);return this.compute(n,{X:t.input},{pads:this.copyPad(t.pads,2*this.maxRank),value:t.value,mode:this.getModeFlag(t.mode)})},n.prototype.getOutputShape=function(t){for(var n=t.input.shape.length,e=Tn(t.input.shape),r=0;r<n;r++)e[r]+=t.pads[r]+t.pads[r+n];return e},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),void 0!==n.mode&&"string"===typeof n.mode&&(n.mode=this.getModeFlag(n.mode)),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,pads:t.pads,mode:this.getModeFlag(t.mode),value:t.value}},n.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.pads+"-"+t.mode+"-"+t.value},n}(ut),Vn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Cn=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Gn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Vn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIx["+this.maxRank+"];\n      "+this.initIndex("inIx")+"\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = index[i]*steps[i] + offsets[i];\n      }\n\n      return _X(inIx);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("offsets")+" int offsets["+this.maxRank+"];\n    "+this.getVarModifier("steps")+" int steps["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"offsets",length:this.maxRank},{name:"steps",length:this.maxRank}]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});for(var n=t.X.shape.length,e=Cn(t.X.shape),r=new Array(n).fill(0),o=new Array(n).fill(1),i=0,a=0;a<n&&i<t.axes.length;a++)a===t.axes[i]&&(e[a]=Math.ceil((t.ends[i]-t.starts[i])/t.steps[i]),r[a]=t.starts[i],o[a]=t.steps[i],i++);return this.compute(e,{X:t.X},{offsets:this.pad(r),steps:this.pad(o)})},n.prototype.getOutputShape=function(t){for(var n=t.X.shape.length,e=Cn(t.X.shape),r=0,o=0;o<n&&r<t.axes.length;o++)o===t.axes[r]&&(e[o]=Math.ceil((t.ends[r]-t.starts[r])/t.steps[r]),r++);return e},n.prototype.compile=function(n){if(void 0!==n.shapeX&&(this.maxRank=n.shapeX.length,void 0!==n.axes&&void 0!==n.starts&&void 0!==n.ends&&void 0!==n.steps)){for(var e=n.shapeX.length,r=new Array(e).fill(0),o=new Array(e).fill(1),i=0,a=0;a<e&&i<n.axes.length;a++)a===n.axes[i]&&(r[a]=n.starts[i],o[a]=n.steps[i],i++);n.offsets=r,n.steps=o,delete n.starts,delete n.ends,delete n.axes}t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){for(var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype),r=t.X.shape.length,o=Cn(t.X.shape),i=new Array(r).fill(0),a=new Array(r).fill(1),u=0,s=0;s<r&&u<t.axes.length;s++)s===t.axes[u]&&(o[s]=Math.ceil((t.ends[u]-t.starts[u])/t.steps[u]),i[s]=t.starts[u],a[s]=t.steps[u],u++);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,offsets:i,steps:a}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.axes+"-"+t.starts+"-"+t.ends+"-"+t.steps},n}(ut),Xn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),En=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Rn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Xn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int inIx["+this.maxRank+"];\n      "+this.initIndex("inIx")+"\n\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        inIx[i] = int(floor(float(index[i]) / scales[i]));\n      }\n\n      return _X(inIx);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("scales")+" float scales["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"scales",length:this.maxRank,type:"float"}]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X});var n=this.getOutputShape(t);return this.compute(n,{X:t.X},{scales:this.copyPad(t.scales)})},n.prototype.getOutputShape=function(t){for(var n=t.X.shape.length,e=En(t.X.shape),r=0;r<n;r++)e[r]=Math.floor(e[r]*t.scales[r]);return e},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,scales:t.scales}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.scales},n}(ut),Dn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Un=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Dn(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("epsilon")+" float epsilon;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"epsilon",type:"float"}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int["+this.maxRank+"] index) {\n      float result = _X(index) - _Mean(index);\n      result = result / sqrt(_Variance(index) + epsilon);\n      result = result * _Scale(index) + _Bias(index);\n      return result;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getOutputShape=function(t){return t.X.shape},n.prototype.getTextureNames=function(){return["X","Mean","Variance","Scale","Bias"]},n.prototype.calc=function(t){return this.compute(t.X.shape,{X:t.X,Mean:t.Mean,Variance:t.Variance,Scale:t.Scale,Bias:t.Bias},{epsilon:t.epsilon})},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeBias:t.Bias.shape,widthBias:t.Bias.memory.width,heightBias:t.Bias.memory.height,shapeMean:t.Mean.shape,widthMean:t.Mean.memory.width,heightMean:t.Mean.memory.height,shapeScale:t.Scale.shape,widthScale:t.Scale.memory.width,heightScale:t.Scale.memory.height,shapeVariance:t.Variance.shape,widthVariance:t.Variance.memory.width,heightVariance:t.Variance.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,epsilon:t.epsilon}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.Mean.shape+"-"+t.Variance.shape+"-"+t.Scale.shape+"-"+t.Bias.shape+"-"+t.epsilon},n}(ut),Bn=function(){function t(t,n){void 0===n&&(n=2),this.getOp=t,this.minCallsToCompile=n,this.opDict={}}return t.prototype.getDefault=function(t){var n="default-"+t;if(void 0===this.opDict[n]){var e=this.getOp(t);e.compile({}),this.opDict[n]={infoString:n,numCalls:0,operation:e}}return this.opDict[n]},t.prototype.calc=function(t,n){var e=this.getDefault(n),r=e.operation.getInputInfoString(t);void 0===this.opDict[r]&&(this.opDict[r]={infoString:r,numCalls:0});var o=this.opDict[r];if(o.numCalls++,o.numCalls>=this.minCallsToCompile){if(void 0===o.operation){o.operation=this.getOp(n);var i=e.operation.getCompilationInfo(t);o.operation.compile(i)}return o.operation.calc(t)}return e.numCalls++,e.operation.calc(t)},t}(),zn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Wn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return zn(n,t),n.prototype.operation=function(t){return"sign("+t+")"},n}(lt),Ln=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Ln(n,t),n.prototype.operation=function(t){return"-"+t},n}(lt),Nn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),qn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Nn(n,t),n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float val = _X(index);\n      if (doMin == 1 && val < minVal) {\n        return 0.0;\n      }\n      if (doMax == 1 && val > maxVal) {\n        return 0.0;\n      }\n      return _Grad(index);\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X","Grad"]},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("minVal")+" float minVal;\n    "+this.getVarModifier("maxVal")+" float maxVal;\n    "+this.getVarModifier("doMin")+" int doMin;\n    "+this.getVarModifier("doMax")+" int doMax;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"minVal",type:"float"},{name:"maxVal",type:"float"},{name:"doMin"},{name:"doMax"}]},n.prototype.calc=function(t){return this.fullyStatic&&void 0!==this.outputShape?this.compute(this.outputShape,{X:t.input,Grad:t.grad}):this.compute(t.input.shape,{X:t.input,Grad:t.grad},{minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0})},n.prototype.getOutputShape=function(t){return t.input.shape},n.prototype.compile=function(n){void 0!==n.shapeX&&(this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=et.getAllocationDimensions(t.input.size,this.dtype);return{shapeX:t.input.shape,widthX:t.input.memory.width,heightX:t.input.memory.height,shapeGrad:t.grad.shape,widthGrad:t.grad.memory.width,heightGrad:t.grad.memory.height,shapeOutput:t.input.shape,widthOutput:n.width,heightOutput:n.height,minVal:void 0!==t.minVal?t.minVal:0,maxVal:void 0!==t.maxVal?t.maxVal:0,doMin:void 0!==t.minVal?1:0,doMax:void 0!==t.maxVal?1:0}},n.prototype.getInputInfoString=function(t){return t.input.shape+"-"+t.minVal+"-"+t.maxVal},n}(ut),Hn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Yn=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return Hn(n,t),n.prototype.updateInputIx=function(){return"\n    for (int d = 0; d < "+(this.maxRank-2)+"; d++) {\n      int stride = strides[d];\n      int pad = pads[d];\n      int dilation = dilations[d];\n      if (stride == -1) {\n        break;\n      }\n\n      int trans_kernel_ix = shapeW[d + 2] - kernelIx[d + 2] - 1;\n\n      inputIx[d+2] = index[d + 2] - pad + trans_kernel_ix * dilation;\n\n      int divS = inputIx[d+2] / stride;\n      int resS = inputIx[d+2] - divS*stride;\n\n      if (resS != 0) {\n        skip = true;\n        break;\n      }\n      inputIx[d+2] = divS;\n\n      if (inputIx[d+2] < 0 || inputIx[d+2] >= shapeX[d+2]) {\n        skip = true;\n        break;\n      }\n    }\n    "},n.prototype.getMainBody=function(){return"\n    int n = index[0];\n    int m = index[1];\n\n    int kernelIx["+this.maxRank+"];\n    "+this.initIndex("kernelIx")+"\n    for (int i = 0; i < "+this.maxRank+"; i++) {\n      if (i >= dataRank) {\n        break;\n      }\n      kernelIx[i+2] = 0;\n    }\n    kernelIx[0] = m;\n    int inputIx["+this.maxRank+"];\n    "+this.initIndex("inputIx")+"\n    inputIx[0] = n;\n\n    for (int cg = 0; cg < "+this.maxIterations+"; cg++) {\n      if (cg >= CG) {\n        break;\n      }\n      int c = m * CG + cg;\n      int d = c/C;\n      c = c - d*C;\n      inputIx[1] = c;\n      kernelIx[1] = cg;\n      for (int kIx = 0; kIx < "+this.maxIterations+"; kIx++) {\n        if (kIx >= kernelSize) {\n          break;\n        }\n\n        bool skip = false;\n\n        "+this.updateInputIx()+"\n\n        if (!skip) {\n          res += _X(inputIx) * _W(kernelIx);\n        }\n\n        "+this.incrementIndex("kernelIx","shapeW")+"\n      }\n    }\n    "},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("CG")+" int CG;\n    "+this.getVarModifier("kernelSize")+" int kernelSize;\n    "+this.getVarModifier("dataRank")+" int dataRank;\n    "+this.getVarModifier("C")+" int C;\n    "+this.getVarModifier("dilations")+" int dilations["+this.maxRank+"];\n    "+this.getVarModifier("pads")+" int pads["+this.maxRank+"];\n    "+this.getVarModifier("strides")+" int strides["+this.maxRank+"];\n    "},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      float res = 0.0;\n\n      "+this.getMainBody()+"\n\n      return res;\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["X","W"]},n.prototype.getUniformAttrs=function(){return[{name:"CG"},{name:"kernelSize"},{name:"C"},{name:"dataRank"},{name:"pads",length:2*this.maxRank},{name:"strides",length:this.maxRank},{name:"dilations",length:this.maxRank}]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{X:t.X,W:t.W});var n=t.X.shape[0],e=t.X.shape[1],r=t.X.shape.slice(2),o=t.W.shape.slice(2),i=t.W.shape[0],a=t.W.shape[1],u=g(o),s=X(r,o,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),p=[n,i];return p=p.concat(s),this.compute(p,{X:t.X,W:t.W},{CG:a,kernelSize:u,C:e,dataRank:r.length,pads:this.copyPad(t.pads,2*this.maxRank),strides:this.copyPad(t.strides),dilations:this.copyPad(t.dilations)})},n.prototype.getOutputShape=function(t){var n=t.X.shape[0],e=t.X.shape.slice(2),r=t.W.shape.slice(2),o=t.W.shape[0],i=X(e,r,t.pads.slice(0,t.pads.length/2),t.pads.slice(t.pads.length/2),t.dilations,t.strides),a=[n,o];return a=a.concat(i)},n.prototype.compile=function(n){void 0!==n.shapeW&&(n.CG=n.shapeW[1],n.kernelSize=g(n.shapeW.slice(2)),n.dataRank=n.shapeW.length-2,this.maxRank=n.shapeW.length),void 0!==n.shapeX&&(n.C=n.shapeX[1],n.dataRank=n.shapeX.length-2,this.maxRank=n.shapeX.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype),r=g(t.W.shape.slice(2)),o=t.X.shape[1],i=t.X.shape.slice(2);return{shapeX:t.X.shape,widthX:t.X.memory.width,heightX:t.X.memory.height,shapeW:t.W.shape,widthW:t.W.memory.width,heightW:t.W.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,pads:t.pads,dilations:t.dilations,strides:t.strides,CG:t.W.shape[1],kernelSize:r,dataRank:i.length,C:o}},n.prototype.getInputInfoString=function(t){return t.X.shape+"-"+t.W.shape+"-"+t.dilations+"-"+t.pads+"-"+t.dilations+"-"+t.strides},n}(ut),Jn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Kn=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Jn(n,t),n.prototype.operation=function(t){return"1.0/(1.0 + exp(-"+t+"))"},n}(lt),Qn=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Zn=function(){return(Zn=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},$n=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Qn(n,t),n.prototype.operation=function(t){return"factor*"+t+" + add"},n.prototype.calc=function(t){return this.compute(t.input.shape,{X:t.input},{factor:t.factor,add:t.add})},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return Zn(Zn({},e),{factor:n.factor,add:n.add})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.factor+"-"+n.add},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("factor")+" float factor;\n    "+this.getVarModifier("add")+" float add;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"factor",type:"float"},{name:"add",type:"float"}]},n}(lt),te=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ne=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return te(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("starts")+" int starts["+this.maxRank+"];\n    "},n.prototype.getUniformAttrs=function(){return[{name:"starts",length:this.maxRank}]},n.prototype.getFragmentShader=function(t){return"\n    float process(int index["+this.maxRank+"]) {\n      int valueIx["+this.maxRank+"];\n      "+this.initIndex("valueIx")+"\n\n      int inValues = 1;\n\n      for (int i = 0; i < "+this.maxRank+"; i++) {\n        if (index[i] == -1) {\n          break;\n        }\n\n        if (index[i] < starts[i] || index[i] >= (starts[i] + shapeValues[i])) {\n          inValues = 0;\n          break;\n        } else {\n          valueIx[i] = index[i] - starts[i];\n        }\n      }\n\n      if (inValues == 1) {\n        return _Values(valueIx);\n      } else {\n        return _A(index);\n      }\n    }\n\n    "+this.getDefaultMain()+"\n    "},n.prototype.getTextureNames=function(){return["A","Values"]},n.prototype.calc=function(t){if(this.fullyStatic&&void 0!==this.outputShape)return this.compute(this.outputShape,{A:t.A,Values:t.Values});var n=this.getOutputShape(t);return this.compute(n,{A:t.A,Values:t.Values},{starts:this.pad(t.starts)})},n.prototype.getOutputShape=function(t){return t.A.shape},n.prototype.compile=function(n){void 0!==n.shapeA&&(this.maxRank=n.shapeA.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeA:t.A.shape,widthA:t.A.memory.width,heightA:t.A.memory.height,shapeValues:t.Values.shape,widthValues:t.Values.memory.width,heightValues:t.Values.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,starts:t.starts}},n.prototype.getInputInfoString=function(t){return t.A.shape+"-"+t.Values.shape+"-"+t.starts},n}(ut),ee=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),re=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ee(n,t),n.prototype.operation=function(t){return"sin("+t+")"},n}(lt),oe=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ee(n,t),n.prototype.operation=function(t){return"asin("+t+")"},n}(lt),ie=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ee(n,t),n.prototype.operation=function(t){return"(exp("+t+") - exp(-"+t+"))/2.0"},n}(lt),ae=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ue=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ae(n,t),n.prototype.operation=function(t){return"cos("+t+")"},n}(lt),se=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ae(n,t),n.prototype.operation=function(t){return"acos("+t+")"},n}(lt),pe=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ae(n,t),n.prototype.operation=function(t){return"(1.0 + exp(-2.0*"+t+"))/(2.0*exp(-"+t+"))"},n}(lt),ce=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),le=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ce(n,t),n.prototype.operation=function(t){return"tan("+t+")"},n}(lt),he=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ce(n,t),n.prototype.operation=function(t){return"atan("+t+")"},n}(lt),fe=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ce(n,t),n.prototype.operation=function(t){return"(exp(2.0*"+t+") - 1.0)/(exp(2.0*"+t+") + 1.0)"},n}(lt),de=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ye=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return de(n,t),n.prototype.update=function(t,n){return t+" + "+n},n.prototype.post=function(t){return t+" = log("+t+");"},n.prototype.init=function(t){return""+t},n}(Rt),ve=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),we=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return ve(n,t),n.prototype.update=function(t,n){return"exp("+t+") + "+n},n.prototype.post=function(t){return t+" = log("+t+");"},n.prototype.init=function(t){return"exp("+t+")"},n}(Rt),me=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ge=function(){return(ge=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},be=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return me(n,t),n.prototype.operation=function(t){return"max(vec4(0.0,0.0,0.0,0.0), min(vec4(1.0,1.0,1.0,1.0), alpha*"+t+" + beta))"},n.prototype.calc=function(t){return this.compute(t.input.shape,{X:t.input},{alpha:t.alpha,beta:t.beta})},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return ge(ge({},e),{alpha:n.alpha,beta:n.beta})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.alpha+"-"+n.beta},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("beta")+" float beta;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"},{name:"beta",type:"float"}]},n}(lt),_e=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),xe=function(){return(xe=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},Oe=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return _e(n,t),n.prototype.operation=function(t){throw new Error("Method not implemented.")},n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      if (power < 0.0) {\n        gl_FragColor = vec4(factor,factor,factor,factor) / pow(texture2D(X, uv), vec4(-power,-power,-power,-power));\n      } else {\n        gl_FragColor = pow(texture2D(X, uv), vec4(power,power,power,power)) * factor;\n      }\n    }\n    "},n.prototype.calc=function(t){return this.compute(t.input.shape,{X:t.input},{factor:t.factor,power:t.power})},n.prototype.getCompilationInfo=function(n){var e=t.prototype.getCompilationInfo.call(this,n);return xe(xe({},e),{factor:n.factor,power:n.power})},n.prototype.getInputInfoString=function(n){return t.prototype.getInputInfoString.call(this,n)+"-"+n.factor+"-"+n.power},n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("factor")+" float factor;\n    "+this.getVarModifier("power")+" float power;\n    "},n.prototype.getUniformAttrs=function(){return[{name:"factor",type:"float"},{name:"power",type:"float"}]},n}(lt),ke=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Se=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return ke(n,t),n.prototype.operation=function(t){return"floor("+t+"+vec4(0.5))"},n}(lt),Ae=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),je=function(t){function n(n,e,r){var o=t.call(this,r||"float32")||this;return o.shape=e,o.deleted=!1,o.size=g(e),o.memory=n instanceof Array?et.allocateTexture(n,o.dtype):n,o}return Ae(n,t),n.range=function(t,e,r,o){for(var i=Math.max(Math.ceil((e-t)/r),0),a=new Array(i),u=0;u<i;u++)a[u]=t+u*r;return new n(a,[i],o)},n.fromData=function(t){var e=nt.texture({data:t,format:"rgba",type:et.getColorType("float32")}),r=et.allocateFramebuffer(e,"float32"),o=e.width;return new n(r,[e.height,o,4],"float32")},n.prototype.cast=function(t){if("float64"===t)throw new Error("The WebGL backend does not support float64 tensors");return Cr.calc({input:this},t)},n.prototype.getValues=function(){var t=this;if("float32"===this.dtype)return new Promise((function(n){nt({framebuffer:t.memory.frameBuffer})((function(){var e=new Float32Array(t.memory.size);e=nt.read(e),n(e.subarray(0,t.size))}))}));throw new Error("Reading values only supported for data type float32")},n.prototype.getShape=function(){return this.shape},n.prototype.constantLike=function(t){return new n(new Array(this.size).fill(t),this.shape,this.dtype)},n.prototype.singleConstant=function(t){return new n([t],[1],this.dtype)},n.prototype.delete=function(){this.deleted||(this.deleted=!0,et.deallocate(this.memory),this.memory=void 0)},n.prototype.copy=function(){return Cr.calc({input:this},this.dtype)},n.prototype.exp=function(){return ze.calc({input:this},this.dtype)},n.prototype.log=function(){return ar.calc({input:this},this.dtype)},n.prototype.sqrt=function(){return ir.calc({input:this},this.dtype)},n.prototype.abs=function(){return We.calc({input:this},this.dtype)},n.prototype.sin=function(){return Le.calc({input:this},this.dtype)},n.prototype.cos=function(){return Fe.calc({input:this},this.dtype)},n.prototype.tan=function(){return Ne.calc({input:this},this.dtype)},n.prototype.asin=function(){return qe.calc({input:this},this.dtype)},n.prototype.acos=function(){return He.calc({input:this},this.dtype)},n.prototype.atan=function(){return Ye.calc({input:this},this.dtype)},n.prototype.sinh=function(){return Je.calc({input:this},this.dtype)},n.prototype.cosh=function(){return Ke.calc({input:this},this.dtype)},n.prototype.tanh=function(){return Qe.calc({input:this},this.dtype)},n.prototype.asinh=function(){throw new Error("Method not implemented")},n.prototype.acosh=function(){throw new Error("Method not implemented")},n.prototype.atanh=function(){throw new Error("Method not implemented")},n.prototype.sigmoid=function(){return Ze.calc({input:this},this.dtype)},n.prototype.hardSigmoid=function(t,n){return $e.calc({input:this,alpha:t,beta:n},this.dtype)},n.prototype.floor=function(){return nr.calc({input:this},this.dtype)},n.prototype.ceil=function(){return tr.calc({input:this},this.dtype)},n.prototype.round=function(){return er.calc({input:this},this.dtype)},n.prototype.negate=function(){return ur.calc({input:this},this.dtype)},n.prototype.addMultiplyScalar=function(t,n){return sr.calc({input:this,factor:t,add:n},this.dtype)},n.prototype.powerScalar=function(t,n){return pr.calc({input:this,factor:n,power:t},this.dtype)},n.prototype.sign=function(){return cr.calc({input:this},this.dtype)},n.prototype.setValues=function(t,e){if(!(t instanceof n))throw new Error("Can only set GPU values to GPU tensor");return Vr.calc({A:this,Values:t,starts:e},this.dtype)},n.prototype.add_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add GPU tensor to GPU tensor");return wr.calc({A:t,B:e,outputShape:r,alpha:o,beta:i},this.dtype)},n.prototype.subtract_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only subtract GPU tensor from GPU tensor");return mr.calc({A:t,B:e,outputShape:r,alpha:o,beta:i},this.dtype)},n.prototype.multiply_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only multiply GPU tensor with GPU tensor");return gr.calc({A:t,B:e,outputShape:r,alpha:o},this.dtype)},n.prototype.divide_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only divide GPU tensor by GPU tensor");return br.calc({A:t,B:e,outputShape:r,alpha:o},this.dtype)},n.prototype.power_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only take GPU tensor to power of GPU tensor");return _r.calc({A:t,B:e,outputShape:r},this.dtype)},n.prototype.matMul=function(t){if(!(t instanceof n))throw new Error("Can only matrix multiply GPU tensor to GPU tensor");return De.calc({A:this,B:t},this.dtype)},n.prototype.gemm_impl=function(t,e,r,o,i,a){if(!(t instanceof n&&(void 0===a||a instanceof n)))throw new Error("Can only do gemm with CPU tensors");return void 0===a?Ue.calc({a:this,b:t,aTranspose:e,bTranspose:r,alpha:o,beta:i},this.dtype):Be.calc({a:this,b:t,c:a,aTranspose:e,bTranspose:r,alpha:o,beta:i},this.dtype)},n.prototype.sum_impl=function(t,n){return Sr.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.sumSquare_impl=function(t,n){return kr.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.reduceMean_impl=function(t,n){return xr.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.reduceMeanSquare_impl=function(t,n){return Or.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.reduceLogSum_impl=function(t,n){return Mr.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.reduceLogSumExp_impl=function(t,n){return Tr.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.product_impl=function(t,n){return Ar.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.max_impl=function(t,n){return jr.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.min_impl=function(t,n){return Pr.calc({X:this,axes:t,keepDims:n},this.dtype)},n.prototype.conv_impl=function(t,e,r,o,i,a,u){if(!(t instanceof n)||void 0!==u&&!(u instanceof n))throw new Error("Can only do convolution of GPU tensor with GPU tensor");return void 0===u?lr.calc({X:this,W:t,pads:o,dilations:e,strides:i,activation:a},this.dtype):fr.calc({X:this,W:t,B:u,pads:o,dilations:e,strides:i,activation:a},this.dtype)},n.prototype.convTranspose_impl=function(t,e,r,o,i){if(!(t instanceof n))throw new Error("Can only do transpose convolution of GPU tensor with GPU tensor");return dr.calc({X:this,W:t,pads:o,dilations:e,strides:i},this.dtype)},n.prototype.averagePool_impl=function(t,n,e,r){return hr.calc({X:this,includePad:r,kernelShape:t,pads:n,strides:e},this.dtype)},n.prototype.reshape_impl=function(t,e){return e?Cr.calc({input:this,outputShape:t},this.dtype):new n(this.memory,t,this.dtype)},n.prototype.concat=function(t,e){if(!(t instanceof n))throw new Error("Can only concat GPU tensor to GPU tensor");return e<0&&(e+=this.shape.length),Ir.calc({A:this,B:t,axis:e},this.dtype)},n.prototype.transpose_impl=function(t){return Er.calc({A:this,permutation:t},this.dtype)},n.prototype.clip=function(t,n){return rr.calc({input:this,minVal:t,maxVal:n},this.dtype)},n.prototype.clipBackward=function(t,n,e){return or.calc({input:this,minVal:n,maxVal:e,grad:t},this.dtype)},n.prototype.repeat=function(t){return Rr.calc({A:this,repeats:t},this.dtype)},n.prototype.expand=function(t){var n=this.alignShapes(this.shape,t),e=n[0],r=(n[1],n[2]);return x(this.shape,r)?this.copy():Gr.calc({input:this.reshape(e,!1),outputShape:r},this.dtype)},n.prototype.pad_impl=function(t,n,e){return yr.calc({input:this,pads:t,mode:n,value:e},this.dtype)},n.prototype.gather=function(t,n){return Xr.calc({X:this,axis:t,indices:n},this.dtype)},n.prototype.slice_impl=function(t,n,e,r){return Dr.calc({X:this,starts:t,ends:n,axes:e,steps:r},this.dtype)},n.prototype.upsample=function(t){return vr.calc({X:this,scales:t},this.dtype)},n.prototype.normalize=function(t,e,r,o,i){if(!(t instanceof n)||!(e instanceof n)||!(o instanceof n)||!(i instanceof n))throw new Error("Can only normalize with CPU tensors");return Ur.calc({X:this,Mean:t,Variance:e,Scale:o,Bias:i,epsilon:r},this.dtype)},n}(P);function Pe(t,n,e){return new je(t,n,e)}var Me,Te,Ie,Ve,Ce,Ge,Xe,Ee,Re,De=new Bn((function(t){return new pt(Pe,t)})),Ue=new Bn((function(t){return new wn(Pe,t)})),Be=new Bn((function(t){return new mn(Pe,t)})),ze=new Bn((function(t){return new ft(Pe,t)})),We=new Bn((function(t){return new gt(Pe,t)})),Le=new Bn((function(t){return new re(Pe,t)})),Fe=new Bn((function(t){return new ue(Pe,t)})),Ne=new Bn((function(t){return new le(Pe,t)})),qe=new Bn((function(t){return new oe(Pe,t)})),He=new Bn((function(t){return new se(Pe,t)})),Ye=new Bn((function(t){return new he(Pe,t)})),Je=new Bn((function(t){return new ie(Pe,t)})),Ke=new Bn((function(t){return new pe(Pe,t)})),Qe=new Bn((function(t){return new fe(Pe,t)})),Ze=new Bn((function(t){return new Kn(Pe,t)})),$e=new Bn((function(t){return new be(Pe,t)})),tr=new Bn((function(t){return new $t(Pe,t)})),nr=new Bn((function(t){return new rn(Pe,t)})),er=new Bn((function(t){return new Se(Pe,t)})),rr=new Bn((function(t){return new nn(Pe,t)})),or=new Bn((function(t){return new qn(Pe,t)})),ir=new Bn((function(t){return new xn(Pe,t)})),ar=new Bn((function(t){return new kn(Pe,t)})),ur=new Bn((function(t){return new Fn(Pe,t)})),sr=new Bn((function(t){return new $n(Pe,t)})),pr=new Bn((function(t){return new Oe(Pe,t)})),cr=new Bn((function(t){return new Wn(Pe,t)})),lr=new Bn((function(t){return new vt(Pe,t)})),hr=new Bn((function(t){return new Xt(Pe,t)})),fr=new Bn((function(t){return new wt(Pe,t)})),dr=new Bn((function(t){return new Yn(Pe,t)})),yr=new Bn((function(t){return new In(Pe,t)})),vr=new Bn((function(t){return new Rn(Pe,t)})),wr=new Bn((function(t){return new kt(Pe,t)})),mr=new Bn((function(t){return new Tt(Pe,t)})),gr=new Bn((function(t){return new jt(Pe,t)})),br=new Bn((function(t){return new Ct(Pe,t)})),_r=new Bn((function(t){return new bn(Pe,t)})),xr=new Bn((function(t){return new Ut(Pe,t)})),Or=new Bn((function(t){return new zt(Pe,t)})),kr=new Bn((function(t){return new Lt(Pe,t)})),Sr=new Bn((function(t){return new Nt(Pe,t)})),Ar=new Bn((function(t){return new Ht(Pe,t)})),jr=new Bn((function(t){return new Jt(Pe,t)})),Pr=new Bn((function(t){return new Qt(Pe,t)})),Mr=new Bn((function(t){return new ye(Pe,t)})),Tr=new Bn((function(t){return new we(Pe,t)})),Ir=new Bn((function(t){return new un(Pe,t)})),Vr=new Bn((function(t){return new ne(Pe,t)})),Cr=new Bn((function(t){return new pn(Pe,t)})),Gr=new Bn((function(t){return new ln(Pe,t)})),Xr=new Bn((function(t){return new fn(Pe,t)})),Er=new Bn((function(t){return new An(Pe,t)})),Rr=new Bn((function(t){return new Pn(Pe,t)})),Dr=new Bn((function(t){return new Gn(Pe,t)})),Ur=new Bn((function(t){return new Un(Pe,t)})),Br=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),zr=(new Promise((function(t){e.e(3).then(e.bind(null,140)).then((function(n){Me=n.TensorF32,Te=n.TensorF64,Ie=n.TensorI32,Ve=n.TensorI16,Ce=n.TensorI8,Ge=n.TensorU32,Xe=n.TensorU16,Ee=n.TensorU8,Re={float64:Te,float32:Me,int32:Ie,int16:Ve,int8:Ce,uint32:Ge,uint16:Xe,uint8:Ee},t()}))})),function(t){function n(n,e,r){var o=t.call(this,r||"float32")||this;if(n instanceof Array){if(void 0===e)throw new Error("Need the shape when creating a Wasm tensor from values");var i=new j[o.dtype](n);o.wasmTensor=Re[o.dtype].create(e,i)}else o.wasmTensor=n;return o}return Br(n,t),n.range=function(t,e,r){for(var o=Math.max(Math.ceil((e-t)/r),0),i=new Array(o),a=0;a<o;a++)i[a]=t+a*r;return new n(i,new Uint32Array([o]))},n.prototype.cast=function(t){throw new Error("Method not implemented.")},n.prototype.getValues=function(){return Promise.resolve(this.wasmTensor.get_vals())},n.prototype.getShape=function(){return Array.from(this.wasmTensor.get_shape())},n.prototype.constantLike=function(t){return new n([t],this.wasmTensor.get_shape(),this.dtype)},n.prototype.singleConstant=function(t){return new n([t],new Uint32Array([1]),this.dtype)},n.prototype.delete=function(){void 0!==this.wasmTensor&&(this.wasmTensor.free(),this.wasmTensor=void 0)},n.prototype.copy=function(){return new n(this.wasmTensor.copy(),void 0,this.dtype)},n.prototype.exp=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Exp can only be called on float tensors");return new n(this.wasmTensor.exp())},n.prototype.log=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Log can only be called on float tensors");return new n(this.wasmTensor.log())},n.prototype.sqrt=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Sqrt can only be called on float tensors");return new n(this.wasmTensor.sqrt())},n.prototype.abs=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me)&&!(this.wasmTensor instanceof Ie)&&!(this.wasmTensor instanceof Ve)&&!(this.wasmTensor instanceof Ce))throw new Error("Abs can only be called on signed tensors");return new n(this.wasmTensor.abs())},n.prototype.sin=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Sin can only be called on float tensors");return new n(this.wasmTensor.sin())},n.prototype.cos=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Cos can only be called on float tensors");return new n(this.wasmTensor.cos())},n.prototype.tan=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Tan can only be called on float tensors");return new n(this.wasmTensor.tan())},n.prototype.asin=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Asin can only be called on float tensors");return new n(this.wasmTensor.asin())},n.prototype.acos=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Acos can only be called on float tensors");return new n(this.wasmTensor.acos())},n.prototype.atan=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Atan can only be called on float tensors");return new n(this.wasmTensor.atan())},n.prototype.sinh=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Sinh can only be called on float tensors");return new n(this.wasmTensor.sinh())},n.prototype.cosh=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Cosh can only be called on float tensors");return new n(this.wasmTensor.cosh())},n.prototype.tanh=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Tanh can only be called on float tensors");return new n(this.wasmTensor.tanh())},n.prototype.asinh=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Asinh can only be called on float tensors");return new n(this.wasmTensor.asinh())},n.prototype.acosh=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Acosh can only be called on float tensors");return new n(this.wasmTensor.acosh())},n.prototype.atanh=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Atanh can only be called on float tensors");return new n(this.wasmTensor.atanh())},n.prototype.sigmoid=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Sigmoid can only be called on float tensors");return new n(this.wasmTensor.sigmoid())},n.prototype.hardSigmoid=function(t,e){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("HardSigmoid can only be called on float tensors");return new n(this.wasmTensor.hard_sigmoid(t,e))},n.prototype.negate=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me)&&!(this.wasmTensor instanceof Ie)&&!(this.wasmTensor instanceof Ve)&&!(this.wasmTensor instanceof Ce))throw new Error("Negate can only be called on signed tensors");return new n(this.wasmTensor.negate())},n.prototype.powerScalar=function(t,e){return new n(this.wasmTensor.power_scalar(t,e))},n.prototype.addMultiplyScalar=function(t,e){return new n(this.wasmTensor.add_multiply_scalar(t,e))},n.prototype.sign=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me)&&!(this.wasmTensor instanceof Ie)&&!(this.wasmTensor instanceof Ve)&&!(this.wasmTensor instanceof Ce))throw new Error("Sign can only be called on signed tensors");return new n(this.wasmTensor.sign())},n.prototype.setValues=function(t,e){if(!(t instanceof n))throw new Error("Can only set WASM values to WASM values");return new n(this.wasmTensor.set_values(t.wasmTensor,new Uint32Array(e)))},n.prototype.add_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add WASM tensor to WASM tensor");return new n(t.wasmTensor.addition(e.wasmTensor,o,i))},n.prototype.subtract_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only subtract WASM tensor from WASM tensor");return new n(t.wasmTensor.subtraction(e.wasmTensor,o,i))},n.prototype.multiply_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only multiply WASM tensor with WASM tensor");return new n(t.wasmTensor.multiply(e.wasmTensor,o))},n.prototype.divide_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only divide WASM tensor by WASM tensor");return new n(t.wasmTensor.divide(e.wasmTensor,o))},n.prototype.power_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only take WASM tensor to power of WASM tensor");return new n(t.wasmTensor.power(e.wasmTensor))},n.prototype.matMul=function(t){if(!(t instanceof n))throw new Error("Can only add WASM tensor to WASM tensor");return new n(this.wasmTensor.matmul(t.wasmTensor))},n.prototype.gemm_impl=function(t,e,r,o,i,a){if(!(t instanceof n&&(void 0===a||a instanceof n)))throw new Error("Can only do gemm with CPU tensors");return new n(void 0!==a?this.wasmTensor.gemm_with_c(t.wasmTensor,e,r,o,a.wasmTensor,i):this.wasmTensor.gemm(t.wasmTensor,e,r,o))},n.prototype.sum_impl=function(t,e){return new n(this.wasmTensor.sum(new Uint32Array(t),e))},n.prototype.sumSquare_impl=function(t,e){return new n(this.wasmTensor.sum_square(new Uint32Array(t),e))},n.prototype.product_impl=function(t,e){return new n(this.wasmTensor.product(new Uint32Array(t),e))},n.prototype.max_impl=function(t,e){return new n(this.wasmTensor.max(new Uint32Array(t),e))},n.prototype.min_impl=function(t,e){return new n(this.wasmTensor.min(new Uint32Array(t),e))},n.prototype.reduceMean_impl=function(t,e){return new n(this.wasmTensor.reduce_mean(new Uint32Array(t),e))},n.prototype.reduceMeanSquare_impl=function(t,e){return new n(this.wasmTensor.reduce_mean_square(new Uint32Array(t),e))},n.prototype.reduceLogSum_impl=function(t,e){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("ReduceLogSum can only be called on float tensors");return new n(this.wasmTensor.reduce_log_sum(new Uint32Array(t),e))},n.prototype.reduceLogSumExp_impl=function(t,e){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("ReduceLogSumExp can only be called on float tensors");return new n(this.wasmTensor.reduce_log_sum_exp(new Uint32Array(t),e))},n.prototype.getActivationFlag=function(t){return"id"===t?0:"relu"===t?1:2},n.prototype.conv_impl=function(t,e,r,o,i,a,u){if(!(t instanceof n)||void 0!==u&&!(u instanceof n))throw new Error("Can only do convolution of WASM tensor with WASM tensor");var s=this.getActivationFlag(a);return new n(void 0!==u?this.wasmTensor.conv_with_bias(t.wasmTensor,u.wasmTensor,new Uint32Array(e),r,new Uint32Array(o),new Uint32Array(i),s):this.wasmTensor.conv(t.wasmTensor,new Uint32Array(e),r,new Uint32Array(o),new Uint32Array(i),s))},n.prototype.convTranspose_impl=function(t,e,r,o,i){if(!(t instanceof n))throw new Error("Can only do transpose convolution of WASM tensor with WASM tensor");return new n(this.wasmTensor.conv_transpose(t.wasmTensor,new Uint32Array(e),r,new Uint32Array(o),new Uint32Array(i)))},n.prototype.averagePool_impl=function(t,e,r,o){return new n(this.wasmTensor.average_pool(new Uint32Array(t),new Uint32Array(e),new Uint32Array(r),o))},n.prototype.reshape_impl=function(t){var e=new Uint32Array(t);return new n(this.wasmTensor.reshape(e),e)},n.prototype.concat=function(t,e){if(!(t instanceof n))throw new Error("Can only concat WASM tensor to WASM tensor");return e<0&&(e+=this.getShape().length),new n(this.wasmTensor.concat(t.wasmTensor,e))},n.prototype.transpose_impl=function(t){return new n(this.wasmTensor.transpose(new Uint32Array(t)))},n.prototype.clip=function(t,e){return void 0!==t&&void 0!==e?new n(this.wasmTensor.clip(t,e)):void 0!==t?new n(this.wasmTensor.clip_min(t)):void 0!==e?new n(this.wasmTensor.clip_max(e)):this.copy()},n.prototype.clipBackward=function(t,e,r){if(!(t instanceof n))throw new Error("Can only do grad backward with Wasm tensor");return void 0!==e&&void 0!==r?new n(this.wasmTensor.clip_backward(e,r,t.wasmTensor)):void 0!==e?new n(this.wasmTensor.clip_min_backward(e,t.wasmTensor)):void 0!==r?new n(this.wasmTensor.clip_max_backward(r,t.wasmTensor)):this.copy()},n.prototype.repeat=function(t){return new n(this.wasmTensor.repeat(new Uint32Array(t)))},n.prototype.expand=function(t){var e=this.getShape(),r=this.alignShapes(e,t),o=r[0],i=(r[1],r[2]);return x(e,i)?this.copy():new n(this.reshape(o,!1).wasmTensor.expand(new Uint32Array(i)))},n.prototype.pad_impl=function(t,e,r){return new n(this.wasmTensor.pad(new Uint32Array(t),n.padModeToInt[e],r))},n.prototype.gather=function(t,e){return new n(this.wasmTensor.gather(t,e.values,new Uint32Array(e.shape)))},n.prototype.floor=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Floor can only be called on float tensors");return new n(this.wasmTensor.floor())},n.prototype.ceil=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Ceil can only be called on float tensors");return new n(this.wasmTensor.ceil())},n.prototype.round=function(){if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Round can only be called on float tensors");return new n(this.wasmTensor.round())},n.prototype.slice_impl=function(t,e,r,o){return new n(this.wasmTensor.slice(new Uint32Array(t),new Uint32Array(e),new Uint32Array(r),new Int32Array(o)))},n.prototype.upsample=function(t){return new n(this.wasmTensor.upsample(new Float32Array(t)))},n.prototype.normalize=function(t,e,r,o,i){if(!(t instanceof n)||!(e instanceof n)||!(o instanceof n)||!(i instanceof n))throw new Error("Can only normalize with WASM tensors");if(!(this.wasmTensor instanceof Te)&&!(this.wasmTensor instanceof Me))throw new Error("Normalize can only be called on float tensors");return new n(this.wasmTensor.normalize(t.wasmTensor,e.wasmTensor,r,o.wasmTensor,i.wasmTensor))},n.padModeToInt={constant:0,reflect:1,edge:2},n}(P)),Wr=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Lr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function Fr(t){return Wr(this,void 0,void 0,(function(){var n,e,r,o,i;return Lr(this,(function(a){switch(a.label){case 0:return t instanceof Wp?(n=Wp.bind,[4,Fr(t.value)]):[3,5];case 1:return e=[void 0,a.sent()],i={},void 0===t.grad?[3,3]:[4,Fr(t.grad)];case 2:return r=a.sent(),[3,4];case 3:r=void 0,a.label=4;case 4:return[2,new(n.apply(Wp,e.concat([(i.grad=r,i)])))];case 5:return t instanceof H?[2,t]:[4,t.getValues()];case 6:return o=a.sent(),[2,new H(t.getShape(),o,t.dtype)]}}))}))}function Nr(t){return Wr(this,void 0,void 0,(function(){var n,e,r,o,i;return Lr(this,(function(a){switch(a.label){case 0:if("float16"===t.dtype)throw new Error("Cant represent float16 tensor on Wasm backend");return t instanceof Wp?(n=Wp.bind,[4,Nr(t.value)]):[3,5];case 1:return e=[void 0,a.sent()],i={},void 0===t.grad?[3,3]:[4,Nr(t.grad)];case 2:return r=a.sent(),[3,4];case 3:r=void 0,a.label=4;case 4:return[2,new(n.apply(Wp,e.concat([(i.grad=r,i)])))];case 5:return t instanceof zr?[2,t]:[4,t.getValues()];case 6:return o=a.sent(),t instanceof H&&o instanceof Int32Array?[2,t]:[2,new zr(Array.from(o),new Uint32Array(t.getShape()),t.dtype)]}}))}))}function qr(t){return Wr(this,void 0,void 0,(function(){var n,e,r,o,i;return Lr(this,(function(a){switch(a.label){case 0:if("float64"===t.dtype)throw new Error("Cant represent float64 tensor on WebGL backend");return t instanceof Wp?(n=Wp.bind,[4,qr(t.value)]):[3,5];case 1:return e=[void 0,a.sent()],i={},void 0===t.grad?[3,3]:[4,qr(t.grad)];case 2:return r=a.sent(),[3,4];case 3:r=void 0,a.label=4;case 4:return[2,new(n.apply(Wp,e.concat([(i.grad=r,i)])))];case 5:return t instanceof je?[2,t]:[4,t.getValues()];case 6:return o=a.sent(),t instanceof H&&o instanceof Int32Array?[2,t]:[2,new je(Array.from(o),t.getShape(),t.dtype)]}}))}))}var Hr=e(22),Yr=e.n(Hr),Jr=e(54),Kr=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Qr=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Zr=function(){function t(){this.backend="CPU",this.mode="train"}return t.prototype.getSubModules=function(){for(var n=[],e=0,r=Object.keys(this);e<r.length;e++){var o=r[e];this[o]instanceof t&&n.push(this[o])}return n},t.prototype.getParameters=function(){for(var t=[],n=0,e=Object.keys(this);n<e.length;n++){var r=e[n];this[r]instanceof Wp&&t.push(this[r])}for(var o=0,i=this.getSubModules();o<i.length;o++){var a=i[o].getParameters();t=t.concat(a)}return t},t.prototype.toBackend=function(t){return"CPU"===t?this.toCPU():"WASM"===t?this.toWASM():this.toGPU()},t.prototype.toCPU=function(){return Kr(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return Qr(this,(function(s){switch(s.label){case 0:t=this.getSubModules(),n=0,e=t,s.label=1;case 1:return n<e.length?[4,e[n].toCPU()]:[3,4];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:r=0,o=Object.keys(this),s.label=5;case 5:return r<o.length?this[i=o[r]]instanceof P?(a=this,u=i,[4,Fr(this[i])]):[3,7]:[3,8];case 6:a[u]=s.sent(),s.label=7;case 7:return r++,[3,5];case 8:return this.backend="CPU",[2]}}))}))},t.prototype.toWASM=function(){return Kr(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return Qr(this,(function(s){switch(s.label){case 0:t=this.getSubModules(),n=0,e=t,s.label=1;case 1:return n<e.length?[4,e[n].toWASM()]:[3,4];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:r=0,o=Object.keys(this),s.label=5;case 5:return r<o.length?this[i=o[r]]instanceof P?(a=this,u=i,[4,Nr(this[i])]):[3,7]:[3,8];case 6:a[u]=s.sent(),s.label=7;case 7:return r++,[3,5];case 8:return this.backend="WASM",[2]}}))}))},t.prototype.toGPU=function(){return Kr(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return Qr(this,(function(s){switch(s.label){case 0:t=this.getSubModules(),n=0,e=t,s.label=1;case 1:return n<e.length?[4,e[n].toGPU()]:[3,4];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:r=0,o=Object.keys(this),s.label=5;case 5:return r<o.length?this[i=o[r]]instanceof P?(a=this,u=i,[4,qr(this[i])]):[3,7]:[3,8];case 6:a[u]=s.sent(),s.label=7;case 7:return r++,[3,5];case 8:return this.backend="GPU",[2]}}))}))},t}(),$r=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),to=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},no=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},eo=function(t){function n(n,e,r,o,i,a){var u=t.call(this)||this;u.attributes={},u.mode=a;for(var s=0;s<n.length;s++)u.attributes[n[s].name]=n[s];u.inputs=e,u.outputs=r,u.onnxVersion=i,u.variableInputs=0;for(s=0;s<u.inputs.length;s++)void 0===o[u.inputs[s]]&&u.variableInputs++;return u}return $r(n,t),n.prototype.initialize=function(t){},n.prototype.getAttribute=function(t){return this.attributes[t]},n.prototype.getAttributeString=function(t){var n=this.attributes[t];if(void 0!==n){var e=n.s;return void 0!==e&&null!==e?new TextDecoder("utf-8").decode(e):void 0}},n.prototype.getAttributeInts=function(t){if(void 0!==this.attributes[t]){var n=this.attributes[t].ints;if(void 0!==n&&null!==n){for(var e=0;e<n.length;e++)Yr.a.isLong(n[e])&&(n[e]=n[e].toNumber());return n}}},n.prototype.getAttributeInt=function(t){var n=this.attributes[t];if(void 0!==n){var e=n.i;return Yr.a.isLong(e)&&(e=e.toNumber()),e}},n.prototype.getAttributeFloat=function(t){var n=this.attributes[t];if(void 0!==n)return n.f},n.prototype.getAttributeFloats=function(t){var n=this.attributes[t];if(void 0!==n)return n.floats},n.prototype.getAttributeTensor=function(t){var n=this.attributes[t];if(void 0!==n)return n.t},n.prototype.toValues=function(t){return to(this,void 0,void 0,(function(){var n,e,r;return no(this,(function(o){switch(o.label){case 0:return t instanceof H?[3,2]:(console.warn("Tensor for values not on CPU, need to transfer!"),[4,Fr(t)]);case 1:t=o.sent(),o.label=2;case 2:for(n=t,e=new Array(n.size),r=0;r<n.size;r++)e[r]=n.get(r);return[2,e]}}))}))},n.prototype.toCPU=function(){return to(this,void 0,void 0,(function(){return no(this,(function(t){return[2]}))}))},n.prototype.toWASM=function(){return to(this,void 0,void 0,(function(){return no(this,(function(t){return[2]}))}))},n.prototype.toGPU=function(){return to(this,void 0,void 0,(function(){return no(this,(function(t){return[2]}))}))},n}(Zr);function ro(t,n){if(void 0===n&&(n=!1),void 0!==t.segment&&null!==t.segment)throw new Error("Handling of tensor proto segment not yet implemented");var e=t.dims;if(void 0===e||null===e)throw new Error("Tensor shape must be specified");for(var r=0;r<e.length;r++)Yr.a.isLong(e[r])&&(e[r]=e[r].toNumber());0===e.length&&(e=[1]);var o=g(e);if(1===t.dataType){if(t.floatData&&t.floatData.length>0)return new H(e,t.floatData);if(t.rawData&&t.rawData.length>0){var i=t.rawData.buffer.slice(t.rawData.byteOffset,t.rawData.byteOffset+t.rawData.byteLength),a=new Float32Array(i);return new H(e,a,n?"float16":"float32")}if(0===o)return new H(e);throw new Error("Cant process float tensor without float or raw data")}if(7===t.dataType){if(t.rawData&&t.rawData.length>0){for(a=new Int32Array(t.rawData.length/8),r=0;r<t.rawData.length;r+=8){var u=Yr.a.fromBytesLE(Array.from(t.rawData.slice(r,r+8))).toNumber();a[r/8]=u}return new H(e,a,"int32")}throw new Error("Cant process int64 tensor without raw data")}throw new Error("Handling of tensor type "+t.dataType+" not yet implemented")}var oo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),io=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ao=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},uo=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this,s=u.getAttributeTensor("value");if(void 0===s||null===s)throw new Error('Constant needs tensor value, but attribute "value" was not defined');return u.tensor=ro(s),"train"===a&&void 0!==u.tensor&&(u.tensor=new Wp(u.tensor)),u}return oo(n,t),n.prototype.forward=function(t){return io(this,void 0,void 0,(function(){return ao(this,(function(t){if(void 0!==this.tensor)return[2,[this.tensor]];throw new Error("Constant without tensor value doesnt work")}))}))},n.prototype.toCPU=function(){return io(this,void 0,void 0,(function(){var t;return ao(this,(function(n){switch(n.label){case 0:return void 0===this.tensor?[3,2]:(t=this,[4,Fr(this.tensor)]);case 1:t.tensor=n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.toWASM=function(){return io(this,void 0,void 0,(function(){var t;return ao(this,(function(n){switch(n.label){case 0:return void 0===this.tensor?[3,2]:(t=this,[4,Nr(this.tensor)]);case 1:t.tensor=n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.toGPU=function(){return io(this,void 0,void 0,(function(){var t;return ao(this,(function(n){switch(n.label){case 0:return void 0===this.tensor?[3,2]:(t=this,[4,qr(this.tensor)]);case 1:t.tensor=n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.getType=function(){return"Constant"},n.prototype.delete=function(){void 0!==this.tensor&&this.tensor.delete()},n}(eo),so=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),po=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},co=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},lo=function(t){function n(n,e,r,o,i,a,u,s,p){var c=t.call(this,n,e,r,o,i,a)||this;if(void 0!==c.getAttributeString("autoPad"))throw new Error("Autopad in conv not supported yet");return void 0===p&&(p="id"),c.activation=p,c.group=c.getAttributeInt("group")||1,c.dilations=c.getAttributeInts("dilations"),c.pads=c.getAttributeInts("pads"),c.strides=c.getAttributeInts("strides"),c.kernel=u,c.bias=s,"train"===a&&void 0!==c.kernel&&(c.kernel=new Wp(c.kernel)),"train"===a&&void 0!==c.bias&&(c.bias=new Wp(c.bias)),c}return so(n,t),n.prototype.forward=function(t){return po(this,void 0,void 0,(function(){var n,e,r;return co(this,(function(o){return n=t[0],e=void 0!==this.kernel?this.kernel:t[1],r=t.length>2?t[2]:this.bias,[2,[n.conv(e,r,this.dilations,this.group,this.pads,this.strides,this.activation)]]}))}))},n.prototype.getDilations=function(t){return void 0!==this.dilations?this.dilations:new Array(t).fill(1)},n.prototype.getPads=function(t){return void 0!==this.pads?this.pads:new Array(2*t).fill(0)},n.prototype.getStrides=function(t){return void 0!==this.strides?this.strides:new Array(t).fill(1)},n.prototype.getType=function(){return"Conv"},n.prototype.toCPU=function(){return po(this,void 0,void 0,(function(){var t,n;return co(this,(function(e){switch(e.label){case 0:return void 0===this.kernel?[3,2]:(t=this,[4,Fr(this.kernel)]);case 1:t.kernel=e.sent(),e.label=2;case 2:return void 0===this.bias?[3,4]:(n=this,[4,Fr(this.bias)]);case 3:n.bias=e.sent(),e.label=4;case 4:return[2]}}))}))},n.prototype.toWASM=function(){return po(this,void 0,void 0,(function(){var t,n;return co(this,(function(e){switch(e.label){case 0:return void 0===this.kernel?[3,2]:(t=this,[4,Nr(this.kernel)]);case 1:t.kernel=e.sent(),e.label=2;case 2:return void 0===this.bias?[3,4]:(n=this,[4,Nr(this.bias)]);case 3:n.bias=e.sent(),e.label=4;case 4:return[2]}}))}))},n.prototype.toGPU=function(){return po(this,void 0,void 0,(function(){var t,n;return co(this,(function(e){switch(e.label){case 0:return void 0===this.kernel?[3,2]:(t=this,[4,qr(this.kernel)]);case 1:t.kernel=e.sent(),e.label=2;case 2:return void 0===this.bias?[3,4]:(n=this,[4,qr(this.bias)]);case 3:n.bias=e.sent(),e.label=4;case 4:return[2]}}))}))},n.prototype.delete=function(){void 0!==this.kernel&&this.kernel.delete(),void 0!==this.bias&&this.bias.delete()},n}(eo),ho=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),fo=function(){},yo=function(t){function n(n){var e=t.call(this)||this;return e.nodeTypes=n,e}return ho(n,t),n.prototype.findApplications=function(t){var n=[],e=t.getNodes();for(var r in Object.keys(e)){var o=e[r];if(void 0!==o&&o.getType()===this.nodeTypes[0]){var i=this.checkApplication(t,r);void 0!==i&&n.push(i)}}return n},n.prototype.checkApplication=function(t,n){for(var e=t.getNodes(),r=[n],o=e[n],i=[o],a=1;a<this.nodeTypes.length;a++){var u=t.getNodeWithInput(o.outputs[0]);if(void 0===u)return;var s=e[u];if(s.getType()!==this.nodeTypes[a])return;r.push(u),o=s,i.push(o)}return this.canApply(i)?r:void 0},n.prototype.canApply=function(t){return!0},n}(fo),vo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),wo=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},mo=function(t){function n(){return t.call(this,["Conv","BatchNormalization"])||this}return vo(n,t),n.prototype.apply=function(t,n,e,r){var o=t[0],i=t[1],a=n(o.inputs[1]),u=n(o.inputs[2]),s=n(i.inputs[1]),p=n(i.inputs[2]),c=n(i.inputs[3]),l=n(i.inputs[4]).add(i.epsTensor).sqrt(),h=s.divide(l);l.delete();var f=p.subtract(c.multiply(h)),d=wo(h.getShape(),new Array(a.getShape().length-h.getShape().length).fill(1)),y=a.multiply(h.reshape(d,!1)),v=f;if(void 0!==u){var w=u.multiply(h);v=v.add(w),w.delete()}return new lo(Object.entries(o.attributes).map((function(t){return t[1]})),[o.inputs[0]],i.outputs,e,r,o.mode,y,v)},n}(yo),go=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),bo=function(t){function n(){return t.call(this,["Conv","Relu"])||this}return go(n,t),n.prototype.apply=function(t,n,e,r){var o=t[0],i=t[1];return new lo(Object.entries(o.attributes).map((function(t){return t[1]})),o.inputs,i.outputs,e,r,o.mode,o.kernel,o.bias,"relu")},n}(yo),_o=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),xo=function(t){function n(){return t.call(this,["Conv","Clip"])||this}return _o(n,t),n.prototype.apply=function(t,n,e,r){var o=t[0],i=t[1];return new lo(Object.entries(o.attributes).map((function(t){return t[1]})),o.inputs,i.outputs,e,r,o.mode,o.kernel,o.bias,"relu6")},n.prototype.canApply=function(t){var n=t[1];return 0===n.min&&6===n.max},n}(yo),Oo=[new mo,new bo,new xo],ko=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),So=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ao=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},jo=function(t){function n(n,e,r,o,i,a,u){var s=t.call(this,n,e,r,o,i,u)||this;return s.name=a,s}return ko(n,t),n.prototype.forward=function(t){return So(this,void 0,void 0,(function(){var n,e;return Ao(this,(function(r){if(this.onnxVersion<13&&this.onnxVersion>=7)return n=t[0],e=t[1],[2,[this.compute(n,e)]];throw new Error(this.name+" not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return this.name},n.prototype.delete=function(){},n}(eo),Po=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Mo=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Add",a)||this}return Po(n,t),n.prototype.compute=function(t,n){return t.add(n)},n}(jo),To=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Io=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Vo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Co=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Go=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.epsilon=u.getAttributeFloat("epsilon")||1e-5,u.momentum=u.getAttributeFloat("momentum")||.9,u.epsTensor=new H([1],[u.epsilon]),"train"===a&&(u.epsTensor=new Wp(u.epsTensor)),u}return To(n,t),n.prototype.forward=function(t){return Io(this,void 0,void 0,(function(){var n,e,r,o,i,a,u;return Vo(this,(function(s){return n=t[0],e=t[1],r=t[2],o=t[3],i=t[4],a=e.getShape()[0],u=Co([1,a],new Array(n.getShape().length-2).fill(1)),e=e.reshape(u,!1),r=r.reshape(u,!1),o=o.reshape(u,!1),i=i.reshape(u,!1),[2,[n.normalize(o,i,this.epsilon,e,r)]]}))}))},n.prototype.getType=function(){return"BatchNormalization"},n.prototype.toCPU=function(){return Io(this,void 0,void 0,(function(){var t;return Vo(this,(function(n){switch(n.label){case 0:return t=this,[4,Fr(this.epsTensor)];case 1:return t.epsTensor=n.sent(),[2]}}))}))},n.prototype.toWASM=function(){return Io(this,void 0,void 0,(function(){var t;return Vo(this,(function(n){switch(n.label){case 0:return t=this,[4,Nr(this.epsTensor)];case 1:return t.epsTensor=n.sent(),[2]}}))}))},n.prototype.toGPU=function(){return Io(this,void 0,void 0,(function(){var t;return Vo(this,(function(n){switch(n.label){case 0:return t=this,[4,qr(this.epsTensor)];case 1:return t.epsTensor=n.sent(),[2]}}))}))},n.prototype.delete=function(){this.epsTensor.delete()},n}(eo),Xo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Eo=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ro=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Do=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.to=u.getAttributeString("to"),u}return Xo(n,t),n.prototype.forward=function(t){return Eo(this,void 0,void 0,(function(){return Ro(this,(function(n){return[2,[t[0].cast(this.to)]]}))}))},n.prototype.getType=function(){return"Cast"},n.prototype.delete=function(){},n}(eo),Uo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Bo=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},zo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Wo=function(t){function n(n,e,r,o,i,a,u){var s=t.call(this,n,e,r,o,i,u)||this;return s.name=a,s}return Uo(n,t),n.prototype.forward=function(t){return Bo(this,void 0,void 0,(function(){var n;return zo(this,(function(e){return n=t[0],[2,[this.compute(n)]]}))}))},n.prototype.getType=function(){return this.name},n.prototype.delete=function(){},n}(eo),Lo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fo=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Ceil",a)||this}return Lo(n,t),n.prototype.compute=function(t){return t.ceil()},n}(Wo),No=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),qo=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ho=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Yo=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return i<11&&(u.min=u.getAttributeFloat("min"),u.max=u.getAttributeFloat("max")),u}return No(n,t),n.prototype.forward=function(t){return qo(this,void 0,void 0,(function(){var n,e,r;return Ho(this,(function(o){if(n=t[0],this.onnxVersion<11)return[2,[n.clip(this.min,this.max)]];if(e=t.length>1?t[1]:void 0,r=t.length>2?t[2]:void 0,void 0===e&&void 0===r)return[2,[n.copy()]];throw new Error("Clip with onnx version >= 11 not yet implemented")}))}))},n.prototype.getType=function(){return"Clip"},n.prototype.delete=function(){},n}(eo),Jo=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ko=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Qo=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Zo=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return i<13&&(u.axis=u.getAttributeInt("axis")),u}return Jo(n,t),n.prototype.forward=function(t){return Ko(this,void 0,void 0,(function(){var n,e,r;return Qo(this,(function(o){if(t.length,this.onnxVersion<13&&void 0!==this.axis){for(n=t[0],e=1;e<t.length;e++)r=n.concat(t[e],this.axis),e>1&&n.delete(),n=r;return[2,[n]]}throw new Error("Concat not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Concat"},n.prototype.delete=function(){},n}(eo),$o=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ti=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ni=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ei=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;if(i<11){var s=u.getAttributeTensor("value");null!==s&&void 0!==s&&(u.tensor=ro(s))}return u}return $o(n,t),n.prototype.forward=function(t){return ti(this,void 0,void 0,(function(){var n,e,r,o,i;return ni(this,(function(a){if(n=t[0],this.onnxVersion<11&&void 0!==this.tensor){if(!(n instanceof H))throw new Error("ConstantOfShape needs cpu tensor as shape tensor");for(e=new Array(n.size),r=0;r<n.size;r++)e[r]=n.get(r);return o=g(e),i=new Float32Array(o).fill(this.tensor.get(0)),[2,[new H(e,i,this.tensor.dtype)]]}throw new Error("ConstantOfShape not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"ConstantOfShape"},n.prototype.delete=function(){void 0!==this.tensor&&this.tensor.delete()},n}(eo),ri=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),oi=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Div",a)||this}return ri(n,t),n.prototype.compute=function(t,n){return t.divide(n)},n}(jo),ii=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ai=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Exp",a)||this}return ii(n,t),n.prototype.compute=function(t){return t.exp()},n}(Wo),ui=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),si=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},pi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ci=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return ui(n,t),n.prototype.forward=function(t){return si(this,void 0,void 0,(function(){var n,e,r,o;return pi(this,(function(i){if(this.onnxVersion<13){if(n=t[0],!((e=t[1])instanceof H))throw new Error("Expand needs cpu tensor as shape tensor");for(r=new Array(e.size),o=0;o<e.size;o++)r[o]=e.get(o);return[2,[n.expand(r)]]}throw new Error("Expand not yet implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Expand"},n.prototype.delete=function(){},n}(eo),li=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),hi=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Floor",a)||this}return li(n,t),n.prototype.compute=function(t){return t.floor()},n}(Wo),fi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),di=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},yi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},vi=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.axis=u.getAttributeInt("axis")||0,u}return fi(n,t),n.prototype.forward=function(t){return di(this,void 0,void 0,(function(){var n,e;return yi(this,(function(r){if(n=t[0],!((e=t[1])instanceof H))throw new Error("Gather requires CPU tensor for the indices");return[2,[n.gather(this.axis,e)]]}))}))},n.prototype.getType=function(){return"Gather"},n.prototype.delete=function(){},n}(eo),wi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),mi=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},gi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},bi=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;u.alpha=u.getAttributeFloat("alpha")||1,u.beta=u.getAttributeFloat("beta")||1;var s=u.getAttributeInt("transA"),p=u.getAttributeInt("transB");return u.transA=1===s,u.transB=1===p,u}return wi(n,t),n.prototype.forward=function(t){return mi(this,void 0,void 0,(function(){var n,e,r;return gi(this,(function(o){return n=t[0],e=t[1],r=t[2],[2,[n.gemm(e,this.transA,this.transB,this.alpha,r,this.beta)]]}))}))},n.prototype.getType=function(){return"Gemm"},n.prototype.delete=function(){},n}(eo),_i=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),xi=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Oi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ki=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Si=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.epsilon=u.getAttributeFloat("epsilon")||1e-5,u}return _i(n,t),n.prototype.forward=function(t){return xi(this,void 0,void 0,(function(){var n,e,r,o,i,a,u,s,p,c,l,h;return Oi(this,(function(f){for(n=t[0],e=t[1],r=t[2],o=n.getShape().length-2,i=e.getShape()[0],a=ki([1,i],new Array(o).fill(1)),e=e.reshape(a,!1),r=r.reshape(a,!1),u=new Array(n.getShape().length-2),s=0;s<o;s++)u[s]=s+2;return p=n.reduceMean(u,!0),tt.flush(),c=n.subtract(p),tt.flush(),l=c.reduceMeanSquare(u,!0),tt.flush(),h=n.normalize(p,l,this.epsilon,e,r),p.delete(),c.delete(),l.delete(),[2,[h]]}))}))},n.prototype.getType=function(){return"InstanceNormalization"},n.prototype.delete=function(){},n}(eo),Ai=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ji=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Pi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Mi=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return Ai(n,t),n.prototype.forward=function(t){return ji(this,void 0,void 0,(function(){var n,e;return Pi(this,(function(r){if(n=t[0],e=t[1],this.onnxVersion<13){if(n.getShape().length!==e.getShape().length)throw new Error("Automatic broadcasting in MatMul not supported yet");return[2,[n.gemm(e)]]}throw new Error("Matmul with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"MatMul"},n.prototype.delete=function(){},n}(eo),Ti=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ii=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Mul",a)||this}return Ti(n,t),n.prototype.compute=function(t,n){return t.multiply(n)},n}(jo),Vi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ci=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Gi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Xi=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.padMode=u.getAttributeString("mode")||"constant",u.pads=u.getAttributeInts("pads"),u.value=u.getAttributeFloat("value")||0,u}return Vi(n,t),n.prototype.forward=function(t){return Ci(this,void 0,void 0,(function(){return Gi(this,(function(n){if(this.onnxVersion<11)return[2,[t[0].pad(this.pads,this.padMode,this.value)]];throw new Error("Pad not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Pad"},n.prototype.delete=function(){},n}(eo),Ei=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ri=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Di=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ui=function(t){function n(n,e,r,o,i,a,u){var s=t.call(this,n,e,r,o,i,u)||this;s.axes=s.getAttributeInts("axes");var p=s.getAttributeInt("keepdims");return s.keepDims=1===p||void 0===p,s.name=a,s}return Ei(n,t),n.prototype.getAxes=function(t){if(void 0!==this.axes)return this.axes;for(var n=t.getShape().length,e=new Array(n),r=0;r<n;r++)e[r]=r;return e},n.prototype.forward=function(t){return Ri(this,void 0,void 0,(function(){return Di(this,(function(n){if(this.onnxVersion<13)return[2,[this.calc(t[0])]];throw new Error(this.name+" is not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return this.name},n.prototype.delete=function(){},n}(eo),Bi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),zi=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceMax",a)||this}return Bi(n,t),n.prototype.calc=function(t){return t.max(this.axes,this.keepDims)},n}(Ui),Wi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Li=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceMean",a)||this}return Wi(n,t),n.prototype.calc=function(t){return t.reduceMean(this.axes,this.keepDims)},n}(Ui),Fi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ni=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceSum",a)||this}return Fi(n,t),n.prototype.calc=function(t){return t.sum(this.axes,this.keepDims)},n}(Ui),qi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Hi=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceSumSquare",a)||this}return qi(n,t),n.prototype.calc=function(t){return t.sumSquare(this.axes,this.keepDims)},n}(Ui),Yi=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ji=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.max=void 0,u.min=0,u}return Yi(n,t),n.prototype.getType=function(){return"Relu"},n}(Yo),Ki=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Qi=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Zi=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},$i=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return Ki(n,t),n.prototype.forward=function(t){return Qi(this,void 0,void 0,(function(){var n,e,r,o;return Zi(this,(function(i){if(n=t[0],!((e=t[1])instanceof H))throw new Error("Reshape only works with CPU tensor as shape tensor");if(this.onnxVersion<13){for(r=new Array(e.size),o=0;o<e.size;o++)r[o]=e.get(o);return[2,[n.reshape(r)]]}throw new Error("Reshape with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"Reshape"},n.prototype.delete=function(){},n}(eo),ta=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),na=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ea=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ra=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},oa=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return ta(n,t),n.prototype.forward=function(t){return na(this,void 0,void 0,(function(){var n,e;return ea(this,(function(r){if(this.onnxVersion<13)return n=t[0],e=n.getShape(),[2,[new H([e.length],ra(e),"int32")]];throw new Error("Shape not implemented for onnx version "+this.onnxVersion)}))}))},n.prototype.getType=function(){return"Shape"},n.prototype.delete=function(){},n}(eo),ia=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),aa=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ua=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},sa=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.axes=u.getAttributeInts("axes"),u.starts=u.getAttributeInts("starts"),u.ends=u.getAttributeInts("ends"),u}return ia(n,t),n.prototype.forward=function(t){return aa(this,void 0,void 0,(function(){var n,e,r,o,i,a,u,s,p,c,l;return ua(this,(function(h){switch(h.label){case 0:if(!(this.onnxVersion<10))return[3,1];if(void 0===this.starts||void 0===this.ends)throw new Error("Slice with onnx version < 10 needs starts and ends defined as attributes");return[2,[(n=t[0]).slice(this.starts,this.ends,this.axes)]];case 1:return n=t[0],e=t[1],r=t[2],o=t[3],i=t[4],[4,this.toValues(e)];case 2:return a=h.sent(),[4,this.toValues(r)];case 3:return u=h.sent(),void 0===o?[3,5]:[4,this.toValues(o)];case 4:return p=h.sent(),[3,6];case 5:p=void 0,h.label=6;case 6:return s=p,void 0===i?[3,8]:[4,this.toValues(i)];case 7:return l=h.sent(),[3,9];case 8:l=void 0,h.label=9;case 9:return c=l,[2,[n.slice(a,u,s,c)]]}}))}))},n.prototype.getType=function(){return"Slice"},n.prototype.delete=function(){},n}(eo),pa=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ca=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},la=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ha=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.axis=u.getAttributeInt("axis"),u}return pa(n,t),n.prototype.forward=function(t){return ca(this,void 0,void 0,(function(){var n,e,r,o,i,a,u,s,p,c;return la(this,(function(l){return n=t[0],e=n.getShape(),void 0===(r=this.axis)&&(r=this.onnxVersion<13?1:e.length-1),o=e.slice(0,r).reduce((function(t,n){return t*n}),1),i=n.reshape([o,-1],!1),a=i.max(1,!0),u=i.subtract(a),s=u.exp(),p=s.sum(1,!0),c=s.divide(p),a.delete(),u.delete(),s.delete(),p.delete(),[2,[c.reshape(e,!1)]]}))}))},n.prototype.getType=function(){return"Softmax"},n.prototype.delete=function(){},n}(eo),fa=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),da=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Sub",a)||this}return fa(n,t),n.prototype.compute=function(t,n){return t.subtract(n)},n}(jo),ya=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),va=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},wa=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ma=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return ya(n,t),n.prototype.forward=function(t){return va(this,void 0,void 0,(function(){var n,e,r,o;return wa(this,(function(i){if(n=t[0],!((e=t[1])instanceof H))throw new Error("Tile only works with CPU tensor as repeats");if(this.onnxVersion<13&&this.onnxVersion>=6){for(r=new Array(e.size),o=0;o<e.size;o++)r[o]=e.get(o);return[2,[n.repeat(r)]]}throw new Error("Tile with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"Tile"},n.prototype.delete=function(){},n}(eo),ga=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ba=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},_a=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},xa=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.permutation=u.getAttributeInts("perm"),u}return ga(n,t),n.prototype.forward=function(t){return ba(this,void 0,void 0,(function(){return _a(this,(function(n){return[2,[t[0].transpose(this.permutation)]]}))}))},n.prototype.getType=function(){return"Transpose"},n.prototype.delete=function(){},n}(eo),Oa=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ka=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Sa=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Aa=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return i<13&&(u.axes=u.getAttributeInts("axes")),u}return Oa(n,t),n.prototype.forward=function(t){return ka(this,void 0,void 0,(function(){var n,e,r,o,i;return Sa(this,(function(a){if(n=t[0],this.onnxVersion<13&&void 0!==this.axes){for(e=n.getShape(),r=[],o=0,i=0;i<e.length;i++)o<this.axes.length&&this.axes[o]===i&&(r.push(1),o++),r.push(e[i]);return this.axes[this.axes.length-1]===e.length&&r.push(1),[2,[n.reshape(r)]]}throw new Error("Unsqueeze with onnx version "+this.onnxVersion+" not yet implemented")}))}))},n.prototype.getType=function(){return"Unsqueeze"},n.prototype.delete=function(){},n}(eo),ja=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Pa=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ma=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ta=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;if(u.sampleMode=u.getAttributeString("mode"),"nearest"!==u.sampleMode)throw new Error("Upsampling only supported with nearest neighbor sampling");if(u.onnxVersion<9){var s=u.getAttributeFloats("scales");if(void 0===s||null===s)throw new Error("Upsample node with onnx version "+u.onnxVersion+" is missing scales attribute");u.scales=s}return u}return ja(n,t),n.prototype.getScales=function(t){return Pa(this,void 0,void 0,(function(){var n,e,r;return Ma(this,(function(o){switch(o.label){case 0:return this.onnxVersion<9?[2,this.scales]:t instanceof H?[3,2]:(console.warn("Scales tensor for upsample not on CPU, need to transfer!"),[4,Fr(t)]);case 1:t=o.sent(),o.label=2;case 2:for(n=t,e=new Array(n.size),r=0;r<n.size;r++)e[r]=n.get(r);return[2,e]}}))}))},n.prototype.forward=function(t){return Pa(this,void 0,void 0,(function(){var n,e,r;return Ma(this,(function(o){switch(o.label){case 0:return n=t[0],e=t[1],[4,this.getScales(e)];case 1:return r=o.sent(),[2,[n.upsample(r)]]}}))}))},n.prototype.getType=function(){return"Upsample"},n.prototype.delete=function(){},n}(eo),Ia=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Va=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ca=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Ga=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return Ia(n,t),n.prototype.forward=function(t){return Va(this,void 0,void 0,(function(){var n,e,r;return Ca(this,(function(o){for(n=t[0],e=new Array(n.getShape().length-2),r=0;r<n.getShape().length-2;r++)e[r]=r+2;return[2,[n.reduceMean(e,!0)]]}))}))},n.prototype.getType=function(){return"GlobalAveragePool"},n.prototype.delete=function(){},n}(eo),Xa=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ea=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Abs",a)||this}return Xa(n,t),n.prototype.compute=function(t){return t.abs()},n}(Wo),Ra=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Da=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Log",a)||this}return Ra(n,t),n.prototype.compute=function(t){return t.log()},n}(Wo),Ua=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ba=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Sqrt",a)||this}return Ua(n,t),n.prototype.compute=function(t){return t.sqrt()},n}(Wo),za=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Wa=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Sign",a)||this}return za(n,t),n.prototype.compute=function(t){return t.sign()},n}(Wo),La=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fa=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Tan",a)||this}return La(n,t),n.prototype.compute=function(t){return t.tan()},n}(Wo),Na=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Atan",a)||this}return La(n,t),n.prototype.compute=function(t){return t.atan()},n}(Wo),qa=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"TanH",a)||this}return La(n,t),n.prototype.compute=function(t){return t.tanh()},n}(Wo),Ha=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ATanH",a)||this}return La(n,t),n.prototype.compute=function(t){return t.atanh()},n}(Wo),Ya=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ja=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Cos",a)||this}return Ya(n,t),n.prototype.compute=function(t){return t.cos()},n}(Wo),Ka=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Acos",a)||this}return Ya(n,t),n.prototype.compute=function(t){return t.acos()},n}(Wo),Qa=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Cosh",a)||this}return Ya(n,t),n.prototype.compute=function(t){return t.cosh()},n}(Wo),Za=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"AcosH",a)||this}return Ya(n,t),n.prototype.compute=function(t){return t.acosh()},n}(Wo),$a=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),tu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Sin",a)||this}return $a(n,t),n.prototype.compute=function(t){return t.sin()},n}(Wo),nu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Asin",a)||this}return $a(n,t),n.prototype.compute=function(t){return t.asin()},n}(Wo),eu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Sinh",a)||this}return $a(n,t),n.prototype.compute=function(t){return t.sinh()},n}(Wo),ru=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Asinh",a)||this}return $a(n,t),n.prototype.compute=function(t){return t.asinh()},n}(Wo),ou=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),iu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Sigmoid",a)||this}return ou(n,t),n.prototype.compute=function(t){return t.sigmoid()},n}(Wo),au=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),uu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceMin",a)||this}return au(n,t),n.prototype.calc=function(t){return t.min(this.axes,this.keepDims)},n}(Ui),su=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),pu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceProd",a)||this}return su(n,t),n.prototype.calc=function(t){return t.product(this.axes,this.keepDims)},n}(Ui),cu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),lu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceLogSum",a)||this}return cu(n,t),n.prototype.calc=function(t){return t.reduceLogSum(this.axes,this.keepDims)},n}(Ui),hu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),fu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceLogSumExp",a)||this}return hu(n,t),n.prototype.calc=function(t){return t.reduceLogSumExp(this.axes,this.keepDims)},n}(Ui),du=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),yu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceL2",a)||this}return du(n,t),n.prototype.calc=function(t){var n=t.sumSquare(this.axes,this.keepDims),e=n.sqrt();return n.delete(),e},n}(Ui),vu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),wu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"ReduceL1",a)||this}return vu(n,t),n.prototype.calc=function(t){var n=t.abs(),e=n.sum(this.axes,this.keepDims);return n.delete(),e},n}(Ui),mu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),gu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Pow",a)||this}return mu(n,t),n.prototype.compute=function(t,n){return t.power(n)},n}(jo),bu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),_u=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Identity",a)||this}return bu(n,t),n.prototype.compute=function(t){return t.copy()},n}(Wo),xu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ou=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,"HardSigmoid",a)||this;return u.alpha=u.getAttributeFloat("alpha")||.2,u.beta=u.getAttributeFloat("beta")||.5,u}return xu(n,t),n.prototype.compute=function(t){return t.hardSigmoid(this.alpha,this.beta)},n}(Wo),ku=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Su=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Neg",a)||this}return ku(n,t),n.prototype.compute=function(t){return t.negate()},n}(Wo),Au=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ju=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Reciprocal",a)||this}return Au(n,t),n.prototype.compute=function(t){return t.powerScalar(-1,1)},n}(Wo),Pu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Mu=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Tu=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Iu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return Pu(n,t),n.prototype.forward=function(t){return Mu(this,void 0,void 0,(function(){return Tu(this,(function(n){return[2,[t[0].squeeze()]]}))}))},n.prototype.getType=function(){return"Squeeze"},n.prototype.delete=function(){},n}(eo),Vu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Cu=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Gu=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Xu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return Vu(n,t),n.prototype.forward=function(t){return Cu(this,void 0,void 0,(function(){var n,e,r;return Gu(this,(function(o){return n=t[0],e=n.getShape(),r=g(e),[2,[new H([1],[r],"uint32")]]}))}))},n.prototype.getType=function(){return"Size"},n.prototype.delete=function(){},n}(eo),Eu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ru=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Du=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Uu=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.alpha=u.getAttributeFloat("alpha")||.01,u}return Eu(n,t),n.prototype.forward=function(t){return Ru(this,void 0,void 0,(function(){var n,e,r,o;return Du(this,(function(i){return n=t[0],e=n.clip(void 0,0),r=n.clip(0,void 0),o=e.add(r,this.alpha),e.delete(),r.delete(),[2,[o]]}))}))},n.prototype.delete=function(){},n.prototype.getType=function(){return"LeakyRelu"},n}(eo),Bu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),zu=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Wu=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Lu=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.alpha=u.getAttributeFloat("alpha")||1,u}return Bu(n,t),n.prototype.forward=function(t){return zu(this,void 0,void 0,(function(){var n,e,r,o,i,a;return Wu(this,(function(u){return n=t[0],e=n.clip(void 0,0),r=n.clip(0,void 0),o=e.exp(),e.delete(),i=o.addMultiplyScalar(this.alpha,-this.alpha),o.delete(),a=i.add(r),i.delete(),r.delete(),[2,[a]]}))}))},n.prototype.delete=function(){},n.prototype.getType=function(){return"Elu"},n}(eo),Fu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Nu=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},qu=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Hu=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return Fu(n,t),n.prototype.forward=function(t){return Nu(this,void 0,void 0,(function(){var n,e,r,o,i,a;return qu(this,(function(u){return n=t[0],e=t[1],r=n.clip(void 0,0),o=n.clip(0,void 0),i=r.multiply(e),r.delete(),a=i.add(o),i.delete(),o.delete(),[2,[a]]}))}))},n.prototype.delete=function(){},n.prototype.getType=function(){return"PRElu"},n}(eo),Yu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ju=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Ku=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Qu=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.alpha=u.getAttributeFloat("alpha")||1.6732631921768188,u.gamma=u.getAttributeFloat("gamma")||1.0507010221481323,u}return Yu(n,t),n.prototype.forward=function(t){return Ju(this,void 0,void 0,(function(){var n,e,r,o,i,a;return Ku(this,(function(u){return n=t[0],e=n.clip(void 0,0),r=n.clip(0,void 0),o=e.exp(),e.delete(),i=o.addMultiplyScalar(this.gamma*this.alpha,-this.alpha*this.gamma),o.delete(),a=i.add(r,1,this.gamma),i.delete(),r.delete(),[2,[a]]}))}))},n.prototype.delete=function(){},n.prototype.getType=function(){return"Selu"},n}(eo),Zu=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),$u=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ts=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ns=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this,s=u.getAttributeInt("axis");return null!==s&&(u.axis=s),u}return Zu(n,t),n.prototype.forward=function(t){return $u(this,void 0,void 0,(function(){return ts(this,(function(n){return[2,[t[0].flatten(this.axis)]]}))}))},n.prototype.getType=function(){return"Flatten"},n.prototype.delete=function(){},n}(eo),es=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),rs=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},os=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},is=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return es(n,t),n.prototype.forward=function(t){return rs(this,void 0,void 0,(function(){var n,e,r,o;return os(this,(function(i){return n=t[0],e=n.exp(),r=e.addScalar(1),e.delete(),o=r.log(),r.delete(),[2,[o]]}))}))},n.prototype.getType=function(){return"Softplus"},n.prototype.delete=function(){},n}(eo),as=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),us=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},ss=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ps=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return as(n,t),n.prototype.forward=function(t){return us(this,void 0,void 0,(function(){var n,e,r,o;return ss(this,(function(i){return n=t[0],e=n.abs(),r=e.addScalar(1),e.delete(),o=n.divide(r),r.delete(),[2,[o]]}))}))},n.prototype.getType=function(){return"Softsign"},n.prototype.delete=function(){},n}(eo),cs=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ls=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},hs=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},fs=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return cs(n,t),n.prototype.forward=function(t){return ls(this,void 0,void 0,(function(){var n,e,r;return hs(this,(function(o){for(t.length,n=t[0],e=1;e<t.length;e++)r=n.add(t[e]),e>1&&n.delete(),n=r;return[2,[n]]}))}))},n.prototype.getType=function(){return"Sum"},n.prototype.delete=function(){},n}(eo),ds=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ys=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},vs=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ws=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,a)||this}return ds(n,t),n.prototype.forward=function(t){return ys(this,void 0,void 0,(function(){var n,e,r,o;return vs(this,(function(i){for(t.length,n=t[0],e=1;e<t.length;e++)r=n.add(t[e]),e>1&&n.delete(),n=r;return o=n.multiplyScalar(1/t.length),t.length>2&&n.delete(),[2,[o]]}))}))},n.prototype.getType=function(){return"Mean"},n.prototype.delete=function(){},n}(eo),ms=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),gs=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},bs=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},_s=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.alpha=u.getAttributeFloat("alpha")||1,u}return ms(n,t),n.prototype.forward=function(t){return gs(this,void 0,void 0,(function(){var n,e,r,o,i,a,u;return bs(this,(function(s){return n=t[0],e=n.clip(void 0,0),r=n.clip(0,void 0),o=e.multiplyScalar(1/this.alpha),e.delete(),i=o.exp(),o.delete(),a=i.addMultiplyScalar(this.alpha,-this.alpha),i.delete(),u=a.add(r),a.delete(),r.delete(),[2,[u]]}))}))},n.prototype.delete=function(){},n.prototype.getType=function(){return"Celu"},n}(eo),xs=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Os=function(t){function n(n,e,r,o,i,a){return t.call(this,n,e,r,o,i,"Round",a)||this}return xs(n,t),n.prototype.compute=function(t){return t.round()},n}(Wo),ks=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ss=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},As=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},js=function(t){function n(n,e,r,o,i,a){var u=t.call(this,n,e,r,o,i,a)||this;return u.backend="CPU",u}return ks(n,t),n.prototype.forward=function(t){return Ss(this,void 0,void 0,(function(){var n,e,r,o,i,a;return As(this,(function(u){switch(u.label){case 0:return n=t[0],e=t[1],r=t[2],[4,this.toValues(n)];case 1:return o=u.sent()[0],[4,this.toValues(e)];case 2:return i=u.sent()[0],[4,this.toValues(r)];case 3:return a=u.sent()[0],"CPU"===this.backend?[2,[H.range(o,i,a)]]:"WASM"===this.backend?[2,[zr.range(o,i,a)]]:[2,[je.range(o,i,a)]]}}))}))},n.prototype.delete=function(){},n.prototype.getType=function(){return"Range"},n.prototype.toCPU=function(){return Ss(this,void 0,void 0,(function(){return As(this,(function(t){return this.backend="CPU",[2]}))}))},n.prototype.toWASM=function(){return Ss(this,void 0,void 0,(function(){return As(this,(function(t){return this.backend="WASM",[2]}))}))},n.prototype.toGPU=function(){return Ss(this,void 0,void 0,(function(){return As(this,(function(t){return this.backend="GPU",[2]}))}))},n}(eo),Ps={Conv:function(t,n,e,r,o,i){return new lo(t,n,e,r,o,i)},BatchNormalization:function(t,n,e,r,o,i){return new Go(t,n,e,r,o,i)},Clip:function(t,n,e,r,o,i){return new Yo(t,n,e,r,o,i)},Add:function(t,n,e,r,o,i){return new Mo(t,n,e,r,o,i)},Pow:function(t,n,e,r,o,i){return new gu(t,n,e,r,o,i)},ReduceMean:function(t,n,e,r,o,i){return new Li(t,n,e,r,o,i)},Gemm:function(t,n,e,r,o,i){return new bi(t,n,e,r,o,i)},Constant:function(t,n,e,r,o,i){return new uo(t,n,e,r,o,i)},Reshape:function(t,n,e,r,o,i){return new $i(t,n,e,r,o,i)},Range:function(t,n,e,r,o,i){return new js(t,n,e,r,o,i)},Flatten:function(t,n,e,r,o,i){return new ns(t,n,e,r,o,i)},Tile:function(t,n,e,r,o,i){return new ma(t,n,e,r,o,i)},MatMul:function(t,n,e,r,o,i){return new Mi(t,n,e,r,o,i)},Exp:function(t,n,e,r,o,i){return new ai(t,n,e,r,o,i)},Log:function(t,n,e,r,o,i){return new Da(t,n,e,r,o,i)},Sqrt:function(t,n,e,r,o,i){return new Ba(t,n,e,r,o,i)},Sign:function(t,n,e,r,o,i){return new Wa(t,n,e,r,o,i)},ReduceSum:function(t,n,e,r,o,i){return new Ni(t,n,e,r,o,i)},ReduceProd:function(t,n,e,r,o,i){return new pu(t,n,e,r,o,i)},ReduceMax:function(t,n,e,r,o,i){return new zi(t,n,e,r,o,i)},ReduceMin:function(t,n,e,r,o,i){return new uu(t,n,e,r,o,i)},ReduceSumSquare:function(t,n,e,r,o,i){return new Hi(t,n,e,r,o,i)},ReduceL2:function(t,n,e,r,o,i){return new yu(t,n,e,r,o,i)},ReduceL1:function(t,n,e,r,o,i){return new wu(t,n,e,r,o,i)},ReduceLogSum:function(t,n,e,r,o,i){return new lu(t,n,e,r,o,i)},ReduceLogSumExp:function(t,n,e,r,o,i){return new fu(t,n,e,r,o,i)},Sub:function(t,n,e,r,o,i){return new da(t,n,e,r,o,i)},Mul:function(t,n,e,r,o,i){return new Ii(t,n,e,r,o,i)},Div:function(t,n,e,r,o,i){return new oi(t,n,e,r,o,i)},Unsqueeze:function(t,n,e,r,o,i){return new Aa(t,n,e,r,o,i)},Concat:function(t,n,e,r,o,i){return new Zo(t,n,e,r,o,i)},Sum:function(t,n,e,r,o,i){return new fs(t,n,e,r,o,i)},Mean:function(t,n,e,r,o,i){return new ws(t,n,e,r,o,i)},ConstantOfShape:function(t,n,e,r,o,i){return new ei(t,n,e,r,o,i)},Expand:function(t,n,e,r,o,i){return new ci(t,n,e,r,o,i)},Squeeze:function(t,n,e,r,o,i){return new Iu(t,n,e,r,o,i)},InstanceNormalization:function(t,n,e,r,o,i){return new Si(t,n,e,r,o,i)},Pad:function(t,n,e,r,o,i){return new Xi(t,n,e,r,o,i)},Relu:function(t,n,e,r,o,i){return new Ji(t,n,e,r,o,i)},LeakyRelu:function(t,n,e,r,o,i){return new Uu(t,n,e,r,o,i)},Elu:function(t,n,e,r,o,i){return new Lu(t,n,e,r,o,i)},PRelu:function(t,n,e,r,o,i){return new Hu(t,n,e,r,o,i)},Selu:function(t,n,e,r,o,i){return new Qu(t,n,e,r,o,i)},Celu:function(t,n,e,r,o,i){return new _s(t,n,e,r,o,i)},Shape:function(t,n,e,r,o,i){return new oa(t,n,e,r,o,i)},Size:function(t,n,e,r,o,i){return new Xu(t,n,e,r,o,i)},Gather:function(t,n,e,r,o,i){return new vi(t,n,e,r,o,i)},Cast:function(t,n,e,r,o,i){return new Do(t,n,e,r,o,i)},Floor:function(t,n,e,r,o,i){return new hi(t,n,e,r,o,i)},Ceil:function(t,n,e,r,o,i){return new Fo(t,n,e,r,o,i)},Round:function(t,n,e,r,o,i){return new Os(t,n,e,r,o,i)},Abs:function(t,n,e,r,o,i){return new Ea(t,n,e,r,o,i)},Neg:function(t,n,e,r,o,i){return new Su(t,n,e,r,o,i)},Reciprocal:function(t,n,e,r,o,i){return new ju(t,n,e,r,o,i)},Identity:function(t,n,e,r,o,i){return new _u(t,n,e,r,o,i)},Sigmoid:function(t,n,e,r,o,i){return new iu(t,n,e,r,o,i)},HardSigmoid:function(t,n,e,r,o,i){return new Ou(t,n,e,r,o,i)},Sin:function(t,n,e,r,o,i){return new tu(t,n,e,r,o,i)},Cos:function(t,n,e,r,o,i){return new Ja(t,n,e,r,o,i)},Tan:function(t,n,e,r,o,i){return new Fa(t,n,e,r,o,i)},Asin:function(t,n,e,r,o,i){return new nu(t,n,e,r,o,i)},Acos:function(t,n,e,r,o,i){return new Ka(t,n,e,r,o,i)},Atan:function(t,n,e,r,o,i){return new Na(t,n,e,r,o,i)},Sinh:function(t,n,e,r,o,i){return new eu(t,n,e,r,o,i)},Cosh:function(t,n,e,r,o,i){return new Qa(t,n,e,r,o,i)},Tanh:function(t,n,e,r,o,i){return new qa(t,n,e,r,o,i)},Asinh:function(t,n,e,r,o,i){return new ru(t,n,e,r,o,i)},Acosh:function(t,n,e,r,o,i){return new Za(t,n,e,r,o,i)},Atanh:function(t,n,e,r,o,i){return new Ha(t,n,e,r,o,i)},Slice:function(t,n,e,r,o,i){return new sa(t,n,e,r,o,i)},Upsample:function(t,n,e,r,o,i){return new Ta(t,n,e,r,o,i)},Transpose:function(t,n,e,r,o,i){return new xa(t,n,e,r,o,i)},Softmax:function(t,n,e,r,o,i){return new ha(t,n,e,r,o,i)},Softplus:function(t,n,e,r,o,i){return new is(t,n,e,r,o,i)},Softsign:function(t,n,e,r,o,i){return new ps(t,n,e,r,o,i)},GlobalAveragePool:function(t,n,e,r,o,i){return new Ga(t,n,e,r,o,i)}},Ms=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ts=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Is=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Vs=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Cs=(function(t){function n(n,e){var r,o=t.call(this)||this;o.inputSet=new Set,o.nodes={},o.nodeIds=[],o.defaultReady=[],o.intermediaries={},o.constants={},o.nodeIdCounter=1e4,void 0===e&&(e={}),o.noConvertConstants=new Set(void 0!==e.noConvertConstants?e.noConvertConstants:[]),o.noConvertNodes=new Set(void 0!==e.noConvertNodes?e.noConvertNodes:[]),o.mode=e.mode||"inference",o.precision=e.precision||32,r=n instanceof ArrayBuffer?new Uint8Array(n):n,o.modelProto=Jr.onnx.ModelProto.decode(r);var i=o.modelProto.opsetImport[0].version;Yr.a.isLong(i)&&(i=i.toNumber()),o.version=i,o.inputs=o.modelProto.graph.input;for(var a=0;a<o.inputs.length;a++)o.inputSet.add(o.inputs[a].name);return o.outputs=o.modelProto.graph.output.map((function(t){return t.name})),o.initializer(o.modelProto.graph.initializer),o.initNodes(o.modelProto),o}Ms(n,t),n.prototype.initNodes=function(t){for(var n=this,e=0;e<t.graph.node.length;e++){var r=t.graph.node[e],o=Ps[r.opType];if(void 0===o)throw new Error("Node operator "+r.opType+" can not be resolved");var i=r.attribute||[],a=r.input||[],u=o(i,a,r.output||[],this.constants,this.version,this.mode);this.nodes[e]=u,this.nodeIds.push(e);for(var s=0;s<a.length;s++){var p=a[s];void 0===this.intermediaries[p]&&(this.intermediaries[p]={to:[],deletable:!0}),this.intermediaries[p].to.push(e)}0===u.variableInputs&&this.defaultReady.push(e),"Constant"===r.opType&&(void 0===this.intermediaries[r.output[0]]?this.intermediaries[r.output[0]]={to:[],deletable:!1}:this.intermediaries[r.output[0]].deletable=!1)}for(var c=0,l=this.nodeIds;c<l.length;c++){var h=l[c];this.nodes[h].initialize((function(t){return n.resolveConstant(t)}))}},n.prototype.initializer=function(t){for(var n=0;n<t.length;n++){var e=t[n],r=ro(e,16===this.precision);"train"===this.mode&&(r=new Wp(r)),this.constants[e.name]=r}},n.prototype.forward=function(t,n){return Ts(this,void 0,void 0,(function(){var e,r,o,i,a,u,s,p,c,l,h,f,d,y,v=this;return Is(this,(function(w){switch(w.label){case 0:for(e={},r={},o=0,i=this.nodeIds;o<i.length;o++)y=i[o],r[y]={variableInputs:0};a=Vs(this.defaultReady),this.initializeForward(t,e,r,a),w.label=1;case 1:if(!(a.length>0))return[3,8];u=a.shift(),s=this.nodes[u],p=this.getInputsToNode(s,e),c=p.inputs,l=p.toDelete,h=void 0,w.label=2;case 2:return w.trys.push([2,4,,5]),[4,s.forward(c)];case 3:return h=w.sent(),[3,5];case 4:throw f=w.sent(),console.error("Error occurred in node "+u+" with inputs "+s.inputs+" from nodes "+s.inputs.map((function(t){return v.getNodeWithOutput(t)}))),f;case 5:for(tt.flush(),this.propagateResults(s,e,h,r,a),y=0;y<l.length;y++)this.inputSet.has(l[y])||(e[l[y]].value.delete(),delete e[l[y]]);return void 0===n?[3,7]:[4,new Promise((function(t){setTimeout(t,n)}))];case 6:w.sent(),w.label=7;case 7:return[3,1];case 8:for(d=[],y=0;y<this.outputs.length;y++)d.push(e[this.outputs[y]].value);return[2,d]}}))}))},n.prototype.initializeForward=function(t,n,e,r){for(var o=0;o<t.length;o++){n[this.inputs[o].name]={value:t[o],used:0};for(var i=this.intermediaries[this.inputs[o].name],a=0;a<i.to.length;a++){var u=i.to[a];e[u].variableInputs++,e[u].variableInputs===this.nodes[u].variableInputs&&(r.push(u),delete e[u])}}},n.prototype.getInputsToNode=function(t,n){for(var e=[],r=[],o=0;o<t.inputs.length;o++){var i=t.inputs[o];if(void 0!==this.constants[i])e.push(this.constants[i]);else{var a=n[i];a.used++,a.used>=this.intermediaries[i].to.length&&this.intermediaries[i].deletable&&r.push(i),e.push(a.value)}}return{inputs:e,toDelete:r}},n.prototype.propagateResults=function(t,n,e,r,o){for(var i=0;i<t.outputs.length;i++){var a=t.outputs[i];n[a]={value:e[i],used:0};var u=this.intermediaries[a];if(void 0!==u)for(var s=0;s<u.to.length;s++){var p=u.to[s];r[p].variableInputs++,r[p].variableInputs===this.nodes[p].variableInputs&&(o.push(p),delete r[p])}}},n.prototype.toCPU=function(){return Ts(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return Is(this,(function(s){switch(s.label){case 0:for(n in t=[],this.constants)t.push(n);e=0,s.label=1;case 1:return e<t.length?(u=t[e],this.noConvertConstants.has(u)?[3,3]:(r=this.constants,o=u,[4,Fr(this.constants[u])])):[3,4];case 2:r[o]=s.sent(),s.label=3;case 3:return e++,[3,1];case 4:i=0,a=this.nodeIds,s.label=5;case 5:return i<a.length?(u=a[i],this.noConvertNodes.has(u)?[3,7]:[4,this.nodes[u].toCPU()]):[3,8];case 6:s.sent(),s.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},n.prototype.toWASM=function(){return Ts(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return Is(this,(function(s){switch(s.label){case 0:for(n in t=[],this.constants)t.push(n);e=0,s.label=1;case 1:return e<t.length?(u=t[e],this.noConvertConstants.has(u)?[3,3]:(r=this.constants,o=u,[4,Nr(this.constants[u])])):[3,4];case 2:r[o]=s.sent(),s.label=3;case 3:return e++,[3,1];case 4:i=0,a=this.nodeIds,s.label=5;case 5:return i<a.length?(u=a[i],this.noConvertNodes.has(u)?[3,7]:[4,this.nodes[u].toWASM()]):[3,8];case 6:s.sent(),s.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},n.prototype.toGPU=function(){return Ts(this,void 0,void 0,(function(){var t,n,e,r,o,i,a,u;return Is(this,(function(s){switch(s.label){case 0:for(n in t=[],this.constants)t.push(n);e=0,s.label=1;case 1:return e<t.length?(u=t[e],this.noConvertConstants.has(u)?[3,3]:(r=this.constants,o=u,[4,qr(this.constants[u])])):[3,4];case 2:r[o]=s.sent(),s.label=3;case 3:return e++,[3,1];case 4:i=0,a=this.nodeIds,s.label=5;case 5:return i<a.length?(u=a[i],this.noConvertNodes.has(u)?[3,7]:[4,this.nodes[u].toGPU()]):[3,8];case 6:s.sent(),s.label=7;case 7:return i++,[3,5];case 8:return[2]}}))}))},n.prototype.optimize=function(){for(var t=this,n=0,e=Oo;n<e.length;n++)for(var r=e[n],o=0,i=r.findApplications(this);o<i.length;o++){for(var a=i[o],u=a.map((function(n){return t.nodes[n]})),s=r.apply(u,(function(n){return t.resolveConstant(n)}),this.constants,this.version),p=new Set(s.outputs),c=0,l=a;c<l.length;c++){var h=l[c];this.removeNode(h,p)}this.insertNode(s)}this.prune()},n.prototype.prune=function(t){for(var n=this;;){var e=this.pruneIntermediaries(t);if(t=[],!(e.size>0))break;e.forEach((function(e){var r=n.removeNode(e,new Set);t=null===t||void 0===t?void 0:t.concat(r)}))}},n.prototype.pruneIntermediaries=function(t){var n=new Set;void 0===t&&(t=[]);for(var e=0;e<t.length;e++){var r=t[e],o=this.getNodeWithOutput(r);void 0!==o&&n.add(o);var i=this.getNodeWithInput(r);void 0!==i&&n.add(i)}var a=function(e){if(0===u.intermediaries[e].to.length&&void 0===u.outputs.find((function(t){return t===e}))){t.push(e);var r=u.getNodeWithOutput(e);void 0!==r&&n.add(r);var o=u.getNodeWithInput(e);void 0!==o&&n.add(o)}},u=this;for(var r in this.intermediaries)a(r);for(var s=0,p=t;s<p.length;s++){r=p[s];delete this.intermediaries[r]}return n},n.prototype.removeNode=function(t,n){for(var e=this.nodes[t],r=0,o=e.inputs;r<o.length;r++){var i=o[r];void 0!==this.intermediaries[i]&&(this.intermediaries[i].to=this.intermediaries[i].to.filter((function(n){return n.toString()!==t.toString()})))}var a=[];return n.has(e.outputs[0])||a.push(e.outputs[0]),this.nodeIds=this.nodeIds.filter((function(n){return n.toString()!==t.toString()})),this.nodes[t].delete(),delete this.nodes[t],this.defaultReady=this.defaultReady.filter((function(n){return n!==t})),a},n.prototype.insertNode=function(t){var n=this.nodeIdCounter++;this.nodeIds.push(n),this.nodes[n]=t;for(var e=0,r=t.inputs;e<r.length;e++){var o=r[e];this.intermediaries[o].to.push(n)}},n.prototype.getNodeWithOutput=function(t){for(var n=0,e=this.nodeIds;n<e.length;n++){var r=e[n];if(-1!==this.nodes[r].outputs.findIndex((function(n){return n===t})))return r}},n.prototype.getNodeWithInput=function(t){for(var n=0,e=this.nodeIds;n<e.length;n++){var r=e[n];if(-1!==this.nodes[r].inputs.findIndex((function(n){return n===t})))return r}},n.prototype.resolveConstant=function(t){if(void 0!==this.constants[t])return this.constants[t];var n=this.getNodeWithOutput(t),e=this.nodes[n];return e instanceof uo?e.tensor:void 0},n.prototype.getNodes=function(){return this.nodes},n.prototype.delete=function(){for(var t in this.constants)this.constants[t].delete();for(var n=0,e=this.nodeIds;n<e.length;n++){var r=e[n];this.nodes[r].delete()}},n.prototype.getSubModules=function(){for(var n=t.prototype.getSubModules.call(this),e=0,r=this.nodeIds;e<r.length;e++){var o=r[e];n.push(this.nodes[o])}return n},n.prototype.getParameters=function(){var n=t.prototype.getParameters.call(this);for(var e in this.constants)this.constants[e]instanceof Wp&&n.push(this.constants[e]);return n}}(Zr),function(){function t(t){this.model=t,this.parameters=t.getParameters()}return t.prototype.zeroGrads=function(){for(var t=0,n=this.parameters;t<n.length;t++){var e=n[t];void 0!==e.grad&&(e.grad.delete(),e.grad=void 0)}},t}()),Gs=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Xs=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return Gs(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("beta1")+" float beta1;\n    "+this.getVarModifier("beta2")+" float beta2;\n    "+this.getVarModifier("t")+" int t;\n    "},n.prototype.getFragmentShader=function(t){return"\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      float m1 = getValueAtPos(pos, widthMoments, heightMoments, Moments);\n      float m2 = getValueAtPos(pos+2, widthMoments, heightMoments, Moments);\n      float grad = getValueAtPos(pos/4, widthGrad, heightGrad, Grad);\n\n      m1 = beta1*m1 + (1.0-beta1)*grad;\n      m2 = beta2*m2 + (1.0-beta2)*grad*grad;\n\n      float m1Corr = m1/(1.0-pow(beta1, float(t)));\n      float m2Corr = m2/(1.0-pow(beta2, float(t)));\n\n      gl_FragColor = vec4(m1,m1Corr,m2,m2Corr);\n    }\n    "},n.prototype.getTextureNames=function(){return["Grad","Moments"]},n.prototype.getUniformAttrs=function(){return[{name:"beta1",type:"float"},{name:"beta2",type:"float"},{name:"t",type:"int"}]},n.prototype.calc=function(t){return this.compute(t.Moments.shape,{Grad:t.Grad,Moments:t.Moments},{beta1:t.beta1,beta2:t.beta2,t:t.t})},n.prototype.getOutputShape=function(t){return t.Moments.shape},n.prototype.compile=function(n){void 0!==n.shapeMoments&&(this.maxRank=n.shapeMoments.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeGrad:t.Grad.shape,widthGrad:t.Grad.memory.width,heightGrad:t.Grad.memory.height,shapeMoments:t.Moments.shape,widthMoments:t.Moments.memory.width,heightMoments:t.Moments.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,beta1:t.beta1,beta2:t.beta2}},n.prototype.getInputInfoString=function(t){return t.Grad.shape+"-"+t.Moments.shape+"-"+t.beta1+"-"+t.beta2},n}(ut),Es=new Bn((function(t){return new Xs(Pe,t)})),Rs=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ds=function(t){function n(n,e,r){var o=t.call(this,n,e,r)||this;return o.maxIterations=1e6,o}return Rs(n,t),n.prototype.getVariables=function(){return"\n    "+this.getVarModifier("alpha")+" float alpha;\n    "+this.getVarModifier("epsilon")+" float epsilon;\n    "},n.prototype.getFragmentShader=function(t){return"\n    float newVal(float m1Corr, float m2Corr, float value) {\n      return value - alpha*(m1Corr/(sqrt(m2Corr)+epsilon));\n    }\n\n    void main() {\n      initVars();\n\n      int pos = coordinateToPos(uv, widthOutput, heightOutput);\n\n      vec4 result = vec4(0,0,0,0);\n\n      float m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      float m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      float value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.r = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.g = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.b = newVal(m1Corr, m2Corr, value);\n\n      pos++;\n      m1Corr = getValueAtPos(pos*4+1, widthMoments, heightMoments, Moments);\n      m2Corr = getValueAtPos(pos*4+3, widthMoments, heightMoments, Moments);\n      value = getValueAtPos(pos, widthValue, heightValue, Value);\n      result.a = newVal(m1Corr, m2Corr, value);\n\n\n      gl_FragColor = result;\n    }\n    "},n.prototype.getTextureNames=function(){return["Value","Moments"]},n.prototype.getUniformAttrs=function(){return[{name:"alpha",type:"float"},{name:"epsilon",type:"float"}]},n.prototype.calc=function(t){return this.compute(t.Value.shape,{Value:t.Value,Moments:t.Moments},{alpha:t.alpha,epsilon:t.epsilon})},n.prototype.getOutputShape=function(t){return t.Value.shape},n.prototype.compile=function(n){void 0!==n.shapeMoments&&(this.maxRank=n.shapeMoments.length),t.prototype.compile.call(this,n)},n.prototype.getCompilationInfo=function(t){var n=this.getOutputShape(t),e=et.getAllocationDimensions(g(n),this.dtype);return{shapeValue:t.Value.shape,widthValue:t.Value.memory.width,heightValue:t.Value.memory.height,shapeMoments:t.Moments.shape,widthMoments:t.Moments.memory.width,heightMoments:t.Moments.memory.height,shapeOutput:n,widthOutput:e.width,heightOutput:e.height,alpha:t.alpha,epsilon:t.epsilon}},n.prototype.getInputInfoString=function(t){return t.Value.shape+"-"+t.Moments.shape+"-"+t.alpha+"-"+t.epsilon},n}(ut),Us=new Bn((function(t){return new Ds(Pe,t)})),Bs=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),zs=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},Ws=function(t){function n(n,e,r,o,i){void 0===e&&(e=.001),void 0===r&&(r=.9),void 0===o&&(o=.999),void 0===i&&(i=1e-7);var a=t.call(this,n)||this;a.lr=e,a.beta1=r,a.beta2=o,a.epsilon=i,a.t=0;var u=a.parameters;if(u[0].value instanceof je){a.moments=new Array(u.length);for(var s=0;s<u.length;s++)a.moments[s]=new je(new Array(4*u[s].value.size).fill(0),zs(u[s].getShape(),[4]),u[s].value.dtype)}else a.moment1=new Array(u.length).fill(void 0),a.moment2=new Array(u.length).fill(void 0);return a}return Bs(n,t),n.prototype.step=function(){if(this.t++,void 0!==this.moment1&&void 0!==this.moment2)for(var t=0;t<this.parameters.length;t++){if(void 0!==(a=this.parameters[t]).grad){var n=a.value,e=this.paramStep(a.value,a.grad,this.moment1[t],this.moment2[t]),r=e.newValue,o=e.moment1,i=e.moment2;a.value=r,this.moment1[t]=o,this.moment2[t]=i,n.delete()}}else if(void 0!==this.moments)for(t=0;t<this.parameters.length;t++){var a;if(void 0!==(a=this.parameters[t]).grad){n=a.value;var u=this.gpuParamStep(a.value,a.grad,this.moments[t]),s=(r=u.newValue,u.moments);a.value=r,this.moments[t]=s,n.delete()}}},n.prototype.updateMoments=function(t,n,e){var r,o;if(void 0===n)r=t.multiplyScalar(1-this.beta1);else{var i=n;r=n.add(t,this.beta1,1-this.beta1),i.delete()}if(void 0===e)o=t.multiply(t,1-this.beta2);else{var a=t.multiply(t),u=e;o=e.add(a,this.beta2,1-this.beta2),a.delete(),u.delete()}return{moment1New:r,moment2New:o}},n.prototype.getCorrectedMoments=function(t,n){return{correctMoment1:t.addMultiplyScalar(1/(1-Math.pow(this.beta1,this.t)),0),correctMoment2:n.addMultiplyScalar(1/(1-Math.pow(this.beta2,this.t)),0)}},n.prototype.paramStep=function(t,n,e,r){var o=this.updateMoments(n,e,r),i=o.moment1New,a=o.moment2New.addMultiplyScalar(1/(1-Math.pow(this.beta2,this.t)),this.epsilon),u=a.sqrt();a.delete();var s=i.divide(u,-this.lr/(1-Math.pow(this.beta1,this.t)));u.delete();var p=t.add(s);return s.delete(),{newValue:p,moment1:e,moment2:r}},n.prototype.gpuParamStep=function(t,n,e){var r=Es.calc({Grad:n,Moments:e,beta1:this.beta1,beta2:this.beta2,t:this.t},t.dtype);return e.delete(),{newValue:Us.calc({Value:t,Moments:r,alpha:this.lr,epsilon:this.epsilon},t.dtype),moments:r}},n}(Cs),Ls=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fs=function(t){function n(n,e){void 0===e&&(e=.001);var r=t.call(this,n)||this;return r.lr=e,r}return Ls(n,t),n.prototype.step=function(){for(var t=0,n=this.parameters;t<n.length;t++){var e=n[t];if(void 0!==e.grad){var r=e.value;e.value=e.value.subtract(e.grad,1,this.lr),r.delete()}}},n}(Cs);var Ns=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),qs=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Ns(n,t),n.prototype.getOp=function(t,n){return n+" == 1.0 ? -1.0/"+t+" : 1.0/(1.0-"+t+")"},n}(_t),Hs=new Bn((function(t){return new qs(Pe,t)}));!function(){function t(t,n){this.x=t,this.y=n}t.prototype.backward=function(t){var n,e,r;if(t instanceof H){var o=(e=this.x.value,r=this.y.value,V(e,r,(function(t,n){return 1===n?-1/t:1/(1-t)}),e.shape));n=t.multiply(o),o.delete()}else if(t instanceof zr){o=this.x.value.wasmTensor.bce_back(this.y.value.wasmTensor);n=new zr(t.wasmTensor.multiply(o,1),t.dtype),o.free()}else{o=Hs.calc({A:this.x.value,B:this.y.value,outputShape:this.x.getShape()},this.x.value.dtype);n=t.multiply(o),o.delete()}this.x.backward(n)||n.delete()},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete(),this.y.isLeaf()||this.y.delete()}}();var Ys=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Js=function(t){function n(n,e,r){return t.call(this,n,e,r)||this}return Ys(n,t),n.prototype.getOp=function(t,n){return n+" == 1.0 ? -log("+t+") : -log(1.0-"+t+")"},n}(_t);new Bn((function(t){return new Js(Pe,t)}));(function(){function t(t,n){this.model=t,this.gamma=n,this.parameters=t.getParameters()}t.prototype.getLoss=function(){for(var t=this.parameters[0].sumSquare(),n=this.gamma,e=1;e<this.parameters.length;e++)t=t.add(this.parameters[e].sumSquare(),n,this.gamma),n/=n;return t}})(),function(){function t(t,n){this.model=t,this.gamma=n,this.parameters=t.getParameters()}t.prototype.getLoss=function(){for(var t=this.parameters[0].abs().sum(),n=this.gamma,e=1;e<this.parameters.length;e++)t=t.add(this.parameters[e].abs().sum(),n,this.gamma),n/=n;return t}}();var Ks=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.sign(),e=t.multiply(n);n.delete(),this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Qs=function(){function t(t,n){this.input=t,this.exp=n}return t.prototype.backward=function(t){var n=t.multiply(this.exp);this.input.backward(n)||n.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Zs=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=t.divide(this.input.value);this.input.backward(n)||n.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),$s=function(){function t(t,n){this.a=t,this.b=n}return t.prototype.backward=function(t){if(!this.b.noGrad){var n=this.a.value.gemm(t,!0,!1);this.b.backward(n)||n.delete()}if(!this.a.noGrad){var e=t.gemm(this.b.value,!1,!0);this.a.backward(e)||e.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),tp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=t.negate();this.input.backward(n)||n.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),np=function(){function t(t,n){this.input=t,this.sqrt=n}return t.prototype.backward=function(t){var n=t.divide(this.sqrt,.5);this.input.backward(n)||n.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),ep=function(){function t(t,n,e){this.a=t,this.b=n,this.axis=e}return t.prototype.backward=function(t){var n=this.axis;if(n<0&&(n+=this.a.getShape().length),!this.a.noGrad){var e=t.slice([0],[this.a.getShape()[n]],[n]);this.a.backward(e)||e.delete()}if(!this.b.noGrad){var r=t.slice([this.a.getShape()[n]],[t.getShape()[n]],[n]);this.b.backward(r)||r.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),rp=function(){function t(t,n,e){this.input=t,this.min=n,this.max=e}return t.prototype.backward=function(t){var n=this.input.value.clipBackward(t,this.min,this.max);this.input.backward(n)||n.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),op=function(){function t(t,n){this.a=t,this.repeats=n}return t.prototype.backward=function(t){for(var n=this.a.getShape(),e=[],r=[],o=0;o<n.length;o++)e.push(this.repeats[o],n[o]),r.push(2*o);var i=t.reshape(e,!1).sum(r,!1);this.a.backward(i)||i.delete()},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),ip=function(){function t(t,n){this.a=t,this.shape=n}return t.prototype.backward=function(t){for(var n=this.a.value.alignShapes(this.a.getShape(),this.shape),e=n[0],r=n[1],o=(n[2],[]),i=0;i<e.length;i++)e[i]<r[i]&&o.push(i);var a=t.sum(o).reshape(this.a.getShape());this.a.backward(a)||a.delete()},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),ap=function(){function t(t){this.a=t}return t.prototype.backward=function(t){var n=this.a.getShape();if(!this.a.noGrad){var e=t.reshape(n);this.a.backward(e)||e.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),up=function(){function t(t,n,e,r,o){this.a=t,this.b=n,this.shape=e,this.alpha=r,this.beta=o}return t.prototype.backward=function(t){for(var n=this.a.getShape(),e=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)n[i]<this.shape[i]&&r.push(i),e[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=1===this.alpha?t.reshape(n):t.multiplyScalar(this.alpha).reshape(n,!1);else if(1===this.alpha)a=t.sum(r).reshape(n,!1);else{var u=(p=t.sum(r)).multiplyScalar(this.alpha);p.delete(),a=u.reshape(n,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var s=void 0;if(0===o.length)s=1===this.beta?t.reshape(e):t.multiplyScalar(this.beta).reshape(e,!1);else if(1===this.beta)s=t.sum(o).reshape(e,!1);else{var p;u=(p=t.sum(o)).multiplyScalar(this.beta);p.delete(),s=u.reshape(e,!1)}this.b.backward(s)||s.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),sp=function(){function t(t,n,e,r,o){this.a=t,this.b=n,this.shape=e,this.alpha=r,this.beta=o}return t.prototype.backward=function(t){for(var n=this.a.getShape(),e=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)n[i]<this.shape[i]&&r.push(i),e[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=1===this.alpha?t.reshape(n):t.multiplyScalar(this.alpha).reshape(n,!1);else if(1===this.alpha)a=t.sum(r).reshape(n,!1);else{var u=(p=t.sum(r)).multiplyScalar(this.alpha);p.delete(),a=u.reshape(n,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var s=void 0;if(0===o.length)s=t.multiplyScalar(-this.beta).reshape(e,!1);else{var p;u=(p=t.sum(o)).multiplyScalar(-this.beta);p.delete(),s=u.reshape(e,!1)}this.b.backward(s)||s.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),pp=function(){function t(t,n,e,r){this.a=t,this.b=n,this.shape=e,this.alpha=r}return t.prototype.backward=function(t){for(var n=this.a.getShape(),e=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)n[i]<this.shape[i]&&r.push(i),e[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=t.multiply(this.b.value,this.alpha).reshape(n,!1);else{var u=(p=t.multiply(this.b.value,this.alpha)).sum(r);p.delete(),a=u.reshape(n,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var s=void 0;if(0===o.length)s=t.multiply(this.a.value,this.alpha).reshape(e,!1);else{var p;u=(p=t.multiply(this.a.value,this.alpha)).sum(o);p.delete(),s=u.reshape(e,!1)}this.b.backward(s)||s.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),cp=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],a=0,u=i.length;a<u;a++,o++)r[o]=i[a];return r},lp=function(){function t(t,n,e,r,o,i,a){this.x=t,this.w=n,this.strides=e,this.padding=r,this.dilations=o,this.group=i,this.b=a}return t.prototype.backward=function(t){if(!this.w.noGrad){var n=this.x.value.conv(t,void 0,this.strides,this.group,this.padding,this.dilations);this.w.backward(n)||n.delete()}if(void 0!==this.b&&!this.b.noGrad){for(var e=[0],r=0;r<this.dilations.length;r++)e.push(r+2);var o=t.sum(e);this.b.backward(o)||o.delete()}if(!this.x.noGrad){var i=this.w.getShape(),a=[];for(r=0;r<this.dilations.length;r++)a.push(i[r+2]-this.padding[r]+this.dilations[r]-2);a=cp(a,a);var u=t.convTranspose(this.w.value,this.dilations,this.group,a,this.strides);this.x.backward(u)||u.delete()}},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete(),this.w.isLeaf()||this.w.delete(),void 0===this.b||this.b.isLeaf()||this.b.delete()},t}(),hp=function(){function t(t,n,e,r,o){this.a=t,this.b=n,this.divResult=e,this.shape=r,this.alpha=o}return t.prototype.backward=function(t){for(var n=this.a.getShape(),e=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)n[i]<this.shape[i]&&r.push(i),e[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length)a=t.divide(this.b.value,this.alpha).reshape(n,!1);else{var u=t.divide(this.b.value,this.alpha),s=u.sum(r);u.delete(),a=s.reshape(n,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var p=void 0;if(0===o.length){var c=(l=t.multiply(this.divResult)).divide(this.b.value,-this.alpha);l.delete(),p=c.reshape(e,!1)}else{var l;c=(l=t.multiply(this.divResult)).divide(this.b.value,-this.alpha);l.delete();s=c.sum(o);c.delete(),p=s.reshape(e,!1)}this.b.backward(p)||p.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),fp=function(){function t(t,n,e,r){this.a=t,this.b=n,this.powerResult=e,this.shape=r}return t.prototype.backward=function(t){for(var n=this.a.getShape(),e=this.b.getShape(),r=[],o=[],i=0;i<this.shape.length;i++)n[i]<this.shape[i]&&r.push(i),e[i]<this.shape[i]&&o.push(i);if(!this.a.noGrad){var a=void 0;if(0===r.length){var u=(p=this.powerResult.multiply(this.b.value)).divide(this.a.value);p.delete();var s=t.multiply(u);u.delete(),a=s.reshape(n,!1)}else{var p;u=(p=this.powerResult.multiply(this.b.value)).divide(this.a.value);p.delete();s=t.multiply(u);u.delete();var c=s.sum(r);s.delete(),a=c.reshape(n,!1)}this.a.backward(a)||a.delete()}if(!this.b.noGrad){var l=void 0;if(0===o.length){var h=this.a.value.log(),f=this.powerResult.multiply(h);h.delete(),l=t.multiply(f),f.delete(),l=l.reshape(e,!1)}else{h=this.a.value.log(),f=this.powerResult.multiply(h);h.delete();var d=t.multiply(f);f.delete();c=d.sum(o);d.delete(),l=c.reshape(e,!1)}this.b.backward(l)||l.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete()},t}(),dp=function(){function t(t,n,e,r,o,i,a){this.a=t,this.b=n,this.transA=e,this.transB=r,this.alpha=o,this.beta=i,this.c=a}return t.prototype.backward=function(t){if(!this.b.noGrad){var n=void 0;n=this.transB?t.gemm(this.a.value,!0,this.transA,this.alpha):this.a.value.gemm(t,!this.transA,!1,this.alpha),this.b.backward(n)||n.delete()}if(!this.a.noGrad){var e=void 0;e=this.transA?this.b.value.gemm(t,this.transB,!0,this.alpha):t.gemm(this.b.value,!1,!this.transB,this.alpha),this.a.backward(e)||e.delete()}if(void 0!==this.c&&!this.c.noGrad){for(var r=t.getShape(),o=this.c.getShape(),i=[],a=0;a<r.length;a++)o[a]<r[a]&&i.push(a);var u=t.sum(i).reshape(o,!1);if(1!==this.beta){var s=u;u=u.multiplyScalar(this.beta),s.delete()}this.c.backward(u)||u.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete(),this.b.isLeaf()||this.b.delete(),void 0===this.c||this.c.isLeaf()||this.c.delete()},t}(),yp=function(){function t(t,n){this.a=t,this.permutation=n}return t.prototype.backward=function(t){for(var n=new Array(this.permutation.length),e=0;e<this.permutation.length;e++)n[this.permutation[e]]=e;var r=t.transpose(n);this.a.backward(r)||r.delete()},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),vp=function(){function t(t,n,e){this.input=t,this.sumDims=n,this.keepDims=e}return t.prototype.backward=function(t){var n=this.input.value.getShape();if(!this.keepDims){for(var e=[],r=0,o=0;o<n.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(e.push(1),r++):e.push(n[o]);t=t.reshape(e,!1)}t=t.expand(n),this.input.backward(t)||t.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),wp=function(){function t(t,n,e){this.input=t,this.sumDims=n,this.keepDims=e}return t.prototype.backward=function(t){var n=this.input.value.getShape();if(!this.keepDims){for(var e=[],r=0,o=0;o<n.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(e.push(1),r++):e.push(n[o]);t=t.reshape(e,!1)}var i=t.expand(n),a=i.multiply(this.input.value,2);i.delete(),this.input.backward(a)||a.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),mp=function(){function t(t,n){this.input=t,this.scalar=n}return t.prototype.backward=function(t){var n=t.multiplyScalar(this.scalar);this.input.backward(n)||n.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),gp=function(){function t(t,n,e){this.input=t,this.sumDims=n,this.keepDims=e}return t.prototype.backward=function(t){var n=this.input.value.getShape();if(!this.keepDims){for(var e=[],r=0,o=0;o<n.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(e.push(1),r++):e.push(n[o]);t=t.reshape(e,!1)}var i=1;for(o=0;o<this.sumDims.length;o++)i*=n[this.sumDims[o]];var a=t.multiplyScalar(1/i),u=a.expand(n);a.delete,this.input.backward(u)||t.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),bp=function(){function t(t,n,e){this.input=t,this.sumDims=n,this.keepDims=e}return t.prototype.backward=function(t){var n=this.input.value.getShape();if(!this.keepDims){for(var e=[],r=0,o=0;o<n.length;o++)r<this.sumDims.length&&this.sumDims[r]===o?(e.push(1),r++):e.push(n[o]);t=t.reshape(e,!1)}var i=1;for(o=0;o<this.sumDims.length;o++)i*=n[this.sumDims[o]];var a=t.expand(n),u=a.multiply(this.input.value,2/i);a.delete(),this.input.backward(u)||u.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),_p=function(){function t(t,n,e,r,o){if(this.a=t,this.starts=n,this.ends=e,this.axes=r,this.steps=o,void 0!==o.find((function(t){return 1!==t})))throw new Error("Slice backward pass only supports step size of 1")}return t.prototype.backward=function(t){if(!this.a.noGrad){for(var n=this.a.getShape(),e=n.length,r=new Array(2*e).fill(0),o=0;o<this.axes.length;o++)r[this.axes[o]]=this.starts[o],r[e+this.axes[o]]=n[this.axes[o]]-this.ends[o];var i=t.pad(r,"constant",0);this.a.backward(i)||i.delete()}},t.prototype.delete=function(){this.a.isLeaf()||this.a.delete()},t}(),xp=function(){function t(t,n,e,r,o){this.x=t}return t.prototype.backward=function(t){throw new Error("Backward pass not implemented for average pool")},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete()},t}(),Op=function(){function t(t,n,e,r){this.x=t,this.pads=n,this.mode=e,this.value=r}return t.prototype.backward=function(t){throw new Error("Backward pass not implemented for pad")},t.prototype.delete=function(){this.x.isLeaf()||this.x.delete()},t}(),kp=function(){function t(t,n,e,r){this.input=t,this.product=n,this.sumDims=e,this.keepDims=r}return t.prototype.backward=function(t){var n=this.input.value.getShape(),e=t.multiply(this.product);if(!this.keepDims){for(var r=[],o=0,i=0;i<n.length;i++)o<this.sumDims.length&&this.sumDims[o]===i?(r.push(1),o++):r.push(n[i]);e=e.reshape(r,!1)}var a=e.expand(n);e.delete();var u=a.divide(this.input.value);a.delete(),this.input.backward(u)||u.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Sp=function(){function t(t,n){this.input=t,this.sigmoid=n}return t.prototype.backward=function(t){var n=this.sigmoid.addMultiplyScalar(-1,1),e=this.sigmoid.multiply(n);n.delete();var r=e.multiply(t);e.delete(),this.input.backward(r)||r.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Ap=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.cos(),e=t.multiply(n);n.delete(),this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),jp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.multiply(this.input.value),e=n.addMultiplyScalar(-1,1);n.delete();var r=e.sqrt();e.delete();var o=t.divide(r);r.delete(),this.input.backward(o)||o.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Pp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.cosh(),e=t.multiply(n);n.delete(),this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Mp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.multiply(this.input.value),e=n.addMultiplyScalar(1,1);n.delete();var r=e.sqrt();e.delete();var o=t.divide(r);r.delete(),this.input.backward(o)||o.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Tp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.sin(),e=t.multiply(n,-1);n.delete(),this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Ip=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.multiply(this.input.value),e=n.addMultiplyScalar(-1,1);n.delete();var r=e.sqrt();e.delete();var o=t.divide(r,-1);r.delete(),this.input.backward(o)||o.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Vp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.sinh(),e=t.multiply(n);n.delete(),this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Cp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.multiply(this.input.value),e=n.addMultiplyScalar(1,-1);n.delete();var r=e.sqrt();e.delete();var o=t.divide(r);r.delete(),this.input.backward(o)||o.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Gp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.cos(),e=n.multiply(n);n.delete();var r=t.divide(e);e.delete(),this.input.backward(r)||r.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Xp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.multiply(this.input.value),e=n.addMultiplyScalar(1,1);n.delete();var r=t.divide(e);e.delete(),this.input.backward(r)||r.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Ep=function(){function t(t,n){this.input=t,this.tanH=n}return t.prototype.backward=function(t){var n=this.tanH.multiply(this.tanH),e=n.addMultiplyScalar(-1,1);n.delete();var r=t.multiply(e);e.delete(),this.input.backward(r)||r.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Rp=function(){function t(t){this.input=t}return t.prototype.backward=function(t){var n=this.input.value.multiply(this.input.value),e=n.addMultiplyScalar(-1,1);n.delete();var r=t.divide(e);e.delete(),this.input.backward(r)||r.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Dp=function(){function t(t,n,e){this.input=t,this.sumDims=n,this.keepDims=e}return t.prototype.backward=function(t){var n=this.input.value.getShape(),e=this.input.value.sum(this.sumDims,this.keepDims),r=t.divide(e);if(e.delete(),!this.keepDims){for(var o=[],i=0,a=0;a<n.length;a++)i<this.sumDims.length&&this.sumDims[i]===a?(o.push(1),i++):o.push(n[a]);r=r.reshape(o,!1)}var u=r.expand(n);r.delete(),this.input.backward(u)||u.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Up=function(){function t(t,n,e){this.input=t,this.sumDims=n,this.keepDims=e}return t.prototype.backward=function(t){var n=this.input.value.getShape(),e=this.input.value.exp(),r=e.sum(this.sumDims,!0),o=e.divide(r);if(e.delete(),r.delete(),!this.keepDims){for(var i=[],a=0,u=0;u<n.length;u++)a<this.sumDims.length&&this.sumDims[a]===u?(i.push(1),a++):i.push(n[u]);t=t.reshape(i,!1)}var s=t.expand(n),p=s.multiply(o);s.delete(),this.input.backward(p)||p.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),Bp=function(){function t(t,n,e){this.input=t,this.power=n,this.factor=e}return t.prototype.backward=function(t){var n=this.input.value.powerScalar(this.power-1,this.factor*this.power),e=t.multiply(n);n.delete(),this.input.backward(e)||e.delete()},t.prototype.delete=function(){this.input.isLeaf()||this.input.delete()},t}(),zp=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Wp=function(t){function n(n,e){var r=t.call(this,n.dtype)||this;return r.value=n,void 0===e&&(e={}),r.grad=e.grad,void 0!==e.backEdge&&(r.backEdge=e.backEdge),r.noGrad=e.noGrad||!1,r}return zp(n,t),n.create=function(t,e,r,o,i){return void 0===i&&(i="float32"),new n("CPU"===r?new H(t,e):"WASM"===r?new zr(e,new Uint32Array(t),i):new je(e,t,i),o)},n.fromData=function(t,e){return new n(je.fromData(t),e)},n.prototype.cast=function(t){throw new Error("Method not implemented.")},n.prototype.backward=function(t){if(void 0===t){var n=this.value.getShape();if(1!==n.length||1!==n[0])throw new Error("Backward without an input gradient can only be done for tensors with shape [1]");t=this.value}var e=!1;if(void 0!==this.grad){var r=this.grad;this.grad=this.grad.add(t),r.delete()}else this.grad=t,e=!0;return void 0!==this.backEdge&&this.backEdge.backward(t),e},n.prototype.isLeaf=function(){return void 0===this.backEdge},n.prototype.constantLike=function(t){return new n(this.value.constantLike(t),{noGrad:!0})},n.prototype.singleConstant=function(t){return new n(this.value.singleConstant(t),{noGrad:!0})},n.prototype.getValues=function(){return this.value.getValues()},n.prototype.getShape=function(){return this.value.getShape()},n.prototype.delete=function(){this.value.delete(),void 0!==this.grad&&this.grad.delete(),void 0!==this.backEdge&&this.backEdge.delete()},n.prototype.reshape_impl=function(t,e){return new n(this.value.reshape(t),{backEdge:this.noGrad?void 0:new ap(this),noGrad:this.noGrad})},n.prototype.exp=function(){var t=this.value.exp();return new n(t,{backEdge:this.noGrad?void 0:new Qs(this,t),noGrad:this.noGrad})},n.prototype.log=function(){return new n(this.value.log(),{backEdge:this.noGrad?void 0:new Zs(this),noGrad:this.noGrad})},n.prototype.sqrt=function(){var t=this.value.sqrt();return new n(t,{backEdge:this.noGrad?void 0:new np(this,t),noGrad:this.noGrad})},n.prototype.abs=function(){return new n(this.value.abs(),{backEdge:this.noGrad?void 0:new Ks(this),noGrad:this.noGrad})},n.prototype.sin=function(){return new n(this.value.sin(),{backEdge:this.noGrad?void 0:new Ap(this),noGrad:this.noGrad})},n.prototype.cos=function(){return new n(this.value.cos(),{backEdge:this.noGrad?void 0:new Tp(this),noGrad:this.noGrad})},n.prototype.tan=function(){return new n(this.value.tan(),{backEdge:this.noGrad?void 0:new Gp(this),noGrad:this.noGrad})},n.prototype.asin=function(){return new n(this.value.asin(),{backEdge:this.noGrad?void 0:new jp(this),noGrad:this.noGrad})},n.prototype.acos=function(){return new n(this.value.acos(),{backEdge:this.noGrad?void 0:new Ip(this),noGrad:this.noGrad})},n.prototype.atan=function(){return new n(this.value.atan(),{backEdge:this.noGrad?void 0:new Xp(this),noGrad:this.noGrad})},n.prototype.sinh=function(){return new n(this.value.sinh(),{backEdge:this.noGrad?void 0:new Pp(this),noGrad:this.noGrad})},n.prototype.cosh=function(){return new n(this.value.cosh(),{backEdge:this.noGrad?void 0:new Vp(this),noGrad:this.noGrad})},n.prototype.tanh=function(){var t=this.value.tanh();return new n(t,{backEdge:this.noGrad?void 0:new Ep(this,t),noGrad:this.noGrad})},n.prototype.asinh=function(){return new n(this.value.asinh(),{backEdge:this.noGrad?void 0:new Mp(this),noGrad:this.noGrad})},n.prototype.acosh=function(){return new n(this.value.acosh(),{backEdge:this.noGrad?void 0:new Cp(this),noGrad:this.noGrad})},n.prototype.atanh=function(){return new n(this.value.atanh(),{backEdge:this.noGrad?void 0:new Rp(this),noGrad:this.noGrad})},n.prototype.sigmoid=function(){var t=this.value.sigmoid();return new n(t,{backEdge:this.noGrad?void 0:new Sp(this,t),noGrad:this.noGrad})},n.prototype.hardSigmoid=function(t,n){throw new Error("Method not implemented.")},n.prototype.sign=function(){return new n(this.value.sign())},n.prototype.negate=function(){return new n(this.value.negate(),{backEdge:this.noGrad?void 0:new tp(this),noGrad:this.noGrad})},n.prototype.addMultiplyScalar=function(t,e){return new n(this.value.addMultiplyScalar(t,e),{backEdge:this.noGrad?void 0:new mp(this,t),noGrad:this.noGrad})},n.prototype.powerScalar=function(t,e){return new n(this.value.powerScalar(t,e),{backEdge:this.noGrad?void 0:new Bp(this,t,e),noGrad:this.noGrad})},n.prototype.setValues=function(t,n){throw new Error("Method not implemented.")},n.prototype.matMul=function(t){if(!(t instanceof n))throw new Error("MatMul can only be done with another variable");var e=this.noGrad&&t.noGrad;return new n(this.value.matMul(t.value),{backEdge:e?void 0:new $s(this,t),noGrad:e})},n.prototype.concat=function(t,e){if(!(t instanceof n))throw new Error("Concat can only be done with another variable");var r=this.noGrad&&t.noGrad;return new n(this.value.concat(t.value,e),{backEdge:r?void 0:new ep(this,t,e),noGrad:r})},n.prototype.clip=function(t,e){return new n(this.value.clip(t,e),{backEdge:this.noGrad?void 0:new rp(this,t,e),noGrad:this.noGrad})},n.prototype.clipBackward=function(t,n,e){throw new Error("Clip backward not implemented for Variable")},n.prototype.repeat=function(t){return new n(this.value.repeat(t),{backEdge:this.noGrad?void 0:new op(this,t),noGrad:this.noGrad})},n.prototype.expand=function(t){return new n(this.value.expand(t),{backEdge:this.noGrad?void 0:new ip(this,t),noGrad:this.noGrad})},n.prototype.copy=function(){return new n(this.value.copy(),{grad:void 0!==this.grad?this.grad.copy():void 0})},n.prototype.gather=function(t,n){throw new Error("Method not implemented.")},n.prototype.floor=function(){return new n(this.value.floor())},n.prototype.ceil=function(){return new n(this.value.ceil())},n.prototype.round=function(){return new n(this.value.round())},n.prototype.upsample=function(t){throw new Error("Method not implemented.")},n.prototype.normalize=function(t,n,e,r,o){throw new Error("Method not implemented.")},n.prototype.add_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add Variable tensor to Variable tensor");var a=t.noGrad&&e.noGrad;return new n(t.value.add_impl(t.value,e.value,r,o,i),{backEdge:a?void 0:new up(t,e,r,o,i),noGrad:a})},n.prototype.subtract_impl=function(t,e,r,o,i){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add Variable tensor to Variable tensor");var a=t.noGrad&&e.noGrad;return new n(t.value.subtract_impl(t.value,e.value,r,o,i),{backEdge:a?void 0:new sp(t,e,r,o,i),noGrad:a})},n.prototype.multiply_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only add Variable tensor to Variable tensor");var i=t.noGrad&&e.noGrad;return new n(t.value.multiply_impl(t.value,e.value,r,o),{backEdge:i?void 0:new pp(t,e,r,o),noGrad:i})},n.prototype.divide_impl=function(t,e,r,o){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only divide Variable tensor by Variable tensor");var i=t.value.divide_impl(t.value,e.value,r,o),a=t.noGrad&&e.noGrad;return new n(i,{backEdge:a?void 0:new hp(t,e,i,r,o),noGrad:a})},n.prototype.power_impl=function(t,e,r){if(!(e instanceof n)||!(t instanceof n))throw new Error("Can only take Variable tensor to power of Variable tensor");var o=t.value.power_impl(t.value,e.value,r),i=t.noGrad&&e.noGrad;return new n(o,{backEdge:i?void 0:new fp(t,e,o,r),noGrad:i})},n.prototype.gemm_impl=function(t,e,r,o,i,a){if(!(t instanceof n)||void 0!==a&&!(a instanceof n))throw new Error("Can only do gemm with variable tensors");var u=this.noGrad&&t.noGrad&&(void 0===a||a.noGrad);return new n(this.value.gemm_impl(t.value,e,r,o,i,void 0!==a?a.value:void 0),{backEdge:u?void 0:new dp(this,t,e,r,o,i,a),noGrad:u})},n.prototype.sum_impl=function(t,e){return new n(this.value.sum(t,e),{backEdge:this.noGrad?void 0:new vp(this,t,e),noGrad:this.noGrad})},n.prototype.sumSquare_impl=function(t,e){return new n(this.value.sumSquare(t,e),{backEdge:this.noGrad?void 0:new wp(this,t,e),noGrad:this.noGrad})},n.prototype.product_impl=function(t,e){var r=this.value.product(t,e);return new n(r,{backEdge:this.noGrad?void 0:new kp(this,r,t,e),noGrad:this.noGrad})},n.prototype.max_impl=function(t,n){throw new Error("Method not implemented.")},n.prototype.min_impl=function(t,n){throw new Error("Method not implemented.")},n.prototype.reduceMean_impl=function(t,e){return new n(this.value.reduceMean(t,e),{backEdge:this.noGrad?void 0:new gp(this,t,e),noGrad:this.noGrad})},n.prototype.reduceMeanSquare_impl=function(t,e){return new n(this.value.reduceMeanSquare(t,e),{backEdge:this.noGrad?void 0:new bp(this,t,e),noGrad:this.noGrad})},n.prototype.reduceLogSum_impl=function(t,e){return new n(this.value.reduceLogSum(t,e),{backEdge:this.noGrad?void 0:new Dp(this,t,e),noGrad:this.noGrad})},n.prototype.reduceLogSumExp_impl=function(t,e){return new n(this.value.reduceLogSumExp(t,e),{backEdge:this.noGrad?void 0:new Up(this,t,e),noGrad:this.noGrad})},n.prototype.conv_impl=function(t,e,r,o,i,a,u){if(!(t instanceof n)||void 0!==u&&!(u instanceof n))throw new Error("Can only do convolution with variable as kernel and bias");if("id"!==a)throw new Error("Activation has to be ID for convolution with variables");var s=this.noGrad&&t.noGrad&&(void 0===u||u.noGrad);return new n(this.value.conv(t.value,void 0!==u?u.value:void 0,e,r,o,i),{backEdge:s?void 0:new lp(this,t,i,o,e,r,u),noGrad:s})},n.prototype.convTranspose_impl=function(t,n,e,r,o){throw new Error("Method not implemented.")},n.prototype.pad_impl=function(t,e,r){return new n(this.value.pad(t,e,r),{backEdge:this.noGrad?void 0:new Op(this,t,e,r),noGrad:this.noGrad})},n.prototype.averagePool_impl=function(t,e,r,o){return new n(this.value.averagePool(t,e,r,o),{backEdge:this.noGrad?void 0:new xp(this,t,e,r,o),noGrad:this.noGrad})},n.prototype.transpose_impl=function(t){return new n(this.value.transpose(t),{backEdge:this.noGrad?void 0:new yp(this,t),noGrad:this.noGrad})},n.prototype.slice_impl=function(t,e,r,o){return new n(this.value.slice(t,e,r,o),{backEdge:this.noGrad?void 0:new _p(this,t,e,r,o),noGrad:this.noGrad})},n}(P),Lp=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fp=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(n){i(n)}}function u(t){try{s(r.throw(t))}catch(n){i(n)}}function s(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,u)}s((r=r.apply(t,n||[])).next())}))},Np=function(t,n){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(t,a)}catch(u){i=[6,u],r=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},qp=function(t){function n(n,e,r){var o=t.call(this)||this;r=void 0===r||r;var i=function(t,n,e){void 0===n&&(n=0),void 0===e&&(e=1);for(var r=[],o=0;o<t;o+=2){var i=$(),a=i[0],u=i[1];r.push(a*e+n),o<t-1&&r.push(u*e+n)}return r}(n*e,0,2/(n+e)),a=new H([n,e],i);if(o.weights=new Wp(a),r){var u=new Array(e).fill(0),s=new H([1,e],u);o.bias=new Wp(s)}return o}return Lp(n,t),n.prototype.forward=function(t){return Fp(this,void 0,void 0,(function(){return Np(this,(function(n){return[2,[t[0].gemm(this.weights,!1,!1,1,this.bias)]]}))}))},n}(Zr),Hp=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Lp(n,t),n.prototype.forward=function(t){return Fp(this,void 0,void 0,(function(){return Np(this,(function(n){return[2,[t[0].clip(0)]]}))}))},n}(Zr),Yp=function(t){function n(n){var e=t.call(this)||this;return e.modules=n,e}return Lp(n,t),n.prototype.forward=function(t){return Fp(this,void 0,void 0,(function(){var n,e,r,o;return Np(this,(function(i){switch(i.label){case 0:n=t,e=0,i.label=1;case 1:return e<this.modules.length?(r=n,[4,this.modules[e].forward(n)]):[3,4];case 2:if(n=i.sent(),"inference"===this.mode&&e>0)for(o=0;o<r.length;o++)r[o].delete();i.label=3;case 3:return e++,[3,1];case 4:return[2,n]}}))}))},n.prototype.getSubModules=function(){return t.prototype.getSubModules.call(this).concat(this.modules)},n}(Zr),Jp=(function(t){function n(n){void 0===n&&(n={});var e=t.call(this)||this;return e.modules=n,e}Lp(n,t),n.prototype.forward=function(t){return Fp(this,void 0,void 0,(function(){return Np(this,(function(t){throw new Error("Module dict does not support forward")}))}))},n.prototype.getSubModules=function(){var t=[];for(var n in this.modules)t.push(this.modules[n]);return t},n.prototype.get=function(t){return this.modules[t]},n.prototype.set=function(t,n){this.modules[t]=n}}(Zr),function(t){function n(n){void 0===n&&(n=[]);var e=t.call(this)||this;return e.modules=n,e}Lp(n,t),n.prototype.forward=function(t){return Fp(this,void 0,void 0,(function(){return Np(this,(function(t){throw new Error("Module list does not support forward")}))}))},n.prototype.getSubModules=function(){return this.modules},n.prototype.get=function(t){return this.modules[t]},n.prototype.set=function(t,n){this.modules[t]=n},n.prototype.push=function(t){this.modules.push(t)},n.prototype.pop=function(){return this.modules.pop()}}(Zr),e(125)),Kp=e(130),Qp=e(131),Zp=e(134),$p=e(133),tc=e(135),nc=e(132),ec=e(136),rc=e(129),oc=[{name:"Cosine",start:0,end:2*Math.PI,f:function(t){return Math.cos(t)}},{name:"Cubic Polynomial",start:-2*Math.PI,end:2*Math.PI,f:function(t){return 3*t*t*t-2*t*t}},{name:"Sine",start:0,end:2*Math.PI,f:function(t){return Math.sin(t)}}],ic=function(t){Object(y.a)(e,t);var n=Object(v.a)(e);function e(t){var r;return Object(f.a)(this,e),(r=n.call(this,t)).state={curves:[],losses:[],noise:.01,optimizer:"Adam",numSamples:100,numIterations:1e3,function:0},r}return Object(d.a)(e,[{key:"uniform",value:function(t,n,e){for(var r=[],o=0;o<e;o++){var i=o/e*(n-t)+t;r.push(i)}return r}},{key:"random",value:function(t,n,e){for(var r=[],o=0;o<e;o++){var i=Math.random()*(n-t)+t;r.push(i)}return r=r.sort()}},{key:"getFunctionValue",value:function(t){return oc[this.state.function].f(t)}},{key:"getFunctionRange",value:function(){return{start:oc[this.state.function].start,end:oc[this.state.function].end}}},{key:"generateYs",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;console.log(n);for(var e=[],r=0;r<t.length;r++){var o=this.getFunctionValue(t[r])+Math.random()*n-n/2;e.push(o)}return e}},{key:"doStuff",value:function(){var t=Object(h.a)(p.a.mark((function t(){var n,e,r,o,i,a,u,s,h,f,d,y,v,w,m,g,b,_,x,O,k,S,A,j,P,M,T,I,V,C,G,X,E,R,D,U,B,z,W,L,F;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState(Object(l.a)(Object(l.a)({},this.state),{},{curves:[],trainData:void 0})),n=new qp(1,128),e=new Hp,r=new qp(128,128),o=new Hp,i=new qp(128,64),a=new Hp,u=new qp(64,1),s="GPU",h=new Yp([n,e,r,o,i,a,u]),t.next=12,h.toBackend(s);case 12:return f="Adam"===this.state.optimizer?new Ws(h):new Fs(h,.5),d=this.getFunctionRange(),y=d.start,v=d.end,w=this.state.numSamples,m=this.uniform(y,v,w),g=this.generateYs(m),b=this.state.curves||[],this.setState(Object(l.a)(Object(l.a)({},this.state),{},{curves:[].concat(Object(c.a)(b),[{name:"Ground truth",xs:m,ys:g}])})),_=this.random(y,v,w),x=this.generateYs(_,this.state.noise),5,O=this.random(y,v,w/5),k=this.generateYs(O,this.state.noise),this.setState(Object(l.a)(Object(l.a)({},this.state),{},{trainData:{name:"Train Data",xs:_,ys:x},valData:{name:"Validation Data",xs:O,ys:k}})),S=Wp.create([w,1],_,s,{noGrad:!0}),A=Wp.create([w,1],x,s,{noGrad:!0}),j=Wp.create([w/5,1],O,s,{noGrad:!0}),P=Wp.create([w/5,1],k,s,{noGrad:!0}),t.next=31,new Promise((function(t,n){setTimeout((function(){t(0)}),1e3)}));case 31:M=Date.now(),T=[],I=[],V=[],C=20,G=0;case 37:if(!(G<this.state.numIterations)){t.next=71;break}return t.next=40,h.forward([S]);case 40:if(X=t.sent[0],E=X.subtract(A),(R=E.reduceMeanSquare()).backward(),f.step(),G%C!==0){t.next=51;break}return t.next=48,R.value.getValues();case 48:D=t.sent[0],I.push(D),T.push(G);case 51:if(R.delete(),f.zeroGrads(),G%C!==0){t.next=68;break}return t.next=56,h.forward([j]);case 56:return U=t.sent[0],B=U.subtract(P),z=B.reduceMeanSquare(),t.next=61,z.value.getValues();case 61:return W=t.sent[0],V.push(W),z.delete(),f.zeroGrads(),this.setState(Object(l.a)(Object(l.a)({},this.state),{},{trainProgress:G/this.state.numIterations*100})),t.next=68,new Promise((function(t,n){setTimeout((function(){t(0)}),50)}));case 68:G++,t.next=37;break;case 71:return L=Date.now(),console.log("Done, took ".concat(L-M,"ms")),this.setState(Object(l.a)(Object(l.a)({},this.state),{},{trainProgress:void 0,losses:[{name:"Train loss",xs:T,ys:I},{name:"Validation loss",xs:T,ys:V}]})),t.next=76,h.forward([S]);case 76:return t.next=78,t.sent[0].getValues();case 78:F=t.sent,this.setState(Object(l.a)(Object(l.a)({},this.state),{},{curves:[].concat(Object(c.a)(this.state.curves),[{name:"Predicition",xs:m,ys:Array.from(F)}])}));case 80:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this;return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)("h1",{children:"Training visualization"}),this.renderSettings(),Object(r.jsx)(Jp.a,{color:"primary",onClick:function(){return t.doStuff()},children:"Run training"}),Object(r.jsx)("br",{}),void 0!==this.state.trainProgress?Object(r.jsx)(rc.a,{value:this.state.trainProgress,variant:"determinate"}):Object(r.jsx)(r.Fragment,{}),Object(r.jsx)(Kp.a,{item:!0,xs:12,children:Object(r.jsxs)(Kp.a,{container:!0,justify:"center",spacing:2,children:[Object(r.jsx)(Kp.a,{item:!0,children:this.renderValuePlot()}),Object(r.jsx)(Kp.a,{item:!0,children:this.renderLossPlot()})]})})]})}},{key:"renderValuePlot",value:function(){var t=this.state.curves.map((function(t){return{x:t.xs,y:t.ys,type:"scatter",mode:"lines",name:t.name}}));return void 0!==this.state.trainData&&t.push({x:this.state.trainData.xs,y:this.state.trainData.ys,type:"scatter",mode:"markers",name:"Training data"}),void 0!==this.state.valData&&t.push({x:this.state.valData.xs,y:this.state.valData.ys,type:"scatter",mode:"markers",name:"Validation data"}),Object(r.jsx)(m.a,{data:t,layout:{width:600,height:400,title:"Ground truth and learned curve"},config:{showTips:!1,displaylogo:!1,modeBarButtons:!1}})}},{key:"renderLossPlot",value:function(){var t=this.state.losses.map((function(t){return{x:t.xs,y:t.ys,type:"scatter",mode:"lines",name:t.name}}));return Object(r.jsx)(m.a,{data:t,layout:{width:600,height:400,title:"Losses",xaxis:{autorange:!0},yaxis:{type:"log",autorange:!0}},config:{showTips:!1,displaylogo:!1,modeBarButtons:!1}})}},{key:"renderSettings",value:function(){var t=this,n=this.state.noise;return Object(r.jsxs)(Kp.a,{container:!0,spacing:2,children:[Object(r.jsx)(Kp.a,{item:!0,xs:!0,children:Object(r.jsxs)(Qp.a,{children:[Object(r.jsx)(Zp.a,{id:"label-function",children:"Function"}),Object(r.jsx)($p.a,{labelId:"label-function",id:"select-function",value:this.state.function,onChange:function(n,e){return t.setState(Object(l.a)(Object(l.a)({},t.state),{},{function:n.target.value}))},children:oc.map((function(t,n){return Object(r.jsx)(tc.a,{value:n,children:t.name},n)}))})]})}),Object(r.jsxs)(Kp.a,{item:!0,xs:!0,children:[Object(r.jsx)(nc.a,{id:"slide-noise",gutterBottom:!0,children:"Noise in training data"}),Object(r.jsx)(ec.a,{value:n,onChange:function(n,e){return t.setState(Object(l.a)(Object(l.a)({},t.state),{},{noise:e}))},"aria-labelledby":"slider-noise",min:0,max:.4,step:.01,marks:!0,valueLabelDisplay:"auto"})]}),Object(r.jsxs)(Kp.a,{item:!0,xs:!0,children:[Object(r.jsx)(nc.a,{id:"slide-n-samples",gutterBottom:!0,children:"Number of samples"}),Object(r.jsx)(ec.a,{value:this.state.numSamples,onChange:function(n,e){return t.setState(Object(l.a)(Object(l.a)({},t.state),{},{numSamples:e}))},"aria-labelledby":"slider-n-samples",min:50,max:400,step:50,marks:!0,valueLabelDisplay:"auto"})]}),Object(r.jsxs)(Kp.a,{item:!0,xs:!0,children:[Object(r.jsx)(nc.a,{id:"slide-n-iterations",gutterBottom:!0,children:"Number of iterations for training"}),Object(r.jsx)(ec.a,{value:this.state.numIterations,onChange:function(n,e){return t.setState(Object(l.a)(Object(l.a)({},t.state),{},{numIterations:e}))},"aria-labelledby":"slider-n-samples",min:200,max:2e3,step:200,marks:!0,valueLabelDisplay:"auto"})]}),Object(r.jsx)(Kp.a,{item:!0,xs:!0,children:Object(r.jsxs)(Qp.a,{children:[Object(r.jsx)(Zp.a,{id:"label-optimizer",children:"Optimizer"}),Object(r.jsxs)($p.a,{labelId:"label-optimizer",id:"demo-simple-select-helper",value:this.state.optimizer,onChange:function(n,e){return t.setState(Object(l.a)(Object(l.a)({},t.state),{},{optimizer:n.target.value}))},children:[Object(r.jsx)(tc.a,{value:"Adam",children:"Adam"}),Object(r.jsx)(tc.a,{value:"SGD",children:"SGD"})]})]})})]})}}]),e}(i.a.Component),ac=function(t){t&&t instanceof Function&&e.e(4).then(e.bind(null,141)).then((function(n){var e=n.getCLS,r=n.getFID,o=n.getFCP,i=n.getLCP,a=n.getTTFB;e(t),r(t),o(t),i(t),a(t)}))};u.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(ic,{})}),document.getElementById("root")),ac()}},[[95,1,2]]]);
//# sourceMappingURL=main.5e134236.chunk.js.map